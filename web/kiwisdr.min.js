

/* web/extensions/ext.min.js (web/extensions/ext.js = Fri Jun  9 09:39:28 2023) */
var extint={ws:null,extname:null,isAdmin_cb:null,srate:0,nom_srate:0,param:null,override_pb:false,displayed:false,help_displayed:false,current_ext_name:null,using_data_container:false,hide_func:null,default_w:525,default_h:300,prev_mode:null,mode_prior_to_dx_click:null,seq:0,scanning:0,web_socket_fragmentation:8192,send_hiwat:0,send_hiwat_msg:null,no_lockout:['noise_blank','noise_filter','ant_switch','iframe','colormap','devl','prefs'],excl_devl:['devl','s4285','prefs'],OPT_NOLOCAL:1,};var devl={p0:0,p1:0,p2:0,p3:0,p4:0,p5:0,p6:0,p7:0};function ext_switch_to_client(ext_name,first_time,recv_func){recv_websocket(extint.ws,recv_func);ext_send('SET ext_switch_to_client='+ext_name+' first_time='+(first_time?1:0)+' rx_chan='+rx_chan);w3_call(ext_name+'_focus');}
function ext_send(msg,ws){if(isNoArg(ws))ws=extint.ws;var len=msg.length;if(len>extint.send_hiwat){extint.send_hiwat_msg=msg;extint.send_hiwat=len;}
try{ws.send(msg);return 0;}catch(ex){console.log("CATCH ext_send('"+s+"') ex="+ex);kiwi_trace();}}
function ext_send_cfg(cfg,s){var ws=extint.ws;var len=s.length;var tr='='+len;var _send=function(seq,suffix,s){return('SET '+cfg.cmd+suffix+seq+' '+s);};var transaction_seq=cfg.seq;cfg.seq++;w3_do_when_cond(function(seq){var ba=ws.bufferedAmount?('['+ws.bufferedAmount+']'):'0';tr=w3_sb(tr,ba);if(ws.bufferedAmount!=0)return false;if(len>extint.web_socket_fragmentation){cfg.lock=1;ws.send(_send(seq,'_frag=',s.slice(0,extint.web_socket_fragmentation)));s=s.slice(extint.web_socket_fragmentation);len=s.length;tr=w3_sb(tr,'W'+extint.web_socket_fragmentation);return false;}else{ws.send(_send(seq,'=',s.slice(0,extint.web_socket_fragmentation)));cfg.lock=0;if(kiwi.log_cfg_save_seq)
kiwi_debug(w3_sb('save_config:',seq+'-'+cfg.name+tr,'w'+len,'DONE'),true);len=0;return true;}},null,transaction_seq,kiwi.test_cfg_save_seq?1000:50);}
function ext_send_after_cfg_save(msg,cfg_s){cfg_s=cfg_s||'cfg';var kiwi_cfg=kiwi[cfg_s];w3_do_when_cond(function(){if(kiwi.log_cfg_save_seq)
kiwi_debug('ext_send_after_cfg_save lock='+kiwi_cfg.lock+' msg=<'+msg+'>');return(kiwi_cfg.lock==0);},function(msg){ext_send(msg);},msg,100);}
function ext_panel_show(controls_html,data_html,show_func,hide_func){extint_panel_show(controls_html,data_html,show_func,hide_func);}
function ext_set_data_height(height){var el=w3_el('id-ext-data-container');if(!height){if(el)el.style.height='';}else{if(el)el.style.height=px(height);}}
function ext_set_controls_width_height(width,height){panel_set_width_height('ext-controls',width,height);}
var EXT_SAVE=true;var EXT_NO_SAVE=false;function ext_get_cfg_param(path,init_val,save,update_path_var){var cur_val;var cfg_path=w3_add_toplevel(path);try{cur_val=getVarFromString(cfg_path);}catch(ex){cur_val=null;}
if(isNoArg(cur_val)&&init_val!=undefined){cur_val=init_val;setVarFromString(cfg_path,cur_val);if((save==undefined&&isAdmin())||save==EXT_SAVE)
cfg_save_json('ext_get_cfg_param',cfg_path);}
if(update_path_var){if(path.startsWith('cfg.')||path.startsWith('adm.')){console.log('ext_get_cfg_param: update_path_var CAUTION: NOT SETTING path='+path+' cur_val='+cur_val);}else{setVarFromString(path,cur_val);}}
return cur_val;}
function ext_get_cfg_param_string(path,init_val,save){var s=ext_get_cfg_param(path,init_val,save);if(isNoArg(s))s='';return kiwi_decodeURIComponent(ext_get_cfg_param_string+':'+path,s);}
function ext_set_cfg_param(path,val,save){path=w3_add_toplevel(path);setVarFromString(path,val);if(isArg(save)&&save==EXT_SAVE){cfg_save_json('ext_set_cfg_param',path);}}
function ext_get_freq_range(){var offset=kiwi.freq_offset_kHz;return{lo_kHz:cfg.sdr_hu_lo_kHz+offset,hi_kHz:cfg.sdr_hu_hi_kHz+offset,offset_kHz:offset};}
var ext_zoom={TO_BAND:0,IN:1,OUT:-1,ABS:2,WHEEL:3,CUR:4,NOM_IN:8,MAX_IN:9,MAX_OUT:-9};var extint_ext_is_tuning=false;function ext_tune(freq_dial_kHz,mode,zoom,zlevel,low_cut,high_cut,opt){var pb_specified=(low_cut!=undefined&&high_cut!=undefined);extint_ext_is_tuning=true;freq_dial_kHz=freq_dial_kHz||(freq_displayed_Hz / 1000);freqmode_set_dsp_kHz(freq_dial_kHz,mode,opt);if(pb_specified)ext_set_passband(low_cut,high_cut);if(isArg(zoom)){if(zoom==ext_zoom.CUR)
zoom_step(ext_zoom.ABS,zoom_level);else
zoom_step(zoom,zlevel);}else{zoom_step(ext_zoom.TO_BAND);}
extint_ext_is_tuning=false;}
function ext_get_freq_Hz(){return{displayed:freq_displayed_Hz,carrier:freq_car_Hz,passband_center:freq_passband_center()};}
function ext_get_freq(){return freq_displayed_Hz;}
function ext_get_freq_kHz(){return(freq_displayed_Hz/1e3).toFixed(2);}
function ext_get_carrier_freq(){return freq_car_Hz;}
function ext_get_passband_center_freq(){return freq_passband_center();}
function ext_save_setup(){var mode=isArg(extint.mode_prior_to_dx_click)?extint.mode_prior_to_dx_click:cur_mode;console.log('ext_save_setup mode='+mode+' mode_prior_to_dx_click='+extint.mode_prior_to_dx_click+' cur_mode='+cur_mode);extint.mode_prior_to_dx_click=null;return{mode:mode,zoom:zoom_level};}
function ext_restore_setup(s){console.log('ext_restore_setup mode='+s.mode+' zoom='+s.zoom);ext_set_mode(s.mode);ext_set_zoom(ext_zoom.ABS,s.zoom);}
function ext_get_mode(){return cur_mode;}
function ext_mode(mode){var fail=false;if(isArg(mode)){mode=mode.toLowerCase();var str=mode.substr(0,2);if(str=='qa')str='sa';if(str=='nn')str='nb';}else{str='';fail=true;}
var o={fail:fail,str:str};o.AM=fail?false:(str=='am');o.LSB=fail?false:(str=='ls');o.USB=fail?false:(str=='us');o.CW=fail?false:(str=='cw');o.IQ=fail?false:(str=='iq');o.NBFM=fail?false:(str=='nb');o.SAx=fail?false:(str=='sa');o.DRM=fail?false:(str=='dr');o.AM=fail?false:(str=='am');o.LSB_SAL=fail?false:(o.LSB||mode=='sal');o.SSB=fail?false:(o.USB||o.LSB);o.SSB_CW=fail?false:(o.SSB||o.CW);o.STEREO=fail?false:(o.IQ||o.DRM||mode=='sas'||mode=='qam');o.AM_SAx_IQ_DRM=fail?false:(o.AM||o.SAx||o.SSB||o.DRM);return o;}
function ext_is_IQ_or_stereo_mode(mode){return ext_mode(mode).STEREO;}
function ext_is_IQ_or_stereo_curmode(){return ext_is_IQ_or_stereo_mode(cur_mode);}
function ext_get_prev_mode(){return extint.prev_mode;}
function ext_set_mode(mode,freq,opt){if(isUndefined(mode))return;var new_drm=(mode=='drm');if(new_drm)
extint.prev_mode=cur_mode;demodulator_analog_replace(mode,freq);var open_ext=w3_opt(opt,'open_ext',false);var no_drm_proc=w3_opt(opt,'no_drm_proc',false);var drm_active=(typeof(drm)!='undefined'&&drm.active);if(!no_drm_proc){if(new_drm&&open_ext){if(drm_active){toggle_panel("ext-controls",1);}else{extint_open('drm');}}else
if(!new_drm&&drm_active){extint_panel_hide();demodulator_analog_replace(mode,freq);}}}
function ext_get_passband(){var demod=demodulators[0];return{low:demod.low_cut,high:demod.high_cut};}
function ext_set_passband(low_cut,high_cut,set_mode_pb,freq_dial_Hz){var demod=demodulators[0];var filter=demod.filter;if(low_cut==undefined)low_cut=demod.low_cut;if(high_cut==undefined)high_cut=demod.high_cut;var bw=Math.abs(high_cut-low_cut);low_cut=(low_cut<filter.low_cut_limit)?filter.low_cut_limit:low_cut;high_cut=(high_cut>filter.high_cut_limit)?filter.high_cut_limit:high_cut;var bw=Math.abs(high_cut-low_cut);var okay=false;if(bw>=filter.min_passband&&low_cut<high_cut){demod.low_cut=low_cut;demod.high_cut=high_cut;okay=true;}
if(isArg(set_mode_pb)&&set_mode_pb&&okay){owrx.last_lo[cur_mode]=low_cut;owrx.last_hi[cur_mode]=high_cut;}
if(freq_dial_Hz!=undefined&&freq_dial_Hz!=null){freq_dial_Hz*=1000;freq_car_Hz=freq_dsp_to_car(freq_dial_Hz);}
extint_ext_is_tuning=true;demodulator_set_offset_frequency(owrx.FSET_EXT_SET_PB,freq_car_Hz-center_freq);extint_ext_is_tuning=false;}
function ext_get_tuning(){return{low:demod.low_cut,high:demod.high_cut,mode:cur_mode,freq_dial_kHz:freq_displayed_Hz/1000};}
function ext_get_zoom(){return zoom_level;}
function ext_set_zoom(zoom_mode,zoom_level){zoom_step(zoom_mode,zoom_level);}
function ext_get_audio_comp(){return btn_compression?true:false;}
function ext_set_audio_comp(comp){toggle_or_set_compression(toggle_e.SET,comp?1:0);}
function ext_set_scanning(scanning){extint.scanning=scanning?1:0;}
function ext_agc_delay(set_val){var prev_val=w3_el('input-decay').value;if(isDefined(set_val))setDecay_cb('',set_val,1);return prev_val;}
extint.optbars={'optbar-wf':0,'optbar-audio':1,'optbar-agc':2,'optbar-users':3,'optbar-status':4,'optbar-off':5};function ext_get_optbar(){var optbar=readCookie('last_optbar');return optbar;}
function ext_set_optbar(optbar){if(extint.optbars[optbar]){writeCookie('last_optbar',optbar);w3_el('id-nav-'+optbar).click();}}
function ext_hasCredential(conn_type,cb,cb_param,ws){if(conn_type=='mfg')conn_type='admin';var pwd;if(conn_type=='admin'){deleteCookie('admin');deleteCookie('admin-pwd');pwd='';}else{pwd=readCookie(conn_type);pwd=pwd?decodeURIComponent(pwd):'';}
extint_pwd_cb=cb;extint_pwd_cb_param=cb_param;ext_valpwd(conn_type,pwd,ws);}
function ext_valpwd(conn_type,pwd,ws){pwd=encodeURIComponent(pwd);if(conn_type!='admin')
writeCookie(conn_type,pwd);extint_conn_type=conn_type;pwd=(pwd!='')?pwd:'#';var ipl=null;var iplimit_cookie=readCookie('iplimit');var iplimit_pwd=kiwi_url_param(['pwd','password'],'','');if(iplimit_pwd!=''){ipl=iplimit_pwd;}else
if(iplimit_cookie&&iplimit_cookie!=''){ipl=iplimit_cookie;}
ipl=ipl?(' ipl='+ipl):'';if(kiwi_url_param(['p','prot','protected'],'true',null)!=null&&conn_type!='admin')
conn_type='prot';var options=0;if(kiwi_url_param('nolocal'))options|=extint.OPT_NOLOCAL;if(options!=0)ext_send('SET options='+options);ext_send('SET auth t='+conn_type+' p='+pwd+ipl,ws);}
function ext_isAdmin(cb){extint.isAdmin_cb=cb;ext_send('SET is_admin');}
var extint_authkey_cb;function ext_get_authkey(func){ext_send('SET get_authkey');extint_authkey_cb=func;}
var extint_adc_clock_Hz=0;function ext_adc_clock_Hz(){return extint_adc_clock_Hz;}
var extint_adc_gps_clock_corr=0;function ext_adc_gps_clock_corr(){return extint_adc_gps_clock_corr;}
var extint_adc_clock_nom_Hz=0;function ext_adc_clock_nom_Hz(){return extint_adc_clock_nom_Hz;}
function ext_sample_rate(){return extint.srate;}
function ext_nom_sample_rate(){return extint.nom_srate;}
var extint_audio_data_cb=null;function ext_register_audio_data_cb(func){extint_audio_data_cb=func;}
function ext_unregister_audio_data_cb(){extint_audio_data_cb=null;}
function ext_param(){var p=extint.param;extint.param=null;return p;}
function ext_panel_set_name(name){extint.current_ext_name=name;}
function ext_get_name(){return extint.current_ext_name;}
function ext_mobile_info(last){var w=window.innerWidth;var h=window.innerHeight;var rv={width:w,height:h};var isPortrait;if(owrx.popup_keyboard_active){isPortrait=last?last.isPortrait:1;}else{isPortrait=(w<h||mobile_laptop_test)?1:0;}
rv.orient_unchanged=(last&&last.isPortrait==isPortrait)?1:0;rv.isPortrait=isPortrait?1:0;rv.iPad=(isPortrait&&w<=768)?1:0;rv.small=(isPortrait&&w<768)?1:0;rv.narrow=(isPortrait&&w<=600)?1:0;return rv;}
function ext_get_menus_cb(ctx,freqs,retry_cb,done_cb,done_cb_param){var fault=false;if(!freqs){console.log('ext_get_menus_cb: freqs='+freqs);fault=true;}else
if(freqs.AJAX_error&&freqs.AJAX_error=='timeout'){console.log('ext_get_menus_cb: TIMEOUT');ctx.using_default=true;fault=true;}else
if(freqs.AJAX_error&&freqs.AJAX_error=='status'){console.log('ext_get_menus_cb: status='+freqs.status);ctx.using_default=true;fault=true;}else
if(!isObject(freqs)){console.log('ext_get_menus_cb: not array');fault=true;}else
if(isDefined(freqs.AJAX_error)){console.log('ext_get_menus_cb: AJAX_error');fault=true;}
var url;if(fault){if(ctx.double_fault){console.log('ext_get_menus_cb: default freq list fetch FAILED');console.log(freqs);return;}
console.log(freqs);url=ctx.int_url;console.log('ext_get_menus_cb: using default freq list '+url);ctx.using_default=true;ctx.double_fault=true;kiwi_ajax(url,retry_cb,0,10000);return;}else{url=ctx.ext_url;}
console.log('ext_get_menus_cb: from '+url);if(dbgUs)console.log(freqs);w3_call(done_cb,done_cb_param);}
function ext_render_menus(ctx,ext_name,ctx_name){var new_menu=function(i,o,menu_s){ctx.n_menu++;ctx.menus[i]=o;ctx.menu_s[i]=menu_s;var s=w3_div('id-'+menu_s+' w3-margin-between-24',w3_select_hier(ctx.sfmt,menu_s,'select',ctx_name+'.menu'+i,-1,o,ext_name+'_pre_select_cb'));return s;};if(isUndefined(ctx_name))ctx_name=ext_name;var s='';ctx.n_menu=0;w3_obj_enum(ctx.freqs,function(menu_s,i,o2){s+=new_menu(i,o2,menu_s);});w3_innerHTML('id-'+ext_name+'-menus',s);console.log('ext_render_menus n_menu='+ctx.n_menu);}
function ext_panel_init(){w3_el('id-panels-container').innerHTML+='<div id="id-ext-controls" class="class-panel" data-panel-name="ext-controls" data-panel-pos="bottom-left" data-panel-order="0" '+'data-panel-size="'+extint.default_w+','+extint.default_h+'"></div>';var el=w3_el('id-ext-data-container');el=w3_el('id-ext-controls');el.innerHTML=w3_div('id-ext-controls-container w3-relative|width:100%;height:100%;')+
w3_div('id-ext-controls-vis class-vis')+
w3_div('id-ext-controls-help cl-ext-help',w3_button('id-ext-controls-help-btn w3-green w3-small w3-padding-small w3-disabled||onclick="extint_help_click()"','help'));w3_el('id-kiwi-body').addEventListener('keyup',function(evt){if(evt.key=='Escape'&&extint.displayed&&!confirmation.displayed){if(w3_call(extint.current_ext_name+'_escape_key_cb')!=true){console.log('EXT ESC: no _escape_key_cb() routine, so doing id-ext-controls-close.click()');w3_el('id-ext-controls-close').click();}}},true);}
function ext_show_spectrum(which){toggle_or_set_spec(toggle_e.SET|toggle_e.NO_CLOSE_EXT,which);}
function ext_hide_spectrum(){toggle_or_set_spec(toggle_e.SET|toggle_e.NO_CLOSE_EXT,spec.NONE);}
function extint_panel_show(controls_html,data_html,show_func,hide_func,show_help_button){extint.using_data_container=(data_html?true:false);if(extint.using_data_container){toggle_or_set_spec(toggle_e.SET,spec.NONE);w3_hide('id-top-container');w3_show_block(w3_innerHTML('id-ext-data-container',data_html));}else{w3_hide('id-ext-data-container');if(spec.source==spec.NONE)
w3_show_block('id-top-container');}
if(extint.help_displayed==true){confirmation_panel_close();extint.help_displayed=false;}
var el=w3_el('id-ext-controls-close');el.onclick=function(){toggle_panel("ext-controls");extint_panel_hide();};ext_set_data_height();w3_el('id-ext-controls').style.zIndex=150;w3_create_attribute('id-ext-controls-close-img','src','icons/close.24.png');var el=w3_el('id-ext-controls-container');el.innerHTML=controls_html;if(show_func)show_func();extint.hide_func=hide_func;el=w3_el('id-ext-controls');el.style.zIndex=150;w3_visible(el,true);el.panelShown=1;toggle_or_set_hide_panels(0);w3_el('id-confirmation-container').style.height='';show_help_button=isDefined(show_help_button)?show_help_button:w3_call(extint.current_ext_name+'_help',false);w3_set_props('id-ext-controls-help-btn','w3-disabled',isUndefined(show_help_button)||show_help_button==false);w3_show_hide('id-ext-controls-help-btn',show_help_button!='off');extint.displayed=true;}
function ext_panel_displayed(ext_name){return(extint.displayed&&(ext_name?(ext_name==extint.current_ext_name):true));}
function ext_panel_redisplay(s){w3_innerHTML('id-ext-controls-container',s);}
function extint_panel_hide(skip_calling_hide_spec){if(extint.using_data_container){w3_hide('id-ext-data-container');if(skip_calling_hide_spec!=true)
ext_hide_spectrum();w3_show_block('id-top-container');extint.using_data_container=false;if(extint.help_displayed==true){confirmation_panel_close();extint.help_displayed=false;}}
w3_visible('id-ext-controls',false);extint_blur_prev(1);w3_call(extint.hide_func);w3_select_value('id-select-ext',-1);resize_waterfall_container(true);extint.displayed=false;freqset_select();}
function extint_help_click_now(){extint.help_displayed=w3_call(extint.current_ext_name+'_help',true);}
function extint_help_click(delay){if(w3_contains('id-ext-controls-help-btn','w3-disabled'))return;console.log(extint.current_ext_name+'_help_click CLICKED');if(delay)
setTimeout(function(){extint_help_click_now();},2000);else
extint_help_click_now();}
function extint_environment_changed(changed){setTimeout(function(){if(extint.current_ext_name){w3_call(extint.current_ext_name+'_environment_changed',changed);}
if(changed.freq||changed.mode||changed.zoom||changed.waterfall_pan||changed.resize)
mouse_freq_remove();w3_call('injection_environment_changed',changed);},100);}
var extint_pwd_cb=null;var extint_pwd_cb_param=null;var extint_conn_type=null;function extint_valpwd_cb(badp){if(extint_pwd_cb)extint_pwd_cb(badp,extint_pwd_cb_param);}
function extint_open_ws_cb(){ext_hasCredential('kiwi',null,null);setTimeout(function(){setInterval(function(){ext_send("SET keepalive")},5000)},5000);}
function extint_connect_server(){extint.ws=open_websocket('EXT',extint_open_ws_cb,null,extint_msg_cb);return extint.ws;}
function extint_msg_cb(param,ws){switch(param[0]){case"keepalive":break;case"ext_client_init":console.log('ext_client_init is_locked='+ +param[1]);extint_focus(+param[1]);break;default:return false;}
return true;}
function extint_blur_prev(restore){if(extint.current_ext_name!=null){w3_call(extint.current_ext_name+'_blur');recv_websocket(extint.ws,null);if(restore)ext_set_controls_width_height();extint.current_ext_name=null;time_display_setup('id-topbar-right-container');}
if(extint.ws)
ext_send('SET ext_blur='+rx_chan);}
function extint_focus(is_locked){var ext=extint.current_ext_name;console.log('extint_focus: loading '+ext+'.js');if(is_locked&&!extint.no_lockout.includes(ext)){var s=w3_text('w3-medium w3-text-css-yellow','Cannot use extensions while <br> another channel is in DRM mode.');extint_panel_show(s,null,null,null,'off');ext_set_controls_width_height(300,75);return;}
kiwi_load_js_dir('extensions/'+ext+'/'+ext,['.js','.css'],function(){console.log('extint_focus: calling '+ext+'_main()');ext_set_controls_width_height();w3_call(ext+'_main');if(isNonEmptyArray(shortcut.keys))
setTimeout(keyboard_shortcut_url_keys,3000);},function(loaded){console.log('extint_focus: '+ext+' loaded='+loaded);if(loaded){var s='loading extension...';extint_panel_show(s,null,null,null,'off');ext_set_controls_width_height(325,45);if(kiwi.is_locked)
console.log('==== IS_LOCKED =================================================');}});}
var extint_first_ext_load=true;function extint_select(value){extint_blur_prev(0);w3_call(extint.hide_func);freqset_select();value=+value;var el=w3_el('id-select-ext');if(!el){setTimeout(extint_select,1000,value);return;}
w3_select_value(el,value);var menu=el.childNodes;var name=menu[value+1].innerHTML.toLowerCase();console.log('extint_select val='+value+' name='+name);var idx;extint_names_enum(function(i,value,id,id_en){if(name.startsWith(id.toLowerCase())){idx=i;}});extint.current_ext_name=extint_names[idx];if(extint_first_ext_load){extint.ws=extint_connect_server();extint_first_ext_load=false;}else{ext_send('SET ext_is_locked_status');}}
var extint_names;function extint_list_json(param){extint_names=kiwi_JSON_parse('extint_list_json',decodeURIComponent(param));}
function extint_names_enum(func){var i,value;for(i=value=0;i<extint_names.length;i++){var id=extint_names[i];if(!dbgUs&&extint.excl_devl.includes(id))continue;if(id=='sig_gen'&&(rx_chan!=0||rx_chans>=14))continue;if(id=='wspr')id='WSPR';var id_en=id.toLowerCase();if(id_en=='cw_decoder')id_en='cw';if(id_en=='drm')id_en='DRM';if(id_en=='s_meter')id_en='S_meter';if(id_en=='wspr')id_en='WSPR';func(i,value,id,id_en);value++;}}
function extint_select_build_menu(){var s='';if(extint_names&&isArray(extint_names)){extint_names_enum(function(i,value,id,id_en){var enable=ext_get_cfg_param(id_en+'.enable');if(enable==null||kiwi.is_local[rx_chan])enable=true;if(id=='DRM')kiwi.DRM_enable=enable;if(id=='NAVTEX')id='NAVTEX/DSC';else
if(id=='FT8')id='FT8/FT4';else;s+='<option value='+dq(value)+' kiwi_idx='+dq(i)+' '+(enable?'':'disabled')+'>'+id+'</option>';});}
return s;}
function extint_open(name,delay){name=name.toLowerCase();if(name=='dsc')name='navtex';else
if(name=='ft4')name='ft8';else;var found=0;extint_names_enum(function(i,value,id,id_en){var enable=ext_get_cfg_param(id_en+'.enable');if(enable==null||kiwi.is_local[rx_chan])enable=true;if(!found&&enable&&id.toLowerCase().includes(name)){if(delay){setTimeout(function(){extint_select(value);},delay);}else{extint_select(value);}
found=1;}});}
function extint_audio_data(data,samps){if(isFunction(extint_audio_data_cb))
extint_audio_data_cb(data,samps);}





/* web/kiwi/kiwi.min.js (web/kiwi/kiwi.js = Sat Jun 10 13:15:34 2023) */
var kiwi={d:{},PLATFORM_BBG_BBB:0,PLATFORM_BB_AI:1,PLATFORM_BB_AI64:2,PLATFORM_RPI:3,platform:-1,cfg:{seq:0,name:'cfg',cmd:'save_cfg',lock:0,timeout:null},dxcfg:{seq:0,name:'dxcfg',cmd:'save_dxcfg',lock:0,timeout:null},adm:{seq:0,name:'adm',cmd:'save_adm',lock:0,timeout:null},test_cfg_save_seq:false,log_cfg_save_seq:false,BADP_OK:0,BADP_TRY_AGAIN:1,BADP_STILL_DETERMINING_LOCAL_IP:2,BADP_NOT_ALLOWED_FROM_IP:3,BADP_NO_ADMIN_PWD_SET:4,BADP_NO_MULTIPLE_CONNS:5,BADP_DATABASE_UPDATE_IN_PROGRESS:6,BADP_ADMIN_CONN_ALREADY_OPEN:7,isOffset:false,is_local:[],loaded_files:{},WSPR_rgrid:'',GPS_fixes:0,wf_fps:0,is_multi_core:0,log2_seq:0,w3_text:'w3-text-bottom w3-text-css-orange',inactivity_panel:false,no_admin_conns_pend:0,foff_error_pend:0,notify_seq:0,ident_min:16,volume:50,volume_f:1e-6,muted:1,unmuted_color:'lime',pan:0,queued:0,modes_lc:['am','amn','usb','lsb','cw','cwn','nbfm','iq','drm','usn','lsn','sam','sau','sal','sas','qam','nnfm'],modes_uc:[],modes_idx:{},mode_menu:['AM','AMN','USB','USN','LSB','LSN','CW','CWN','NBFM','NNFM','IQ','DRM','SAM','SAU','SAL','SAS','QAM'],ITU_s:['any','R1: Europe, Africa','R2: North & South America','R3: Asia / Pacific','show on band scale only','show on band menu only'],ITU_ANY:0,BAND_SCALE_ONLY:4,BAND_MENU_ONLY:5,RX4_WF4:0,RX8_WF2:1,RX3_WF3:2,RX14_WF0:3,cmap_s:['Kiwi','CSDR','grey','linear','turbo','SdrDx','cust1','cust2','cust3','cust4'],cmap_e:{kiwi:0,CuteSDR:1,greyscale:2,linear:3,turbo:4,SdrDx:5,custom_1:6,custom_2:7,custom_3:8,custom_4:9},aper_s:['man','auto'],aper_e:{man:0,auto:1},esc_lt:'\x11',esc_gt:'\x12',xdLocalStorage_ready:false,prefs_import_ch:-1,ADC_CLK_CORR_DISABLED:0,ADC_CLK_CORR_CONTINUOUS:1,pre_samps:0,pre_size:0,pre_last:0,pre_buf:null,pre_data:null,pre_off:0,pre_captured:false,pre_wrapped:false,pre_ping_pong:0,bands:null,bands_community:null,_ver_:1.578,_last_:null};kiwi.modes_lc.forEach(function(e,i){kiwi.modes_uc.push(e.toUpperCase());kiwi.modes_idx[e]=i});var WATERFALL_CALIBRATION_DEFAULT=-13;var SMETER_CALIBRATION_DEFAULT=-13;var rx_chans,wf_chans,wf_chans_real,max_camp;var rx_chan=null;var try_again="";var conn_type;var seriousError=false;var timestamp;var dbgUs=false;var dbgUsFirst=true;var gmap;function kiwi_bodyonload(error){if(error!=''){kiwi_serious_error(error);}
else
if(kiwi_isSmartTV()=='LG'&&kiwi_isChrome()<87){var s='Browser: '+navigator.userAgent+'<br>Sorry, KiwiSDR requires SmartTV Chrome version >= 87';kiwi_serious_error(s);}else{if(initCookie('ident',"").startsWith('ZL/KF6VO'))dbgUs=true;conn_type=w3_el('id-kiwi-container').getAttribute('data-type');if(conn_type=='undefined')conn_type='kiwi';console.log('conn_type='+conn_type);w3int_init();var d=new Date();timestamp=d.getTime();if(conn_type=='kiwi'){extint.ws=owrx_ws_open_snd(kiwi_open_ws_cb,{conn_type:conn_type});}else{extint.ws=kiwi_ws_open(conn_type,kiwi_open_ws_cb,{conn_type:conn_type});}}}
function kiwi_open_ws_cb(p){if(p.conn_type!='kiwi')
setTimeout(function(){setInterval(function(){ext_send("SET keepalive");},5000)},5000);if(seriousError)
return;ext_hasCredential(p.conn_type,kiwi_valpwd1_cb,p);}
function kiwi_load_js_polled(obj,js_files){if(!obj.started){kiwi_load_js(js_files,function(){obj.finished=true;});obj.started=true;obj.finished=false;}
return obj.finished;}
function kiwi_load_js_dir(dir,js_files,cb_post,cb_pre){if(isString(js_files))js_files=[js_files];for(var i=0;i<js_files.length;i++){js_files[i]=dir+js_files[i];}
kiwi_load_js(js_files,cb_post,cb_pre);}
function kiwi_load_js(js_files,cb_post,cb_pre){console.log('DYNLOAD START');if(isString(js_files))js_files=[js_files];js_files.push('kiwi/kiwi_js_load.js');console.log(js_files);var loaded_any=false;js_files.forEach(function(src,i){if(!kiwi.loaded_files[src]){if(!src.includes('kiwi_js_load.js')){kiwi.loaded_files[src]=1;loaded_any=true;}else{if(!loaded_any)return;}
var unknown_ext=false;var script;if(src.endsWith('.js')||src.includes('/js?key=')){script=document.createElement('script');script.src=src;script.type='text/javascript';if(src=='kiwi/kiwi_js_load.js'){script.kiwi_js=js_files[i-1];script.kiwi_cb=cb_post;}}else
if(src.endsWith('.css')){script=document.createElement('link');script.rel='stylesheet';script.href=src;script.type='text/css';}else
unknown_ext=true;if(unknown_ext){console.log('DYNLOAD UNKNOWN FILETYPE '+src);}else{script.async=false;document.head.appendChild(script);console.log('DYNLOAD loading '+src);}}else{console.log('DYNLOAD already loaded: '+src);}});console.log('DYNLOAD FINISH');if(!loaded_any){if(cb_pre){console.log('DYNLOAD call pre');w3_call(cb_pre,false);}
if(cb_post){console.log('DYNLOAD call post');w3_call(cb_post);}}else{if(cb_pre){console.log('DYNLOAD call pre subsequent');w3_call(cb_pre,true);}}}
function kiwi_ask_pwd_cb(path,val,first){ext_valpwd(conn_type,val);}
function kiwi_queue_or_camp_cb(path,val,first){var url=window.location.href;console.log(url);url=url+kiwi_add_search_param(window.location,'camp');console.log('--> '+url);window.location.href=url;}
function kiwi_ask_pwd(conn_kiwi){console.log('kiwi_ask_pwd chan_no_pwd_true='+chan_no_pwd_true+' client_public_ip='+client_public_ip);var s1='',s2='';if(conn_kiwi&&chan_no_pwd_true){s1='All channels busy that don\'t require a password ('+chan_no_pwd_true+'/'+rx_chans+')<br>';s2='<br> <b>OR</b> <br><br> click to queue for an available channel, <br>'+'or camp on an existing channel: <br>'+
w3_button('w3-medium w3-padding-smaller w3-aqua w3-margin-T-8','Queue or Camp','kiwi_queue_or_camp_cb');}
var prot=(kiwi_url_param(['p','prot','protected'],true,false)&&conn_kiwi);if(prot)s1='You have requested a password protected channel<br>';var s="KiwiSDR: software-defined receiver <br>"+s1+try_again+
w3_input('w3-retain-input-focus w3-margin-TB-8/w3-label-inline w3-label-not-bold/kiwi-pw|padding:1px|size=40','Password:','id-pwd','','kiwi_ask_pwd_cb')+
s2;kiwi_show_msg(s);w3_field_select('id-pwd',{mobile:1});}
var body_loaded=false;function kiwi_valpwd1_cb(badp,p){if(seriousError)
return;if(badp==kiwi.BADP_TRY_AGAIN){kiwi_ask_pwd(p.conn_type=='kiwi');try_again='Try again. ';}else
if(badp==kiwi.BADP_STILL_DETERMINING_LOCAL_IP){kiwi_show_msg('Still determining local interface address.<br>Please try reloading page in a few moments.');}else
if(badp==kiwi.BADP_NOT_ALLOWED_FROM_IP){kiwi_show_msg('Admin connection not allowed from this ip address.');}else
if(badp==kiwi.BADP_NO_ADMIN_PWD_SET){kiwi_show_msg('No admin password set. Can only connect from same local network as Kiwi.<br>Client ip = '+client_public_ip);}else
if(badp==kiwi.BADP_NO_MULTIPLE_CONNS){kiwi_show_msg('Multiple connections from the same ip address not allowed.<br>Client ip = '+client_public_ip);}else
if(badp==kiwi.BADP_DATABASE_UPDATE_IN_PROGRESS){kiwi_show_msg('Database update in progress.<br>Please try reloading page after one minute.');}else
if(badp==kiwi.BADP_ADMIN_CONN_ALREADY_OPEN){kiwi_show_msg('Another admin connection already open. Only one at a time allowed. <br>'+'Kick the other connection and retry? <br>'+
w3_button('w3-medium w3-padding-smaller w3-red w3-margin-T-8','Kick other admin','kick_other_admin_cb'));}else
if(badp==kiwi.BADP_OK){if(p.conn_type=='kiwi'){extint.ws=owrx_ws_open_wf(kiwi_open_ws_cb2,p);}else{kiwi_valpwd2_cb(0,p);}}}
function kick_other_admin_cb(){console.log('kick_other_admin_cb');msg_send('SET kick_admins');setTimeout(function(){window.location.reload(true);},1000);}
function kiwi_open_ws_cb2(p){ext_hasCredential(p.conn_type,kiwi_valpwd2_cb,p);}
function kiwi_valpwd2_cb(badp,p){if(seriousError)
return;kiwi_show_msg('');if(!body_loaded){body_loaded=true;if(p.conn_type!='kiwi'){w3_hide('id-kiwi-msg-container');w3_show_block('id-kiwi-container');w3_el('id-kiwi-body').style.overflow='hidden';}
try{w3_call(p.conn_type+'_main');}catch(ex){console.log('EX: '+ex);console.log('kiwi_valpwd2_cb: no interface routine for '+p.conn_type+'?');}}else{console.log("kiwi_valpwd2_cb: body_loaded previously!");return;}}
function kiwi_xdLocalStorage_init(){var iframeUrls=[];var N_PUB=2;for(var i=0;i<N_PUB;i++){iframeUrls[i]='http://pub'+i+'.kiwisdr.com/pkgs/xdLocalStorage/xdLocalStorage.php/?key=4e92a0c3194c62b2a067c494e2473e8dfe261138';}
xdLocalStorageHA.init({iframeUrls:iframeUrls,initCallback:function(){kiwi.xdLocalStorage_ready=true;console.log('xdLocalStorageHA READY');}});}
var override_freq,override_mode,override_zoom,override_max_dB,override_min_dB,override_9_10;function kiwi_get_init_settings(){var init_f=(init_frequency==undefined)?7020:init_frequency;init_f=ext_get_cfg_param('init.freq',init_f,EXT_NO_SAVE);init_frequency=override_freq?override_freq:init_f;var init_m=ext_get_cfg_param('init.mode',init_mode||'lsb',EXT_NO_SAVE);console.log('INIT init_mode='+init_mode+' init.mode='+init_m+' override_mode='+override_mode);init_mode=override_mode?override_mode:init_m;if(init_mode==='drm')init_mode='am';var init_z=(init_zoom==undefined)?0:init_zoom;init_z=ext_get_cfg_param('init.zoom',init_z,EXT_NO_SAVE);init_zoom=isNumber(override_zoom)?override_zoom:init_z;var init_max=(init_max_dB==undefined)?-10:init_max_dB;init_max=ext_get_cfg_param('init.max_dB',init_max,EXT_NO_SAVE);init_max_dB=override_max_dB?override_max_dB:init_max;var init_min=(init_min_dB==undefined)?-110:init_min_dB;init_min=ext_get_cfg_param('init.min_dB',init_min,EXT_NO_SAVE);init_min_dB=override_min_dB?override_min_dB:init_min;console.log('INIT f='+init_frequency+' m='+init_mode+' z='+init_zoom
+' min='+init_min_dB+' max='+init_max_dB);w3_call('init_scale_dB');var ant=ext_get_cfg_param('rx_antenna');var el=w3_el('rx-antenna');if(el!=undefined&&ant){el.innerHTML='Antenna: '+kiwi_decodeURIComponent('rx_antenna',ant);}
kiwi.WSPR_rgrid=ext_get_cfg_param_string('WSPR.grid','',EXT_NO_SAVE);}
var cfg={};var dxcfg={};var dxcomm_cfg={};var adm={};function config_save(cfg_s,cfg){var kiwi_cfg=kiwi[cfg_s];if(!isArg(kiwi_cfg)||!isArg(kiwi_cfg.cmd)){kiwi_debug('DANGER: config_save() cfg_s=<'+cfg_s+'> NOT FOUND in kiwi[] ???',true);return;}
var cfg_len=JSON.stringify(cfg).length;if(cfg_len<32){kiwi_debug('DANGER: config_save() cfg_s=<'+cfg_s+'> cfg_len='+cfg_len+' TOO SMALL???',true);return;}{config_save2(kiwi_cfg,cfg);}}
function config_save2(kiwi_cfg,cfg){var s=encodeURIComponent(JSON.stringify(cfg,null,3));ext_send_cfg(kiwi_cfg,s);}
function cfg_save_json(id,path){console.log('cfg_save_json: from='+id+' path='+path+' BEGIN');var s;if(path.startsWith('adm.')){config_save('adm',adm);}else
if(path.startsWith('dxcfg.')){config_save('dxcfg',dxcfg);}else{config_save('cfg',cfg);}}
var geo={geo:'',json:'',retry:0,};function kiwi_geolocate(which){var ff=kiwi_isFirefox();if(ff&&ff<=28)return;if(which==undefined)which=(new Date()).getSeconds();which=which%3;var server;switch(which){case 0:server='https://ipapi.co/json';break;case 1:server='https://get.geojs.io/v1/ip/geo.json';break;case 2:server='http://ip-api.com/json?fields=49177';break;default:break;}
kiwi_ajax(server,function(json){if(isUndefined(json.AJAX_error)){console.log('GEOLOC '+server);console.log(json);geoloc_json(json);}else{if(geo.retry++<=3)
kiwi_geolocate(which+1);}},null,5000);}
function geoloc_json(json){if(isDefined(json.AJAX_error))
return;if(window.JSON&&window.JSON.stringify)
geo.json=JSON.stringify(json);else
geo.json=json.toString();var country=json.country_name||json.country;var region=json.regionName||json.region;if(country=="United States"&&region){country=region+', USA';}
geo.geo='';if(json.city)geo.geo+=json.city;if(country)geo.geo+=(json.city?', ':'')+country;console.log('GEOLOC '+geo.geo);}
function kiwi_geo(){return encodeURIComponent(geo.geo);}
function kiwi_geojson(){return encodeURIComponent(geo.json);}
var server_time_utc,server_time_local,server_time_tzid,server_time_tzname,server_tz;var time_display_current=true;function time_display_cb(o){if(isUndefined(o.tu))return;server_time_utc=o.tu;server_time_local=o.tl;server_time_tzid=decodeURIComponent(o.ti);server_time_tzname=decodeURIComponent(o.tn).replace(/\\/g,'').replace(/_/g,' ');server_tz=server_time_tzname;if(server_time_tzid)server_tz+=' ('+server_time_tzid+')';if(!time_display_started){time_display_periodic();time_display_started=true;}else
time_display(time_display_current);}
function time_display(display_time){var el=w3_el('id-time-display-text-inner');if(!el)return;var noLatLon=(server_time_local==''||server_time_tzname=='null');w3_innerHTML('id-time-display-UTC',server_time_utc?server_time_utc:'?');w3_innerHTML('id-time-display-local',noLatLon?'?':server_time_local);w3_innerHTML('id-time-display-tzname',noLatLon?'Lat/lon needed for local time':server_tz);w3_el('id-time-display-logo-inner').style.opacity=display_time?0:1;w3_el('id-time-display-inner').style.opacity=display_time?1:0;}
function time_display_periodic(){time_display(time_display_current);time_display_current^=1;setTimeout(function(){time_display_periodic();},time_display_current?50000:10000);}
var time_display_started=false;var time_display_prev;function time_display_setup(ext_name_or_id){if(ext_name_or_id.startsWith('id-')==false)
ext_name_or_id+='-time-display';var el;if(time_display_prev){el=w3_el(time_display_prev);if(el)el.innerHTML='';}
time_display_prev=ext_name_or_id;var el=w3_el(ext_name_or_id);el.innerHTML=w3_div('id-time-display-inner',w3_div('id-time-display-text-inner',w3_inline('',w3_div('id-time-display-UTC'),w3_div('cl-time-display-text-suffix','UTC')),w3_inline('',w3_div('id-time-display-local'),w3_div('cl-time-display-text-suffix','Local')),w3_div('id-time-display-tzname')))+
w3_div('id-time-display-logo-inner',w3_div('id-time-display-logo-text','Powered by'),'<a href="https://github.com/ha7ilm/openwebrx" target="_blank"><img id="id-time-display-logo" src="gfx/openwebrx-top-logo.png" /></a>');time_display(time_display_current);}
function time_display_height(){return 80;}
function time_display_width(){return 200;}
function time_display_html(ext_name,top){top=top||'50px';return w3_div(ext_name+'-time-display|top:'+top+'; background-color:black; position:relative;');}
var ansi={colors:[[0,0,0],[252,57,31],[49,231,34],[234,236,35],[88,51,255],[249,53,248],[20,240,240],[233,235,235],[0,0,0],[252,57,31],[49,231,34],[234,236,35],[88,51,255],[249,53,248],[20,240,240],[233,235,235]],BRIGHT:8,RED:"\u001b[97m\u001b[101m",YELLOW:"\u001b[103m",GREEN:"\u001b[102m",CYAN:"\u001b[106m",BLUE:"\u001b[97m\u001b[104m",MAGENTA:"\u001b[97m\u001b[105m",GREY:"\u001b[47m",NORM:"\u001b[m",rolling:['RED','YELLOW','GREEN','CYAN','BLUE','MAGENTA','GREY'],rolling_n:7};function kiwi_output_sgr(p){var dbg_sgr=0;var msg='SGR',str='';var sgr,saw_reset=0,saw_color=0;var sa=p.esc.s.substr(1).split(';');var sl=sa.length;if(dbg_sgr)console.log('SGR '+kiwi_JSON(p.esc.s)+' sl='+sl);if(dbg_sgr)console.log(sa);if(p.isAltBuf)msg+='('+p.r+','+p.c+')';for(var ai=0;ai<sl&&!isNumber(msg);ai++){sgr=(sa[ai]==''||sa[ai]=='m')?0:parseInt(sa[ai]);if(dbg_sgr)console.log('sgr['+ai+']='+sgr);if(sgr==0){p.sgr.fg=p.sgr.bg=null;msg+=', reset';saw_reset=1;}else
if(isNaN(sgr)){msg=2;}else
if(sgr==1){p.sgr.bright=ansi.BRIGHT;msg+=', bright';}else
if(sgr==2){p.sgr.bright=0;msg+=', faint';}else
if(sgr==22){p.sgr.bright=0;msg+=', normal';}else
if(sgr==7){var tf=p.sgr.fg;p.sgr.fg=p.sgr.bg;p.sgr.bg=tf;if(p.sgr.fg==null)p.sgr.fg=[255,255,255];if(p.sgr.bg==null)p.sgr.bg=[0,0,0];msg+=', reverse video';saw_color=1;}else
if(sgr==27){p.sgr.fg=p.sgr.bg=null;msg+=', reverse video off';saw_reset=1;}else
if(sgr>=30&&sgr<=37){if(dbg_sgr)console.log('SGR='+sgr+' bright='+p.sgr.bright);p.sgr.fg=ansi.colors[sgr-30+p.sgr.bright];msg+=', fg color';saw_color=1;}else
if(sgr>=90&&sgr<=97){p.sgr.fg=ansi.colors[sgr-90+ansi.BRIGHT];msg+=', fg color bright';saw_color=1;}else
if(sgr==39){p.sgr.fg=null;msg+=', fg normal';saw_color=1;}else
if(sgr>=40&&sgr<=47){p.sgr.bg=ansi.colors[sgr-40+p.sgr.bright];msg+=', bg color';saw_color=1;}else
if(sgr>=100&&sgr<=107){p.sgr.bg=ansi.colors[sgr-100+ansi.BRIGHT];msg+=', bg color bright';saw_color=1;}else
if(sgr==49){p.sgr.bg=null;msg+=', bg normal';saw_color=1;}else
if(sgr==38||sgr==48){if(dbg_sgr)console.log('SGR-8/24 sl='+sl);var n8,r,g,b,color,ci;if(sl==3&&(parseInt(sa[1])==5)&&(!isNaN(n8=parseInt(sa[2])))){if(dbg_sgr)console.log('SGR n8='+n8);ai+=2;if(n8<=15){color=ansi.colors[n8];if(sgr==38)p.sgr.fg=color;else p.sgr.bg=color;msg+=', 38/48 mode color';saw_color=1;}else
if(n8<=231){n8-=16;r=Math.floor(n8/36);n8-=r*36;g=Math.floor(n8/6);n8-=g*6;b=n8;r=Math.floor(255*r/5);g=Math.floor(255*g/5);b=Math.floor(255*b/5);color=[r,g,b];if(sgr==38)p.sgr.fg=color;else p.sgr.bg=color;msg+=', color cube';saw_color=1;}else
if(n8<=255){ci=8+(n8-232)*10;if(dbg_sgr)console.log('n8='+n8+' ci='+ci);color=[ci,ci,ci];if(sgr==38)p.sgr.fg=color;else p.sgr.bg=color;msg+=', grayscale ramp';saw_color=1;}else
msg=2;}else
if(sl==5&&(parseInt(sa[1])==2)&&(!isNaN(r=parseInt(sa[2])))&&(!isNaN(g=parseInt(sa[3])))&&(!isNaN(b=parseInt(sa[4])))){r=w3_clamp(r,0,255);g=w3_clamp(g,0,255);b=w3_clamp(b,0,255);color=[r,g,b];if(sgr==38)p.sgr.fg=color;else p.sgr.bg=color;msg+=', 24-bit color';saw_color=1;}else
msg=2;}else
msg=2;}
if(saw_reset){if(dbg_sgr)console.log('SGR DONE');if(p.sgr.span){str+='</span>';p.sgr.span=0;}}else
if(saw_color){if(dbg_sgr){console.log('SGR saw_color fg='+kiwi_rgb(p.sgr.fg)+' bg='+kiwi_rgb(p.sgr.bg));console.log(p.sgr.fg);console.log(p.sgr.bg);}
if(p.sgr.span)str+='</span>';str+='<span style="'+(p.sgr.fg?('color:'+kiwi_rgb(p.sgr.fg)+';'):'')+(p.sgr.bg?('background-color:'+kiwi_rgb(p.sgr.bg)+';'):'')+'">';p.sgr.span=1;}else{if(dbg_sgr)console.log('SGR ERROR');}
return{msg:msg,str:str};}
function kiwi_output_msg(id,id_scroll,p){var i,j;var dbg=(0&&dbgUs);if(dbg)kiwi.d.p=p;if(1&&dbg){console.log('$kiwi_output_msg id='+id+' init='+p.init+' isAltBuf='+p.isAltBuf+' s='+p.s);console.log('$ '+kiwi_JSON(p));if(!p.init)kiwi_trace();}
var parent_el=w3_el(id);if(!parent_el){console.log('kiwi_output_msg NOT_FOUND id='+id);return;}
var appendEmptyLine=function(parent_el){var el=w3_create_appendElement(parent_el,'pre','');p.nlines++;while(p.nlines>p.max_lines){parent_el.removeChild(parent_el.firstChild);p.nlines--;}
return el;};var removeAllLines=function(parent_el){while(parent_el.firstChild){parent_el.removeChild(parent_el.firstChild);}
p.nlines=0;};var console_cursor=function(ch){ch=ch||'&nbsp;';return'<span class="cl-admin-console-cursor">'+ch+'</span>';};var render2=function(){var fg=null,bg=null,span=false;for(var r=1;r<=p.rows;r++){if(!p.dirty[r])continue;p.dirty[r]=false;var s='';for(var c=1;c<=p.cols;c++){var color=p.color[r][c];if(color.fg!=fg||color.bg!=bg){if(span)s+='</span>';if(color.fg||color.bg){s+='<span style="'+(color.fg?('color:'+kiwi_rgb(color.fg)+';'):'')+
(color.bg?('background:'+kiwi_rgb(color.bg)+';'):'')+'">';}else{span=false;}
fg=color.fg;bg=color.bg;span=true;}
var ch=p.screen[r][c];if(ch=='<')ch='&lt;';else
if(ch=='>')ch='&gt;';else
if(ch=='&')ch='&amp;';else
if(ch=='\'')ch='&apos;';else
if(ch=='/')ch='&#47;';else;if(p.show_cursor&&r==p.r&&c==p.c){if(dbg)console.log('cursor '+p.r+','+p.c);s+=console_cursor(ch);p.r_cursor=r;p.c_cursor=c;}else{s+=ch;}}
if(s=='')s='&nbsp;';else
if(span)s+='</span>';try{p.els[r].innerHTML=s;}catch(ex){if(dbg){console.log('r='+r);console.log(p.els[r]);console.log(ex);}}}};var render=function(){if(p.r_cursor!=p.r&&p.r_cursor!=0){p.dirty[p.r_cursor]=true;}
render2();};var sched=function(){kiwi_clearTimeout(p.rend_timeout);p.rend_timeout=setTimeout(function(){render();},250);};var dirty=function(){p.dirty[p.r]=true;};var screen_char=function(ch,shift_mode){var r=p.r,c=p.c;if(shift_mode!=p.NOSHIFT_MODE&&p.insertMode){for(i=r.cols-1;i>=c;i--){p.screen[r][i+1]=p.screen[r][i];p.color[r][i+1]=p.color[r][i];}}
try{p.screen[r][c]=ch;}catch(ex){if(dbg){console.log('r='+r+' c='+c);console.log(kiwi_JSON(ch));console.log(p);console.log(ex);}}
p.color[r][c]={fg:p.sgr.fg,bg:p.sgr.bg};dirty();p.c++;if(p.c>p.cols){if(p.eol_wrap&&shift_mode!=p.NOSHIFT_MODE){p.c=1;p.r++;if(p.r>p.rows){p.r=1;dirty();}}else{p.c=p.cols;}}
sched();};var move_in_display=function(dr_start,sr_start,sr_end,step){var row=dr_start;var down=(step>0);for(var ri=sr_start;(down&&ri<=sr_end)||(!down&&ri>=sr_end);ri+=step){p.r=row;row+=step;p.c=1;for(var ci=1;ci<=p.cols;ci++){screen_char(p.screen[ri][ci]);}}};var erase_in_line=function(c_start,c_end){for(var c=c_start;c_start&&c<=c_end;c++){p.screen[p.r][c]=' ';p.color[p.r][c]={fg:null,bg:null};}
dirty();sched();};var erase_in_display=function(r_start,r_end,c_start,c_end){for(var r=r_start;r_start&&r<=r_end;r++){for(var c=c_start;c<=((r==p.r)?c_end:p.cols);c++){p.screen[r][c]=' ';p.color[r][c]={fg:null,bg:null};}
p.dirty[r]=true;}
sched();};var snew_add=function(c){if(snew==''){p.snew_r=p.r;p.snew_c=p.c;}
snew+=c;};var snew_dump=function(where){if(snew!=''){if(dbg)console.log('> '+(p.isAltBuf?'ALT':'REG')+' '+where+' ('+p.snew_r+','+p.snew_c+') '+' CHARS #'+snew.length+' '+kiwi_JSON(snew));snew='';}};var html_add=function(c){if(isString(p.line_html[p.ccol]))
p.line_html[p.ccol]+=c;else
p.line_html[p.ccol]=c;};var line_s=function(){return kiwi_JSON(p.line.join(''));};var line_join=function(col_start,col_stop){col_stop=col_stop||p.cols;var s='';var a=[];var i;for(var c=col_start,i=0;c<col_stop;c++,i++){var sgr=(isString(p.line_sgr[c]))?p.line_sgr[c]:'';var html=(isString(p.line_html[c]))?p.line_html[c]:'';var ch=(isString(p.line[c]))?p.line[c]:'';s+=sgr+html+ch;a[i]={sgr:sgr,html:html,ch:ch,s:s};}
return{s:s,a:a};};var s;if(isNoArg(p.no_decode)||p.no_decode!=true){try{s=kiwi_decodeURIComponent('kiwi_output_msg',p.s);}catch(ex){console.log('decodeURIComponent FAIL:');console.log(p.s);s=p.s;}}else{s=p.s;}
if(p.init!=true){removeAllLines(parent_el);p.el=appendEmptyLine(parent_el);p.cols=p.cols||80;p.NONE=0;p.ESC=1;p.CSI=2;p.NON_CSI=3;p.NOSHIFT_MODE=true;p.esc={s:'',state:p.NONE};p.sgr={span:0,bright:0,fg:null,bg:null};p.return_pending=false;p.must_scroll_down=false;p.traceEvery=false;p.ccol=1;p.line=[];p.line_sgr=[];p.line_html=[];p.inc=1;p.r=p.c=1;p.margin_set=false;p.margin_top=1;p.margin_bottom=p.rows;p.show_cursor=p.show_cursor||false;p.r_cursor=p.c_cursor=0;p.insertMode=true;p.eol_wrap=false;p.screen=[];p.color=[];p.dirty=[];p.els=[];for(var r=0;r<=p.rows;r++){p.screen[r]=[];p.color[r]=[];}
p.isAltBuf=false;p.altbuf_via_cursor_visible=false;p.altbuf_via_cup=false;p.alt_save='';p.rend_timeout=null;p.init=true;}
var snew='',stmp;var el_scroll=w3_el(id_scroll);var wasScrolledDown=null;if(p.process_return_alone&&s.charAt(0)=='\r'&&(s.length==1||s.charAt(1)!='\n')){if(p.isAltBuf){}else{s=s.substring(1);p.line=[];p.line_sgr=[];p.line_html=[];p.ccol=1;}}
if(0){if(dbg)console.log('kiwi_output_msg:');if(dbg)console.log(kiwi_JSON(p));if(dbg)console.log(kiwi_JSON(s));}
if(p.remove_returns)s=s.replace(/\r/g,'');if(p.inline_returns&&!p.isAltBuf){s=s.replace(/\r\n/g,'\n');s=s.replace(/\r\n/g,'\n');}
if(dbg)console.log('OUTPUT '+kiwi_JSON(s).replace(/\\u001b/g,'\\e'));var cnt=0;for(var si=0;si<s.length;si++){var result=null;var c=s.charAt(si);if(p.inline_returns&&p.return_pending&&c!='\r'){if(p.isAltBuf){}else{p.ccol=1;p.line_sgr[p.ccol]=null;p.line_html[p.ccol]=null;p.return_pending=false;}}
if(c=='\f'){if(p.isAltBuf){}else{if(dbg)console.log('console \f');removeAllLines(parent_el);p.el=appendEmptyLine(parent_el);p.line=[];p.line_sgr=[];p.line_html=[];p.ccol=1;}}else
if(c=='\r'){if(p.isAltBuf){p.c=1;dirty();}
if(p.inline_returns){p.return_pending=true;}
snew_dump('rtn');result='\\r col = 1 ('+p.r+',1)';}else
if(c=='\n'&&p.isAltBuf){if(p.margin_set){move_in_display(p.margin_top,p.margin_top+1,p.margin_bottom,+1);result='\\n (scroll text up)';}else{p.c=1;if(p.r<p.rows)p.r++;dirty();result='\\n row++ ('+p.r+','+p.c+')';}}else
if(c=='\b'){result='backspace (arrow left)';if(p.isAltBuf){if(p.c>1){dirty();p.c--;}}else{if(p.ccol>1){p.ccol--;if(dbg)console.log('BACKSPACE col='+p.ccol+' '+line_s());}}}else
if(c=='\t'){result='tab';if(p.isAltBuf){}else{snew_add('&nbsp;');p.line[p.ccol]='&nbsp;';p.ccol++;while((p.ccol&7)!=0){snew_add('&nbsp;');p.line[p.ccol]='&nbsp;';p.ccol++;}}}else
if(c=='\x1b'){p.esc.s='';p.esc.state=p.ESC;p.traceEvery=false;}else
if(p.esc.state>=p.ESC){var interp=false;if(p.esc.state==p.ESC){if(c=='['){p.esc.state=p.CSI;}else{p.esc.state=p.NON_CSI;switch(c){case'(':case'O':cnt=2;break;case'>':case'=':cnt=1;break;default:if(dbg)console.log('$LEN? c='+c);cnt=1;break;}}}
if(p.esc.state==p.CSI){p.esc.s+=c;if(p.esc.s.length>1&&c>='@'&&c<='~')interp=true;}else
if(p.esc.state==p.NON_CSI&&cnt){p.esc.s+=c;cnt--;if(cnt==0)interp=true;}
if(interp){var first=p.esc.s.charAt(0);var second=p.esc.s.charAt(1);var last_hl=(c=='h'||c=='l');var enable=(c=='h');result=0;var error=0;var n1=1,n2=1;var t=p.esc.s.slice(1);if(t.length>1&&isNumber(+t[0])){var a=t.slice(0,t.length-1);a=a.split(';');n1=+a[0];n1=n1||1;if(a.length>1)n2=+a[1];n2=n2||1;}
if(first=='['){if(c=='m'){var rv=kiwi_output_sgr(p);result=rv.msg;if(p.isAltBuf){}else{snew_add(rv.str);p.line_sgr[p.ccol]=rv.str;if(dbg)console.log('AFTER SGR snew='+kiwi_JSON(snew));}
p.traceEvery=true;}else
if(c=='K'){if(p.isAltBuf){var c_start,c_end;result='erase in line: ';switch(second){case'0':case'K':c_start=p.c;c_end=p.cols;result+='cur to EOL';break;case'1':c_start=1;c_end=p.c;result+='BOL to cur';break;case'2':c_start=1;c_end=p.cols;result+='full line';break;default:c_start=0;break;}
erase_in_line(c_start,c_end);}else{if(second=='K'){if(dbg)console.log('EEOL BEFORE col='+p.ccol+' '+line_s());var col_stop=p.line.length;for(i=p.ccol;i<=col_stop;i++){p.line[i]=null;p.line_sgr[i]=null;p.line_html[i]=null;}
if(dbg)console.log('EEOL AFTER col='+p.ccol+' '+line_s());result='erase in line: cur to EOL';}}}else
if(c=='J'){if(p.isAltBuf){var r_start,r_end,c_start,c_end;if(second=='0'||second=='J'){r_start=p.r,r_end=p.rows;c_start=p.c,c_end=p.cols;result='erase cur to EOS';}else
if(second=='2'||second=='3'){r_start=1,r_end=p.rows;c_start=1,c_end=p.cols;result='erase full screen';}else
if(second=='1'){r_start=1,r_end=p.r;c_start=1,c_end=p.c;result='erase BOS to cur';}else{r_start=0;result=2;}
erase_in_display(r_start,r_end,c_start,c_end);}else{if(second=='2'||second=='3'){if(dbg)console.log('console ERASE FULL SCREEN');removeAllLines(parent_el);p.el=appendEmptyLine(parent_el);p.line=[];p.line_sgr=[];p.line_html=[];p.ccol=1;result='erase full screen';}}}else
if(c=='H'){result='move '+n1+','+n2;if(p.isAltBuf){dirty();p.r=n1;p.c=n2;dirty();}else{error=1;}}else
if(c=='d'){result='move row '+n1;if(p.isAltBuf){dirty();p.r=n1;dirty();}else{error=1;}}else
if(c=='G'){result='move col '+n1;if(p.isAltBuf){p.c=n1;dirty();}else{error=1;}}else
if(second=='?'&&last_hl){n1=parseInt(p.esc.s.substr(2));result=(enable?'SET':'RESET')+' ';var enter_altbuf=false,exit_altbuf=false,exit_altbuf_no_restore=false;switch(n1){case 1:result+='cursor keys mode';break;case 7:result+='vertical autowrap';break;case 12:result+='cursor bold';break;case 25:result+='cursor visible';p.show_cursor=enable?true:false;if(!enable&&!p.isAltBuf){enter_altbuf=true;p.altbuf_via_cursor_visible=true;}else
if(enable&&p.isAltBuf&&p.altbuf_via_cursor_visible){exit_altbuf=true;}
break;case 1049:result+='alt screen buf';if(enable&&!p.isAltBuf){enter_altbuf=true;p.altbuf_via_cup=true;}else
if(!enable&&p.isAltBuf&&p.altbuf_via_cup){exit_altbuf=true;}
break;default:result+='$UNKNOWN ='+n1;break;}
if(enter_altbuf){if(dbg)console.log('$ENTER alt buf via '+(p.altbuf_via_cup?'cup':'cursor_visible')+' ====================================');p.alt_save=parent_el.innerHTML.replace(/<pre><span class="cl-admin-console-cursor">.*<\/span><\/pre>$/,'');if(dbg)console.log(kiwi_JSON(p.alt_save));removeAllLines(parent_el);for(var r=1;r<=p.rows;r++){p.dirty[r]=false;try{for(var c=1;c<=p.cols;c++){p.screen[r][c]=' ';p.color[r][c]={fg:null,bg:null};}}catch(ex){if(dbg){console.log('--------');console.log('r='+r+' c='+c);console.log(p.screen);console.log(ex);}}
p.els[r]=appendEmptyLine(parent_el);p.els[r].innerHTML='&nbsp;';}
console_is_char_oriented(true);p.margin_set=false;p.isAltBuf=true;}else
if(exit_altbuf){if(dbg)console.log('$EXIT alt buf via '+(p.altbuf_via_cup?'cup':'cursor_visible')+' ====================================');p.altbuf_via_cursor_visible=false;p.altbuf_via_cup=false;if(dbg)console.log(kiwi_JSON(p.alt_save));parent_el.innerHTML=p.alt_save;p.el=appendEmptyLine(parent_el);p.must_scroll_down=true;console_is_char_oriented();p.isAltBuf=false;}else
if(exit_altbuf_no_restore){if(dbg)console.log('$EXIT alt buf NO RESTORE =====================================');p.must_scroll_down=true;console_is_char_oriented();p.isAltBuf=false;}}else
if(second=='4'&&p.isAltBuf&&last_hl){p.insertMode=enable;result=enable?'INSERT mode':'REPLACE mode';}else
if(c=='X'&&p.isAltBuf){if(n1==0)n1=1;var col;for(var ci=0,col=p.c;ci<n1&&col<=p.cols;ci++,col++){p.screen[p.r][col]=' ';p.color[p.r][col]={fg:null,bg:null};}
dirty();sched();result='erase '+n1+' chars';}else
if(c=='P'){if(n1==0)n1=1;if(p.isAltBuf){var save_col=p.c,src_col,dst_col;for(src_col=p.c+n1,dst_col=p.c;src_col<=p.cols;src_col++,dst_col++){p.screen[p.r][dst_col]=p.screen[p.r][src_col];p.color[p.r][dst_col]=p.color[p.r][src_col];}
for(;dst_col<p.cols;dst_col++){p.screen[p.r][dst_col]=' ';p.color[p.r][dst_col]={fg:null,bg:null};}
p.c=save_col;dirty();sched();}else{if(dbg)console.log('DEL-CHARS BEFORE col='+p.ccol+'/'+p.line.length+' '+line_s());for(i=0;i<n1;i++){var col_stop=p.line.length;for(j=p.ccol;j<col_stop;j++)p.line[j]=p.line[j+1];p.line[j]=null;}
if(dbg)console.log('DEL-CHARS AFTER col='+p.ccol+'/'+p.line.length+' '+line_s());}
result='del #'+n1+' chars';}else
if(c=='@'){if(n1==0)n1=1;if(p.isAltBuf){var save_col=p.c,src_col,dst_col;for(src_col=p.cols-n1,dst_col=p.cols;src_col>=save_col;src_col--,dst_col--){p.screen[p.r][dst_col]=p.screen[p.r][src_col];p.color[p.r][dst_col]=p.color[p.r][src_col];}
for(;dst_col>=save_col;dst_col--){p.screen[p.r][dst_col]=' ';p.color[p.r][dst_col]={fg:null,bg:null};}
p.c=save_col;dirty();sched();}else{if(dbg)console.log('INS-CHARS BEFORE col='+p.ccol+'/'+p.line.length+' '+line_s());for(i=0;i<n1;i++){var col_stop=p.line.length;for(j=col_stop;j>p.ccol;j--)p.line[j]=p.line[j-1];}
if(dbg)console.log('INS-CHARS AFTER col='+p.ccol+'/'+p.line.length+' '+line_s());}
result='ins #'+n1+' chars';}else
if(c=='r'&&p.isAltBuf){p.margin_top=n1;p.margin_bottom=n2;p.margin_set=true;result='set margins, top='+n1+', bottom='+n2;}else
if(c=='S'&&p.isAltBuf){move_in_display(p.margin_top,p.margin_top+n1,p.margin_bottom,+1);erase_in_display(p.r,p.margin_bottom,1,p.cols);p.insertMode=save_insertMode;result='pan down '+n1;}else
if(c=='T'&&p.isAltBuf){var save_insertMode=p.insertMode;p.insertMode=false;move_in_display(p.margin_bottom,p.margin_top+n1-1,p.margin_top,-1);erase_in_display(p.margin_top,p.margin_top+n1-1,1,p.cols);p.insertMode=save_insertMode;result='pan up '+n1;}else
if(c=='M'&&p.isAltBuf){var save_insertMode=p.insertMode;p.insertMode=false;move_in_display(p.r,p.r+1,p.r+n1,+1);erase_in_display(p.r+n1,p.r+n1,1,p.cols);p.insertMode=save_insertMode;result='delete line(s) '+n1;}else
if(c=='t'){result='set lines per page '+n1+' (ignored)';}else
if(c=='A'){if(p.isAltBuf){if(p.r>1){dirty();p.r--;dirty();}
result='arrow up';}else{}}else
if(c=='B'){if(p.isAltBuf){if(p.r<p.rows){dirty();p.r++;dirty();}
result='arrow down';}else{}}else
if(c=='C'){if(p.isAltBuf){if(p.c<p.cols){dirty();p.c++;}}else{if(dbg)console.log('ARROW RIGHT col='+p.ccol+'/'+p.line.length+' '+sq(p.line[p.ccol])+' '+line_s());if(p.ccol<p.line.length)
p.ccol++;}
result='arrow right';}else
if(c=='D'){if(p.isAltBuf){if(p.c>1){dirty();p.c--;}
result='arrow left';}else{}}else{result=2;}}else
if(first=='('){result='define char set';}else
switch(c){case'H':result='set horiz tab (nop)';break;case'M':if(p.isAltBuf){var save_insertMode=p.insertMode;p.insertMode=false;move_in_display(p.margin_bottom,p.margin_bottom-1,p.margin_top,-1);erase_in_display(p.margin_top,p.margin_top,1,p.cols);p.insertMode=save_insertMode;result='scroll text down';}
break;case'>':result='set numeric keypad';break;case'=':result='keypad application mode';break;case'7':result='save cursor';break;case'8':result='restore cursor';break;case'c':result='reset initial state (nop)';break;default:result=2;break;}
snew_dump('cmd');if(error)result+=' UNEXPECTED ====================================================================================';error=0;if(result===1){if(dbg)console.log('> ESC '+kiwi_JSON(p.esc.s)+' $IGNORED ==========================================================================================');}else
if(result===2){if(1||dbg)console.log('> ESC '+kiwi_JSON(p.esc.s)+' $UNKNOWN ======================================================================================');}else
if(isString(result)){if(dbg)console.log('> ESC '+(p.isAltBuf?'ALT':'REG')+' '+kiwi_JSON(p.esc.s)+' '+result);}
result=null;p.esc.state=p.NONE;}}else
if(c>=' '||c=='\n'||c=='\t'){var prt=false;if(!p.isAltBuf&&c=='<'){if(p.inc){snew_add('<');p.line[p.ccol]='&lt;';p.ccol+=p.inc;}
prt=true;}else
if(!p.isAltBuf&&c=='>'){if(p.inc){snew_add('>');p.line[p.ccol]='&gt;';p.ccol+=p.inc;}
prt=true;}else{if(c!='\n'){snew_add(c);if(p.isAltBuf){screen_char(c);}else{if(p.inc){p.line[p.ccol]=c;p.ccol++;}else{html_add(c);}
prt=true;}}
var at_EOL=(p.ccol==p.cols);if(c=='\n'||(at_EOL&&(!p.isAltBuf||(p.isAltBuf&&p.eol_wrap)))){wasScrolledDown=w3_isScrolledDown(el_scroll);if(p.isAltBuf){p.c=1;dirty();p.r++;dirty();if(p.r>p.rows)p.r=1;}else{var stmp=line_join(1).s;p.el.innerHTML=(stmp=='')?'&nbsp;':stmp;if(dbg)console.log('TEXT-EMIT '+kiwi_JSON(stmp));p.line=[];p.line_sgr=[];p.line_html=[];p.el=appendEmptyLine(parent_el);p.ccol=1;}
if(w3_contains(el_scroll,'w3-scroll-down')&&(!p.scroll_only_at_bottom||(p.scroll_only_at_bottom&&wasScrolledDown)))
w3_scrollDown(el_scroll);}}}else
if(!p.isAltBuf&&c==kiwi.esc_lt){snew_add('<');html_add('<');p.inc=0;}else
if(!p.isAltBuf&&c==kiwi.esc_gt){snew_add('>');html_add('>');p.inc=1;}else
if(p.isAltBuf){if(dbg)console.log('> 0x7f CHAR '+ord(c)+' '+ord(c).toHex(-2));}
if(result){if(dbg)console.log('> '+result);}}
wasScrolledDown=w3_isScrolledDown(el_scroll);if(p.isAltBuf){}else{if(dbg)console.log('TEXT-ACCUM col='+p.ccol+'/'+p.line.length+' '+line_s());if(p.show_cursor){var first_s=line_join(1,p.ccol).s;var second_a=line_join(p.ccol,p.ccol+1).a;var third_s=line_join(p.ccol+1).s;if(second_a.length){stmp=first_s;stmp+=second_a[0].sgr+second_a[0].html+console_cursor(second_a[0].ch);stmp+=third_s;}else{stmp=first_s+console_cursor();}}else{stmp=line_join(1).s;}
p.el.innerHTML=stmp;if(dbg)console.log('TEXT-ACCUM col='+p.ccol+' '+kiwi_JSON(stmp));}
if(w3_contains(el_scroll,'w3-scroll-down')&&(!p.scroll_only_at_bottom||(p.scroll_only_at_bottom&&wasScrolledDown)||p.must_scroll_down)){w3_scrollDown(el_scroll);p.must_scroll_down=false;}
if(p.isAltBuf)sched();snew_dump('end');}
function gps_stats_cb(acquiring,tracking,good,fixes,adc_clock,adc_gps_clk_corrections){var s=(acquiring?'yes':'pause')+', track '+tracking+', good '+good+', fixes '+fixes.toUnits();w3_innerHTML('id-msg-gps','GPS: acquire '+s);w3_innerHTML('id-status-gps',w3_text('w3-text-css-orange','GPS'),w3_text('','acq '+s));extint_adc_clock_Hz=adc_clock*1e6;extint_adc_gps_clock_corr=adc_gps_clk_corrections;if(adc_gps_clk_corrections){s=adc_clock.toFixed(6)+' ('+adc_gps_clk_corrections.toUnits()+' avgs)';var el=w3_el('id-msg-gps');if(el)el.innerHTML+=', ADC clock '+s;w3_innerHTML('id-status-adc',w3_text('w3-text-css-orange','ADC clock '),w3_text('',s));}}
function admin_stats_cb(audio_dropped,underruns,seq_errors,dp_resets,dp_hist_cnt,dp_hist,in_hist_cnt,in_hist){if(audio_dropped==undefined)return;var el=w3_el('id-msg-errors');if(el)el.innerHTML='Stats: '+
audio_dropped.toUnits()+' dropped, '+
underruns.toUnits()+' underruns, '+
seq_errors.toUnits()+' sequence, '+
dp_resets.toUnits()+' realtime';el=w3_el('id-status-dp-hist');if(el){var s='Datapump: ';for(var i=0;i<dp_hist_cnt;i++){s+=(i?', ':'')+dp_hist[i].toUnits();}
el.innerHTML=s;}
el=w3_el('id-status-in-hist');if(el){var s='SoundInQ: ';for(var i=0;i<in_hist_cnt;i++){s+=(i?', ':'')+in_hist[i].toUnits();}
el.innerHTML=s;}}
function kiwi_too_busy(rx_chans){var s='Sorry, the KiwiSDR server is too busy right now ('+rx_chans+' users max). <br>'+'There is also a limit on the total number of channel queuers and campers. <br>'+'Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.';kiwi_show_msg(s);}
function kiwi_exclusive_use(){var s='Sorry, this Kiwi has been locked for special use. <br>'+'This happens when using an extension (e.g. DRM decoder) that requires all available resources. <br>'+'Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide. <br><br>'+' <br>'+'DRM  <br>'+' KiwiSDR <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> ';kiwi_show_msg(s);}
function kiwi_ip_limit_pwd_cb(pwd){console.log('kiwi_ip_limit_pwd_cb pwd='+pwd);writeCookie('iplimit',encodeURIComponent(pwd));window.location.reload(true);}
function kiwi_show_error_ask_exemption_cb(path,val,first){kiwi_ip_limit_pwd_cb(val);}
function kiwi_show_error_ask_exemption(s){s+='<br><br>If you have an exemption password from the KiwiSDR owner/admin <br> please enter it here: '+
w3_input('w3-retain-input-focus w3-margin-TB-8/w3-label-inline w3-label-not-bold/kiwi-pw|padding:1px|size=40','Password:','id-epwd','','kiwi_show_error_ask_exemption_cb');kiwi_show_msg(s);w3_field_select('id-epwd',{mobile:1});}
function kiwi_inactivity_timeout(mins){var s='Sorry, this KiwiSDR has an inactivity timeout after '+mins+' minutes.<br>Reload the page to continue.';kiwi_show_msg(s);}
function kiwi_24hr_ip_limit(mins,ip){var s='Sorry, this KiwiSDR can only be used for '+mins+' minutes every 24 hours by each IP address.<br>'+'Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.';kiwi_show_error_ask_exemption(s);}
function kiwi_password_entry_timeout(){var s='Timeout. Please reload page to continue.';kiwi_show_msg(s);}
function kiwi_up(up){if(!seriousError){w3_hide('id-kiwi-msg-container');w3_show_block('id-kiwi-container');w3_el('id-kiwi-body').style.overflow='hidden';}}
function kiwi_down(type,reason){var s;type=+type;if(type==1){s='Sorry, software update in progress. Please check back in a few minutes.<br>'+'Or check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.';}else
if(type==2){s="Backup in progress.";}else{if(reason==null||reason==''){reason='Sorry, this KiwiSDR server is being used for development right now. <br>'+'Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.';}
s=reason;}
kiwi_show_msg(s);}
var stats_interval=10000;var need_config=true;function stats_init(){if(need_config){msg_send('SET GET_CONFIG');need_config=false;}
stats_update();}
function stats_update(){msg_send('SET STATS_UPD ch='+rx_chan);var now=new Date();var aligned_interval=Math.ceil(now/stats_interval)*stats_interval-now;if(aligned_interval<stats_interval/2)aligned_interval+=stats_interval;setTimeout(stats_update,aligned_interval);}
function status_periodic(){w3_innerHTML('id-status-stats-cpu',kiwi_cpu_stats_str);w3_innerHTML('id-status-stats-xfer',kiwi_xfer_stats_str);w3_innerHTML('id-msg-stats-cpu',kiwi_cpu_stats_str_long);w3_innerHTML('id-msg-stats-xfer',kiwi_xfer_stats_str_long);}
var kiwi_xfer_stats_str="";var kiwi_xfer_stats_str_long="";function xfer_stats_cb(audio_kbps,waterfall_kbps,waterfall_fps,http_kbps,sum_kbps){kiwi_xfer_stats_str=w3_text('w3-text-css-orange','Net')+
w3_text('','aud '+audio_kbps.toFixed(0)+', wf '+waterfall_kbps.toFixed(0)+', http '+
http_kbps.toFixed(0)+', total '+sum_kbps.toFixed(0)+' kB/s');kiwi_xfer_stats_str_long='Network (all channels): audio '+audio_kbps.toFixed(0)+' kB/s, waterfall '+waterfall_kbps.toFixed(0)+' kB/s ('+waterfall_fps.toFixed(0)+' fps)'+', http '+http_kbps.toFixed(0)+' kB/s, total '+sum_kbps.toFixed(0)+' kB/s ('+(sum_kbps*8).toFixed(0)+' kb/s)';}
var kiwi_cpu_stats_str='';var kiwi_cpu_stats_str_long='';var kiwi_config_str='';var kiwi_config_str_long='';function cpu_stats_cb(o,uptime_secs,ecpu,waterfall_fps){idle%=100;var cputempC=o.cc?o.cc:0;var cputempF=cputempC*9/5+32;var temp_color=o.cc?((o.cc>=60)?'w3-text-css-red w3-bold':((o.cc>=50)?'w3-text-css-yellow':'w3-text-css-lime')):'';var cputemp=cputempC?(cputempC.toFixed(0)+'&deg;C '+cputempF.toFixed(0)+'&deg;F '):'';var cpufreq=(o.cf>=1000)?((o.cf/1000).toFixed(1)+' GHz'):(o.cf.toFixed(0)+' MHz');kiwi_cpu_stats_str=w3_text('w3-text-css-orange','BB ')+
w3_text('',o.cu[0]+','+o.cs[0]+','+o.ci[0]+' usi% ')+
(cputempC?w3_text(temp_color,cputemp):'')+
w3_text('',cpufreq+' ')+
w3_text('w3-text-css-orange','FPGA')+
w3_text('',ecpu.toFixed(0)+'%');kiwi.wf_fps=waterfall_fps;var user='',sys='',idle='';var first=true;for(var i=0;i<o.cu.length;i++){user+=(first?'':' ')+o.cu[i]+'%';sys+=(first?'':' ')+o.cs[i]+'%';idle+=(first?'':' ')+o.ci[i]+'%';first=false;}
var cpus='cpu';if(o.cu.length>1){cpus+='0';for(var i=1;i<o.cu.length;i++)
cpus+=' cpu'+i;}
kiwi_cpu_stats_str_long=w3_inline('',w3_text('w3-text-black','Beagle: '+cpus+' '+user+' usr | '+sys+' sys | '+idle+' idle,'+(cputempC?'':' '))+
(cputempC?('&nbsp;'+w3_text(temp_color+' w3-text-outline w3-large',cputemp)+'&nbsp;'):'')+
w3_text('w3-text-black',cpufreq+', ')+
w3_text('w3-text-black','FPGA eCPU: '+ecpu.toFixed(0)+'%'));var t=uptime_secs;var sec=Math.trunc(t%60);t=Math.trunc(t/60);var min=Math.trunc(t%60);t=Math.trunc(t/60);var hr=Math.trunc(t%24);t=Math.trunc(t/24);var days=t;var s=' ';if(days)s+=days+'d:';s+=hr+':'+min.leadingZeros(2)+':'+sec.leadingZeros(2);w3_innerHTML('id-status-config',w3_text('w3-text-css-orange','Up'),w3_text('',s+', '+kiwi_config_str));s=' | Uptime: ';if(days)s+=days+' '+((days>1)?'days':'day')+' ';s+=hr+':'+min.leadingZeros(2)+':'+sec.leadingZeros(2);var noLatLon=(server_time_local==''||server_time_tzname=='null');if(server_time_utc)s+=' | UTC: '+server_time_utc;if(isDefined(server_time_tzname)){s+=' | Local: ';if(!noLatLon)s+=server_time_local+' ';s+=noLatLon?'Lat/lon needed for local time':server_tz;}
w3_innerHTML('id-msg-config',kiwi_config_str_long+s);}
function config_str_update(rx_chans,gps_chans,vmaj,vmin){kiwi_config_str='v'+vmaj+'.'+vmin+', '+rx_chans+' SDR ch, '+gps_chans+' GPS ch';w3_innerHTML('id-status-config',kiwi_config_str);kiwi_config_str_long='Config: v'+vmaj+'.'+vmin+', '+rx_chans+' SDR channels, '+gps_chans+' GPS channels';w3_innerHTML('id-msg-config',kiwi_config_str);}
var config_net={};function config_cb(rx_chans,gps_chans,serno,pub,port_ext,pvt,port_int,nm,mac,vmaj,vmin,dmaj,dmin){var s;config_str_update(rx_chans,gps_chans,vmaj,vmin);w3_innerHTML('id-msg-debian','Debian '+dmaj+'.'+dmin);kiwi.debian_maj=dmaj;kiwi.debian_min=dmin;var net_config=w3_el("id-net-config");if(net_config){net_config.innerHTML=w3_div('',w3_col_percent('',w3_div('','Public IP address (outside your firewall/router): '+pub+' [port '+port_ext+']'),50,w3_div('','Ethernet MAC address: '+mac.toUpperCase()),30,w3_div('','KiwiSDR serial number: '+serno),20),w3_col_percent('',w3_div('','Private IP address (inside your firewall/router): '+pvt+' [port '+port_int+']'),50,w3_div('','Private netmask: /'+nm),50));config_net.pub_ip=pub;config_net.pub_port=port_ext;config_net.pvt_ip=pub;config_net.pvt_port=port_int;config_net.mac=mac;config_net.serno=serno;}}
function update_cb(fail_reason,pending,in_progress,rx_chans,gps_chans,vmaj,vmin,pmaj,pmin,build_date,build_time){config_str_update(rx_chans,gps_chans,vmaj,vmin);var msg_update=w3_el("id-msg-update");if(msg_update){var s;s='Installed version: v'+vmaj+'.'+vmin+', built '+build_date+' '+build_time;if(fail_reason){var r;switch(fail_reason){case 1:r='Filesystem is FULL!';break;case 2:r='No Internet connection? (can\'t ping 1.1.1.1 or 8.8.8.8)';break;case 3:r='No connection to github.com?';break;case 4:r='Git clone damaged!';break;case 5:r='Makefile update failed -- check /root/build.log file';break;case 6:r='Build failed, check /root/build.log file';break;default:r='Unknown reason, code='+fail_reason;break;}
s+='<br>'+r;w3_hide('id-build-restart');w3_hide('id-build-reboot');}else
if(in_progress){s+='<br>Update to version v'+ +pmaj+'.'+pmin+' in progress';}else
if(pending){s+='<br>Update check pending';}else
if(pmaj==-1){s+='<br>Error determining the latest version -- check log';}else{if(vmaj==pmaj&&vmin==pmin)
s+='<br>Running most current version';else
s+='<br>Available version: v'+pmaj+'.'+pmin;}
msg_update.innerHTML=s;}}
var users_interval=2500;var user_init=false;function users_init(called_from){kiwi.called_from_admin=called_from.admin;kiwi.called_from_user=called_from.user;kiwi.called_from_monitor=called_from.monitor;if(kiwi.called_from_admin||kiwi.called_from_monitor){var id_prefix=kiwi.called_from_admin?'id-admin-user-':'id-monitor-user-';var pad=kiwi.called_from_monitor?' w3-padding-LR-2':'';var s1='',s2;for(var i=0;i<rx_chans;i++){if(kiwi.called_from_admin){s1=w3_button('id-user-kick-'+i+' w3-hide w3-small w3-white w3-border w3-border-red w3-round-large w3-padding-0 w3-padding-LR-8','Kick','status_user_kick_cb',i);}
s2=w3_div('id-campers-'+i+' w3-css-orange w3-padding-LR-8');w3_el('id-users-list').innerHTML+=w3_inline('/w3-hspace-8',w3_div('id-user-'+i+pad,'RX'+i),w3_div(id_prefix+i),s1,s2);}}
users_update();w3_call('users_setup');user_init=true;}
function users_update(){msg_send('SET GET_USERS');setTimeout(users_update,users_interval);}
function user_cb(obj){var id_prefix=kiwi.called_from_admin?'id-admin-user-':'id-monitor-user-';var host=kiwi_url_origin();obj.forEach(function(obj){var s1='',s2='',s3='';var i=obj.i;var name=obj.n;var freq=obj.f;var geoloc=obj.g;var ip=(isDefined(obj.a)&&obj.a!='')?(obj.a+', '):'';var mode=obj.m;var zoom=obj.z;var connected=obj.t;var remaining='';if(obj.rt){var t=(obj.rt==1)?' act':' 24h';remaining=' '+w3_text('w3-text-css-orange|vertical-align:bottom',obj.rs+t);}
var ext=obj.e;if(isDefined(name)){var okay=false;var deco;do{try{deco=decodeURIComponent(name);okay=true;}catch(ex){name=name.slice(0,-1);}}while(!okay);var id=kiwi_strip_tags(deco,'');if(!kiwi.called_from_admin&&id=='')id='(no identity)';if(id!='')id='"'+id+'"';var g=(geoloc=='(null)'||geoloc=='')?(kiwi.called_from_admin?'unknown location':''):decodeURIComponent(geoloc);ip=ip.replace(/::ffff:/,'');g=(ip!=''||g!='')?('('+ip+g+')'):'';var f=freq+kiwi.freq_offset_Hz;var f=(f/1000).toFixed((f>100e6)?1:2);var f_s=f+' kHz ';var fo=(freq/1000).toFixed(2);var link,target;if(kiwi.called_from_admin){link=host+'/?f='+fo+mode+'z'+zoom;target=' target="_blank"';}else{link='javascript:'+(kiwi.called_from_user?('tune('+fo+','+sq(mode)+','+zoom+')'):('camp('+i+')'));target='';}
if(ext!='')ext=decodeURIComponent(ext)+' ';s1=w3_sb(id,g)+' ';s2=w3_link('w3-link-darker-color',link,f_s+(obj.wf?'WF':mode)+' z'+zoom)+' '+ext+connected+remaining;}
if(user_init){if(kiwi.called_from_user){w3_innerHTML('id-optbar-user-'+i,(s1!='')?(s1+'<br>'+s2):'');}else{w3_innerHTML(id_prefix+i,s1+s2+s3);w3_hide2('id-user-kick-'+i,s1=='');w3_hide2('id-user-bl32-'+i,s1=='');w3_hide2('id-user-bl24-'+i,s1=='');}}
if(i==rx_chan&&isDefined(obj.c)){var el=w3_el('id-sam-carrier');if(el)w3_innerHTML(el,'carrier '+obj.c.toFixed(1)+' Hz');}
w3_innerHTML('id-campers-'+i,obj.ca?(obj.ca+plural(obj.ca,' camper')):'');if(i==rx_chan&&obj.rn){if(obj.rn<=55&&!kiwi.inactivity_panel){var s=(obj.rt==1)?'Inactivity timeout in one minute.<br>Close this panel to avoid disconnection.':'Per 24-hour connection timeout in one minute.';confirmation_show_content(s,360,55,function(){msg_send('SET inactivity_ack');confirmation_panel_close();kiwi.inactivity_panel=false;},'red');kiwi.inactivity_panel=true;}}
if(i==rx_chan&&obj.rn>55&&kiwi.inactivity_panel){confirmation_panel_close();kiwi.inactivity_panel=false;}
if(i==rx_chan&&isNumber(obj.fo)&&obj.fo!=kiwi.freq_offset_kHz&&!confirmation.displayed){var s=w3_div('','Frequency scale offset changed. Page must be reloaded.',w3_inline('w3-halign-space-around/',w3_button('w3-margin-T-16 w3-aqua','OK','freq_offset_page_reload')));confirmation_show_content(s,425,100);}
if(i==rx_chan&&isNumber(obj.nc)&&obj.nc!=rx_chan&&isNumber(obj.ns)&&obj.ns!=kiwi.notify_seq){console.log('$ NOTIFY sn='+obj.ns);msg_send('SET notify_msg');kiwi.notify_seq=obj.ns;}});}
function freq_offset_page_reload(){window.location.reload(true);}
var toggle_e={SET:1,SET_URL:2,FROM_COOKIE:4,WRITE_COOKIE:8,NO_CLOSE_EXT:16};function kiwi_toggle(flags,val_set,val_default,cookie_id){var rv=null;if(flags&toggle_e.SET_URL&&(val_set!=null||val_set!=undefined)){rv=val_set;}else
if(flags&toggle_e.FROM_COOKIE){rv=readCookie(cookie_id);if(rv!=null){var rv_num=parseFloat(rv);if(!isNaN(rv_num))rv=rv_num;}}
if(rv==null){if(flags&toggle_e.SET){rv=val_set;}}
if(rv==null){rv=val_default;}
return rv;}
function kiwi_fft_mode(){if(0){toggle_or_set_spec(toggle_e.SET,spec.RF);setmaxdb(10);}else{setmaxdb(-30);}}
function kiwi_mapPinSymbol(fillColor,strokeColor){fillColor=fillColor||'red';strokeColor=strokeColor||'white';return{path:'M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z',fillColor:fillColor,fillOpacity:1,strokeColor:strokeColor,strokeWeight:1,scale:1,};}
function isAdmin(){return(Object.keys(adm).length!=0);}
function kiwi_force_admin_close_cb(path,val,first){if(first)return;val=+val;ext_send('SET close_admin_force');confirmation_panel_close();kiwi.no_admin_conns_pend=0;if(val){setTimeout(function(){dx_send_update_retry();},1000);}else{setTimeout(function(){cfg_save_json('kiwi_force_admin_close_cb','adm');},1000);}}
function kiwi_set_freq_offset(freq_offset_kHz){kiwi.isOffset=(freq_offset_kHz!=0);kiwi.freq_offset_kHz=freq_offset_kHz;kiwi.freq_offset_Hz=freq_offset_kHz*1000;kiwi.offset_frac=(freq_offset_kHz%1000)*1000;}
function kiwi_init_cfg(){kiwi_set_freq_offset(cfg.freq_offset);var page_title=kiwi_decodeURIComponent('PAGE_TITLE',cfg.index_html_params.PAGE_TITLE);if(page_title=='')page_title='KiwiSDR';var el=w3_el('id-page-title');if(el)el.innerHTML+=page_title;w3_innerHTML('id-rx-photo-title',kiwi_decodeURIComponent('RX_PHOTO_TITLE',cfg.index_html_params.RX_PHOTO_TITLE));w3_innerHTML('id-rx-photo-desc',kiwi_decodeURIComponent('RX_PHOTO_DESC',cfg.index_html_params.RX_PHOTO_DESC));w3_innerHTML('id-rx-title',kiwi_decodeURIComponent('RX_TITLE',cfg.index_html_params.RX_TITLE));w3_innerHTML('id-owner-info',kiwi_decodeURIComponent('owner_info',cfg.owner_info));}
var reason_disabled='';var version_maj=-1,version_min=-1,debian_ver=-1;var tflags={INACTIVITY:1,WF_SM_CAL:2,WF_SM_CAL2:4};var chan_no_pwd,chan_no_pwd_true;var kiwi_output_msg_p={scroll_only_at_bottom:true,process_return_alone:false};var client_public_ip;function kiwi_msg(param,ws){var rtn=true;switch(param[0]){case"version_maj":version_maj=parseInt(param[1]);break;case"version_min":version_min=parseInt(param[1]);break;case"debian_ver":debian_ver=parseInt(param[1]);break;case"platform":kiwi.platform=parseInt(param[1]);break;case"client_public_ip":client_public_ip=param[1].replace(/::ffff:/,'');console.log('client public IP: '+client_public_ip);break;case"badp":extint_valpwd_cb(parseInt(param[1]));break;case"chan_no_pwd":chan_no_pwd=parseInt(param[1]);break;case"chan_no_pwd_true":chan_no_pwd_true=parseInt(param[1]);break;case"rx_chans":rx_chans=parseInt(param[1]);break;case"wf_chans":wf_chans=parseInt(param[1]);break;case"wf_chans_real":wf_chans_real=parseInt(param[1]);break;case"rx_chan":rx_chan=parseInt(param[1]);break;case"max_camp":max_camp=parseInt(param[1]);break;case"load_cfg":var cfg_json=decodeURIComponent(param[1]);console.log('### load_cfg '+ws.stream+' '+cfg_json.length);cfg=kiwi_JSON_parse('load_cfg',cfg_json);kiwi_init_cfg();owrx_init_cfg();break;case"load_dxcfg":var dxcfg_json=decodeURIComponent(param[1]);console.log('### load_dxcfg '+ws.stream+' '+dxcfg_json.length);dxcfg=kiwi_JSON_parse('load_dxcfg',dxcfg_json);break;case"load_dxcomm_cfg":var dxcomm_cfg_json=decodeURIComponent(param[1]);console.log('### load_dxcomm_cfg '+ws.stream+' '+dxcomm_cfg_json.length);dxcomm_cfg=kiwi_JSON_parse('load_dxcomm_cfg',dxcomm_cfg_json);break;case"load_adm":var adm_json=decodeURIComponent(param[1]);console.log('### load_adm '+ws.stream+' '+adm_json.length);adm=kiwi_JSON_parse('load_adm',adm_json);break;case"no_admin_conns":var retry_dx_update=parseInt(param[1]);kiwi.no_admin_conns_pend++;if(kiwi.no_admin_conns_pend==1){confirmation_panel_close();confirmation_show_content('Must close admin connection before attempting this operation.'+
w3_button('w3-small w3-padding-smaller w3-yellow w3-margin-T-8','Close admin connection and complete original operation','kiwi_force_admin_close_cb',retry_dx_update),500,75,function(){confirmation_panel_close();kiwi.no_admin_conns_pend=0;},'red');}
break;case"foff_error":kiwi.foff_error_pend++;if(kiwi.foff_error_pend==1){setTimeout(function(){confirmation_panel_close();confirmation_show_content((+param[1]==0)?'"foff=" URL parameter available from local connections only.':'Must close admin connection before using "foff=" URL parameter.',500,55,function(){confirmation_panel_close();kiwi.foff_error_pend=0;},'red');},5000);}
break;case"request_dx_update":if(isAdmin()){if(dx.ignore_dx_update){dx.ignore_dx_update=false;}else{dx_update_admin();}}else{dx_update_request();}
break;case"mkr":var mkr=param[1];var obj=kiwi_JSON_parse('mkr',mkr);if(obj)dx_label_render_cb(obj);break;case"user_cb":var obj=kiwi_JSON_parse('user_cb',param[1]);if(obj)user_cb(obj);break;case"config_cb":var o=kiwi_JSON_parse('config_cb',param[1]);if(o)config_cb(o.r,o.g,o.s,o.pu,o.pe,o.pv,o.pi,o.n,o.m,o.v1,o.v2,o.d1,o.d2);break;case"update_cb":var o=kiwi_JSON_parse('update_cb',param[1]);if(o)update_cb(o.f,o.p,o.i,o.r,o.g,o.v1,o.v2,o.p1,o.p2,decodeURIComponent(o.d),decodeURIComponent(o.t));break;case"stats_cb":var o=kiwi_JSON_parse('stats_cb',param[1]);if(o){if(o.ce!=undefined)
cpu_stats_cb(o,o.ct,o.ce,o.fc);xfer_stats_cb(o.ac,o.wc,o.fc,o.ah,o.as);extint.srate=o.sr;extint.nom_srate=o.nsr;gps_stats_cb(o.ga,o.gt,o.gg,o.gf,o.gc,o.go);if(o.gr){kiwi.WSPR_rgrid=decodeURIComponent(o.gr);kiwi.GPS_fixes=o.gf;}
if(o.sh==-1){w3_innerHTML('id-rx-snr',', SNR ',o.sa,' dB');w3_innerHTML('id-msg-snr','SNR: All ',o.sa,' dB');}else{w3_innerHTML('id-rx-snr',', SNR ',o.sa,':',o.sh,' dB');w3_innerHTML('id-msg-snr','SNR: All ',o.sa,' dB, HF ',o.sh,' dB');}
admin_stats_cb(o.ad,o.au,o.ae,o.ar,o.an,o.ap,o.an2,o.ai);w3_call('config_status_cb',o);time_display_cb(o);}
break;case"status_msg_text":kiwi_output_msg_p.s=param[1];kiwi_output_msg('id-output-msg','id-output-msg',kiwi_output_msg_p);break;case"status_msg_html":var s=kiwi_decodeURIComponent('status_msg_html',param[1]);w3_innerHTML('id-status-msg',s);w3_innerHTML('id-msg-status',s);break;case"is_admin":extint.isAdmin_cb(param[1]);break;case"is_local":var p=param[1].split(',');console.log('kiwi_msg rx_chan='+p[0]+' is_local='+p[1]);kiwi.is_local[+p[0]]=+p[1];break;case"no_admin_reopen_retry":admin.no_admin_reopen_retry=true;break;case"is_multi_core":kiwi.is_multi_core=1;break;case"authkey_cb":extint_authkey_cb(param[1]);break;case"down":kiwi_down(param[1],reason_disabled);break;case"too_busy":kiwi_too_busy(parseInt(param[1]));break;case"monitor":kiwi_monitor();break;case"exclusive_use":kiwi_exclusive_use();break;case"inactivity_timeout":kiwi_inactivity_timeout(param[1]);break;case"ip_limit":var p=decodeURIComponent(param[1]).split(',');kiwi_24hr_ip_limit(parseInt(p[0]),p[1]);break;case"password_timeout":kiwi_password_entry_timeout();break;case"reason_disabled":reason_disabled='User connections disabled.'+
((param[1]!='')?(' Reason: '+kiwi_decodeURIComponent('reason_disabled',param[1])):'');break;case"sample_rate":extint.srate=parseFloat(param[1]);break;case'pref_import_ch':kiwi.prefs_import_ch=+param[1];break;case'pref_import':prefs_import_cb(param[1],kiwi.prefs_import_ch);break;case'adc_clk_nom':extint_adc_clock_nom_Hz=+param[1];break;case'notify_msg':var s=kiwi_decodeURIComponent('notify_msg',param[1]);console.log('notify_msg: '+s);if(confirmation.displayed)break;s=w3_div('',s);confirmation_show_content(s,425,50);setTimeout(confirmation_panel_close,3000);break;case'kiwi_kick':var s=param[1]+((cfg.reason_kicked!='')?('<br>Reason: '+cfg.reason_kicked):'');s=kiwi_decodeURIComponent('kiwi_kick',s);if(confirmation.displayed)break;s=w3_div('',s);confirmation_show_content(s,425,75,null,'red');break;default:rtn=false;break;}
return rtn;}
function kiwi_debug(msg,syslog){console.log(msg);msg_send('SET '+(syslog?'dbug_msg=':'x-DEBUG=')+encodeURIComponent(msg));}
function kiwi_show_msg(s){html('id-kiwi-msg').innerHTML=s;if(s==''){w3_hide('id-kiwi-msg-container');w3_el('id-kiwi-body').style.overflow='hidden';}else{w3_hide('id-kiwi-container');w3_show_block('id-kiwi-msg-container');w3_el('id-kiwi-body').style.overflow='scroll';}}
function kiwi_server_error(s){kiwi_show_msg('Hmm, there seems to be a problem. <br>'+'The server reported the error: <span style="color:red">'+s+'</span>');seriousError=true;}
function kiwi_serious_error(s){kiwi_show_msg(s);seriousError=true;console.log(s);}
function kiwi_trace(msg){if(msg)console.log('kiwi_trace: '+msg);try{console.trace();}catch(ex){}}
function kiwi_trace_mobile(msg){alert(msg+' '+Error().stack);}





/* web/kiwi/kiwi_ui.min.js (web/kiwi/kiwi_ui.js = Sun May 21 09:34:21 2023) */
function dx_get_value(v){return w3_get_value('dx.o.'+v+'_'+dx.o.gid);}
function dx_update_check(idx,upd,isPassband){var user=(idx==dx.IDX_USER);if(!user)dx.o.gid=idx=+idx;var dx_mode_idx,mode_menu_idx,mode_s;if(user){mode_menu_idx=+dx.o.mm;mode_s=kiwi.mode_menu[mode_menu_idx];dx_mode_idx=w3_array_el_seq(kiwi.modes_uc,mode_s);console.log('dx_update_check USER dx_mode_idx='+dx_mode_idx+' mode_menu_idx='+mode_menu_idx+' '+mode_s);}else{mode_menu_idx=+dx_get_value('mm');mode_s=kiwi.mode_menu[mode_menu_idx];dx_mode_idx=w3_array_el_seq(kiwi.modes_uc,mode_s);console.log('dx_update_check ADMIN dx_mode_idx='+dx_mode_idx+' mode_menu_idx='+mode_menu_idx+' '+mode_s);}
dx.o.fm=+dx_mode_idx;if(idx==dx.IDX_USER)return true;console.log('### dx_update_check gid(idx)='+idx+' '+((upd==dx.UPD_ADD)?'ADD':'MODIFY'));dx.o.fr=+dx_get_value('fr');dx.o.ft=+dx_get_value('ft');dx.o.fd=dx.o.last_fd[idx];dx.o.b=+dx_get_value('b');dx.o.e=+dx_get_value('e');dx.o.o=+dx_get_value('o');dx.o.s=+dx_get_value('s');dx.o.i=dx_get_value('i');dx.o.n=dx_get_value('n');dx.o.p=dx_get_value('p');if(!isPassband){if(idx>=0&&dx.o.last_pb[idx]){dx.o.lo=dx.o.last_pb[idx][0];dx.o.hi=dx.o.last_pb[idx][1];}else{dx.o.lo=dx.o.hi=0;}}
var flags=(dx.o.fd<<dx.DX_DOW_SFT)|(dx.o.ft<<dx.DX_TYPE_SFT)|dx_encode_mode(dx.o.fm);if(dx.o.fr<0)dx.o.fr=0;if(upd==dx.UPD_ADD)
dx.o.gid=-1;else
dx.ignore_dx_update=true;console.log('dx.o:');console.log(dx.o);var begin=+(dx.o.b),end=+(dx.o.e);if(begin==0&&end==0)end=2400;console.log('SET DX_UPD g='+dx.o.gid+' f='+dx.o.fr+' lo='+dx.o.lo+' hi='+dx.o.hi+' o='+dx.o.o.toFixed(0)+' s='+dx.o.s.toFixed(0)+' fl='+flags+'(dow='+dx.o.fd+'|ty='+dx.o.ft+'|mo='+dx.o.fm+') b='+begin+' e='+end+' i='+dx.o.i+' n='+dx.o.n+' p='+dx.o.p);ext_send('SET DX_UPD g='+dx.o.gid+' f='+dx.o.fr+' lo='+dx.o.lo.toFixed(0)+' hi='+dx.o.hi.toFixed(0)+' o='+dx.o.o.toFixed(0)+' s='+dx.o.s.toFixed(0)+' fl='+flags+' b='+begin+' e='+end+' i='+encodeURIComponent(dx.o.i+'x')+' n='+encodeURIComponent(dx.o.n+'x')+' p='+encodeURIComponent(dx.o.p+'x'));w3_call('dx_sched_save','id-dx-list-saved',1000);return false;}
function dx_num_cb(path,val,first){if(first)return;var o=w3_remove_trailing_index(path,'_');console.log('dx_num_cb path='+path+' val='+val+' o.idx='+o.idx);w3_num_cb(o.el,val);if(dx_update_check(o.idx,dx.UPD_MOD))dx_button_highlight();}
function dx_freq_cb(path,val,first){if(first)return;var o=w3_remove_trailing_index(path,'_');val=val.parseFloatWithUnits('kM',1e-3);console.log('dx_num_cb path='+path+' val='+val+' o.idx='+o.idx);w3_set_value(path,val);w3_num_cb(o.el,val);if(dx_update_check(o.idx,dx.UPD_MOD))dx_button_highlight();}
function dx_sel_cb(path,val,first){if(first)return;var o=w3_remove_trailing_index(path,'_');console.log('dx_sel_cb path='+path+' val='+val+' o.idx='+o.idx);w3_num_cb(o.el,+val);if(dx_update_check(o.idx,dx.UPD_MOD))dx_button_highlight();}
function dx_string_cb(path,val,first){if(first)return;var o=w3_remove_trailing_index(path,'_');console.log('dx_string_cb path='+path+' val='+val+' o.idx='+o.idx);w3_string_cb(o.el,val);if(dx_update_check(o.idx,dx.UPD_MOD))dx_button_highlight();}
function dx_dow_button(path,day_i){var o=w3_remove_trailing_index(path,'_');console.log('dx_dow_button path='+path+' o.idx='+o.idx);var user=(o.idx==dx.IDX_USER);var dow_b=1<<(6-(+day_i));var dow=user?dx.o.fd:dx.o.last_fd[o.idx];var before=dow;dow^=dow_b;if(user)
dx.o.fd=dow;else
dx.o.last_fd[o.idx]=dow;var sel=dow&dow_b;console.log('dx_dow_button day_i='+day_i+' dow_b='+dow_b.toHex(2)+' sel='+sel.toHex(2)+' before='+before.toHex(2)+' after='+dow.toHex(2)+' o.idx='+o.idx);w3_color(path,sel?'black':'white',sel?dx.dow_colors[day_i]:'darkGrey');if(dx_update_check(o.idx,dx.UPD_MOD))dx_button_highlight();}
function dx_sched_time_cb(path,val,first){val=(+val).toFixed(0).leadingZeros(4);dx_string_cb(path,val,first);w3_set_value(path,val);var o=w3_remove_trailing_index(path,'_');if(o.idx==dx.IDX_USER)dx_button_highlight();}
function dx_passband_cb(path,val,first){if(first)return;var a=val.split(/[,\s]/);var len=a.length;console.log('dx_passband_cb path='+path+' val='+val+' a.len='+len);console.log(a);if(len==1&&a[0]!=''){var hbw=Math.round(a[0].parseFloatWithUnits('kM')/ 2);dx.o.lo=-hbw;dx.o.hi=hbw;}else
if(len>=1&&a[0]!=''&&a[len-1]!=''){dx.o.lo=Math.round(a[0].parseFloatWithUnits('kM'));dx.o.hi=Math.round(a[len-1].parseFloatWithUnits('kM'));}else{dx.o.lo=dx.o.hi=0;}
var o=w3_remove_trailing_index(path,'_');dx.o.last_pb[o.idx]=[dx.o.lo,dx.o.hi];console.log('dx_passband_cb lo='+dx.o.lo+' hi='+dx.o.hi+' o.idx='+o.idx);if(dx_update_check(o.idx,dx.UPD_MOD,true))dx_button_highlight();}





/* web/kiwi/kiwi_util.min.js (web/kiwi/kiwi_util.js = Sun Jun  4 12:07:39 2023) */
function isUndefined(v){return(typeof(v)==='undefined');}
function isDefined(v){return(typeof(v)!=='undefined');}
function isNull(v){return(v===null);}
function isNumber(v){return(typeof(v)==='number'&&!isNaN(v));}
function isBoolean(v){return(typeof(v)==='boolean');}
function isString(v){return(typeof(v)==='string');}
function isNonEmptyString(v){return(isString(v)&&v!=='');}
function isArray(v){return(Array.isArray(v));}
function isNonEmptyArray(v){return(isArray(v)&&v.length>0);}
function isFunction(v){return(typeof(v)==='function');}
function isObject(v){return(typeof(v)==='object');}
function isArg(v){return(isUndefined(v)||isNull(v))?false:true;}
function isNoArg(v){return(isUndefined(v)||isNull(v))?true:false;}
function kiwi_typeof(v){return isNull(v)?'null':(isArray(v)?'array':typeof(v));}
function ifString(s,alt){return(isString(s)?s:alt);}
try{if(!String.prototype.includes){String.prototype.includes=function(str){return(this.indexOf(str)>=0);}}}catch(ex){console.log("kiwi_util: String.prototype.includes");}
try{if(!String.prototype.startsWith){String.prototype.startsWith=function(str){return this.indexOf(str)==0;}}}catch(ex){console.log("kiwi_util: String.prototype.startsWith");}
try{if(!String.prototype.endsWith){String.prototype.endsWith=function(search,this_len){if(this_len===undefined||this_len>this.length){this_len=this.length;}
return this.substring(this_len-search.length,this_len)===search;};}}catch(ex){console.log("kiwi_util: String.prototype.endsWith");}
var kiwi_util={};var kiwi_iOS,kiwi_iPhone,kiwi_MacOS,kiwi_linux,kiwi_Windows,kiwi_android;var kiwi_safari,kiwi_firefox,kiwi_chrome,kiwi_opera,kiwi_smartTV;document.onreadystatechange=function(){if(document.readyState=="complete"){var website=false;var el=w3_el('id-kiwi-container');if(el&&el.getAttribute('data-type')=='website')website=true;var s=navigator.userAgent;if(!website)console.log(s);kiwi_iOS=(s.includes('iPhone')||s.includes('iPad'));kiwi_iPhone=s.includes('iPhone');kiwi_MacOS=s.includes('OS X');kiwi_linux=s.includes('Linux');kiwi_Windows=s.includes('Win');kiwi_android=s.includes('Android');kiwi_safari=/safari\/([0-9]+)/i.exec(s);kiwi_browserVersion=/version\/([0-9]+)/i.exec(s);kiwi_firefox=/firefox\/([0-9]+)/i.exec(s);kiwi_chrome=/chrome\/([0-9]+)/i.exec(s);kiwi_opera=/opera\/([0-9]+)/i.exec(s);if(!kiwi_opera)kiwi_opera=/OPR\/([0-9]+)/i.exec(s);kiwi_smartTV=s.includes('SmartTV');if(!kiwi_smartTV)kiwi_smartTV=s.includes('SMART-TV');if(kiwi_smartTV){if(s.includes('Samsung'))kiwi_smartTV='Samsung';else
if(s.includes('LG'))kiwi_smartTV='LG';}
if(!website)console.log('MacOS='+kiwi_MacOS+' Linux='+kiwi_linux+' Windows='+kiwi_Windows+' iOS='+kiwi_iOS+' iPhone='+kiwi_iPhone+' Android='+kiwi_android+' SmartTV='+kiwi_smartTV);if(kiwi_opera){kiwi_chrome=kiwi_safari=null;}else
if(kiwi_chrome){kiwi_safari=null;}else
if(kiwi_safari){if(kiwi_browserVersion)kiwi_safari[1]=kiwi_browserVersion[1];}
if(!website)console.log('Safari='+kiwi_isSafari()+' Firefox='+kiwi_isFirefox()+' Chrome='+kiwi_isChrome()+' Opera='+kiwi_isOpera());if(!website){kiwi_load_js('pkgs/js/sprintf/sprintf.js',function(){kiwi_load2();});}else{kiwi_load2();}}}
function kiwi_load2(){if(typeof(kiwi_check_js_version)!=='undefined'){kiwi_ajax("/VER",'kiwi_version_cb');}else{if(typeof(kiwi_bodyonload)!=='undefined')
kiwi_bodyonload('');}}
function kiwi_is_iOS(){return kiwi_iOS;}
function kiwi_is_iPhone(){return kiwi_iPhone;}
function kiwi_isMacOS(){return kiwi_MacOS;}
function kiwi_isWindows(){return kiwi_Windows;}
function kiwi_isLinux(){return kiwi_linux;}
function kiwi_isAndroid(){return kiwi_android;}
function kiwi_isSmartTV(){return kiwi_smartTV;}
function kiwi_isMobile(){return(force_mobile||kiwi_is_iOS()||kiwi_isAndroid()||(kiwi_isSmartTV()=='Samsung')||mobile_laptop_test);}
function kiwi_isSafari(){return(kiwi_safari?kiwi_safari[1]:NaN);}
function kiwi_isFirefox(){return(kiwi_firefox?kiwi_firefox[1]:NaN);}
function kiwi_isChrome(){return(kiwi_chrome?kiwi_chrome[1]:NaN);}
function kiwi_isOpera(){return(kiwi_opera?kiwi_opera[1]:NaN);}
var kiwi_version_fail=false;function kiwi_version_cb(response_obj){version_maj=response_obj.maj;version_min=response_obj.min;var s='';kiwi_check_js_version.forEach(function(el){if(el.VERSION_MAJ!=version_maj||el.VERSION_MIN!=version_min){if(kiwi_version_fail==false){s='Your browser is trying to use incorrect versions of the KiwiSDR Javascript files.<br>'+'Please clear your browser cache and try again.<br>'+'Or click the button below to continue anyway.<br><br>'+'v'+version_maj+'.'+version_min+': KiwiSDR server<br>';kiwi_version_fail=true;}
s+='v'+el.VERSION_MAJ+'.'+el.VERSION_MIN+': '+el.file+'<br>';}});if(kiwi_version_fail)
s+='<br>'+w3_button('w3-css-yellow','Continue anyway','kiwi_version_continue_cb');kiwi_bodyonload(s);}
function kiwi_version_continue_cb(){seriousError=false;kiwi_bodyonload('');}
function ord(c,base){if(isString(base))
return c.charCodeAt(0)-base.charCodeAt(0);else
return c.charCodeAt(0);}
function chr(i){return String.fromCharCode(i);}
function sq(s){return'\''+s+'\'';}
function dq(s){return'\"'+s+'\"';}
function dqc(s){return'"'+s+'":';}
function paren(s){return'('+s+')';}
function plural(num,word){if(num==1)return word;else return word+'s';}
function arrayBufferToString(buf){var s;try{if(0){s=String.fromCharCode.apply(null,new Uint8Array(buf));}else{var u8buf=new Uint8Array(buf);s='';for(var i=0;i<u8buf.length;i++)s+=String.fromCharCode(u8buf[i]);}}catch(ex){console.log(buf);console.log(ex);kiwi_trace('arrayBufferToString');s=null;}
return s;}
function arrayBufferToStringLen(buf,len){var u8buf=new Uint8Array(buf);var output=String();len=Math.min(len,u8buf.length);for(var i=0;i<len;i++)output+=String.fromCharCode(u8buf[i]);return output;}
function kiwi_dup_array(a){return a.slice();}
function kiwi_dedup_array(a,func){var ra=[];a.forEach(function(v,i){if(func){var rv=func(v);if(!rv||rv.err)return;v=rv.v;}
if(!ra.includes(v))ra.push(v);});return ra;}
function kiwi_shallow_copy(obj){return Object.assign({},obj);}
function kiwi_deep_copy(obj){return JSON.parse(JSON.stringify(obj));}
function kiwi_bitReverse(v,len){if(v==0)return 0;var rv=0;for(i=0;i<len;i++){rv|=((v>>i)&1)<<(len-1-i);}
return rv>>>0;}
function kiwi_bitCount(n){if(n==0)return 0;return n.toString(2).match(/1/g).length}
function getFirstChars(buf,len){arrayBufferToStringLen(buf,len);}
function removeEnding(str,ending){if(str.endsWith(ending))
return str.slice(0,-ending.length);else
return str;}
function kiwi_inet4_d2h(inet4_str,exclude_local){var s=inet4_str.split('.');if(s.length!=4)return null;var check=function(v){var n=parseInt(v);if(!isNumber(n)||n<0||n>255)return null;return n;}
var a,b,c,d;if((a=check(s[0]))==null)return null;if((b=check(s[1]))==null)return null;if((c=check(s[2]))==null)return null;if((d=check(s[3]))==null)return null;var ip=(a<<24)|(b<<16)|(c<<8)|d;if(exclude_local){if((ip>=kiwi_ip_10_lo&&ip<=kiwi_ip_10_hi)||(ip>=kiwi_ip_172_16_lo&&ip<=kiwi_ip_172_16_hi)||(ip>=kiwi_ip_192_168_lo&&ip<=kiwi_ip_192_168_hi)||(ip==kiwi_ip_loopback)){return null;}}
return ip;}
var kiwi_ip_10_lo=kiwi_inet4_d2h('10.0.0.0');var kiwi_ip_10_hi=kiwi_inet4_d2h('10.255.255.255');var kiwi_ip_172_16_lo=kiwi_inet4_d2h('172.16.0.0');var kiwi_ip_172_16_hi=kiwi_inet4_d2h('172.31.255.255');var kiwi_ip_192_168_lo=kiwi_inet4_d2h('192.168.0.0');var kiwi_ip_192_168_hi=kiwi_inet4_d2h('192.168.255.255');var kiwi_ip_loopback=kiwi_inet4_d2h('127.0.0.1');function kiwi_h2n_32(ip,o){var n;switch(o){case 0:n=ip>>24;break;case 1:n=ip>>16;break;case 2:n=ip>>8;break;case 3:n=ip;break;default:n=0;break;}
return n&0xff;}
function kiwi_ip_str(ip){var s='';if(isNumber(ip))
s=kiwi_h2n_32(ip,0)+'.'+kiwi_h2n_32(ip,1)+'.'+kiwi_h2n_32(ip,2)+'.'+kiwi_h2n_32(ip,3);else
if(isArray(ip))
s=ip[3]+'.'+ip[2]+'.'+ip[1]+'.'+ip[0];else
if(isObject(ip))
s=ip.a+'.'+ip.b+'.'+ip.c+'.'+ip.d;return s;}
Number.prototype.leadingZeros=function(size){var s=String(this);if(!isNumber(size))size=2;while(s.length<size)s='0'+s;return s;}
String.prototype.leadingZeros=function(size){var s=String(this);if(!isNumber(size))size=2;while(s.length<size)s='0'+s;return s;}
Number.prototype.fieldWidth=function(size){var s=String(this);if(!isNumber(size))return s;while(s.length<size)s=' '+s;return s;}
String.prototype.fieldWidth=function(size){var s=String(this);if(!isNumber(size))return s;while(s.length<size)s=' '+s;return s;}
String.prototype.filterInt=function(){var s=String(this);if(/^(\-|\+)?([0-9]+|Infinity)$/.test(s))
return Number(s);return NaN;}
String.prototype.parseIntEnd=function(){var s=String(this);var a=s.match(/[^-\d]+([-\d]+$)/);if(a.length==2&&isNumber(+a[1]))
return Number(a[1]);return NaN;}
String.prototype.withSign=function(){var s=this;var n=Number(s);return(n<0)?s:('+'+s);}
String.prototype.positiveWithSign=function(){var s=this;var n=Number(s);return(n<=0)?s:('+'+s);}
function isHexDigit(c){return('0123456789ABCDEFabcdef'.indexOf(c)>-1);}
Number.prototype.toHex=function(digits){if(!isNumber(digits))digits=0;var add_0x=(digits<0)?0:1;digits=Math.abs(digits);var n=Number(this);n=n>>>0;var s=n.toString(16);while(s.length<digits)s='0'+s;if(add_0x)s='0x'+s;return s;}
Number.prototype.toFixedNZ=function(d){var n=Number(this);var s=n.toFixed(d);while(s.endsWith('0'))
s=s.slice(0,-1);if(s.endsWith('.'))s=s.slice(0,-1);return s;}
Number.prototype.toUnits=function(){var n=Number(this);if(n<1000){return n.toString();}else
if(n<1e6){return(n/1e3).toFixed(1)+'k';}else
if(n<1e9){return(n/1e6).toFixed(1)+'M';}else{return(n/1e9).toFixed(1)+'G';}}
String.prototype.parseFloatWithUnits=function(allowed_suffixes,adj,frac_digits){var s=String(this);var v=parseFloat(s);if(isNaN(v))return NaN;if(!allowed_suffixes||allowed_suffixes.includes('k'))
if(new RegExp('([-0-9.]*k)').test(s)){v*=1e3;if(isNumber(adj))v*=adj;}
if(!allowed_suffixes||allowed_suffixes.includes('M'))
if(new RegExp('([-0-9.]*M)').test(s)){v*=1e6;if(isNumber(adj))v*=adj;}
return kiwi_round(v,frac_digits);}
function kiwi_round(v,frac_digits){if(!isNumber(frac_digits)||frac_digits<0)return v;var factor=Math.pow(10,frac_digits);return Math.round(v*factor)/ factor;}
Number.prototype.withSign=function(){var n=Number(this);var s=n.toString();return(n<0)?s:('+'+s);}
var kHz=function(f){return(f / 1e3).toFixed(3)+'k';}
function kiwi_setTimeout(func,msec,param){func(param);return setTimeout(func,msec,param);}
function kiwi_clearTimeout(timeout){try{clearTimeout(timeout);}catch(e){};}
function kiwi_setInterval(func,msec,param){func(param);return setInterval(func,msec,param);}
function kiwi_clearInterval(interval){try{clearInterval(interval);}catch(e){};}
var littleEndian=(function(){var buffer=new ArrayBuffer(2);new DataView(buffer).setInt16(0,256,true);return new Int16Array(buffer)[0]===256;})();function _nochange(v){if(arguments.length==0)return undefined;return(v===undefined);}
function _default(v){if(arguments.length==0)return NaN;return isNaN(v);}
function _change(v){return(!_nochange(v)&&!_default(v));}
function console_log(){var s;for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(i==0){s=arg+': ';}else{s+='arg'+(i-1)+'='+arg+' ';}}
console.log('CONSOLE_LOG '+s);}
function console_log_fqn(){var s;for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(i==0){s=arg+': ';}else{var val;try{val=getVarFromString(arg);}catch(ex){val='[not defined]';}
var lio=arg.lastIndexOf('.');var name=(lio==-1)?arg:arg.substr(lio+1);s+=name+'='+val+' ';}}
console.log('FQN '+s);}
function console_log_dbgUs(){if(!dbgUs)return;s='';for(var i=0;i<arguments.length;i++)
s+=arguments[i].toString();console.log(s);}
function kiwi_log(s){setTimeout(function(s){console.log(s);},1,s);}
function kiwi_trace_log(s){setTimeout(function(s){kiwi_trace(s);},1,s);}
function canvas_log_int(s){var el;if(!kiwi.canvas_log_init){el=w3_el('id-news');el.style.top='';el.style.bottom='';el.style.left='';el.style.right='';if(kiwi_isMobile()){var w=window.innerWidth;var h=window.innerHeight;if(w<=768&&h>=600){el.style.top='36px';el.style.left='0';el.style.width='350px';el.style.height='400px';}else{el.style.top='36px';el.style.right='0';el.style.width='150px';el.style.height='150px';}}else{el.style.bottom='0';el.style.left='0';el.style.width='350px';el.style.height='300px';}
el.style.visibility='visible';el.style.zIndex=9999;kiwi.canvas_log_init=true;}
el=w3_el('id-news-inner');w3_innerHTML(el,s);w3_scrollDown(el);}
function canvas_log_clear(){if(kiwi.canvas_log_init==true)
canvas_log('\f');}
function canvas_log(s){if(isUndefined(owrx.news_acc_s))owrx.news_acc_s='<br>';if(s=='\f'){owrx.news_acc_s='<br>';}else
if(s.charAt(0)=='$'){owrx.news_acc_s+='<br>'+s;}else{owrx.news_acc_s+=((owrx.news_acc_s!='<br>')?' | ':'')+s;}
canvas_log_int(owrx.news_acc_s);}
function canvas_log2(s){if(kiwi_isMobile())
toggle_or_set_hide_bars(owrx.HIDE_BANDBAR);w3_innerHTML('id-rx-title',kiwi.log2_seq+': '+s);kiwi.log2_seq++;}
function kiwi_pathToSelector(node){if(!node||!node.outerHTML){return null;}
var path;while(node.parentElement){var name=node.localName;if(!name)break;name=name.toLowerCase();var parent=node.parentElement;var domSiblings=[];if(parent.children&&parent.children.length>0){for(var i=0;i<parent.children.length;i++){var sibling=parent.children[i];if(sibling.localName&&sibling.localName.toLowerCase){if(sibling.localName.toLowerCase()===name){domSiblings.push(sibling);}}}}
if(domSiblings.length>1){name+=':eq('+domSiblings.indexOf(node)+')';}
path=name+(path?'>'+path:'');node=parent;}
return path;}
function kiwi_serializeEvent(e){if(e){var o={eventName:e.toString(),altKey:e.altKey,bubbles:e.bubbles,button:e.button,buttons:e.buttons,cancelBubble:e.cancelBubble,cancelable:e.cancelable,clientX:e.clientX,clientY:e.clientY,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:e.currentTarget?e.currentTarget.outerHTML:null,defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,fromElement:e.fromElement?e.fromElement.outerHTML:null,isTrusted:e.isTrusted,layerX:e.layerX,layerY:e.layerY,metaKey:e.metaKey,movementX:e.movementX,movementY:e.movementY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,path:kiwi_pathToSelector(e.path&&e.path.length?e.path[0]:null),relatedTarget:e.relatedTarget?e.relatedTarget.outerHTML:null,returnValue:e.returnValue,screenX:e.screenX,screenY:e.screenY,shiftKey:e.shiftKey,sourceCapabilities:e.sourceCapabilities?e.sourceCapabilities.toString():null,target:e.target?e.target.outerHTML:null,timeStamp:e.timeStamp,toElement:e.toElement?e.toElement.outerHTML:null,type:e.type,view:e.view?e.view.toString():null,which:e.which,x:e.x,y:e.y};var s=JSON.stringify(o,null,2);return s;}
return'(null)';}
function event_dump(evt,id,oneline){var k=evt.key||'(no key)';if(oneline){var trel=(isDefined(evt.relatedTarget)&&evt.relatedTarget)?(' Trel='+evt.relatedTarget.id):'';var key='';if(evt.shiftKey)key+='shift-';if(evt.ctrlKey)key+='ctrl-';if(evt.altKey)key+='alt-';if(evt.metaKey)key+='meta-';key+=k;var ct_id=evt.currentTarget?evt.currentTarget.id:'(null)';console.log('event_dump '+id+' |'+evt.type+'| k='+key+' T='+evt.target.id+' Tcur='+ct_id+trel);}else{console.log('================================');if(isNoArg(evt)){console.log('EVENT_DUMP: '+id+' bad evt');kiwi_trace();return;}
console.log('EVENT_DUMP: '+id+' type='+evt.type);console.log((evt.shiftKey?'SFT ':'')+(evt.ctrlKey?'CTL ':'')+(evt.altKey?'ALT ':'')+(evt.metaKey?'META ':'')+'key='+k);var ct_id=evt.currentTarget?evt.currentTarget.id:'(null)';console.log('this.id='+this.id+' tgt.name='+evt.target.nodeName+' tgt.id='+evt.target.id+' ctgt.id='+ct_id);var buttons='';if(evt.buttons&1)buttons+='L';if(evt.buttons&4)buttons+='M';if(evt.buttons&2)buttons+='R';console.log('button='+"LMR"[evt.button]+' buttons='+buttons+' detail='+evt.detail);if(evt.type.startsWith('touch')){console.log('pageX='+evt.pageX+' clientX='+evt.clientX+' screenX='+evt.screenX);console.log('pageY='+evt.pageY+' clientY='+evt.clientY+' screenY='+evt.screenY);}else{console.log('pageX='+evt.pageX+' clientX='+evt.clientX+' screenX='+evt.screenX+' offX(EXP)='+evt.offsetX+' layerX(DEPR)='+evt.layerX);console.log('pageY='+evt.pageY+' clientY='+evt.clientY+' screenY='+evt.screenY+' offY(EXP)='+evt.offsetY+' layerY(DEPR)='+evt.layerY);}
console.log('evt, evt.target, evt.currentTarget, evt.relatedTarget, elementFromPoint:');console.log(evt);console.log(evt.target);console.log(evt.currentTarget);console.log(evt.relatedTarget);if(isNumber(evt.pageX)&&isNumber(evt.pageY))
console.log(document.elementFromPoint(evt.pageX,evt.pageY));else
console.log('(no x,y)');console.log('----');}}
function kiwi_rateLimit(cb,time){var waiting=false;var rtn=function(){if(waiting)return;waiting=true;var args=arguments;setTimeout(function(){waiting=false;if(isString(cb))
w3_call(cb);else
cb.apply(this,args);},time);};return rtn;}
function kiwi_UTC_minutes(){var d=new Date();return(d.getUTCHours()*60+d.getUTCMinutes());}
function kiwi_hh_mm(hh_mm){if(isNumber(hh_mm))return hh_mm;if(isString(hh_mm)){var t=hh_mm.split(':');var hr=+t[0];if(t.length>1){var min=(+t[1])/ 60;hr=(hr<0)?(hr-min):(hr+min);}
if(t[0]=='-0'||t[0]=='-00')
hr=-hr;return hr;}
return null;}
function kiwi_UTCdoyToDate(doy,year,hour,min,sec){return new Date(Date.UTC(year,0,doy,hour,min,sec));}
function kiwi_decodeURIComponent(id,uri){var obj=null,double_fail=false;if(dbgUs&&arguments.length!=2){alert('kiwi_decodeURIComponent: requires exactly two args');kiwi_trace();return null;}
while(obj==null){try{obj=decodeURIComponent(uri);}catch(ex){console.log('$kiwi_decodeURIComponent('+id+'): decode fail');console.log(uri);if(double_fail){console.log('kiwi_decodeURIComponent('+id+'): DOUBLE DECODE FAIL');console.log(uri);console.log(ex);return null;}
for(var i=0;i<uri.length-2;i++){var c1=uri.charAt(i+1);var c2=uri.charAt(i+2);if(uri.charAt(i)=='%'&&isHexDigit(c1)&&isHexDigit(c2)){if(c1>='8'){var x0=uri.charAt(i-1);x0=x0.charCodeAt(0);uri=uri.substr(0,i)+uri.substr(i+3);i=0;double_fail=true;}}}
obj=null;}}
return obj;}
kiwi_util.str_recode_lookup=[];var e1=function(c){kiwi_util.str_recode_lookup[ord(c)]=1;}
var e2=function(c){kiwi_util.str_recode_lookup[ord(c)]=2;}
var er=function(r1,r2,v){for(var i=r1;i<=r2;i++)
kiwi_util.str_recode_lookup[i]=v;}
er(0,127,0);e1('&');e1("'");e1('+');e1(';');e1('<');e1('>');e1('`');e2('"');e2('%');e2('\\');er(0x00,0x1f,2);er(0x7f,0x7f,2);function kiwi_str_decode_selective_inplace(src,fewer_encoded){var i,dst='';var src_len=src.length;var dst_len=src.length+1;var hex_digit=/[0-9a-fA-F]/;for(i=0;i<src_len;i++){if(src[i]=='%'&&i+2<src_len&&src[i+1].match(hex_digit)&&src[i+2].match(hex_digit)){var c=(parseInt(src[i+1],16)<<4)|parseInt(src[i+2],16);if(c<0x80&&(kiwi_util.str_recode_lookup[c]==0||(fewer_encoded&&kiwi_util.str_recode_lookup[c]==1))){dst+=chr(c);i+=2;}else{dst+='%';}}else{dst+=src[i];}}
return dst;}
function kiwi_JSON(json,pretty){return JSON.stringify(json,null,pretty?3:undefined);}
function kiwi_JSON_parse(tag,json){var obj;try{obj=JSON.parse(json);}catch(ex){console.log('kiwi_JSON_parse('+tag+'): JSON parse fail');console.log(json);console.log(ex);obj=null;}
return obj;}
function kiwi_remove_escape_sequences(s){var a1=s.split('');var a2=[];var inANSI=false,inHTML=false;for(var i=0;i<a1.length;i++){var c=a1[i];if(inANSI){if(c=='m')inANSI=false;}else
if(inHTML){if(c==kiwi.esc_gt)inHTML=false;}else{if(c=='\u001b'&&(i+1)<a1.length&&a1[i+1]=='['){i++;inANSI=true;}else
if(c==kiwi.esc_lt){inHTML=true;}else{if(c!='\f')
a2.push(c);}}}
return a2.join('');}
function kiwi_timestamp(){return new Date().toISOString().replace(/:/g,'_').replace(/\.[0-9]+Z$/,'Z');}
function kiwi_timestamp_filename(pre,post){var el=w3_el('id-freq-input');var freq_mode=el?('_'+el.value+'_'+ext_get_mode()):'';return pre+kiwi_host()+'_'+kiwi_timestamp()+freq_mode+post;}
function kiwi_clean_html(s){return s.replace(/\&/g,'&amp;').replace(/\</g,'&lt;').replace(/\>/g,'&gt;');}
function kiwi_clean_newline(s){return s.replace(/[\r\n\f\v]/g,'').replace(/\t/g,' ');}
function kiwi_SSL(){return window.location.protocol+'//';}
function kiwi_url_origin(){return window.location.origin;}
function kiwi_host_port(){return window.location.host;}
function kiwi_host(){return window.location.hostname;}
function kiwi_remove_protocol(url){return url.replace(/^http:\/\//,'').replace(/^https:\/\//,'');}
function kiwi_add_end(s,end){if(!s.endsWith(end))s=s+end;return s;}
function kiwi_url_param(pnames,default_val,not_found_val){var pn_isArray=isArray(pnames);if(isUndefined(default_val))default_val=true;if(isUndefined(not_found_val))not_found_val=null;var params=(window.location&&window.location.search&&window.location.search.substr(1));if(!params)return not_found_val;var rv=not_found_val;params.split("&").forEach(function(pv){var pv_a=pv.split("=");if(pn_isArray){pnames.forEach(function(pn){if(pn!=pv_a[0])return;rv=(pv_a.length>=2)?pv_a[1]:default_val;});}else{if(pnames==pv_a[0]){rv=(pv_a.length>=2)?pv_a[1]:default_val;}}});return rv;}
function kiwi_add_search_param(location,param){var p;var qs=location.search;console.log('qs=<'+qs+'>');if(qs=='')p='/?';else if(qs.includes('?'))p='&';else p='/?';return p+param;}
function kiwi_remove_search_param(url,p){url=url.replace('?'+p+'&','?').replace('&'+p+'&','&').replace('?'+p+'','').replace('&'+p+'','');return url;}
var kiwiint_dummy_elem={};function html(id_or_name){var el=w3_el(id_or_name);var debug;try{debug=el.value;}catch(ex){console.log("html('"+id_or_name+"')="+el+" FAILED");if(dbgUs&&dbgUsFirst){dbgUsFirst=false;}}
if(el==null)el=kiwiint_dummy_elem;return el;}
function px(s){if(isNoArg(s)||s=='')return'0';var num=parseFloat(s);if(isNaN(num)){console.log('px num='+s);kiwi_trace();return'0';}
return num.toFixed(0)+'px';}
function unpx(s){return parseFloat(s);}
function css_style(el,prop){el=w3_el(el);if(!el)return null;var style=getComputedStyle(el,null);var val=style.getPropertyValue(prop);return val;}
function css_style_num(el,prop){el=w3_el(el);if(!el)return null;var v=parseInt(css_style(el,prop));if(isNaN(v))v=0;return v;}
function html_LR_border_pad(el){var bL=css_style_num(el,'border-left-width');var bR=css_style_num(el,'border-right-width');var pL=css_style_num(el,'padding-left');var pR=css_style_num(el,'padding-right');return bL+bR+pL+pR;}
function cancelEvent(ev){ev=ev?ev:window.event;if(ev.stopPropagation)ev.stopPropagation();if(ev.preventDefault)ev.preventDefault();if(ev.stopImmediatePropagation)ev.stopImmediatePropagation();ev.cancelBubble=true;ev.cancel=true;ev.returnValue=false;return false;}
function ignore(ev){return cancelEvent(ev);}
function kiwi_rgb(r,g,b){if(r==null)return'';if(isArray(r)){g=r[1];b=r[2];r=r[0];}
return'rgb('+Math.floor(r)+','+Math.floor(g)+','+Math.floor(b)+')';}
function hsl(h,s,l){s=Math.floor(s);if(s<0)s=0;if(s>100)s=100;l=Math.floor(l);if(l<0)l=0;if(l>100)l=100;return'hsl('+Math.round(h)+','+s+'%,'+l+'%)';}
function createCookie(name,value,days){var expires="";if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString();}
document.cookie=name+"="+value+expires+"; path=/; SameSite=Lax;";}
function readCookie(name,defaultValue){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);}
if(isDefined(defaultValue)){return defaultValue;}else{return null;}}
function writeCookie(cookie,value){createCookie(cookie,value,42*365);}
function initCookie(cookie,initValue){var v=readCookie(cookie);if(v==null){writeCookie(cookie,initValue);return initValue;}else{return v;}}
function updateCookie(cookie,initValue){var v=readCookie(cookie);if(v==null||v!=initValue){writeCookie(cookie,initValue);return true;}else{return false;}}
function deleteCookie(cookie){var v=readCookie(cookie);if(v==null)return;createCookie(cookie,0,-1);}
function kiwi_storeGet(s,init){var rv;if(isNoArg(s))return null;try{if(localStorage==null)return null;rv=localStorage.getItem(s);if(rv==null){rv=readCookie(s);if(rv!=null){console.log('$moving to storage api: '+s+'='+rv);kiwi_storeSet(s,rv);deleteCookie(s);}else{if(isDefined(init)){kiwi_storeSet(s,init);rv=init;}else{rv=null;}}}}catch(ex){console.log('$kiwi_storeGet CATCH: '+s);console.log('$kiwi_storeGet CATCH: '+ex);rv=null;}
if(rv==null)console.log('$ kiwi_storeGet warning: '+s+'=null');return rv;}
function kiwi_storeSet(s,v){if(isNoArg(v))return null;try{if(localStorage==null)return null;localStorage.setItem(s,v);}catch(ex){return null;}
return true;}
function getVarFromString(path){var scope=window;var scopeSplit=path.split('.');for(i=0;i<scopeSplit.length-1;i++){var scope_name=scopeSplit[i];scope=scope[scope_name];if(isUndefined(scope)){throw'no scope';}}
var r=scope[scopeSplit[scopeSplit.length-1]];return r;}
function setVarFromString(string,val){var scope=window;var scopeSplit=string.split('.');for(i=0;i<scopeSplit.length-1;i++){if(scope[scopeSplit[i]]==undefined){scope[scopeSplit[i]]={};}
scope=scope[scopeSplit[i]];}
scope[scopeSplit[scopeSplit.length-1]]=val;}
function getType(o){return o&&o.constructor&&o.constructor.name}
function kiwi_parseQuery(query){var Params=new Object();if(!query)return Params;var Pairs=query.split(/[;&]/);for(var i=0;i<Pairs.length;i++){var KeyVal=Pairs[i].split('=');if(!KeyVal||KeyVal.length!=2)continue;var key=unescape(KeyVal[0]);var val=unescape(KeyVal[1]);val=val.replace(/\+/g,' ');Params[key]=val;}
return Params;}
function getTextWidth(text,font){var canvas=getTextWidth.canvas||(getTextWidth.canvas=document.createElement("canvas"));var context=canvas.getContext("2d");context.font=font;var metrics=context.measureText(text);return metrics.width;}
function kiwi_GETrequest(id,url,opt){var debug=w3_opt(opt,'debug',0);var iframe=document.createElement("iframe");var uniqueString=id+'_'+(new Date()).toUTCString().substr(17,8);document.body.appendChild(iframe);iframe.style.display="none";iframe.contentWindow.name=uniqueString;w3_add(iframe,'id-kiwi_GETrequest');var form=document.createElement("form");form.target=uniqueString;form.action=url;form.method="GET";w3_add(form,'id-kiwi_GETrequest');if(debug)console.log('kiwi_GETrequest: '+uniqueString);return{iframe:iframe,form:form,debug:debug};}
function kiwi_GETrequest_submit(request,opt){var no_submit=w3_opt(opt,'no_submit',0);var gc=w3_opt(opt,'gc',0);if(no_submit){console.log('kiwi_GETrequest_submit: NO SUBMIT');}else{document.body.appendChild(request.form);request.form.submit();if(request.debug)console.log('kiwi_GETrequest_submit: SUBMITTED');}
if(gc)setTimeout(function(){document.body.removeChild(request.form);document.body.removeChild(request.iframe);},60000);}
function kiwi_GETrequest_param(request,name,value){var input=document.createElement("input");input.type="hidden";input.name=name;input.value=value;request.form.appendChild(input);if(request.debug)console.log('kiwi_GETrequest_param: '+name+'='+value);}
var ajax_state={DONE:4};function kiwi_ajax(url,callback,cb_param,timeout,debug){kiwi_ajax_prim('GET',null,url,callback,cb_param,timeout,undefined,undefined,debug);}
function kiwi_ajax_progress(url,callback,cb_param,timeout,progress_cb,progress_cb_param,debug){kiwi_ajax_prim('GET',null,url,callback,cb_param,timeout,progress_cb,progress_cb_param,debug);}
function kiwi_ajax_send(data,url,callback,cb_param,timeout,debug){kiwi_ajax_prim('PUT',data,url,callback,cb_param,timeout,undefined,undefined,debug);}
var ajax_id=0;var ajax_requests={};function kiwi_ajax_prim(method,data,url,callback,cb_param,timeout,progress_cb,progress_cb_param,debug){ajax_id++;var ajax;var dbug=function(msg){if(debug){console.log(msg);}};try{ajax=new XMLHttpRequest();}catch(ex){try{ajax=new ActiveXObject("Msxml2.XMLHTTP");}catch(ex){try{ajax=new ActiveXObject("Microsoft.XMLHTTP");}catch(ex){return false;}}}
ajax.kiwi_id=ajax_id;ajax_requests[ajax_id]={};ajax_requests[ajax_id].didTimeout=false;ajax_requests[ajax_id].timer=-1;timeout=timeout?timeout:0;if(timeout){ajax_requests[ajax_id].timer=setTimeout(function(){var id=ajax.kiwi_id;ajax_requests[id].didTimeout=true;ajax_requests[id].timer=-1;console.log('$AJAX TIMEOUT url='+url);var obj={AJAX_error:'timeout'};w3_call(callback,obj,cb_param);ajax.abort();delete ajax_requests[id];},Math.abs(timeout));}
if(progress_cb){dbug('AJAX with progress_cb='+progress_cb);ajax.onprogress=function(){var response=ajax.responseText.toString()||'';dbug('XHR.onprogress='+response);w3_call(progress_cb,response,progress_cb_param);};}
ajax.onerror=function(e){dbug('XHR.onerror='+e);if(debug)console.log(e);}
ajax.onabort=function(e){dbug('XHR.onabort='+e);if(debug)console.log(e);}
ajax.onload=function(e){dbug('XHR.onload='+e);if(debug)console.log(e);}
ajax.onloadstart=function(e){dbug('XHR.onloadstart='+e);if(debug)console.log(e);}
ajax.onreadystatechange=function(){dbug('XHR.onreadystatechange readyState='+ajax.readyState);if(ajax.readyState!=ajax_state.DONE){return false;}
var id=ajax.kiwi_id;var timer=ajax_requests[id].timer;dbug('AJAX ORSC ENTER recovered id='+id+' timer='+timer+' cb='+callback);if(timer!=-1){dbug('AJAX ORSC CLEAR_TIMER recovered id='+id+' timer='+timer);kiwi_clearTimeout(timer);ajax_requests[id].timer=-1;}
if(!ajax_requests[id].didTimeout){var obj;dbug('XHR.status='+ajax.status);dbug('XHR.statusText='+ajax.statusText);dbug('XHR.responseType='+ajax.responseType);dbug('XHR.response='+ajax.response);dbug('XHR.responseText='+ajax.responseText);dbug('XHR.responseURL='+ajax.responseURL);if(debug)console.log(ajax);if(ajax.status!=200){console.log('$AJAX BAD STATUS='+ajax.status+' url='+url);obj={AJAX_error:'status',status:ajax.status};}else{var response=ajax.responseText.toString();if(response==null)response='';if(response.startsWith('<?xml')){obj={XML:true,text:response};}else{var firstChar=response.charAt(0);if(firstChar!='{'&&firstChar!='['&&!(firstChar>='0'&&firstChar<='9')){dbug("AJAX: response didn't begin with JSON '{', '[' or digit? "+response);obj={AJAX_error:'JSON prefix',response:response};}else{try{response=kiwi_remove_cjson_comments(response);obj=JSON.parse(response);dbug('AJAX JSON response:');dbug(response);dbug(obj);}catch(ex){dbug("AJAX response JSON.parse failed: <"+response+'>');dbug(ex);var ex_s=ex.toString();var line=ex_s.match(/line ([0-9]*)/);line=(isArray(line)&&line.length>=1)?+line[1]:null;obj={AJAX_error:'JSON parse',JSON_line:line,JSON_ex:ex_s,lines:response.split('\n'),response:response};}}}}
dbug('AJAX ORSC CALLBACK recovered id='+id+' callback='+typeof(callback));w3_call(callback,obj,cb_param);}else{dbug('AJAX ORSC TIMED_OUT recovered id='+id);}
dbug('AJAX ORSC ABORT/DELETE');ajax.abort();delete ajax_requests[id];}
if(timeout>=0){ajax.open(method,url,true);dbug('AJAX SEND id='+ajax_id+' url='+url);ajax.send(data);}
return true;}
function kiwi_remove_cjson_comments(s){var removed=false;var c_begin,c_end;while((c_begin=s.indexOf('\n//'))!=-1){c_end=s.indexOf('\n',c_begin+3);s=s.slice(0,c_begin)+s.slice(c_end);removed=true;}
return s;}
function kiwi_scrollbar_width(){if(kiwi_isMacOS())return 10;return 15;}
function kiwi_strip_tags(input,allowed){allowed=(((allowed||'')+'').toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join('');var tags=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,commentsAndPhpTags=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return input.replace(commentsAndPhpTags,'').replace(tags,function($0,$1){return allowed.indexOf('<'+$1.toLowerCase()+'>')>-1?$0:'';});}
function kiwi_pie(id,size,unfilled_color,filled_color){var size2=size*2;var s='<svg width="'+size2+'" height="'+size2+'" viewbox="0 0 '+size2+' '+size2+'">'+'<circle cx="'+size+'" cy="'+size+'" r="'+size+'" fill="'+unfilled_color+'" />'+'<path class="'+id+'" style="fill:'+filled_color+'" transform="translate('+size+', '+size+')" />'+'</svg>';return s;}
function kiwi_draw_pie(id,size,filled){var alpha=360*filled;var r=alpha*Math.PI / 180,x=Math.sin(r)*size,y=Math.cos(r)*-size,mid=(alpha>=180)?1:0;if(alpha==360){mid=1;x=-0.1;y=-size;}
var animate='M 0 0 v '+(-size)+' A '+size+' '+size+' 1 '+mid+' 1 '+x+' '+y+' z';w3_iterate_classname(id,function(el){el.setAttribute('d',animate);});};function enc(s){return s.replace(/./gi,function(c){return String.fromCharCode(c.charCodeAt(0)^3);});}
var sendmail=function(to,subject){var s="mailto:"+enc(decodeURIComponent(to))+(isDefined(subject)?('?subject='+subject):'');window.location.href=s;}
function line_stroke(ctx,vert,linew,color,x1,y1,x2,y2){var lineh=Math.floor(linew/2);var w=vert?linew:x2-x1+1;var h=vert?y2-y1+1:linew;var x=x1-(vert?lineh:0);var y=y1-(vert?0:lineh);ctx.fillStyle=color;ctx.fillRect(x,y,w,h);}
var wsockets=[];function msg_send(s){for(var i=0;i<wsockets.length;i++){var ws=wsockets[i].ws;if(!ws.up)continue;try{ws.send(s);return 0;}catch(ex){console.log("CATCH msg_send('"+s+"') ex="+ex);kiwi_trace();return-1;}}
return-1;}
function open_websocket(stream,open_cb,open_cb_param,msg_cb,recv_cb,error_cb,close_cb){if(!("WebSocket"in window)||!("CLOSING"in WebSocket)){console.log('WEBSOCKET TEST');kiwi_serious_error("Your browser does not support WebSocket, which is required for OpenWebRX to run. <br> Please use an HTML5 compatible browser.");return null;}
var ws_url=kiwi_url_origin().split("://")[1];var ws_protocol='ws://';if(window.location.protocol==="https:"){ws_protocol='wss://';}
var no_wf=(window.location.href.includes('?no_wf')||window.location.href.includes('&no_wf'));ws_url=ws_protocol+ws_url+'/'+(no_wf?'no_wf/':'kiwi/')+timestamp+'/'+stream;if(isNonEmptyString(window.location.search))
ws_url+=window.location.search;if(no_wf)wf.no_wf=true;var ws=new WebSocket(ws_url);wsockets.push({'ws':ws,'name':stream});ws.up=false;ws.stream=stream;ws.open_cb=open_cb;ws.open_cb_param=open_cb_param;ws.msg_cb=msg_cb;ws.recv_cb=recv_cb;ws.error_cb=error_cb;ws.close_cb=close_cb;ws.onopen=function(){ws.up=true;if(ws.open_cb){try{ws.open_cb(ws.open_cb_param);}catch(ex){console.log(ex);}}};ws.onmessage=function(evt){on_ws_recv(evt,ws);};ws.onclose=function(evt){ws.up=false;console.log('WS-CLOSE: '+ws.stream);if(ws.close_cb){try{ws.close_cb(ws);}catch(ex){console.log(ex);}}};ws.binaryType="arraybuffer";ws.onerror=function(evt){if(ws.error_cb){try{ws.error_cb(evt,ws);}catch(ex){console.log(ex);}}};return ws;}
var kiwi_flush_recv_input=true;function recv_websocket(ws,recv_cb){if(ws.stream=='SND'||ws.stream=='W/F')return;ws.recv_cb=recv_cb;if(recv_cb==null)
kiwi_flush_recv_input=true;}
function on_ws_recv(evt,ws){var data=evt.data;if(!(data instanceof ArrayBuffer)){console.log("on_ws_recv: not an ArrayBuffer?");return;}
if(seriousError)
return;var firstChars=arrayBufferToStringLen(data,3);if(firstChars=="CLI")return;var claimed=false;if(firstChars=="MSG"){var stringData=arrayBufferToString(data);params=stringData.substring(4).split(" ");for(var i=0;i<params.length;i++){var msg_a=params[i].split("=");if(ws.stream=='EXT'&&msg_a[0]=='EXT-STOP-FLUSH-INPUT'){kiwi_flush_recv_input=false;}
claimed=kiwi_msg(msg_a,ws);if(claimed==false){if(ws.msg_cb){claimed=ws.msg_cb(msg_a,ws);}}
if(claimed==false)
console.log('>>> '+ws.stream+': message not claimed: '+params[i]);}}else{if(ws.recv_cb&&(ws.stream!='EXT'||kiwi_flush_recv_input==false)){ws.recv_cb(data,ws,firstChars);if(isDefined(kiwi_gc_recv)&&kiwi_gc_recv)data=null;}}}
window.onbeforeunload=function(){var i;for(i=0;i<wsockets.length;i++){var ws=wsockets[i].ws;if(ws){ws.onclose=function(){};ws.close();}}};





/* web/kiwi/w3_util.min.js (web/kiwi/w3_util.js = Mon Jun  5 11:07:47 2023) */
var w3int={menu_cur_id:null,menu_active:false,menu_debug:false,menu_close_func:null,prev_menu_hover_el:null,rate_limit:{},rate_limit_evt:{},_last_:0};function visible_block(){}
var w3_console={};w3_console.log=function(obj,prefix){var s=prefix?(prefix+': '):'';if(isString(obj)){s+='"'+obj.toString()+'"';}else
if(isObject(obj)){console.log(obj);var json='JSON '+JSON.stringify(obj,w3int_console_replacer);if(json.includes('\n'))
json=JSON.stringify(obj,w3int_console_replacer,1);s+=json;}else{s+=obj.toString();}
console.log(s);};function w3int_console_replacer(k,v){if(isUndefined(v))return'<undefined>';if(isNull(v))return'<null>';if(isFunction(v))return'<function>';return'<'+v.toString()+'>';}
function w3_strip_quotes(s){if(isString(s)&&(s.indexOf('\'')!=-1||s.indexOf('\"')!=-1))
return s.replace(/'/g,'').replace(/"/g,'')+' [quotes stripped]';return s;}
function w3_esc_dq(s){if(isString(s)&&s.indexOf('\"')!=-1)
return s.replace(/"/g,'&quot;');return s;}
function w3_call(func,arg0,arg1,arg2,arg3,arg4){var rv=undefined;if(isNoArg(func))return rv;try{if(isString(func)){var f=getVarFromString(func);if(isFunction(f)){rv=f(arg0,arg1,arg2,arg3,arg4);}else{}}else
if(isFunction(func)){rv=func(arg0,arg1,arg2,arg3,arg4);}else
console.log('w3_call: func not a string or function');}catch(ex){console.log('w3_call: while in func this exception occured:');console.log(ex);}
return rv;}
function w3_first_value(v){if(v==null)
return'null';var rv=null;var to_v=typeof(v);if(to_v==='number'||to_v==='boolean'||to_v==='string'){rv=v;}else
if(isArray(v)){rv=v[0];}else
if(to_v==='object'){rv=w3_obj_seq_el(v,0);}else{rv=to_v;}
return rv;}
function w3_second_value(v){var rv=null;if(isArray(v)&&v.length>1){if(v.length>1)
rv=v[1];}
return rv;}
function w3_opt(opt,elem,default_val){if(isDefined(opt)&&isDefined(opt[elem])){return opt[elem];}else{return default_val;}}
function w3_obj_num(o){if(isUndefined(o)||isNull(o)||isObject(o))return o;if(isNumber(o))return{num:o};if(isBoolean(o))return{num:(o?1:0)};if(isString(o))return{num:parseFloat(o)};return o;}
function w3_obj_seq_el(obj,idx){var keys_a=Object.keys(obj);if(!isNumber(idx)||idx<0||idx>=keys_a.length)return null;return obj[keys_a[idx]];}
function w3_obj_key_seq(obj,key){var seq=null;Object.keys(obj).forEach(function(_key,i){if(_key==key)seq=i;});return seq;}
function w3_array_el_seq(arr,el){var seq=null;arr.forEach(function(a_el,i){if(a_el==el)seq=i;});return seq;}
function w3_obj_enum(obj,func,opt){var key_match=w3_opt(opt,'key_match',undefined);var value_match=w3_opt(opt,'value_match',undefined);Object.keys(obj).forEach(function(key,i){var o=obj[key];if(isDefined(key_match)){if(key==key_match)func(key,i,o);}else
if(isDefined(value_match)){if(o==value_match)func(key,i,o);}else{func(key,i,o);}});}
function w3_enum_obj_or_array_of_objs(obj_arr,func){if(isArray(obj_arr)){obj_arr.forEach(function(obj){func(obj);});}else
if(isObject(obj_arr)){func(obj_arr);}}
function w3_ext_param_array_match_str(arr,s,func){var found=false;arr.forEach(function(a_el,i){var el=a_el.toString().toLowerCase();if(!found&&el.startsWith(s)){if(func)func(i,a_el.toString());found=true;}});return found;}
function w3_ext_param_array_match_num(arr,n,func){var found=false;arr.forEach(function(a_el,i){var a_num=parseFloat(a_el);if(!found&&a_num==n){if(func)func(i,n);found=true;}});return found;}
function w3_ext_param(s,param){var pu=param.split(':');var pl=param.toLowerCase().split(':');if(s.startsWith(pl[0])){rv={match:true};if(pl.length>1){rv.has_value=true;rv.num=parseFloat(pl[1]);rv.string=pl[1];rv.string_case=pu[1];}else{rv.has_value=false;rv.num=0;rv.string='';}
return rv;}
return{match:false}}
function w3_clamp(v,min,max,clamp_val){if(isNaN(v))return(isDefined(clamp_val)?clamp_val:Math.NaN);if(isObject(min)){var o=min;try{if(typeof(o.clamp)==='undefined'){v=Math.max(o.min,Math.min(o.max,v));}else{if(v<o.min||v>o.max)v=o.clamp;}}catch(ex){console.log('w3_clamp: bad obj:');console.log(o);return undefined;}}else{if(clamp_val==undefined)
v=Math.max(min,Math.min(max,v));else
if(v<min||v>max)v=clamp_val;}
return v;}
function w3_clamp3(v,min,max,clamp_min,clamp_max,clamp_NaN){if(isNaN(v))return clamp_NaN;if(v<min)return clamp_min;if(v>max)return clamp_max;return v;}
function w3_add_id(path,suffix){path=path||'';if(path=='')return'';path=path.startsWith('id-')?path:('id-'+path);suffix=suffix||'';return path+suffix;}
function w3int_w3_el(id_name_class){if(!id_name_class||id_name_class=='')return null;var el=document.getElementById(id_name_class);if(el==null){el=document.getElementsByName(id_name_class);if(el!=null)el=el[0];}
if(el==null){el=document.getElementsByClassName(id_name_class);if(el!=null)el=el[0];}
return el;}
function w3int_w3_els(id_name_class){if(!id_name_class||id_name_class=='')return null;var els=document.getElementById(id_name_class);var rv;if(els!=null){rv=[els];}else{els=document.getElementsByName(id_name_class);if(els==null||els.length==0){els=document.getElementsByClassName(id_name_class);}
rv=els;}
if(rv.length==0)rv=null;return rv;}
function w3_el(el_id){if(isString(el_id)){if(el_id=='')return null;if(el_id=='body')return document.body;var el=w3int_w3_el(el_id);if(el==null){el=w3int_w3_el('id-'+el_id);if(el==null){el_id=w3_add_toplevel(el_id);el=w3int_w3_el(el_id);if(el==null){el=w3int_w3_el('id-'+el_id);}}}
return el;}
return(el_id);}
function w3_els(el_id,func){if(isString(el_id)){if(el_id=='')return null;if(el_id=='body')return document.body;var els=w3int_w3_els(el_id);if(els==null){els=w3int_w3_els('id-'+el_id);if(els==null){el_id=w3_add_toplevel(el_id);els=w3int_w3_els(el_id);if(els==null){els=w3int_w3_els('id-'+el_id);}}}
if(els&&func)for(var i=0;i<els.length;i++){func(els[i],i);}
return els;}
var el=w3_el(el_id);if(func){func(el,0);}
return[el];}
function w3_id(el_id){var el=w3_el(el_id);if(!el)return null;if(el.id&&el.id.startsWith('id-'))return el.id;var done=false;var id=null;w3_iterate_classList(el,function(className,idx){if(className.startsWith('id-')&&!done){id=className;done=true;}});return id;}
function w3_innerHTML(id){var el=w3_el(id);if(!el)return null;var s='';var narg=arguments.length;for(var i=1;i<narg;i++){s+=arguments[i];}
el.innerHTML=s;return el;}
function w3_clearInnerHTML(id){w3_innerHTML(id,'');}
function w3_append_innerHTML(id){var el=w3_el(id);if(!el)return null;var s='';var narg=arguments.length;for(var i=1;i<narg;i++){s+=arguments[i];}
el.innerHTML+=s;return el;}
function w3_get_innerHTML(id){var el=w3_el(id);if(!el)return null;return el.innerHTML;}
function w3_iterate_classname(cname,func){var els=document.getElementsByClassName(cname);if(els==null)return;for(var i=0;i<els.length;i++){func(els[i],i);}}
function w3_iterate_classList(el_id,func){var el=w3_el(el_id);if(el&&el.classList)for(var i=0;i<el.classList.length;i++){func(el.classList.item(i),i);}
return el;}
function w3_create_appendElement(el_parent,el_type,html){var el_child=document.createElement(el_type);w3_innerHTML(el_child,html);w3_el(el_parent).appendChild(el_child);return el_child;}
function w3_iterate_parent(el_id,func){var el=w3_el(el_id);var i=0;do{if(func(el,i)!=null)
break;el=el.parentNode;i++;}while(el);}
function w3_iterate_children(el_id,func){var el=w3_el(el_id);for(var i=0;i<el.children.length;i++){var child_el=el.children[i];func(child_el,i);}}
function w3_iterateDeep_children(el_id,func){var el=w3_el(el_id);for(var i=0;i<el.children.length;i++){var child_el=el.children[i];func(child_el);if(child_el.hasChildNodes)
w3_iterateDeep_children(child_el,func);}}
function w3_iterate_childNodes(el_id,func){var el=w3_el(el_id);for(var i=0;i<el.childNodes.length;i++){var child_el=el.childNodes[i];func(child_el,i);}}
function w3_boundingBox_children(el_id,debug){var bbox={x1:1e99,x2:0,y1:1e99,y2:0,w:0,h:0};w3_iterateDeep_children(el_id,function(el){if(el.nodeName!='DIV'&&el.nodeName!='IMG')
return;var position=css_style(el,'position');if(position=='static')
return;if(el.offsetHeight==0)
return;if(debug)console.log(el);if(debug)console.log(el.nodeName+' el.oL='+el.offsetLeft+' el.oW='+el.offsetWidth+' el.oT='+el.offsetTop+' el.oH='+el.offsetHeight+' '+position);bbox.x1=Math.min(bbox.x1,el.offsetLeft);var x2=el.offsetLeft+el.offsetWidth;bbox.x2=Math.max(bbox.x2,x2);bbox.y1=Math.min(bbox.y1,el.offsetTop);var y2=el.offsetTop+el.offsetHeight;bbox.y2=Math.max(bbox.y2,y2);});bbox.w=bbox.x2-bbox.x1;bbox.h=bbox.y2-bbox.y1;if(bbox.w==-1e+99){bbox.w=bbox.h=0;}
if(debug)w3_console.log(bbox,'w3_boundingBox_children');return bbox;}
function w3_center_in_window(el_id,id){var el=w3_el(el_id);var rv=window.innerHeight/2-el.clientHeight/2;return rv;}
function w3_field_select(el_id,opts){var el=w3_el(el_id);el=(el&&isFunction(el.select))?el:null;var trace=0;if(trace){var id=isObject(el_id)?el_id.id:el_id;console.log('w3_field_select id='+id+' el='+el+' v='+(el?el.value:null));console.log(el);console.log(opts);}
if(!el)return;var focus=0,select=0,blur=0;if(opts['mobile']&&kiwi_isMobile())blur=1;else focus=select=1;if(opts['blur'])blur=1;if(opts['focus_select'])focus=select=1;if(opts['focus_only']){focus=1;select=0;}
if(opts['select_only'])select=1;if(trace)console.log('w3_field_select focus='+focus+' select='+select+' blur='+blur);if(focus)el.focus();if(select)el.select();if(blur)el.blur();if(trace)kiwi_trace();}
function w3_add(el_id,props){if(!el_id)return null;var first_el=null;var el=w3_el(el_id);if(!el)return null;if(first_el)return;if(!el||!props)return null;props=props.replace(/\s+/g,' ').split(' ');props.forEach(function(p){el.classList.add(p);});if(!first_el)first_el=el;return first_el;}
function w3_remove(el_id,props){if(!el_id)return null;var first_el=null;var el=w3_el(el_id);if(!el)return null;if(!first_el)first_el=el;if(!el||!props)return null;props=props.replace(/\s+/g,' ').split(' ');props.forEach(function(p){el.classList.remove(p);});return first_el;}
function w3_match_wildcard(el_id,prefix){var el=w3_el(el_id);if(!el)return null;for(var i=0;i<el.classList.length;i++){var cl=el.classList.item(i);if(cl.startsWith(prefix))
return cl;}
return false;}
function w3_remove_wildcard(el_id,prefix){var el=w3_el(el_id);if(!el)return null;for(var i=0;i<el.classList.length;i++){var cl=el.classList.item(i);if(cl.startsWith(prefix))el.classList.remove(cl);}
return el;}
function w3_set_props(el_id,props,cond){var el=w3_el(el_id);if(!el)return el;cond=isArg(cond)?cond:true;if(cond)
w3_add(el,props);else
w3_remove(el,props);return el;}
function w3_remove_then_add(el_id,r_props,a_props){w3_remove(el_id,r_props);w3_add(el_id,a_props);}
function w3_remove_then_add_cond(el_id,cond,t_props,f_props){w3_remove(el_id,t_props+' '+f_props);w3_add(el_id,cond?t_props:f_props);}
function w3_contains(el_id,prop){var el=w3_el(el_id);if(!el)return 0;var clist=el.classList;return(!clist||!clist.contains(prop))?0:1;}
function w3_parent_with(el_id,prop){var el=w3_el(el_id);if(!el)return;var found=null;w3_iterate_parent(el,function(parent){if(!found&&w3_contains(parent,prop)){found=parent;}});return found;}
function w3_toggle(el_id,prop){var el=w3_el(el_id);if(!el)return;if(w3_contains(el,prop)){w3_remove(el,prop);}else{w3_add(el,prop);}
return el;}
function w3_appendAllClass(cname,prop){w3_iterate_classname(cname,function(el){el.classList.add(prop);});}
function w3_setAllHref(cname,href){w3_iterate_classname(cname,function(el){el.href=href;});}
function w3_show(el_id,display){var el=w3_el(el_id);if(!el)return el;w3_remove(el,'w3-hide');w3_add(el,display?display:'w3-show-inline-block');return el;}
function w3_create_attribute(el_id,name,val){var el=w3_el(el_id);if(el==null)return;var attr=document.createAttribute(name);attr.value=val;el.setAttributeNode(attr);}
function w3_attribute(el_id,name,val,cond){var el=w3_el(el_id);if(el==null)return null;if(isUndefined(cond)||cond==true)
el.setAttribute(name,val)
else
el.removeAttribute(name);}
function w3_show_block(el_id){return w3_show(el_id,'w3-show-block');}
function w3_show_inline_block(el_id){return w3_show(el_id,'w3-show-inline-block');}
function w3_show_inline(el_id){return w3_show(el_id,'w3-show-inline-new');}
function w3_show_table_cell(el_id){return w3_show(el_id,'w3-show-table-cell');}
function w3_hide(el_id){var el=w3_el(el_id);if(!el)return el;var el=w3_iterate_classList(el,function(className,idx){if(className.startsWith('w3-show-')){w3_remove(el,className);}});w3_add(el,'w3-hide');return el;}
function w3_hide2(el_id,cond){var el=w3_el(el_id);if(!el)return el;cond=isArg(cond)?cond:true;w3_set_props(el,'w3-hide',cond);return el;}
function w3_show_hide(el,show,display){var rv;if(show){rv=w3_show(el,display?display:'w3-show-block');}else{rv=w3_hide(el);}
return rv;}
function w3_show_hide_inline(el,show){w3_show_hide(el,show,'w3-show-inline-new');}
function w3_disable(el_id,disable){el=w3_el(el_id);w3_set_props(el,'w3-disabled',disable);if(isDefined(el.nodeName)&&(el.nodeName=='SELECT'||el.nodeName=='INPUT')){try{if(disable)
el.setAttribute('disabled','');else
el.removeAttribute('disabled');}catch(ex){console.log('w3_disable:Attribute');console.log(ex);}}
return el;}
function w3_visible(el_id,visible){var el=w3_el(el_id);el.style.visibility=visible?'visible':'hidden';return el;}
function w3_isVisible(el_id){var el=w3_el(el_id);if(!el)return null;return(el.style.visibility=='visible');}
var w3_highlight_time=250;var w3_highlight_color='w3-selection-green';var w3_selection_green='#4CAF50';function w3_highlight(el_id){var el=w3_el(el_id);w3_add(el,el.w3int_highlight_color||w3_highlight_color);}
function w3_unhighlight(el_id){var el=w3_el(el_id);w3_remove(el,el.w3int_highlight_color||w3_highlight_color);}
function w3_isHighlighted(el_id){var el=w3_el(el_id);return w3_contains(el,el.w3int_highlight_color||w3_highlight_color);}
function w3_schedule_highlight(el_id){var el=w3_el(el_id);w3_highlight(el);setTimeout(function(){w3_unhighlight(el);},w3_highlight_time);}
function w3_set_highlight_color(el_id,color){var el=w3_el(el_id);if(!el)return null;if(w3_isHighlighted(el)){w3_unhighlight(el);el.w3int_highlight_color=color;w3_highlight(el);}else{el.w3int_highlight_color=color;}
return el;}
var w3_flag_color='w3-override-yellow';function w3_flag(path){w3_add(w3_el(path),w3_flag_color);}
function w3_unflag(path){w3_remove(w3_el(path),w3_flag_color);}
function w3_color(el_id,color,bkgColor,cond){var el=w3_el(el_id);if(!el)return null;var prev_fg=el.style.color;var prev_bg=el.style.backgroundColor;cond=(isUndefined(cond)||cond);if(isArg(color))el.style.color=cond?color:'';if(isArg(bkgColor))el.style.backgroundColor=cond?bkgColor:'';return{color:prev_fg,backgroundColor:prev_bg};}
function w3_background_color(el_id,color){var el=w3_el(el_id);var prev=el.style.backgroundColor;if(color!=undefined&&color!=null)el.style.backgroundColor=color;return prev;}
function w3_colors(el_id,c1,c2,cond){var el=w3_el(el_id);if(!el)return null;cond=isArg(cond)?cond:true;var fg1=null,bg1=null;if(isArray(c1)){if(c1.length>0)fg1=c1[0];if(c1.length>1)bg1=c1[1];}else
if(isString(c1)){fg1=c1;}else{return null;}
if(fg1.startsWith('w3-')){w3_remove(el,fg1);if(!cond)w3_add(el,fg1);}else{if(!cond)el.style.color=fg1;}
if(bg1){el.style.backgroundColor=bg1;}
var fg2=null,bg2=null;if(isArray(c2)){if(c2.length>0)fg2=c2[0];if(c2.length>1)bg2=c2[1];}else
if(isString(c2)){fg2=c2;}else{return null;}
if(fg2.startsWith('w3-')){w3_remove(el,fg2);if(cond)w3_add(el,fg2);}else{if(cond)el.style.color=fg2;}
if(bg2){el.style.backgroundColor=bg2;}}
function w3_flip_colors(el_id,colors,cond){var el=w3_el(el_id);if(!el)return null;var ar=colors?colors.split(' '):null;if(!ar||ar.length!=2)return null;w3_remove(el,ar[0]);w3_remove(el,ar[1]);w3_add(el,ar[cond?1:0]);}
function w3_fg_color_with_opacity_against_bk_color(fg,opacity,bg){var fg_color=w3color(fg);if(!fg_color.valid)return null;var bg_color=w3color(bg);if(!bg_color.valid)return null;var _opacity=1-opacity;var red=Math.round(opacity*fg_color.red+_opacity*bg_color.red);var green=Math.round(opacity*fg_color.green+_opacity*bg_color.green);var blue=Math.round(opacity*fg_color.blue+_opacity*bg_color.blue);return w3color(kiwi_rgb(red,green,blue));}
function w3_flash_fade(el_id,color,dwell_ms,fade_ms,color2){var el=w3_el(el_id);if(!el)return el;el.style.transition='background 0s';el.style.background=color;setTimeout(function(){el.style.transition='background '+(fade_ms?(fade_ms/1000):0.3)+'s linear';el.style.background=isString(color2)?color2:'black';},dwell_ms?dwell_ms:50);return el;}
function w3_fillText_shadow(canvas,text,x,y,font,fontSize,color,strokeWidth){strokeWidth=strokeWidth||Math.floor(fontSize / 3);var ctx=canvas.getContext("2d");ctx.font=px(fontSize)+' '+font;ctx.miterLimit=2;ctx.lineJoin="circle";ctx.strokeStyle="black";ctx.lineWidth=strokeWidth;ctx.strokeText(text,x,y);ctx.fillStyle=color;ctx.lineWidth=1;ctx.fillText(text,x,y);};function w3_fillText(ctx,x,y,text,color,font,lineWidth,align,baseline){if(color)ctx.fillStyle=color;if(font)ctx.font=font;if(lineWidth)ctx.lineWidth=lineWidth;if(align)ctx.textAlign=align;if(baseline)ctx.textBaseline=baseline;var tw=ctx.measureText(text).width;ctx.fillText(text,x-tw/2,y);}
function w3_check_restart_reboot(el_id){var el=w3_el(el_id);if(!el)return;w3_iterate_parent(el,function(el){if(w3_contains(el,'w3-restart')){w3_restart_cb();return el;}
if(w3_contains(el,'w3-reboot')){w3_reboot_cb();return el;}
return null;});}
function w3_set_value(path,val){if(1){w3_els(path,function(el){if(el)el.value=val;});}else{var el=w3_el(path);if(el)el.value=val;}}
function w3_set_decoded_value(path,val){w3_set_value(path,kiwi_decodeURIComponent('w3_set_decoded_value:'+path,val));}
function w3_get_value(path){var el=w3_el(path);if(!el)return null;return el.value;}
function w3_add_toplevel(path){if(!path.startsWith('cfg.')&&!path.startsWith('adm.'))
return'cfg.'+path;return path;}
function w3_not_toplevel(path){if(path.startsWith('cfg.')||path.startsWith('adm.'))
return path.substr(path.indexOf('.')+1);return path;}
function w3_basename(path){var i=path.lastIndexOf('.');if(i>=0){return path.substr(i+1);}
return path;}
function w3_psa3(psa3){psa3=psa3||'';a=psa3.split('/');var a0=(a[0]||'').replace(/&slash;/g,'/');var a1=(a[1]||'').replace(/&slash;/g,'/');var a2=(a[2]||'').replace(/&slash;/g,'/');if(a.length==1)
return{left:'',middle:'',right:a0};else
if(a.length==2)
return{left:'',middle:a0,right:a1};else
if(a.length==3)
return{left:a0,middle:a1,right:a2};else
return{left:'',middle:'',right:''};}
function w3_sb(){var a=[];for(var i=0;i<arguments.length;i++){var s=arguments[i];s=isString(s)?s.trim():(isNumber(s)?s.toString():'');if(s!='')a.push(s);}
return a.length?a.join(' '):'';}
function w3_sbc(c){var a=[];for(var i=1;i<arguments.length;i++){var s=arguments[i];s=isString(s)?s.trim():(isNumber(s)?s.toString():'');if(s!='')a.push(s);}
return a.length?a.join(c):'';}
function w3_sbew(ew){var a=[];for(var i=1;i<arguments.length;i++){var s=arguments[i];s=isString(s)?s.trim():(isNumber(s)?s.toString():'');if(s!=''){if(s[s.length-1]!=ew)s=s+ew;a.push(s);}}
return a.length?a.join(' '):'';}
function w3_nl(s){if(isArg(s)&&s!='')s+='\n';return s;}
function w3_psa(psa,extra_prop,extra_style,extra_attr){if(psa&&psa.startsWith('class=')){return psa;}
var a=psa?psa.split('|'):[];psa='';var prop=a[0]||'';if(extra_prop)prop=w3_sb(prop,extra_prop);if(prop!='')psa='class='+dq(prop);var style=a[1]||'';if(extra_style)style=w3_sbew(';',style,extra_style);if(style!='')psa=w3_sb(psa,'style='+dq(style));var attr=(a[2]||'').replace(/&vbar;/g,'|');if(extra_attr)attr=w3_sb(attr,extra_attr);if(attr!='')psa=w3_sb(psa,attr);return psa;}
function w3_psa_mix(psa,extra_prop,extra_style,extra_attr){var dump=psa.includes('w3-dump');if(dump)console.log('--- w3_psa_mix psa='+psa);var a=psa?psa.split('|'):[];var prop=a[0]||'';if(dump)console.log('prop=['+prop+']');if(dump)console.log('extra_prop=['+extra_prop+']');if(extra_prop)prop=w3_sb(prop,extra_prop);if(dump)console.log('mixed prop=['+prop+']');var style=a[1]||'';if(dump)console.log('style=['+style+']');if(dump)console.log('extra_style=['+extra_style+']');if(extra_style)style=w3_sbew(';',style,extra_style);if(dump)console.log('mixed style=['+style+']');var attr=a[2]||'';if(dump)console.log('attr=['+attr+']');if(dump)console.log('extra_attr=['+extra_attr+']');if(extra_attr)attr=w3_sb(attr,extra_attr);if(dump)console.log('mixed attr=['+attr+']');psa=prop+'|'+style+'|'+attr;if(dump)console.log('mix_out=['+psa+']');return psa;}
function w3_set_psa(el,psa){var el=w3_el(el);if(!el||!isNonEmptyString(psa))return null;psa=psa.split('/')[0];psa=psa.split('|');var _class=psa[0];var _style=psa[1];var _attr=psa[2];if(isArg(_class))w3_add(el,_class);if(isArg(_style))el.style=_style;}
function w3int_init(){}
function w3int_post_action(){w3_call('freqset_select');}
function w3_copy_to_clipboard(val){var el=document.createElement("input");el.setAttribute('type','text');el.setAttribute('value',val);document.body.appendChild(el);el.select();document.execCommand("copy");document.body.removeChild(el);}
function w3_isScrolling(id){var el=w3_el(id);if(!el)return null;return(el.scrollHeight>el.clientHeight)}
function w3_isScrolledDown(id){var el=w3_el(id);if(!el)return null;return(Math.abs(el.scrollHeight-el.clientHeight-el.scrollTop)<1)}
function w3_scrolledPosition(id){var el=w3_el(id);if(!el)return null;if(el.clientHeight==0)return-1;var scrollH=el.scrollHeight-el.clientHeight;if(scrollH<=0)return 0;return el.scrollTop / scrollH;}
function w3_scrollTo(id,pos,jog){var el=w3_el(id);if(!el)return null;var scrollH=el.scrollHeight-el.clientHeight;if(scrollH<0)scrollH=0;var top=scrollH*pos;var unchanged=(top==el.scrollTop);el.scrollTop=top;if(jog==true){el.scrollTop=top+1;el.scrollTop=top;}
return unchanged;}
function w3_scrollDown(id,cond){var el=w3_el(id);if(isArg(cond)?cond:true)el.scrollTop=el.scrollHeight;return el;}
function w3_scrollTop(id,cond){var el=w3_el(id);if(isArg(cond)?cond:true)el.scrollTop=0;return el;}
function w3_do_when_rendered(id,func,arg,poll_ms){var el=w3_el(id);poll_ms=isNumber(poll_ms)?poll_ms:500;if(isNoArg(el)){setTimeout(function(){w3_do_when_rendered(id,func,arg,poll_ms);},poll_ms);}else{if(isFunction(func))
func(el,arg);}}
function w3_do_when_cond(cond_func,func,arg,poll_ms){poll_ms=isNumber(poll_ms)?poll_ms:500;if(!cond_func(arg)){setTimeout(function(){w3_do_when_cond(cond_func,func,arg,poll_ms);},poll_ms);}else{if(isFunction(func))
func(arg);}}
function w3_hr(psa){var p=w3_psa(psa);var s='<hr '+p+'>';var narg=arguments.length;for(var i=1;i<narg;i++){s+=arguments[i];}
return s;}
function w3_click_nav(next_id,cb_next,cb_param){var next_id_nav='id-nav-'+next_id;var cur_id=null;var next_el=null;var cb_prev=null;w3_iterate_children(w3_el(next_id_nav).parentNode,function(el,i){if(el.nodeName!='A')return;if(w3_contains(el,'w3int-cur-sel')){cur_id=el.id.substring(7);w3_remove(el,'w3int-cur-sel');w3_iterate_classList(el,function(s,i){if(s.startsWith('id-nav-cb-'))
cb_prev=s.substring(10);});}
if(el.id==next_id_nav){next_el=el;}});if(cur_id)
w3_toggle(cur_id,'w3-show-block');if(cur_id&&cb_prev){w3_call(cb_prev+'_blur',cur_id);}
if(next_el){w3_add(next_el,'w3int-cur-sel');w3_check_restart_reboot(next_el);}
w3_toggle(next_id,'w3-show-block');if(cb_next!='null'){w3_call(cb_next+'_focus',next_id,cb_param);}}
function w3int_anchor(psa,text,id,cb,isSelected){if(cb===undefined)cb=id;var nav_cb=cb?('id-nav-cb-'+cb):'';var attr='id="id-nav-'+id+'" onclick="w3_click_nav('+sq(id)+', '+sq(cb)+')"';var p=w3_psa(psa,nav_cb+(isSelected?' w3int-cur-sel':''),'',attr);var s='<a '+p+' href="javascript:void(0)">'+text+'</a>';return s;}
function w3_navbar(psa){var p=w3_psa(psa,'w3-navbar');var s='<nav '+p+'>';var narg=arguments.length;for(var i=1;i<narg;i++){s+=arguments[i];}
s+='</nav>';return s;}
function w3_sidenav(psa){var p=w3_psa(psa,'w3-sidenav w3-static w3-left w3-sidenav-full-height w3-light-grey');var s='<nav '+p+'>';var narg=arguments.length;for(var i=1;i<narg;i++){s+=arguments[i];}
s+='</nav>';return s;}
function w3_nav(psa,text,id,cb,isSelected){return w3int_anchor(psa,text,id,cb,isSelected);}
function w3_navdef(psa,text,id,cb){setTimeout(function(){w3_toggle(id,'w3-show-block');},w3_highlight_time);return w3int_anchor(psa,text,id,cb,true);}
function w3_label(psa,text,path,extension){if(arguments.length>=4)console.log('### w3_label ext='+extension);psa=psa||'';text=text||'';extension=extension||'';if(psa==''&&text==''&&extension=='')return'';if(text.startsWith('<label '))return text;var id=w3_add_id(path,'-label');var p=w3_psa(psa,id);var s='<label '+p+'>'+text+extension+'</label>';return s;}
function w3_get_label(label,path){return w3_get_innerHTML(w3_add_id(path,'-label'));}
function w3_set_label(label,path){w3_innerHTML(w3_add_id(path,'-label'),label);}
function w3_title(id,text){var el=w3_el(id);if(!el)return null;w3_attribute(el,'title',text);return el;}
function w3int_link_click(ev,cb,cb_param){var el=ev.currentTarget;w3_check_restart_reboot(el);if(cb){w3_call(cb,el,cb_param,false);}
w3int_post_action();}
function w3_link(psa,url,inner,title,cb,cb_param){var qual_url=url;var href='';var target='';if(url!=''){if(!url.startsWith('javascript:')){if(!url.startsWith('http://')&&!url.startsWith('https://'))
qual_url='http://'+url;target=' target="_blank"';}
href='href='+dq(qual_url)+' ';}
inner=inner||'';title=title||'';if(title!='')title=' title='+dq(title);var pointer=(cb&&cb!='')?'w3-pointer':'';cb_param=cb_param||0;var onclick=cb?(' onclick="w3int_link_click(event, '+sq(cb)+', '+sq(cb_param)+')"'):'';var p=w3_psa(psa,pointer,'',href+target+title+onclick);var esc_html=psa.includes('w3-esc-html');var lt=esc_html?kiwi.esc_lt:'<';var gt=esc_html?kiwi.esc_gt:'>';var s=lt+'a '+p+gt+inner+lt+'/a'+gt;return s;}
function w3_link_set(path,url){var el=w3_el(path);if(el&&url!=''){if(!url.startsWith('http://')&&!url.startsWith('https://'))
url='http://'+url;w3_attribute(el,'href',url);w3_attribute(el,'target','_blank');}}
function w3_img_wh(src,func){var img=new Image();img.onload=function(){func(this.width,this.height);};img.src=src;}
var w3_SELECTED=true;var w3_NOT_SELECTED=false;function w3_radio_unhighlight(path){w3_iterate_classname('id-'+path,function(el){w3_unhighlight(el);});}
function w3int_radio_click(ev,path,cb,cb_param){w3_radio_unhighlight(path);w3_highlight(ev.currentTarget);var idx=-1;w3_iterate_classname('id-'+path,function(el,i){if(w3_isHighlighted(el))
idx=i;});w3_check_restart_reboot(ev.currentTarget);if(cb){w3_call(cb,path,idx,false,cb_param);}
w3int_post_action();}
function w3_radio_btn(text,path,isSelected,save_cb,prop){var prop=(arguments.length>4)?arguments[4]:null;var _class=' id-'+path+(isSelected?(' '+w3_highlight_color):'')+(prop?(' '+prop):'');var oc='onclick="w3int_radio_click(event, '+sq(path)+', '+sq(save_cb)+')"';var s='<button class="w3-btn w3-ext-btn'+_class+'" '+oc+'>'+text+'</button>';return s;}
function w3_radio_button(psa,text,path,isSelected,cb,cb_param){cb_param=cb_param||0;var onclick=cb?('onclick="w3int_radio_click(event, '+sq(path)+', '+sq(cb)+', '+sq(cb_param)+')"'):'';var p=w3_psa(psa,'id-'+path+(isSelected?(' '+w3_highlight_color):'')+' w3-btn w3-ext-btn','',onclick);var s='<button '+p+'>'+text+'</button>';return s;}
function w3_radio_button_get_param(psa,text,path,selected_if_val,init_val,cb,cb_param){var cur_val=ext_get_cfg_param(path,(init_val==undefined)?null:init_val);var isSelected=(cur_val==selected_if_val)?w3_SELECTED:w3_NOT_SELECTED;return w3_radio_button(psa,text,path,isSelected,cb,cb_param);}
var w3_SWITCH_YES_IDX=0,w3_SWITCH_NO_IDX=1;function w3_switch(psa,text_0,text_1,path,text_0_selected,cb,cb_param){var s=w3_radio_button(w3_psa_mix(psa,'w3int-switch-0'),text_0,path,text_0_selected?1:0,cb,cb_param)+
w3_radio_button(w3_psa_mix(psa,'w3int-switch-1'),text_1,path,text_0_selected?0:1,cb,cb_param);return s;}
function w3_switch_label(psa,label,text_0,text_1,path,text_0_selected,cb,cb_param){var hasLabel=(label!='');var inline=psa.includes('w3-label-inline');var centered=psa.includes('w3-center');var left=psa.includes('w3-label-left');var bold=!psa.includes('w3-label-not-bold');var spacing=(hasLabel&&!inline)?'w3-margin-T-8':'';if(hasLabel&&inline)spacing+=left?' w3-margin-L-8':' w3-margin-R-8';if(centered)spacing+=' w3-halign-center';var psa3=w3_psa3(psa);var psa_outer=w3_psa_mix(psa3.left,(inline?'w3-show-inline-new':'')+(centered?' w3-halign-center w3-center':''));var psa_label=w3_psa_mix(psa3.middle,(hasLabel&&bold)?'w3-bold':'');var psa_inner=w3_psa();var ls=w3_label(psa_label,label,path);var cs=w3_inline(spacing+'/'+psa3.right,w3_radio_button('w3int-switch-0',text_0,path,text_0_selected?1:0,cb,cb_param)+
w3_radio_button('w3int-switch-1',text_1,path,text_0_selected?0:1,cb,cb_param));var s=w3_div(psa_outer,((left||!inline)?(ls+cs):(cs+ls)));return s;}
function w3_switch_get_param(psa,text_0,text_1,path,text_0_selected_if_val,init_val,cb,cb_param){var cur_val=ext_get_cfg_param(path,(init_val==undefined)?null:init_val);var text_0_selected=(cur_val==text_0_selected_if_val)?w3_SELECTED:w3_NOT_SELECTED;return w3_switch(psa,text_0,text_1,path,text_0_selected,cb,cb_param);}
function w3_switch_label_get_param(psa,label,text_0,text_1,path,text_0_selected_if_val,init_val,cb,cb_param){var cur_val=ext_get_cfg_param(path,(init_val==undefined)?null:init_val);var text_0_selected=(cur_val==text_0_selected_if_val)?w3_SELECTED:w3_NOT_SELECTED;return w3_switch_label(psa,label,text_0,text_1,path,text_0_selected,cb,cb_param);}
function w3_switch_set_value(path,switch_idx){var sw='w3int-switch-'+switch_idx;w3_iterate_classname('id-'+path,function(el,i){if(w3_contains(el,sw)){el.click();}});}
function w3int_btn_evt(ev,path,cb,cb_param){if(!w3_contains(path,'w3-disabled')){w3_check_restart_reboot(ev.currentTarget);var el=w3_el(path);var hold=w3_contains(el,'w3-hold');if(hold){if(ev.type=='mousedown'||ev.type=='touchstart'){el.hold_triggered=false;el.hold_timeout=setTimeout(function(){el.hold_triggered=true;if(cb){w3_call(cb,path,cb_param,false,{type:'hold'});}},500);return ignore(ev);}else{if((ev.type=='click'||ev.type=='touchend')&&isArg(el.hold_timeout)){var timeout=el.hold_timeout;var triggered=el.hold_triggered;el.hold_timeout=null;el.hold_triggered=false;kiwi_clearTimeout(timeout);if(triggered){w3int_post_action();return ignore(ev);}}}}
if(cb){w3_call(cb,path,cb_param,false,ev);}}
w3int_post_action();}
var w3int_btn_grp_uniq=0;function w3_btn(text,cb){console.log('### DEPRECATED: w3_btn');return w3_button('',text,cb);}
function w3_cb_param_encode(cbp){if(isNoArg(cbp)){return 0;}
if(isObject(cbp)){return encodeURIComponent(JSON.stringify(cbp));}
return cbp;}
function w3_cb_param_decode(cbp){if(isNoArg(cbp)){return 0;}
if(isString(cbp)){cbp=decodeURIComponent(cbp);var obj;if(cbp[0]=='{'){try{obj=JSON.parse(cbp);}catch(ex){return cbp;}
return obj;}}
return cbp;}
function w3int_button(psa,path,text,cb,cb_param){var momentary=psa.includes('w3-momentary');var hold=psa.includes('w3-hold');var custom_events=psa.includes('w3-custom-events');cb_param=w3_cb_param_encode(cb_param);var ev_cb=function(cbp){return sprintf('"w3int_btn_evt(event,%s,%s,%s);"',sq(path),sq(cb),sq(cbp));}
var onclick=cb?('onclick='+ev_cb(cb_param)):'';if(cb&&momentary&&!hold&&!custom_events){onclick+=' onmousedown='+ev_cb(0);onclick+=' ontouchstart='+ev_cb(0);}else
if(cb&&hold&&!momentary&&!custom_events){onclick+=' onmousedown='+ev_cb(cb_param);onclick+=' ontouchstart='+ev_cb(cb_param);onclick+=' ontouchend='+ev_cb(cb_param);}else
if(cb&&(custom_events||hold)&&!momentary){onclick+=' onmouseenter='+ev_cb(cb_param);onclick+=' onmouseleave='+ev_cb(cb_param);onclick+=' onmousedown='+ev_cb(cb_param);onclick+=' onmousemove="ignore(event);"';onclick+=' onmouseup="ignore(event);"';onclick+=' ontouchstart='+ev_cb(cb_param);onclick+=' ontouchmove="ignore(event);"';onclick+=' ontouchend='+ev_cb(cb_param);}
var default_style=(psa.includes('w3-round')||psa.includes('w3-circle'))?'':' w3-round-large';var noactive=psa.includes('w3-noactive')?' class-button-noactive w3-ext-btn-noactive':'';var psa3=w3_psa3(psa);var psa_outer=w3_psa(psa3.left);var psa_inner=w3_psa(psa3.right,path+' w3-btn w3-ext-btn'+default_style+noactive,'',onclick);if(psa.includes('w3-dump')){console.log('w3_button');console.log(psa3);console.log('psa_outer='+psa_outer);console.log('psa_inner='+psa_inner);}
var s='<button '+psa_inner+'>'+text+'</button>';if(psa_outer!='')s='<div '+psa_outer+'>'+s+'</div>';if(psa_outer.includes('w3-dump'))console.log(s);return s;}
function w3_button(psa,text,cb,cb_param){var path='id-btn-grp-'+w3int_btn_grp_uniq.toString();w3int_btn_grp_uniq++;return w3int_button(psa,path,text,cb,cb_param);}
function w3_button_path(psa,path,text,cb,cb_param){return w3int_button(psa,path,text,cb,cb_param);}
function w3_button_text(path,text,color_or_add_color,remove_color){var el=w3_el(path);if(!el)return null;if(isArg(text))
el.innerHTML=text;if(color_or_add_color){if(color_or_add_color.startsWith('w3-')){w3_remove(el,remove_color);w3_add(el,color_or_add_color);}else
el.style.color=color_or_add_color;}
return el;}
function w3_icon(psa,fa_icon,size,color,cb,cb_param){var momentary=psa.includes('w3-momentary');var hold=psa.includes('w3-hold');var custom_events=psa.includes('w3-custom-events');var pointer=(cb&&cb!='')?' w3-pointer':'';var path='id-btn-grp-'+w3int_btn_grp_uniq.toString();w3int_btn_grp_uniq++;var font_size=null;if(isNumber(size)&&size>=0)font_size=px(size);else
if(isString(size))font_size=size;font_size=font_size?(' font-size:'+font_size+';'):'';color=color||'';var c=color.split('|');color='';if(c[0]!='')color=' color:'+c[0]+';';if(c.length>=2&&c[1]!='')color+=' background-color:'+c[1]+';';cb_param=w3_cb_param_encode(cb_param);var ev_cb=function(cbp){return sprintf('"w3int_btn_evt(event, %s, %s, %s)"',sq(path),sq(cb),sq(cbp));}
var onclick=cb?('onclick='+ev_cb(cb_param)):'';if(cb&&(momentary||hold)&&!custom_events){if(momentary)cb_param=0;onclick+=' onmousedown='+ev_cb(cb_param);onclick+=' ontouchstart='+ev_cb(cb_param);}else
if(cb&&(custom_events||hold)&&!momentary){onclick+=' onmouseenter='+ev_cb(cb_param);onclick+=' onmouseleave='+ev_cb(cb_param);onclick+=' onmousedown="ignore(event)"';onclick+=' onmousemove="ignore(event)"';onclick+=' onmouseup="ignore(event)"';onclick+=' ontouchstart='+ev_cb(cb_param);onclick+=' ontouchmove="ignore(event)"';onclick+=' ontouchend='+ev_cb(cb_param);}
var p=w3_psa(psa,path+pointer+' fa '+fa_icon,font_size+color,onclick);var s='<i '+p+'></i>';return s;}
function w3_spin(el,cond){var el=w3_el(el);if(!el)return null;cond=isArg(cond)?cond:true;w3_remove_then_add(el,'fa-spin',cond?'fa-spin':'');}
function w3int_input_keydown(ev,path,cb){var i,s;var k=ev.key.toUpperCase();var ctrl=ev.ctrlKey;var el=w3_el(path);if(!el)return;var input_any_key=w3_contains(el,'w3-input-any-key');var input_any_change=w3_contains(el,'w3-input-any-change');var disabled=w3_parent_with(el,'w3-disabled');var trace=w3_contains(el,'w3-trace');if(trace)console.log('w3int_input_keydown k='+k+(ctrl?' CTRL ':'')+' val=<'+el.value+'> cb='+cb+' disabled='+disabled);var cb_a=cb.split('|');if(disabled){if(trace)console.log('w3int_input_keydown w3-disabled');return;}
if(input_any_key&&cb_a[1]){w3_call(cb_a[1],ev,true);}
if(ev.key=='Enter'){if(input_any_change){s=el.value;for(i=el.selectionStart;i<el.textLength;i++){if(s.charAt(i)!='\n')
break;}
if(i==el.textLength){while(s.endsWith('\n'))
s=s.slice(0,-1);w3_set_value(el,s);}
if(trace)console.log('ss='+el.selectionStart+' se='+el.selectionEnd+' tl='+el.textLength);if((el.selectionStart==el.selectionEnd&&el.selectionStart==el.textLength)||(el.selectionStart==0&&el.selectionEnd==el.textLength)){if(trace)console.log('w3_input_change...');w3_input_change(path,cb,'kd');}}else
if(el.value==''){w3_input_change(path,cb,'kd');}}
if(ev.key=='Backspace'&&input_any_change&&el.selectionStart==0&&el.selectionEnd==el.value.length){el.value='';w3_input_change(path,cb,'kd');}}
function w3int_input_keyup(ev,path,cb){}
function w3_input_input(ev){var a=ev.detail.split('|');var path=a[0];var cb=a[1];var el=w3_el(path);if(el){var trace=w3_contains(el,'w3-trace');if(trace)console.log('w3_input_input path='+path+' val='+el.value+' cb='+cb);w3_input_change(path,cb,'w3_input_input');}}
function w3_input_change(path,cb,from){var el=w3_el(path);if(el){var trace=w3_contains(el,'w3-trace');if(trace)console.log('w3_input_change path='+path);w3_check_restart_reboot(el);w3_schedule_highlight(el);if(cb){var cb_a=cb.split('|');if(isArg(from))cb_a.push(from);w3_call(cb_a[0],path,el.value,false,cb_a);}}
if(w3_contains(el,'w3-retain-input-focus')||w3_contains(el,'w3-ext-retain-input-focus'))
w3_field_select(path,{mobile:1});else
w3int_post_action();}
function w3_input(psa,label,path,val,cb,placeholder){var dump=psa.includes('w3-dump');var id=w3_add_id(path);cb=cb||'';var phold=placeholder?('placeholder="'+placeholder+'"'):'';var custom=psa.includes('w3-custom-events');var onchange=' onchange="w3_input_change('+sq(path)+', '+sq(cb)+', '+sq('ev')+')"';var onkeydown=' onkeydown="w3int_input_keydown(event, '+sq(path)+', '+sq(cb)+')"';var onkeyup=' onkeyup="w3int_input_keyup(event, '+sq(path)+', '+sq(cb)+')"';var events=(path&&!custom)?(onchange+onkeydown+onkeyup):'';val=' value='+dq(w3_esc_dq(val)||'');var inline=psa.includes('w3-label-inline');var bold=!psa.includes('w3-label-not-bold');label=label||'';var label_spacing=(label!=''&&inline)?'w3int-margin-input':'';var psa3=w3_psa3(psa);if(dump)console.log(psa3);var psa_outer=w3_psa(psa3.left,inline?'w3-show-inline-new':'');var psa_label=w3_psa_mix(psa3.middle,(label!=''&&bold)?'w3-bold':'');var style=psa.includes('w3-no-styling')?'':'w3-input w3-border w3-hover-shadow';var type=psa3.right.includes('type=')?'':'type="text"';var psa_inner=w3_psa(psa3.right,w3_sb(id,style,label_spacing),'',w3_sb(type,phold));if(dump)console.log('O:['+psa_outer+'] L:['+psa_label+'] I:['+psa_inner+']');var s='<div '+psa_outer+'>'+
w3_label(psa_label,label,path)+'<input id='+dq(id)+' '+psa_inner+val+events+'>'+'</div>';return s;}
function w3_input_force(path,cb,input){var el=w3_el(path);if(!el)return;el.addEventListener('input',w3_input_input,true);el.value=input.replace('&vbar;','|');el.dispatchEvent(new CustomEvent('input',{detail:path+'|'+cb}));el.removeEventListener('input',w3_input_input,true);}
function w3_input_get(psa,label,path,cb,init_val,placeholder){var cur_val=ext_get_cfg_param(path,(init_val==undefined)?null:init_val);cur_val=kiwi_decodeURIComponent('w3_input_get:'+path,cur_val);return w3_input(psa,label,path,cur_val,cb,placeholder);}
function w3_input_get_param(label,path,cb,init_val,placeholder){var cur_val=ext_get_cfg_param(path,(init_val==undefined)?null:init_val);cur_val=kiwi_decodeURIComponent('w3_input_get_param:'+path,cur_val);return w3_input('',label,path,cur_val,cb,placeholder);}
function w3_textarea(psa,label,path,val,rows,cols,cb){var id=w3_add_id(path);var spacing=(label!='')?' w3-margin-T-8':'';var custom=psa.includes('w3-custom-events');var onchange=psa.includes('w3-input-any-change')?'':(' onchange="w3_input_change('+sq(path)+', '+sq(cb)+')"');var onkeydown=' onkeydown="w3int_input_keydown(event, '+sq(path)+', '+sq(cb)+')"';var onkeyup=' onkeyup="w3int_input_keyup(event, '+sq(path)+', '+sq(cb)+')"';var events=(path&&!custom)?(onchange+onkeydown+onkeyup):'';var val=val||'';var bold=!psa.includes('w3-label-not-bold');var psa3=w3_psa3(psa);var psa_label=w3_psa_mix(psa3.middle,(label!=''&&bold)?'w3-bold':'');var psa_inner=w3_psa(psa3.right,'w3-input w3-border w3-hover-shadow '+id+spacing,'','rows='+dq(rows)+' cols='+dq(cols));var s=w3_div(psa3.left,w3_label(psa_label,label,path)+'<textarea '+psa_inner+events+'>'+val+'</textarea>');if(psa.includes('w3-dump'))console.log('s='+s);return s;}
function w3_textarea_get_param(psa,label,path,rows,cols,cb,init_val){var cur_val=ext_get_cfg_param(path,(init_val==undefined)?null:init_val);cur_val=kiwi_decodeURIComponent('w3_textarea_get_param:'+path,cur_val);return w3_textarea(psa,label,path,cur_val,rows,cols,cb);}
function w3int_checkbox_change(path,cb,cb_param){var el=w3_el(path);w3_check_restart_reboot(el);if(cb){w3_schedule_highlight(el);w3_call(cb,path,el.checked,false,cb_param);}
if(w3_contains(el,'w3-retain-input-focus')||w3_contains(el,'w3-ext-retain-input-focus'))
w3_field_select(path,{mobile:1});else
w3int_post_action();}
function w3_checkbox(psa,label,path,checked,cb,cb_param){var id=w3_add_id(path);var onchange=' onchange="w3int_checkbox_change('+sq(path)+', '+sq(cb)+', '+sq(cb_param)+')"';var checked_s=checked?' checked':'';var inline=psa.includes('w3-label-inline');var left=psa.includes('w3-label-left');var bold=!psa.includes('w3-label-not-bold');var spacing=(label!=''&&inline)?(left?' w3-margin-L-8':' w3-margin-R-8'):'';var psa3=w3_psa3(psa);var psa_outer=w3_psa(psa3.left,inline?'w3-show-inline-new':'');var psa_label=w3_psa_mix(psa3.middle,(label!=''&&bold)?'w3-bold':'');var psa_inner=w3_psa(psa3.right,'w3-input w3-width-auto w3-border w3-pointer w3-hover-shadow '+id+spacing,'','type="checkbox"');var ls=w3_label(psa_label,label,path);var cs='<input '+psa_inner+checked_s+onchange+'>';var s='<div '+psa_outer+'>'+
(left?(ls+cs):(cs+ls))+'</div>';if(cb)
setTimeout(function(){w3_call(cb,path,checked,true,cb_param);},500);return s;}
function w3_checkbox_get_param(psa,label,path,cb,init_val){var update_path_var=psa.includes('w3-update');var cur_val=ext_get_cfg_param(path,(init_val==undefined)?null:init_val,undefined,update_path_var);return w3_checkbox(psa,label,path,cur_val,cb);}
function w3_checkbox_get(path){var el=w3_el(path);if(!el)return;return(el.checked?true:false);}
function w3_checkbox_set(path,checked){var el=w3_el(path);if(!el)return;el.checked=checked?true:false;}
var W3_SELECT_SHOW_TITLE=-1;function w3int_select_change(ev,path,cb,cb_param){var el=ev.currentTarget;w3_check_restart_reboot(el);if(cb){w3_call(cb,path,el.value,false,cb_param);}
w3int_post_action();}
function w3int_select(psa,label,title,path,sel,opts_s,cb,cb_param){var id=w3_add_id(path);var first='';if(title!=''){var as=title.split('<br>');as.forEach(function(s,i){first+='<option value="-1" '+((sel==W3_SELECT_SHOW_TITLE&&i==0)?'selected':'')+' disabled>'+s+'</option>';});}else{if(sel==W3_SELECT_SHOW_TITLE)sel=0;}
var inline=psa.includes('w3-label-inline');var bold=!psa.includes('w3-label-not-bold');var spacing=(label!=''&&!inline)?' w3-margin-T-8':'';if(inline)spacing+=' w3-margin-left';if(cb==undefined)cb='';var onchange='onchange="w3int_select_change(event, '+sq(path)+', '+sq(cb)+', '+sq(cb_param)+')"';var psa3=w3_psa3(psa);var psa_outer=w3_psa(psa3.left,inline?'w3-show-inline-new':'');var psa_label=w3_psa_mix(psa3.middle,(label!=''&&bold)?'w3-bold':'');var psa_inner=w3_psa(psa3.right,id+' w3-select-menu'+spacing,'',onchange);var s='<div '+psa_outer+'>'+
w3_label(psa_label,label,path)+
((!inline&&label!='')?'<br>':'')+'<select '+psa_inner+'>'+first+opts_s+'</select>'+'</div>';if(cb&&sel!=W3_SELECT_SHOW_TITLE)
setTimeout(function(){w3_call(cb,path,sel,true,cb_param);},500);return s;}
function w3int_select_options(sel,opts,show_empty){var s='';if(isString(opts)){var rng=opts.split(':');if(rng.length==2){var min=+rng[0];var max=+rng[1];var idx=0;for(var i=min;i<=max;i++){s+='<option value='+dq(idx)+' '+((idx==sel)?'selected':'')+'>'+i+'</option>';idx++;}}}else
if(isArray(opts)){opts.forEach(function(obj,i){if(obj==null)return;if(isObject(obj)){var hasName=isDefined(obj.name);if(hasName&&!show_empty&&obj.name=='')return;obj=hasName?obj.name:w3_obj_seq_el(obj,0);}
s+='<option value='+dq(i)+' '+((i==sel)?'selected':'')+'>'+obj+'</option>';});}else
if(isObject(opts)){w3_obj_enum(opts,function(key,i,obj){var value,text,disabled=false;if(isObject(obj)){value=isDefined(obj.value)?obj.value:i;var hasName=isDefined(obj.name);if(hasName&&!show_empty&&obj.name=='')return;text=hasName?obj.name:key;if(isDefined(obj.disabled)&&obj.disabled)disabled=true;}else{value=i;text=obj;}
s+='<option value='+dq(value)+((i==sel)?' selected':'')+(disabled?' disabled':'')+'>'+text+'</option>\n';});}
if(sel==null){s+='<option value=-1 selected disabled>(unknown)</option>\n';}
return s;}
function w3_select(psa,label,title,path,sel,opts,cb,cb_param){var s=w3int_select_options(sel,opts,psa.includes('w3-show-empty'));if(psa.includes('w3-dump'))console.log(s);return w3int_select(psa,label,title,path,sel,s,cb,cb_param);}
function w3int_select_hier(psa,label,title,path,sel,collapse,opts,cb,cb_param){var s='';var idx=0;if(!isObject(opts))return;w3_obj_enum(opts,function(key,i,a){if(!isNumber(+key)){as=key.split('_');as.forEach(function(e){if(!e||e!='')
s+='<option value='+dq(idx++)+' disabled>'+e+'</option> ';});}
if(!isArray(a))return;a.forEach(function(el,j){if(collapse&&j>=collapse)return;var v=w3_first_value(el);if(v=='null')return;var v2=w3_second_value(el);var _class=v2?(' class='+dq(v2)):'';s+='<option value='+dq(idx++)+' id="id-'+i+'-'+j+'"'+_class+'>'+v.toString()+'</option> ';});});return w3int_select(psa,label,title,path,sel,s,cb,cb_param);}
function w3_select_hier(psa,label,title,path,sel,opts,cb,cb_param){return w3int_select_hier(psa,label,title,path,sel,0,opts,cb,cb_param);}
function w3_select_hier_collapse(psa,label,title,path,sel,collapse,opts,cb,cb_param){return w3int_select_hier(psa,label,title,path,sel,collapse,opts,cb,cb_param);}
function w3_select_conditional(psa,label,title,path,sel,opts,cb,cb_param){var s='';var idx=0;if(!isArray(opts))return;opts.forEach(function(el){if(isArray(el))
s+='<option value='+dq(idx)+' '+((idx==sel)?'selected':'')+' '+(el[1]?'':'disabled')+'>'+el[0]+'</option> ';idx++;});return w3int_select(psa,label,title,path,sel,s,cb,cb_param);}
function w3_select_set_disabled(path,value,disabled){w3_iterate_children('id-'+path,function(el,i){if(el.value==value)el.disabled=disabled?true:false;});}
function w3_select_get_param(psa,label,title,path,opts,cb,init_val){var update_path_var=psa.includes('w3-update');var cur_val=ext_get_cfg_param(path,(init_val==undefined)?0:init_val,undefined,update_path_var);return w3_select(psa,label,title,path,cur_val,opts,cb);}
function w3_select_enum(path,func){var path=w3_el(path);if(!path)return;w3_iterate_children(path,func);}
function w3_select_get_value(path,idx){var found=null,last_disabled=null;w3_select_enum(path,function(e){if(e.value==idx)
found=e.innerHTML;if(!found&&e.disabled)
last_disabled=e.innerHTML;});return{option:found,last_disabled:last_disabled};}
function w3_select_value(path,idx,opt){if(w3_opt(opt,'all')){w3_els(path,function(el){el.value=idx;});}else{var el=w3_el(path);if(!el)return;el.value=idx;}}
function w3_select_set_if_includes(path,s){var found=false;var re=RegExp(s);w3_select_enum(path,function(option){if(re.test(option.innerHTML)){if(!found){w3_select_value(path,option.value);found=true;}}});return found;}
function w3int_slider_change(ev,complete,path,cb,cb_param){var el=ev.currentTarget;w3_check_restart_reboot(el);if(cb){w3_call(cb,path,el.value,complete,false,cb_param);}
if(complete)
w3int_post_action();}
function w3int_slider_wheel(evt,path,cb,cb_param){w3int.rate_limit_evt[cb]=evt;w3int.rate_limit[cb](cb_param);evt.preventDefault();}
function w3_slider_wheel(cb,el,cur,slow,fast){var el=w3_el(el);if(!el)return null;var evt=w3int.rate_limit_evt[cb];var x=evt.deltaX;var y=evt.deltaY;var ay=Math.abs(y);var up_down=(ay<50)?slow:fast;if(y>0)up_down=-up_down;var nval=cur+up_down;return w3_clamp(nval,+el.min,+el.max);}
function w3_slider(psa,label,path,val,min,max,step,cb,cb_param){var dump=psa.includes('w3-dump');var id=w3_add_id(path);var inline=psa.includes('w3-label-inline');var bold=!psa.includes('w3-label-not-bold');var spacing=(label!=''&&inline)?' w3-margin-L-8':'';if(inline)spacing+=' w3-margin-left';value=(val==null)?'':w3_strip_quotes(val);value='value='+dq(value);cb_param=cb_param||0;var oc=' oninput="w3int_slider_change(event, 0, '+sq(path)+', '+sq(cb)+', '+sq(cb_param)+')"';var os=' onchange="w3int_slider_change(event, 1, '+sq(path)+', '+sq(cb)+', '+sq(cb_param)+')"';var ow='';if(psa.includes('w3-wheel')){var cb_wheel=removeEnding(cb,'_cb')+'_wheel_cb';ow=' onwheel="w3int_slider_wheel(event, '+sq(path)+', '+sq(cb_wheel)+', '+sq(cb_param)+')"';w3int.rate_limit[cb_wheel]=kiwi_rateLimit(cb_wheel,170);}
var psa3=w3_psa3(psa);var psa_outer=w3_psa(psa3.left,inline?'w3-show-inline-new':'');var psa_label=w3_psa_mix(psa3.middle,(label!=''&&bold)?'w3-bold':'');var psa_inner=w3_psa(psa3.right,id+spacing,'',value+' type="range" min='+dq(min)+' max='+dq(max)+' step='+dq(step)+oc+os+ow);var s=(label!='')?('<div '+psa_outer+'>'+
w3_label(psa_label,label,path)+
((!inline&&label!='')?'<br>':'')+'<input '+psa_inner+'>'+'</div>'):('<input '+psa_inner+'>');if(cb)
setTimeout(function(){w3_call(cb,path,val,true,true,cb_param);},500);if(dump)console.log(s);return s;}
function w3_slider_set(path,val,cb){w3_set_value(path,val);w3_call(cb,path,val,true,false);}
function w3_slider_setup(path,min,max,step,val){var el=w3_el(path);if(!el)return el;el.min=min;el.max=max;el.step=step;el.value=val;return el;}
function w3_slider_get_param(psa,label,path,min,max,step,cb,cb_param,init_val){var update_path_var=psa.includes('w3-update');var cur_val=ext_get_cfg_param(path,(init_val==undefined)?0:init_val,undefined,update_path_var);return w3_slider(psa,label,path,cur_val,min,max,step,cb,cb_param);}
function w3_menu(psa,cb){var id=psa.replace(/\s+/g,' ').split(' |')[0];cb=cb||'';var onclick='onclick="w3int_menu_onclick(event, '+sq(id)+', '+sq(cb)+')"'+' oncontextmenu="w3int_menu_onclick(event, '+sq(id)+', '+sq(cb)+')"';var p=w3_psa(psa,'w3-menu w3-menu-container w3-round-large','',onclick);var s='<div '+p+'></div>';w3_el('id-w3-misc-container').innerHTML+=s;}
function w3_menu_items(id,arr,max_vis){if(w3int.menu_debug)canvas_log('w3_menu_items cur='+w3int.menu_cur_id);w3_menu_close('open');w3int.menu_cur_id=id;var s='';var idx=0,prop,attr;var items;if(isArray(arr)){items=arr;}else{items=[];for(var i=1;i<arguments.length;i++)
items.push(arguments[i]);}
if(w3int.menu_debug)canvas_log('#='+items.length);for(var i=0;i<items.length;i++){if(w3int.menu_debug)canvas_log('i='+i+' '+items[i]);if(items[i]==null)continue;prop='w3-menu ';attr='id='+dq(idx);if(items[i]=='<hr>'){prop+='w3-menu-item-hr';idx++;}else
if(items[i].charAt(0)=='!'){prop+='w3-menu-item-disabled';items[i]=items[i].substr(1);idx++;}else{prop+='w3-menu-item';idx++;if(!kiwi_isMobile())prop+=' w3-menu-item-hover';}
var psa=w3_psa_mix('',prop,'',attr);s+=w3_div(psa,items[i]);}
if(w3int.menu_debug)canvas_log('s#='+s.length);var el=w3_el(id);el.innerHTML=s;if(w3int.menu_debug)
canvas_log('BUILD');max_vis=max_vis||items.length;if(items.length>max_vis){el.style.height=px((max_vis*(4+19.5+4))+2*8);w3_add(el,'w3-scroll-always-y');}else{el.style.height='';w3_remove(el,'w3-scroll-always-y');}
if(kiwi_isMobile()){if(mobile_laptop_test)console.log('w3_menu_items MOBILE '+id);w3_iterate_children(id,function(el,i){el.addEventListener('touchmove',w3int_menu_touch_move,false);if(mobile_laptop_test)
el.addEventListener('mousemove',w3int_menu_mouse_move,false);});}}
function w3int_menu_mouse_move(ev){var x=Math.round(ev.pageX);var y=Math.round(ev.pageY);w3int_menu_move('MMM',x,y);}
function w3int_menu_touch_move(ev){var x=Math.round(ev.touches[0].pageX);var y=Math.round(ev.touches[0].pageY);w3int_menu_move('MTM',x,y);}
function w3int_menu_move(which,x,y){var el=document.elementFromPoint(x,y);if(!el)return;if(w3_isScrolling(w3int.menu_cur_id))return;var rtn=(!el||!w3_contains(el,'w3-menu-item'));if(w3int.prev_menu_hover_el&&(rtn||(el!=w3int.prev_menu_hover_el))){w3int.prev_menu_hover_el.style.background='';w3int.prev_menu_hover_el.style.color='';if(rtn){return;}}
el.style.background='rgb(79, 157, 251)';el.style.color='white';w3int.prev_menu_hover_el=el;}
function w3_menu_popup(id,close_func,x,y){var x0=x,y0=y;var el=w3_el(id);x=x||window.innerWidth/2;y=y||window.innerHeight/2;var slop=16;el.w3_realigned=false;if((x+el.clientWidth)+slop>window.innerWidth){x=window.innerWidth-el.clientWidth-slop;el.w3_realigned_time=Date.now();el.w3_realigned=true;}
el.style.left=px(x);var yt=y+el.clientHeight+slop;if(yt>window.innerHeight){y=window.innerHeight-el.clientHeight-slop;el.w3_realigned_time=Date.now();el.w3_realigned=true;}
el.style.top=px(y);w3_visible(el,true);if(w3int.menu_debug)
canvas_log('VIS');w3int.menu_active=true;el.w3_menu_x=x;w3int.menu_close_func=close_func;w3int.menu_first=true;window.addEventListener("keyup",w3int_menu_event,false);window.addEventListener("mousedown",w3int_menu_event,false);window.addEventListener("touchstart",w3int_menu_event,false);window.addEventListener("click",w3int_menu_event,false);}
function w3_menu_active(){return w3int.menu_active;}
function w3int_menu_onclick(ev,id,cb,cb_param){if(w3int.menu_debug)
canvas_log('menu_onclick '+id+' from='+(cb_param||ev.type));var el=w3_el(id);if(el.w3_realigned){el.w3_realigned=false;var when=Date.now()-el.w3_realigned_time;if(when<50){if(w3int.menu_debug)canvas_log('XRe'+when);return cancelEvent(ev);}
if(w3int.menu_debug)canvas_log('XOK'+when);}
if(ev!=null&&cb!=null){var _id=ev.target.id;var idx=+_id;if(_id==''||isNaN(idx))_id=ev.target.parentNode.id;idx=+_id;if(_id==''||isNaN(idx))idx=-1;if(w3int.menu_debug)
canvas_log('CALL: '+idx);if(idx==-1)return;w3_call(cb,idx,el.w3_menu_x,cb_param);}
w3_visible(el,false);if(w3int.menu_debug)
canvas_log('NOT_VIS');w3int.menu_active=false;window.removeEventListener("keyup",w3int_menu_event,false);window.removeEventListener("mousedown",w3int_menu_event,false);window.removeEventListener("touchstart",w3int_menu_event,false);window.removeEventListener("click",w3int_menu_event,false);if(ev!=null){if(w3int.menu_debug)canvas_log('Enull');return cancelEvent(ev);}}
function w3int_menu_event(evt){if(w3int.menu_debug)canvas_log('ME '+evt.type);var el=w3_el(w3int.menu_cur_id);if(el&&w3int.menu_close_func){var close=w3int.menu_close_func(evt,w3int.menu_first);w3int.menu_first=false;if(w3int.menu_debug)canvas_log('CLOSE='+close);if(close)w3_menu_close(evt.type);}}
function w3_menu_close(from){if(!w3int.menu_cur_id)return;var el=w3_el(w3int.menu_cur_id);if(!el)return;el.w3_realigned=false;w3int_menu_onclick(null,w3int.menu_cur_id,null,'menu_close');w3int.menu_cur_id=null;}
function w3_num_cb(path,val){var v=parseFloat(val);if(val=='')v=0;if(isNaN(v)){w3_set_value(path,0);v=0;}
setVarFromString(path,v);}
function w3_bool_cb(path,val){v=+val;setVarFromString(path,v);}
function w3_string_cb(path,val){setVarFromString(path,val.toString());}
function w3_num_set_cfg_cb(path,val,first){var v=parseFloat(val);if(isNaN(v))v=0;var save=isArg(first)?(first?false:true):true;ext_set_cfg_param(path,v,save);}
function w3_int_set_cfg_cb(path,val,first){var v=parseInt(val);if(isNaN(v))v=0;w3_set_value(path,v);var save=isArg(first)?(first?false:true):true;ext_set_cfg_param(path,v,save);}
function w3_float_set_cfg_cb(path,val,first,cb_a){var prec=-1;if(cb_a&&cb_a.length>=2){prec=+(cb_a[1]);if(isNaN(prec))prec=-1;}
val=parseFloat(val);if(isNaN(val)){val=ext_get_cfg_param(path);}else{if(prec!=-1){var s=val.toFixed(prec);val=+s;}
var save=isArg(first)?(first?false:true):true;ext_set_cfg_param(path,val,save);}
w3_set_value(path,val);}
function w3_bool_set_cfg_cb(path,val,first){var v;if(val==true||val==1)v=true;else
if(val==false||val==0)v=false;else
v=false;var save=isArg(first)?(first?false:true):true;ext_set_cfg_param(path,v,save);}
function w3_string_set_cfg_cb(path,val,first){var save=isArg(first)?(first?false:true):true;ext_set_cfg_param(path,encodeURIComponent(val.toString()),save);}
function w3_json_set_cfg_cb(path,val,first){var save=isArg(first)?(first?false:true):true;ext_set_cfg_param(path,val,save);}
function w3_url_set_cfg_cb(path,val,first){if(val!=''&&!val.startsWith('http://')&&!val.startsWith('https://'))val='http://'+val;w3_string_set_cfg_cb(path,val,first);w3_set_value('id-'+path,val);}
function w3_remove_trailing_index(path,sep){sep=sep||'-';var re=new RegExp('(.*)'+sep+'([-]?[0-9]+)');var el=re.exec(path);var idx;if(!el){idx=null;el=path;}else{idx=el[2];el=el[1];}
return{el:el,idx:idx};}
var w3_MENU_NEXT=1;var w3_MENU_PREV=-1;function w3_select_next_prev_cb(path,cb_param,first){if(dbgUs)console.log('w3_select_next_prev_cb cb_param='+decodeURIComponent(cb_param));var cbp=w3_cb_param_decode(cb_param);if(!isObject(cbp)){console.log('w3_select_next_prev_cb cb_param is not an object');return;}
if(dbgUs)console.log('w3_select_next_prev_cb dir='+cbp.dir+' id='+cbp.id);var prev=0,capture_the_next=0,captured_next=0,captured_prev=0;var menu_s,el;for(var i=0;(el=w3_el(menu_s=cbp.id+i))!=null;i++){var val=el.value;if(dbgUs)console.log('menu_s='+menu_s+' value='+val);if(val==-1)continue;w3_select_enum(menu_s,function(option){var content_check=(isUndefined(cbp.isNumeric)||(cbp.isNumeric==true&&isNumber(parseInt(option.innerText))));if(option.disabled||!content_check)return;if(dbgUs)console.log('consider val='+option.value+' \"'+option.innerText+'\" content_check='+content_check);if(capture_the_next){captured_next=option.value;capture_the_next=0;}
if(option.value===val){captured_prev=prev;capture_the_next=1;}
prev=option.value;});break;}
if(dbgUs)console.log('i='+i+' captured_prev='+captured_prev+' captured_next='+captured_next);val=0;if(cbp.dir==w3_MENU_NEXT&&captured_next)val=captured_next;if(cbp.dir==w3_MENU_PREV&&captured_prev)val=captured_prev;if(dbgUs)console.log('w3_select_next_prev_cb val='+val);w3_call(cbp.func,menu_s,val,first);}
function w3_table(psa){var p=w3_psa(psa,'w3-table w3-table-default');var s='<table '+p+'>';for(var i=1;i<arguments.length;i++){s+=arguments[i];}
s+='</table>';return s;}
function w3_table_heads(psa){var p=w3_psa(psa,'w3-table-head');var s='';for(var i=1;i<arguments.length;i++){if(arguments[i]==null)continue;s+='<th '+p+'>';s+=arguments[i];s+='</th>';}
return s;}
function w3_table_row(psa){var p=w3_psa(psa,'w3-table-row');var s='<tr '+p+'>';for(var i=1;i<arguments.length;i++){if(arguments[i]==null)continue;s+=arguments[i];}
s+='</tr>';return s;}
function w3_table_cells(psa){var p=w3_psa(psa,'w3-table-cell');var s='';for(var i=1;i<arguments.length;i++){if(arguments[i]==null)continue;s+='<td '+p+'>';s+=arguments[i];s+='</td>';}
return s;}
function w3_inline(psa,attr){var narg=arguments.length;var dump=psa.includes('w3-dump');if(psa==''&&attr==''&&narg>2){console.log('### w3_inline OLD API DEPRECATED');var args=Array.prototype.splice.call(arguments,0);args.splice(0,1);return w3_inline.apply(null,args);}else{var psa3=w3_psa3(psa);var psa_outer=w3_psa(psa3.middle,'w3-show-inline-new');var psa_inner=w3_psa(psa3.right);if(dump)console.log('w3_inline psa_outer='+psa_outer+' psa_inner='+psa_inner);var s='<div w3d-inlo '+psa_outer+'>';for(var i=1;i<narg;i++){var psa;var a=arguments[i];if(!a)continue;if(dump)console.log('w3_inline i='+i+' a='+a);var psa_merge=false;if(a.startsWith('w3-')||a.startsWith('id-')){psa=w3_psa(psa3.right,a);i++;a=arguments[i];psa_merge=true;}else{psa=psa_inner;}
if(psa3.right==''&&!psa_merge&&a.startsWith('<div '))
s+=a;else
s+='<div w3d-inli-'+(i-1)+' '+psa+'>'+a+'</div>';}
s+='</div>';if(dump)console.log(s);return s;}}
function w3_inline_percent(psa){var psa3=w3_psa3(psa);var psa_outer=w3_psa(psa3.middle,'w3-show-inline-new');var narg=arguments.length;var total=0;var prop=psa.includes('w3-debug')?'w3_debug ':'';var last_halign_end=psa.includes('w3-last-halign-end');var s='<div w3d-inlpo '+psa_outer+'>';for(var i=1;i<narg;i+=2){var style;if(i+1<narg){style='flex-basis:'+arguments[i+1]+'%';total+=arguments[i+1];}else{style='flex-basis:'+(100-total)+'%';}
if(i==narg-1&&last_halign_end)prop+='w3-flex w3-halign-end';s+='<div w3d-inlpi-'+((i-1)/2)+' '+w3_psa(psa3.right,prop,style)+'>'+arguments[i]+'</div>';}
s+='</div>';return s;}
function w3_div(psa){var p=w3_psa(psa);var s='<div w3d-div '+p+'>';var narg=arguments.length;for(var i=1;i<narg;i++){s+=arguments[i];}
s+='</div>';return s;}
function w3_span(psa){var p=w3_psa(psa,'w3-show-span');var s='<div w3d-span '+p+'>';var narg=arguments.length;for(var i=1;i<narg;i++){s+=arguments[i];}
s+='</div>';return s;}
function w3_divs(psa,attr){var narg=arguments.length;var s;if(psa==''&&attr==''){console.log('### w3_divs OLD API 1 DEPRECATED');s=w3_div.apply(null,Array.prototype.splice.call(arguments,1));return s;}else
if(psa!=''&&attr==''&&narg>2){console.log('### w3_divs OLD API 2 DEPRECATED');var args=Array.prototype.splice.call(arguments,0);args.splice(1,1);s=w3_div.apply(null,args);return s;}else
if(psa==''&&attr&&attr.startsWith('w3-')&&narg>2){console.log('### w3_divs OLD API 3 DEPRECATED');var args=Array.prototype.splice.call(arguments,0);args.splice(0,1);s=w3_divs.apply(null,args);return s;}else
if(psa!=''&&attr&&attr.startsWith('w3-')&&narg>2){console.log('### w3_divs OLD API 4 DEPRECATED');var args=Array.prototype.splice.call(arguments,2);args.splice(0,0,arguments[0]+'/'+arguments[1]);s=w3_divs.apply(null,args);return s;}else{var psa3=w3_psa3(psa);var psa_outer=w3_psa(psa3.middle);var psa_inner=w3_psa(psa3.right);s='<div w3d-divso '+psa_outer+'>';for(var i=1;i<narg;i++){s+='<div w3d-divsi-'+(i-1)+' '+psa_inner+'>'+arguments[i]+'</div>';}
s+='</div>';return s;}}
function w3_col_percent(psa){var psa3=w3_psa3(psa);var psa_outer=w3_psa(psa3.middle,'w3-row');var narg=arguments.length;var s='<div w3d-colpo '+psa_outer+'>';for(var i=1;i<narg;i+=2){var prop,style;if(i+1<narg){prop='w3-col';style='width:'+arguments[i+1]+'%';}else{prop='w3-rest';style='';}
s+='<div w3d-colpi-'+((i-1)/2)+' '+w3_psa(psa3.right,prop,style)+'>'+arguments[i]+'</div>';}
s+='</div>';return s;}
function w3_text(psa,text){var pad=(psa.includes('w3-padding')||psa.includes('w3-nopad'))?'':'padding:0 4px 0 0; ';var s=w3_div(w3_psa_mix(psa,'w3-text',pad+'background-color:inherit'),text?text:' ');return s;}
function w3_code(psa){var psa3=w3_psa3(psa);var narg=arguments.length;var s='<pre '+w3_psa(psa3.left)+'><code '+w3_psa(psa3.middle)+'>';for(var i=1;i<narg;i++){s+='<code '+w3_psa(psa3.right)+'>'+arguments[i]+'</code>';}
s+='</code></pre>';return s;}
function w3_half(prop_row,prop_col,left,right,prop_left,prop_right){if(prop_left==undefined)prop_left='';if(prop_right==undefined)prop_right='';var s='<div class="w3-row '+prop_row+'">'+'<div class="w3-col w3-half '+prop_col+prop_left+'">'+
left+'</div>'+'<div class="w3-col w3-half '+prop_col+prop_right+'">'+
(right?right:'')+'</div>'+'</div>';return s;}
function w3_third(prop_row,prop_col,left,middle,right){var s='<div class="w3-row '+prop_row+'">'+'<div class="w3-col w3-third '+prop_col+'">'+
left+'</div>'+'<div class="w3-col w3-third '+prop_col+'">'+
(middle?middle:'')+'</div>'+'<div class="w3-col w3-third '+prop_col+'">'+
(right?right:'')+'</div>'+'</div>';return s;}
function w3_quarter(prop_row,prop_col,left,middleL,middleR,right){var s='<div class="w3-row '+prop_row+'">'+'<div class="w3-col w3-quarter '+prop_col+'">'+
left+'</div>'+'<div class="w3-col w3-quarter '+prop_col+'">'+
(middleL?middleL:'')+'</div>'+'<div class="w3-col w3-quarter '+prop_col+'">'+
(middleR?middleR:'')+'</div>'+'<div class="w3-col w3-quarter '+prop_col+'">'+
(right?right:'')+'</div>'+'</div>';return s;}
function w3_canvas(psa,w,h,opt){var s='';var pad=w3_opt(opt,'pad',null);var pad_top=w3_opt(opt,'pad_top',0);var pad_bot=w3_opt(opt,'pad_bottom',0);if(!isNull(pad))pad_top=pad_bot=pad;pad=pad_top+pad_bot;if(pad){s+=sprintf(' padding-top:%dpx; padding-bottom:%dpx;',pad_top,pad_bot);}
var left=w3_opt(opt,'left','');if(left!='')s+=sprintf(' left:%dpx;',left);var right=w3_opt(opt,'right','');if(right!='')s+=sprintf(' right:%dpx;',right);var top=w3_opt(opt,'top','');if(top!='')s+=sprintf(' top:%dpx;',top);s='<canvas '+w3_psa(psa,null,'position:absolute;'+s,sprintf('width="%d" height="%d"',w,h))+'></canvas>';return s;}





/* web/kiwi/monitor.min.js (web/kiwi/monitor.js = Mon Jun  5 08:52:43 2023) */
var monitor={init:false};function kiwi_queue_cb(){kiwi.queued^=1;w3_innerHTML('id-queue-button',kiwi.queued?'Exit queue':'Enter queue');if(!kiwi.queued)w3_innerHTML('id-queue-pos','');msg_send('SET MON_QSET='+(kiwi.queued?1:0));}
function kiwi_monitor(){console.log('n_camp='+cfg.n_camp);var camp_s=cfg.n_camp?'To camp (listen) to the audio of an existing connection <br>'+'click on one of the channel links below.':'No audio camping allowed on this Kiwi.';var s=w3_div('',w3_text('w3-text-black','All Kiwi channels busy. Click button to wait in queue for an available channel.'),w3_inline('w3-margin-L-8 w3-margin-T-4/w3-margin-right w3-valign',w3_button('id-queue-button w3-medium w3-padding-smaller w3-green','Enter queue','kiwi_queue_cb'),w3_text('id-queue-pos w3-text-black'),w3_button('id-queue-button w3-medium w3-padding-smaller w3-yellow','Reload page','kiwi_queue_reload_cb')),w3_text('id-queue-status w3-margin-T-4 w3-text-black',''),w3_div('id-camp-container',w3_hr('w3-margin-16'),w3_text('w3-margin-T-4 w3-text-black w3-show-block',camp_s),w3_text('id-camp-status w3-margin-T-4 w3-text-black','')),w3_hr('w3-margin-16'),w3_div('id-users-list w3-margin-T-10'));kiwi_show_msg(s);kiwi.unmuted_color='mediumSeaGreen';users_init({monitor:1});pwd_prot=chan_no_pwd_true?(rx_chans-chan_no_pwd_true):0;console.log('rx_chans='+rx_chans+' chan_no_pwd_true='+chan_no_pwd_true+' pwd_prot='+pwd_prot);var channels=plural(pwd_prot,' channel');var is_are=(pwd_prot==1)?'is':'are';if(pwd_prot){s='<br>Note that '+pwd_prot+channels+' on this Kiwi '+is_are+' password protected. <br>'+'This is why you may see empty channels you cannot access.';w3_innerHTML('id-queue-status',s);}else
w3_innerHTML('id-queue-status','');setInterval(function(){msg_send('SET keepalive');if(kiwi.queued)msg_send('SET MON_QPOS');},2500);ws_any().msg_cb=function(msg_a){var a=msg_a[1]?msg_a[1].split(','):null;switch(msg_a[0]){case'qpos':var pos=a[0],waiters=a[1],reload=+a[2];if(reload)kiwi_queue_reload_cb();var s='';if(kiwi.queued)s+='You are '+pos+' of '+waiters+' in queue.';w3_innerHTML('id-queue-pos',s);break;case'camp':var okay=+a[0],rx=+a[1];var s;if(okay){if(!monitor.init){check_suspended_audio_state();monitor.init=true;}
s=w3_div('',w3_inline('w3-margin-T-4/w3-margin-right w3-valign',w3_text('id-queue-pos w3-text-black','Camping on RX'+rx),w3_button('w3-medium w3-padding-smaller w3-red','Stop','kiwi_camp_stop_cb'),w3_slider('w3-margin-L-16/w3-label-inline w3-label-not-bold/','Volume','kiwi.volume',kiwi.volume,0,200,1,'setvolume'),w3_div('|background-color: #e0e0e0; padding:2px; border-radius:8px|title="mute"',w3_div('id-mute-no fa-stack|width:28px; color:'+kiwi.unmuted_color,w3_icon('','fa-volume-up fa-stack-2x fa-nudge-up',24,'inherit','toggle_or_set_mute')),w3_div('id-mute-yes fa-stack w3-hide|width:28px;color:magenta;',w3_icon('','fa-volume-off fa-stack-2x fa-nudge-left fa-nudge-up',24,'','toggle_or_set_mute'),w3_icon('','fa-times fa-right',12,'','toggle_or_set_mute'))))+
w3_div('id-control-smeter w3-margin-T-4'));}else{s='Too many campers on channel RX'+rx;rx=-1;}
kiwi_camp_update(rx,s);if(rx!=-1)smeter_init(true);toggle_or_set_mute(0);break;case'camp_stop':kiwi_camp_stop_cb();break;default:owrx_msg_cb(msg_a);break;}};}
function kiwi_queue_reload_cb(){var url=kiwi_remove_search_param(window.location.href,'camp');window.location.href=url;}
function kiwi_camp_update(rx,s){w3_innerHTML('id-camp-status',s);for(var i=0;i<rx_chans;i++){var el=w3_el('id-user-'+i);w3_remove(el,'w3-green');if(i==rx)
w3_add(el,'w3-green');}}
function camp(ch,freq,mode,zoom){console.log('camp ch'+ch);if(cfg.n_camp)
msg_send('SET MON_CAMP='+ch);}
function kiwi_camp_stop_cb(){console.log('camp STOP');kiwi_camp_update(-1,'');msg_send('SET MON_CAMP=-1');}





/* web/kiwi/kiwi_map.min.js (web/kiwi/kiwi_map.js = Sat May 13 08:24:35 2023) */
var kmap={ADD_TO_MAP:true,NO_ADD_TO_MAP:false,DIR_LEFT:true,DIR_RIGHT:false,VISIBLE:true,NOT_VISIBLE:false,_last_last:0};function kiwi_map_init(ext_name,init_latlon,init_zoom,mapZoom_nom,move_cb,zoom_cb){var map_tiles;var maxZoom=19;map_tiles=function(){maxZoom=18;return L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{tileSize:256,zoomOffset:0,attribution:'<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',crossOrigin:true});}
var tiles=map_tiles('hybrid');var map=L.map('id-'+ext_name+'-map',{maxZoom:maxZoom,minZoom:1,doubleClickZoom:false,zoomControl:false}).setView(init_latlon,init_zoom);map.on('baselayerchange',function(e){var tmap=e.target;var center=tmap.getCenter();kiwi_pan_zoom(tmap,[center.lat+0.1,center.lng],-1);kiwi_pan_zoom(tmap,[center.lat,center.lng],-1);});var kmap={ext_name:ext_name,map:map};map.on('click',function(e,kmap){w3_call(ext_name+'_map_click_cb',kmap,e);});map.on('move',function(e,kmap){w3_call(ext_name+'_map_move_cb',kmap,e);});map.on('zoom',function(e,kmap){w3_call(ext_name+'_map_zoom_cb',kmap,e);});map.on('moveend',function(e,kmap){w3_call(ext_name+'_map_move_end_cb',kmap,e);});map.on('zoomend',function(e,kmap){w3_call(ext_name+'_map_zoom_end_cb',kmap,e);});L.control.zoom_Kiwi({position:'topright',zoomNomText:'2',zoomNomLatLon:init_latlon}).addTo(map);tiles.addTo(map);var scale=L.control.scale()
scale.addTo(map);scale.setPosition('bottomleft');var day_night=new Terminator();day_night.setStyle({fillOpacity:0.35});day_night.addTo(map);kmap.day_night_interval=setInterval(function(){var t2=new Terminator();day_night.setLatLngs(t2.getLatLngs());day_night.redraw();},60000);day_night._path.style.cursor='grab';var graticule=L.latlngGraticule();graticule.addTo(map);kmap.map_layers=[graticule];kmap.graticule=graticule;kmap.day_night=day_night;kmap.init_latlon=init_latlon;kmap.init_zoom=init_zoom;kmap.mapZoom_nom=mapZoom_nom;return kmap;}
function kiwi_map_blur(kmap){kiwi_clearInterval(kmap.day_night_interval);}
function kiwi_map_add_marker_icon(kmap,addToMap,url,latlon,anchor,opacity,func){var kiwi_icon=L.icon({iconUrl:url,iconAnchor:anchor});var kiwi_mkr=L.marker(latlon,{'icon':kiwi_icon,'opacity':opacity});if(addToMap){kiwi_mkr.addTo(kmap.map);if(func)func(kiwi_mkr._icon);}}
function kiwi_map_add_marker_div(kmap,addToMap,latlon,className,iconAnchor,tooltipAnchor,opacity){var icon=L.divIcon({className:className,html:'',iconAnchor:iconAnchor,tooltipAnchor:tooltipAnchor});var marker=L.marker(latlon,{'icon':icon,'opacity':opacity});if(addToMap)marker.addTo(kmap.map);return marker;}
function kiwi_style_marker(kmap,addToMap,marker,name,className,left,func){marker.bindTooltip(name,{className:className,permanent:true,direction:left?'left':'right'});if(func)marker.on('add',function(ev){func(ev);});if(addToMap){marker.addTo(kmap.map);kmap.map_layers.push(marker);}}
function kiwi_map_day_night_visible(kmap,vis){var day_night=kmap.day_night;if(vis){day_night.addTo(kmap.map);kmap.map_layers.push(day_night);day_night._path.style.cursor='grab';}else{day_night.remove();kmap.map_layers=kmap.map_layers.filter(function(ae){ae!=day_night});}}
function kiwi_map_graticule_visible(kmap,vis){var graticule=kmap.graticule;if(vis){graticule.addTo(kmap.map);kmap.map_layers.push(graticule);}else{graticule.remove();kmap.map_layers=kmap.map_layers.filter(function(ae){ae!=graticule});}}
function kiwi_map_markers_visible(id,vis){w3_iterate_children('leaflet-marker-pane',function(el,i){if(el.className.includes(id)){w3_hide2(el,!vis);}});w3_iterate_children('leaflet-tooltip-pane',function(el,i){if(el.className.includes(id)){w3_hide2(el,!vis);}});}
function kiwi_pan_zoom(map,latlon,zoom){if(latlon==null)latlon=map.getCenter();if(zoom==-1)zoom=map.getZoom();map.setView(latlon,zoom,{duration:0,animate:false});}





/* web/openwebrx/openwebrx.min.js (web/openwebrx/openwebrx.js = Sat Jun 10 13:12:16 2023) */
var bandwidth,center_freq,wf_fft_size,cur_mode,wf_fps,wf_fps_max,ws_snd,ws_wf,owrx={debug_drag:!1,height_top_bar_parts:67,hide_bars:0,HIDE_TOPBAR:1,HIDE_BANDBAR:2,HIDE_ALLBARS:3,PB_NO_EDGE:0,PB_RIGHT_EDGE:1,PB_LEFT_EDGE:2,cfg_loaded:!1,mobile:null,wf_snap:0,wf_cursor:"crosshair",last_shiftKey:!1,last_pageX:0,last_pageY:0,mouse_freq:{},freq_memory:[],freq_memory_menu_shown:0,override_fmem:null,vfo_ab:0,vfo_first:!0,last_freq:-1,last_mode:"",last_locut:-1,last_hicut:-1,last_lo:[],last_hi:[],last_selected_band:0,last_mode_el:null,dseq:0,sMeter_dBm_biased:0,sMeter_dBm:0,smeter_interval:null,force_no_agc_thresh_smeter:!1,overload_mute:90,squelched_overload:!1,prev_squelched_overload:!1,touch_hold_pressed:!1,tuning_locked:0,dx_click_gid_last_stored:void 0,dx_click_gid_last_until_tune:void 0,sam_pll:1,sam_pll_s:["DX","med","fast"],chan_null:0,chan_null_s:["normal","null LSB","null USB"],SAM_opts:3,SAM_opts_s:["none","fade leveler","DC block","fade+block"],SAM_opts_sft:2,ovld_mute:0,ovld_mute_s:["off","on"],FSET_NOP:0,FSET_ADD:1,FSET_SET_FREQ:2,FSET_EXT_SET_PB:3,FSET_PB_CHANGE:4,FSET_SCALE_DRAG:5,FSET_SCALE_DRAG_END:6,FSET_SCALE_MOUSE_CLICK:7,FSET_SCALE_TOUCH_DRAG:8,FSET_SCALE_TOUCH_DRAG_END:9,fset_s:["nop","add","fset","extSetPB","pbChg","drag","dragEnd","mouseClick","touchDrag","touchClick"],scale_canvas:{mouse_out:!1,target:null,restore_visibility:[],restore_visibility_delay:500},canvas:{target:null,restore_visibility:[],restore_visibility_delay:500},zoom_titles:[["passband narrow","passband widen"],["passband right edge","passband right edge"],["passband left edge","passband left edge"]],__last:0},spectrum_show=0,spectrum_param=-1,gen_freq=0,gen_attn=0,squelch_threshold=0,wf_rate="",wf_mm="",wf_auto=null,wf_compression=1,wf_interp=13,wf_winf=2,snd_winf=0,debug_v=0,sb_trace=0,kiwi_gc=1,kiwi_gc_snd=0,kiwi_gc_wf=-1,kiwi_gc_recv=-1,kiwi_gc_wspr=-1,override_ext=null,muted_initially=0,peak_initially1=null,peak_initially2=null,param_nocache=!1,nocache=!1,param_ctrace=!1,ctrace=!1,no_clk_corr=!1,override_pbw="",override_pbc="",nb_click=!1,no_geoloc=!1,force_mobile=!1,mobile_laptop_test=!1,user_url=null,wf_rates={0:0,off:0,1:1,"1hz":1,s:2,slow:2,m:3,med:3,f:4,fast:4},okay_wf_init=!1;function kiwi_main(){w3_do_when_cond(function(){return owrx.cfg_loaded},function(){kiwi_main_ready()},null,200)}function kiwi_main_ready(){override_freq=parseFloat(readCookie("last_freq")),override_mode=readCookie("last_mode"),override_zoom=parseFloat(readCookie("last_zoom")),override_9_10=parseFloat(readCookie("last_9_10")),override_max_dB=parseFloat(readCookie("last_max_dB")),override_min_dB=parseFloat(readCookie("last_min_dB")),setvolume(!0,readCookie("last_volume",50)),console.log("LAST f="+override_freq+" m="+override_mode+" z="+override_zoom+" 9_10="+override_9_10+" min="+override_min_dB+" max="+override_max_dB);console.log("URL: "+window.location.href);var e=window.location.search&&window.location.search.substr(1),t=[],_=[];for(w=1;w<=16;w++){var a="&win"+(w+1)+"&";t[w]=e&&e.split(a)[0],e=e&&e.split(a)[1],_[w]=function(e){var t={};return e&&e.split("&").forEach(function(e){e=e.split("=");t[e[0]]=e[1]||1}),t}(t[w]),_[w].WID=w}var i=window.location.href.split("?")[0];for(g_qs_idx=2,w=2;w<=16;w++)t[w]&&setTimeout(function(){var e=i+"?"+t[g_qs_idx];g_qs_idx++,null==window.open(e,"_blank")&&alert("Do you have popups blocked for this site? "+e)},2e3*(w-1));var o,n="f";(e=_[1])[n]&&((o=parse_freq_pb_mode_zoom(e[n]))[1]&&(override_freq=o[1].replace(",",".").parseFloatWithUnits("M",.001)),o[1]&&console.log("p="+o[1]+" override_freq="+override_freq),o[2]&&console.log("override_pbw/pbc="+o[2]),o[2]&&"/"==o[2].charAt(0)&&(override_pbw=o[2].substr(1)),o[2]&&":"==o[2].charAt(0)&&(override_pbc=o[2].substr(1)),o[3]&&(override_mode=o[3].toLowerCase()),o[4]&&(override_zoom=+o[4])),e[n="ext"]&&isString(e[n])&&(o=e[n].split(","),override_ext=o[0],extint.param=o.slice(1).join(","),console.log("URL: ext="+override_ext+" ext_p="+extint.param)),e[n="pbw"]&&(override_pbw=e[n]),e[n="pb"]&&(override_pbw=e[n]),e[n="pbc"]&&(override_pbc=e[n]),e[n="z"]&&(override_zoom=+e[n]),e[n="sp"]&&(spectrum_show=e[n]),e[n="spec"]&&(spectrum_show=e[n]),e[n="spp"]&&(spectrum_param=parseFloat(e[n])),e[n="vol"]&&setvolume(!0,parseInt(e[n])),e[n="mute"]&&(muted_initially=parseInt(e[n])),e[n="wf"]&&(wf_rate=e[n]),e[n="wfm"]&&(wf_mm=e[n]),e[n="wfa"]&&(wf_auto=parseInt(e[n])),e[n="cmap"]&&(wf.cmap_override=w3_clamp(parseInt(e[n]),0,kiwi.cmap_s.length-1,0)),e[n="sqrt"]&&(wf.sqrt=w3_clamp(parseInt(e[n]),0,4,0)),e[n="wfts"]&&(wf.url_tstamp=w3_clamp(parseInt(e[n]),2,3600,2)),e[n="peak"]&&(peak_initially1=w3_clamp(parseInt(e[n],0,2))),e[n="peak2"]&&(peak_initially2=w3_clamp(parseInt(e[n],0,2))),e[n="no_geo"]&&(no_geoloc=!0),e[n="keys"]&&(shortcut.keys=isNonEmptyString(e[n])?e[n].split(""):null),e[n="user"]&&(user_url=e[n]),e[n="u"]&&(user_url=e[n]),e[n="m"]&&(force_mobile=!0),e[n="mobile"]&&(force_mobile=!0),e[n="mem"]&&(owrx.override_fmem=e[n]),e[n="sqth"]&&(squelch_threshold=parseFloat(e[n])),e[n="click"]&&(nb_click=!0),e[n="nocache"]&&(param_nocache=!0,nocache=parseInt(e[n])),e[n="ncc"]&&(no_clk_corr=parseInt(e[n])),e[n="wfdly"]&&(waterfall_delay=parseFloat(e[n])),e[n="wf_comp"]&&(wf_compression=parseInt(e[n])),e[n="wfi"]&&(wf_interp=parseInt(e[n])),e[n="wfw"]&&(wf_winf=parseInt(e[n])),e[n="sndw"]&&(snd_winf=parseInt(e[n])),e[n="gen"]&&(gen_freq=e[n].parseFloatWithUnits("kM",.001)),e[n="attn"]&&(gen_attn=Math.abs(parseInt(e[n]))),e[n="blen"]&&(audio_buffer_min_length_sec=parseFloat(e[n])/1e3),e[n="audio"]&&(audio_meas_dly_ena=parseFloat(e[n])),e[n="gc"]&&(kiwi_gc=parseInt(e[n])),e[n="gc_snd"]&&(kiwi_gc_snd=parseInt(e[n])),e[n="gc_wf"]&&(kiwi_gc_wf=parseInt(e[n])),e[n="gc_recv"]&&(kiwi_gc_recv=parseInt(e[n])),e[n="gc_wspr"]&&(kiwi_gc_wspr=parseInt(e[n])),e[n="ctrace"]&&(param_ctrace=!0,ctrace=parseInt(e[n])),e[n="tmobile"]&&(mobile_laptop_test=!0),e[n="v"]&&console.log("URL: debug_v = "+(debug_v=e[n])),-1==kiwi_gc_snd&&(kiwi_gc_snd=kiwi_gc),-1==kiwi_gc_wf&&(kiwi_gc_wf=kiwi_gc),-1==kiwi_gc_recv&&(kiwi_gc_recv=kiwi_gc),-1==kiwi_gc_wspr&&(kiwi_gc_wspr=kiwi_gc),console.log("GC: snd="+kiwi_gc_snd+" wf="+kiwi_gc_wf+" recv="+kiwi_gc_recv+" wspr="+kiwi_gc_wspr),""!=wf_mm&&(wf_mm=wf_mm.split(","),s=parseInt(wf_mm[0]),!isNaN(s)&&-190<=s&&s<=-30&&(override_min_dB=s),2<=wf_mm.length&&(s=parseInt(wf_mm[1]),!isNaN(s)&&-100<=s&&s<=20&&(override_max_dB=s))),kiwi_get_init_settings(),no_geoloc||kiwi_geolocate(),freq_memory_init(),init_top_bar(),init_rx_photo(),right_click_menu_init(),freq_memory_menu_init(),keyboard_shortcut_init(),confirmation_panel_init(),ext_panel_init(),place_panels(),init_panels(),okay_wf_init=!0,confirmation_panel_init2(),smeter_init(),time_display_setup("id-topbar-right-container"),window.setInterval(send_keepalive,5e3),window.addEventListener("resize",openwebrx_resize),param_nocache&&console.log("### nocache="+(nocache?1:0)),param_ctrace&&console.log("### ctrace="+(ctrace?1:0)),snd_send("SERVER DE CLIENT openwebrx.js SND"),snd_send("SET dbug_v="+debug_v),w3_do_when_cond(function(){return isArg(rx_chan)&&owrx.cfg_loaded},function(){var e;0==rx_chan&&(0!=gen_attn&&(e=gen_attn+cfg.waterfall_cal,e=Math.pow(10,-e/20),gen_attn=131071*e),set_gen(gen_freq,gen_attn))},null,500);n=kiwi_passbands(init_mode).lo;isNumber(n)||(n=-4e3);var s=kiwi_passbands(init_mode).hi;isNumber(s)||(s=4e3),snd_send("SET mod="+init_mode+" low_cut="+n+" high_cut="+s+" freq="+init_frequency),set_agc(),snd_send("SET browser="+navigator.userAgent),0!=snd_winf&&snd_send("SET window_func="+snd_winf),wf_send("SERVER DE CLIENT openwebrx.js W/F"),wf_send("SET send_dB=1"),wf_send("SET zoom=0 start=0"),wf_send("SET maxdb=0 mindb=-100"),0==wf_compression&&wf_send("SET wf_comp=0"),-1!=wf_interp&&wf_send("SET interp="+wf_interp),0!=wf_winf&&wf_send("SET window_func="+wf_winf),null==(wf_speed=wf_rates[wf_rate])&&(wf_speed=WF_SPEED_FAST),wf_send("SET wf_speed="+wf_speed)}var ptype={HIDE:0,POPUP:1,TOGGLE:2},popt={CLOSE:-1,PERSIST:0},visBorder=10,visIcon=24,readme_color="blueViolet",show_news=!1,news_color="#ff00bf";function init_panels(){init_panel_toggle(ptype.TOGGLE,"id-control",!1,popt.PERSIST);var e=updateCookie("readme","seen2");kiwi_isMobile()&&(e=!1),init_panel_toggle(ptype.TOGGLE,"id-readme",!1,e?popt.PERSIST:popt.CLOSE,readme_color);e=null==readCookie("news","seen");init_panel_toggle(ptype.POPUP,"id-news",!1,show_news&&e?popt.PERSIST:popt.CLOSE),init_panel_toggle(ptype.POPUP,"id-ext-controls",!1,popt.CLOSE),init_panel_toggle(ptype.POPUP,"id-confirmation",!1,popt.CLOSE)}function init_panel_toggle(e,t,_,a,i){var o=w3_el(t);o.ptype=e;var n=w3_el(t+"-vis");o.scrollable=1==_;var s=o.scrollable?-kiwi_scrollbar_width():visBorder,r="right"==o.getAttribute("data-panel-pos");o.panelShown=1,e==ptype.TOGGLE?(_=r?"right":"left",l=r?"left":"right",n.innerHTML='<a id="'+t+'-hide" onclick="toggle_panel('+sq(t)+');"><img src="icons/hide'+_+'.24.png" width="24" height="24" /></a><a id="'+t+'-show" class="class-vis-show" onclick="toggle_panel('+sq(t)+');"><img src="icons/hide'+l+'.24.png" width="24" height="24" /></a>'):n.innerHTML='<a id="'+t+'-close" onclick="toggle_panel('+sq(t)+');"><img id='+dq(t+"-close-img")+' src="icons/close.24.png" width="24" height="24" /></a>';var l=o.activeWidth-visIcon;r?n.style.right=px(0):n.style.left=px(l+s),n.style.top=px(visBorder),null!=a&&(0<a?setTimeout(function(){toggle_panel(t)},a):a==popt.CLOSE?toggle_panel(t):e==ptype.POPUP&&(o.style.visibility="visible")),null==i||null!=(e=w3_el(t+"-show"))&&(e.style.backgroundColor=e.style.borderColor=i),o.init=!0}function toggle_panel(e,t){var _=w3_el(e),a=w3_el(e+"-vis");if(isDefined(t)&&(_.panelShown=1^t),_.ptype==ptype.POPUP)return _.style.visibility=_.panelShown?"hidden":"visible",_.panelShown^=1,updateCookie(e,"seen"),void freqset_select();var i=_.activeWidth+30,t="right"==_.getAttribute("data-panel-pos"),i=-i,i=_.panelShown?(o=0,i):(o=i,kiwi_isMobile()?0:kiwi_scrollbar_width());"id-control"==e&&1==_.panel_isScaled&&_.panelShown&&mobile_scale_control_panel(null,!1),animate(_,t?"right":"left","px",o,i,.93,kiwi_isMobile()?1:1e3,60,0),w3_hide(e+"-"+(_.panelShown?"hide":"show")),w3_show_block(e+"-"+(_.panelShown?"show":"hide")),_.panelShown^=1;var o=_.activeWidth-visIcon,i=_.scrollable?-kiwi_scrollbar_width():visBorder;console.log("toggle_panel "+e+" right="+t+" shown="+_.panelShown),t?a.style.right=px(_.panelShown?0:o+visIcon+2*visBorder):a.style.left=px(o+(_.panelShown?i:visIcon+2*visBorder)),"id-control"==e&&1==_.panel_isScaled&&_.panelShown&&mobile_scale_control_panel(null,!0),freqset_select()}function openwebrx_resize(e){e=isString(e)&&e.startsWith("orient")?e:"event",resize_wf_canvases(),resize_waterfall_container(!0),extint_environment_changed({resize:1}),resize_scale(e),check_top_bar_congestion()}var p_left,p_owner,p_mid,p_right,offsetDiff_init=!1;function offsetDiff(e,t,_,a){var i=w3_el("id-tbar-"+e.toLowerCase()+"-bbox");i.style.left=px(_.x1),i.style.width=px(_.w),i.style.height=px(_.h),i.style.backgroundColor=t,console.log(e+" L/R/W="+_.x1+"/"+_.x2+"/"+_.w+" ("+(a.x1-_.x1)+"/"+(a.x2-_.x2)+"/"+(a.w-_.w)+")")}function check_top_bar_congestion(){var e=w3_boundingBox_children("id-left-info-container"),t=w3_boundingBox_children("id-mid-owner-container"),_=w3_boundingBox_children("id-mid-info-container"),a=w3_boundingBox_children("id-topbar-right-container"),i=e.x2+(_.x1-e.x2)/2-t.w/2;w3_el("id-owner-info").style.left=px(i),t=w3_boundingBox_children("id-mid-owner-container"),w3_visible("id-mid-owner-container",t.x1>=e.x2),w3_visible("id-mid-info-container",_.x1>=e.x2),w3_visible("id-topbar-right-container",a.x1>=e.x2),w3_el("id-rx-details-arrow").style.left=px(e.x2)}function init_top_bar(){var e=kiwi_decodeURIComponent("RX_LOC",cfg.index_html_params.RX_LOC);w3_innerHTML("id-rx-desc",e+" | Grid "+w3_link("","https://www.levinecentral.com/ham/grid_square.php?Grid="+cfg.index_html_params.RX_QRA,cfg.index_html_params.RX_QRA,"","dont_toggle_rx_photo")+", ASL "+cfg.index_html_params.RX_ASL+", "+w3_link("id-rx-gmap","","[map]","","dont_toggle_rx_photo")+w3_div("id-rx-snr w3-show-inline"))}var rx_photo_spacer_height=owrx.height_top_bar_parts;function init_rx_photo(){var e=w3_el("id-top-photo-img");e.src=kiwi_decodeURIComponent("RX_PHOTO_FILE",cfg.index_html_params.RX_PHOTO_FILE),e.alt=e.title=kiwi_decodeURIComponent("RX_PHOTO_DESC",cfg.index_html_params.RX_PHOTO_DESC),e.style.paddingLeft=cfg.index_html_params.RX_PHOTO_LEFT_MARGIN?"50px":0,owrx.RX_PHOTO_HEIGHT=+cfg.index_html_params.RX_PHOTO_HEIGHT+rx_photo_spacer_height,w3_el("id-top-photo-clip").style.maxHeight=px(owrx.RX_PHOTO_HEIGHT),dbgUs||kiwi_isMobile()?close_rx_photo():window.setTimeout(function(){close_rx_photo()},3e3)}var rx_photo_state=1;function open_rx_photo(){rx_photo_state=1,html("id-rx-photo-desc").style.opacity=1,html("id-rx-photo-title").style.opacity=1,animate_to(html("id-top-photo-clip"),"maxHeight","px",owrx.RX_PHOTO_HEIGHT,.93,kiwi_isMobile()?1:1e3,60,function(){resize_waterfall_container(!0)}),w3_hide("id-rx-details-arrow-down"),w3_show_block("id-rx-details-arrow-up")}function close_rx_photo(){rx_photo_state=0,animate_to(html("id-top-photo-clip"),"maxHeight","px",rx_photo_spacer_height,.93,kiwi_isMobile()?1:1e3,60,function(){resize_waterfall_container(!0)}),w3_show_block("id-rx-details-arrow-down"),w3_hide("id-rx-details-arrow-up")}function dont_toggle_rx_photo(){dont_toggle_rx_photo_flag=1}function toggle_rx_photo(){dont_toggle_rx_photo_flag?dont_toggle_rx_photo_flag=0:((rx_photo_state?close_rx_photo:open_rx_photo)(),freqset_select())}function animate(e,t,_,a,i,o,n,s,r){isUndefined(r)&&(r=0),e.style[t]=a.toString()+_,e.anim_i=0,n_of_iters=n/(1e3/s),n_of_iters<1&&(n_of_iters=1),change=(i-a)/n_of_iters,isDefined(e.anim_timer)&&window.clearInterval(e.anim_timer),e.anim_timer=window.setInterval(function(){e.anim_i++<n_of_iters?1==o?e.style[t]=(parseFloat(e.style[t])+change).toString()+_:(remain=parseFloat(e.style[t])-i,new_val=9<Math.abs(remain)||"px"!=_?i+o*remain:Math.abs(remain)<2?i:i+remain-remain/Math.abs(remain),e.style[t]=new_val.toString()+_):(e.style[t]=i.toString()+_,window.clearInterval(e.anim_timer),delete e.anim_timer),0!=r&&r()},1e3/s)}function animate_to(e,t,_,a,i,o,n,s){from=parseFloat(style_value(e,t)),animate(e,t,_,from,a,i,o,n,s)}function style_value(e,t){return(e.currentStyle||(window.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.style))[t]}function demodulators_get_next_color(){return demodulator_color_index>=demodulator_colors.length&&(demodulator_color_index=0),demodulator_colors[demodulator_color_index++]}function demod_envelope_draw(e,t,_,a,i){isUndefined(a)&&(a="lime");var o=scale_px_from_freq(t,e),t=scale_px_from_freq(_,e);t<o&&(_=t,t=o,o=_),pb_adj_cf.style.left=px(o+20),pb_adj_cf.style.width=px(Math.max(0,t-o-40)),pb_adj_lo.style.left=px(o-10-20),pb_adj_lo.style.width=px(50),pb_adj_hi.style.left=px(t-20),pb_adj_hi.style.width=px(50),o-=10,t+=10,scale_ctx.lineWidth=3,scale_ctx.strokeStyle=a,scale_ctx.fillStyle=a;a={envelope_on_screen:!1,line_on_screen:!1,allow_pb_adj:!1};return t<0||o>window.innerWidth||(a.beginning={x1:o-20,x2:o+10+20},a.ending={x1:t-10-20,x2:t+20},a.whole_envelope={x1:o,x2:t},a.envelope_on_screen=!0,a.allow_pb_adj=50<=t-o,a.allow_pb_adj||(scale_ctx.strokeStyle=scale_ctx.fillStyle="yellow"),scale_ctx.beginPath(),scale_ctx.moveTo(o,17),scale_ctx.lineTo(o+5,17),scale_ctx.lineTo(o+10,5),scale_ctx.lineTo(t-5-5,5),scale_ctx.lineTo(t-5,17),scale_ctx.lineTo(t,17),scale_ctx.globalAlpha=.3,scale_ctx.fill(),scale_ctx.globalAlpha=1,scale_ctx.stroke()),isDefined(i)&&(line_px=scale_px_from_freq(i,e),line_px<0||line_px>window.innerWidth||(a.line={x1:line_px-4,x2:line_px+4},a.line_on_screen=!0,scale_ctx.moveTo(line_px,18),scale_ctx.lineTo(line_px,4),scale_ctx.stroke(),pb_adj_car.style.left=px(a.line.x1),pb_adj_car.style.width=px(8))),a}function demod_envelope_where_clicked(e,_,t,a){if(in_range=function(e,t){return t.x1<=e&&t.x2>=e&&_<scale_canvas_h/2},dr=demodulator.draggable_ranges,a.shiftKey){if(t.line_on_screen&&in_range(e,t.line))return dr.bfo;if(t.envelope_on_screen&&in_range(e,t.whole_envelope))return dr.pbs}if(a.altKey){if(t.envelope_on_screen&&in_range(e,t.beginning))return dr.bwlo;if(t.envelope_on_screen&&in_range(e,t.ending))return dr.bwhi}if(t.envelope_on_screen){if(t.allow_pb_adj){if(in_range(e,t.beginning))return dr.beginning;if(in_range(e,t.ending))return dr.ending}if(in_range(e,t.whole_envelope))return dr.anything_else}return dr.none}dont_toggle_rx_photo_flag=0,demodulators=[],demodulator_color_index=0,demodulator_colors=["#ffff00","#00ff00","#00ffff","#058cff","#ff9600","#a1ff39","#ff4e39","#ff5dbd"],demodulator=function(e){this.offset_frequency=e,this.has_audio_output=!0,this.has_text_output=!1,this.envelope={},this.color=demodulators_get_next_color(),this.stop=function(){}},demodulator.draggable_ranges={none:0,beginning:1,ending:2,anything_else:3,bfo:4,pbs:5,bwlo:6,bwhi:7},demodulator_response_time=100;var scale_ctx,band_ctx,dx_ctx,pb_adj_cf,pb_adj_cf_ttip,pb_adj_lo,pb_adj_lo_ttip,pb_adj_hi,pb_adj_hi_ttip,pb_adj_car,pb_adj_car_ttip,scale_canvas,band_canvas,dx_div,dx_canvas,passbands_fallback={am:{lo:-4900,hi:4900},amn:{lo:-2500,hi:2500},sam:{lo:-4900,hi:4900},sal:{lo:-4900,hi:0},sau:{lo:0,hi:4900},sas:{lo:-4900,hi:4900},qam:{lo:-4900,hi:4900},drm:{lo:-5e3,hi:5e3},lsb:{lo:-2700,hi:-300},lsn:{lo:-2400,hi:-300},usb:{lo:300,hi:2700},usn:{lo:300,hi:2400},cw:{lo:300,hi:700,pbw:400},cwn:{lo:470,hi:530,pbw:60},nbfm:{lo:-6e3,hi:6e3},nnfm:{lo:-3e3,hi:3e3},iq:{lo:-5e3,hi:5e3}};function kiwi_passbands(e){var t=cfg.passbands[e];return isDefined(t)?t:(console.log("kiwi_passbands("+e+") fallback:"),console.log(passbands_fallback[e]),passbands_fallback[e])}function demodulator_default_analog(e,t,_,a){null==kiwi_passbands(t)&&(t="am"),demodulator.call(this,e),this.subtype=t,this.envelope.dragged_range=demodulator.draggable_ranges.none;e=audio_input_rate?audio_input_rate/2:5e3;this.filter={min_passband:4,high_cut_limit:e,low_cut_limit:-e},this.server_mode=t;isNaN(_)&&(_=owrx.last_lo[t],isNaN(_)&&(_=kiwi_passbands(t).lo)),owrx.last_lo[t]=_;var i,o,n,s,r,a=a;switch(isNaN(a)&&(a=owrx.last_hi[t],isNaN(a)&&(a=kiwi_passbands(t).hi)),owrx.last_hi[t]=a,""!=override_pbw&&(i=_+(a-_)/2,o=this.filter.min_passband,n=(override_pbw=decodeURIComponent(override_pbw)).split(","),console.log("p.len="+n.length),s=n[0].parseFloatWithUnits("k"),console.log('nlo="'+n[0]+'" '+s),r=NaN,1<n.length&&(r=n[1].parseFloatWithUnits("k"),console.log('nhi="'+n[1]+'" '+s)),1==n.length&&!isNaN(s)&&o<=s?(_=i-s/2,a=i+s/2):2==n.length&&!isNaN(s)&&!isNaN(r)&&s<r&&o<=r-s&&(_=s,a=r),override_pbw="",extint.override_pb=!0),""!=override_pbc&&(i=(a-_)/2,o=this.filter.min_passband,s=(n=(override_pbc=decodeURIComponent(override_pbc)).split(","))[0].parseFloatWithUnits("k"),console.log("pbc="+dq(n[0])+" "+s),r=NaN,1<n.length&&(r=n[1].parseFloatWithUnits("k"),console.log("pbw="+dq(n[1])+" "+r)),1!=n.length||isNaN(s)?2==n.length&&!isNaN(s)&&!isNaN(r)&&o<=r&&(_=s-r/2,a=s+r/2):(_=s-i,a=s+i),override_pbc="",extint.override_pb=!0),this.low_cut=Math.max(_,this.filter.low_cut_limit),this.high_cut=Math.min(a,this.filter.high_cut_limit),this.usePBCenter=!1,this.isCW=!1,t){case"am":case"amn":case"sam":case"sal":case"sau":case"sas":case"qam":case"drm":case"nbfm":case"nnfm":case"iq":break;case"lsb":case"lsn":case"usb":case"usn":this.usePBCenter=!0;break;case"cw":case"cwn":this.usePBCenter=!0,this.isCW=!0;break;default:console.log("DEMOD-new: unknown subtype="+t)}this.wait_for_timer=!1,this.set_after=!1,this.set=function(){this.wait_for_timer?this.set_after=!0:(this.doset(),this.set_after=!1,this.wait_for_timer=!0,timeout_this=this,window.setTimeout(function(){timeout_this.wait_for_timer=!1,timeout_this.set_after&&timeout_this.set()},demodulator_response_time))},this.doset=function(){var e=(freq_car_Hz/1e3).toFixed(3),t=this.server_mode,_=this.low_cut.toString(),a=this.high_cut.toString();snd_send("SET mod="+t+" low_cut="+_+" high_cut="+a+" freq="+e+(ext_mode(t).SAx?" param="+(owrx.chan_null|owrx.SAM_opts<<owrx.SAM_opts_sft):""));var i=null;e!=owrx.last_freq&&((i=i||{}).freq=1,owrx.last_freq=e),t!=owrx.last_mode&&((i=i||{}).mode=1,owrx.last_mode=t),_==owrx.last_locut&&a==owrx.last_hicut||((i=i||{}).passband=1,owrx.last_locut=_,owrx.last_hicut=a),null!=i&&(i.passband_screen_location=1,extint_environment_changed(i)),muted_until_freq_set&&(toggle_or_set_mute(muted_initially),muted_until_freq_set=!1),audio_meas_dly_ena&&(audio_meas_dly_start=(new Date).getTime())},(this.envelope.parent=this).envelope.draw=function(e){this.visible_range=e,this.drag_ranges=demod_envelope_draw(g_range,center_freq+this.parent.offset_frequency+this.parent.low_cut,center_freq+this.parent.offset_frequency+this.parent.high_cut,this.color,center_freq+this.parent.offset_frequency);var t=owrx.last_shiftKey||this.dragged_range==demodulator.draggable_ranges.pbs,e=Math.abs(this.parent.high_cut-this.parent.low_cut),t=t?", PBT":", bw "+e.toString();pb_adj_lo_ttip.innerHTML="lo "+this.parent.low_cut.toString()+t,pb_adj_hi_ttip.innerHTML="hi "+this.parent.high_cut.toString()+t,pb_adj_cf_ttip.innerHTML="cf "+(this.parent.low_cut+Math.abs(this.parent.high_cut-this.parent.low_cut)/2).toString()+t;e=owrx.last_shiftKey||this.dragged_range==demodulator.draggable_ranges.bfo,t=(center_freq+this.parent.offset_frequency)/1e3+kiwi.freq_offset_kHz;pb_adj_car_ttip.innerHTML=(e?"BFO ":"")+t.toFixed(freq_field_prec(t))+" kHz"},this.envelope.env_drag_start=function(e,t,_){return this.key_modifiers=_,this.dragged_range=demod_envelope_where_clicked(e,t,this.drag_ranges,_),this.drag_origin={x:e,low_cut:this.parent.low_cut,high_cut:this.parent.high_cut,offset_frequency:this.parent.offset_frequency},this.dragged_range!=demodulator.draggable_ranges.none},this.envelope.drag_move=function(e){var t=demodulator.draggable_ranges;if(this.dragged_range==t.none)return!1;freq_change=Math.round(this.visible_range.hpp*(e-this.drag_origin.x));var _=this.dragged_range==t.bfo,a=this.dragged_range==t.beginning,i=this.dragged_range==t.ending,o=this.dragged_range==t.bwlo,n=this.dragged_range==t.bwhi,s=_||this.dragged_range==t.pbs||o||n,e=_||n?-1:1,n=_||o?-1:1,o=this.drag_origin.low_cut,a=a||s;a&&(o+=e*freq_change);e=this.drag_origin.high_cut,s=i||s;if(s&&(e+=n*freq_change),a){if(o<this.parent.filter.low_cut_limit)return!0;if(e-o<this.parent.filter.min_passband)return!0;if(e<=o)return!0}if(s){if(e>this.parent.filter.high_cut_limit)return!0;if(e-o<this.parent.filter.min_passband)return!0;if(e<=o)return!0}if(a&&(owrx.last_lo[this.parent.server_mode]=this.parent.low_cut=o),s&&(owrx.last_hi[this.parent.server_mode]=this.parent.high_cut=e),this.dragged_range==t.anything_else||_){if(new_value=this.drag_origin.offset_frequency+freq_change,new_value>bandwidth/2||new_value<-bandwidth/2)return!0;this.parent.offset_frequency=new_value}return mkenvelopes(this.visible_range),freqset_car_Hz(this.parent.offset_frequency+center_freq),this.parent.set(),freqset_update_ui(owrx.FSET_PB_CHANGE),!0},this.envelope.drag_end=function(e){return to_return=this.dragged_range!=demodulator.draggable_ranges.none,this.dragged_range=demodulator.draggable_ranges.none,to_return}}function add_shift_listener(e){e.addEventListener("mouseover",shift_event,!0)}function shift_event(e,t){e&&("mouseover"==e.type||e.key&&"Shift"==e.key)&&(e.key&&"Shift"==e.key&&(owrx.last_shiftKey=e.shiftKey),demodulators[0]&&demodulators[0].envelope.dragged_range==demodulator.draggable_ranges.none&&mkenvelopes(get_visible_freq_range()))}function mkenvelopes(e){scale_ctx.clearRect(0,0,scale_ctx.canvas.width,22);for(var t=0;t<demodulators.length;t++)demodulators[t].envelope.draw(e)}function demodulator_remove(e){demodulators[e].stop(),demodulators.splice(e,1)}function demodulator_add(e){demodulators.push(e),waterfall_setup_done&&mkenvelopes(get_visible_freq_range())}function demodulator_analog_replace(e,t){null==kiwi_passbands(e)&&(e="am");var _,a=0,i=0,o=!1,n=!1,s=!1;demodulators.length?(o=demodulators[0].isCW,a=demodulators[0].offset_frequency,i=passband_offset(),demodulator_remove(0)):(a=(_=Math.round(1e3*(init_frequency-kiwi.freq_offset_kHz)))<=0||bandwidth<_?0:_-center_freq,e=init_mode),isArg(t)&&(a=t-center_freq),demodulator_add(new demodulator_default_analog(a,e,NaN,NaN)),!o&&demodulators[0].isCW&&(n=!0),o&&!demodulators[0].isCW&&(s=!0),isArg(t)?(a=(freq_car_Hz=freq_dsp_to_car(t))-center_freq,wf.audioFFT_clear_wf=!0):(t=0,n&&(t=-passband_offset()),s&&(t=i),a+=t,(n||s)&&(wf.audioFFT_clear_wf=!0)),"drm"!=cur_mode&&(extint.prev_mode=cur_mode),cur_mode=e,(n||s)&&set_agc(),demodulator_set_offset_frequency(owrx.FSET_ADD,a),try_modeset_update_ui(e)}function demodulator_set_offset_frequency(e,t){var _;bandwidth/2<t||t<-bandwidth/2||(freqset_car_Hz((t=Math.round(t))+center_freq),(_=demodulators[0]).offset_frequency=t,_.set(),try_freqset_update_ui(e))}function owrx_init_cfg(){w3_do_when_rendered("id-rx-gmap",function(){var e=kiwi_decodeURIComponent("RX_GMAP",cfg.index_html_params.RX_GMAP);w3_link_set("id-rx-gmap","https://www.google.com/maps/place/"+e)}),owrx.cfg_loaded=!0}function scale_setup(){w3_el("id-scale-container").addEventListener("mouseout",scale_container_mouseout,!1),scale_canvas=w3_el("id-scale-canvas"),scale_ctx=scale_canvas.getContext("2d"),add_scale_listener(scale_canvas),(pb_adj_car=w3_el("id-pb-adj-car")).innerHTML='<span id="id-pb-adj-car-ttip" class="class-passband-adjust-car-tooltip class-tooltip-text"></span>',pb_adj_car_ttip=w3_el("id-pb-adj-car-ttip"),add_scale_listener(pb_adj_car),add_shift_listener(pb_adj_car),(pb_adj_lo=w3_el("id-pb-adj-lo")).innerHTML='<span id="id-pb-adj-lo-ttip" class="class-passband-adjust-cut-tooltip class-tooltip-text"></span>',pb_adj_lo_ttip=w3_el("id-pb-adj-lo-ttip"),add_scale_listener(pb_adj_lo),add_shift_listener(pb_adj_lo),(pb_adj_hi=w3_el("id-pb-adj-hi")).innerHTML='<span id="id-pb-adj-hi-ttip" class="class-passband-adjust-cut-tooltip class-tooltip-text"></span>',pb_adj_hi_ttip=w3_el("id-pb-adj-hi-ttip"),add_scale_listener(pb_adj_hi),add_shift_listener(pb_adj_hi),(pb_adj_cf=w3_el("id-pb-adj-cf")).innerHTML='<span id="id-pb-adj-cf-ttip" class="class-passband-adjust-cf-tooltip class-tooltip-text"></span>',pb_adj_cf_ttip=w3_el("id-pb-adj-cf-ttip"),add_scale_listener(pb_adj_cf),add_shift_listener(pb_adj_cf),band_canvas=w3_el("id-band-canvas"),band_ctx=band_canvas.getContext("2d"),add_canvas_listener(band_canvas),add_canvas_listener(dx_div=w3_el("id-dx-container")),dx_canvas=w3_el("id-dx-canvas"),dx_ctx=dx_canvas.getContext("2d"),add_canvas_listener(dx_canvas),resize_scale("setup")}function add_scale_listener(e){e.addEventListener("mousedown",scale_canvas_mousedown,!1),e.addEventListener("mousemove",scale_canvas_mousemove,!1),e.addEventListener("mouseup",scale_canvas_mouseup,!1),e.addEventListener("contextmenu",scale_canvas_contextmenu,!1),e.addEventListener("wheel",canvas_mousewheel,!1),kiwi_isMobile()&&(e.addEventListener("touchstart",scale_canvas_touchStart,!1),e.addEventListener("touchmove",scale_canvas_touchMove,!1),e.addEventListener("touchend",scale_canvas_touchEnd,!1))}function scale_canvas_contextmenu(e){return cancelEvent(e)}demodulator_default_analog.prototype=new demodulator;var scale_canvas_drag_params={mouse_down:!1,drag:!1,start_x:0,last_x:0,start_y:0,last_y:0,key_modifiers:{shiftKey:!1,altKey:!1,ctrlKey:!1}};function scale_canvas_mousedown(e){scale_canvas_drag_params.drag=!1,scale_canvas_drag_params.start_x=e.pageX,scale_canvas_drag_params.start_y=e.pageY,scale_canvas_drag_params.key_modifiers.shiftKey=e.shiftKey,scale_canvas_drag_params.key_modifiers.altKey=e.altKey,scale_canvas_drag_params.key_modifiers.ctrlKey=e.ctrlKey,scale_canvas_start_drag(e,1),e.preventDefault()}function scale_canvas_touchStart(e){scale_canvas_drag_params.drag=!1,scale_canvas_drag_params.last_x=start_x=e.targetTouches[0].pageX,scale_canvas_drag_params.last_y=start_y=e.targetTouches[0].pageY,scale_canvas_drag_params.key_modifiers.shiftKey=!1,scale_canvas_drag_params.key_modifiers.altKey=!1,scale_canvas_drag_params.key_modifiers.ctrlKey=!1,scale_canvas_start_drag(e,0),touch_restore_tooltip_visibility(owrx.scale_canvas),e.preventDefault()}var scale_canvas_ignore_mouse_event=!1;function scale_canvas_start_drag(e,t){if(e.button==mouse.right&&!e.ctrlKey)return right_click_menu(scale_canvas_drag_params.start_x,scale_canvas_drag_params.start_y,1),scale_canvas_drag_params.mouse_down=owrx.scale_canvas.mouse_out=!1,void(scale_canvas_ignore_mouse_event=!0);scale_canvas_drag_params.mouse_down=!0,owrx.scale_canvas.target=e.target,t&&scale_canvas_mousemove(e)}function scale_offset_carfreq_from_px(e,t){isUndefined(t)&&(t=get_visible_freq_range());var _=passband_offset();return t.start+t.bw*(e/wf_container.clientWidth)-center_freq-_}function scale_canvas_drag(e,t,_){if(!scale_canvas_ignore_mouse_event){var a=0;Math.abs(t-scale_canvas_drag_params.start_x);if(scale_canvas_drag_params.mouse_down&&!scale_canvas_drag_params.drag){scale_canvas_drag_params.drag=!0;for(var i=0;i<demodulators.length;i++)a|=demodulators[i].envelope.env_drag_start(t,_,scale_canvas_drag_params.key_modifiers);e.target.style.cursor="move"}if(scale_canvas_drag_params.drag){for(i=0;i<demodulators.length;i++)a|=demodulators[i].envelope.drag_move(t);a||demodulator_set_offset_frequency(owrx.FSET_SCALE_DRAG,scale_offset_carfreq_from_px(t)),scale_canvas_drag_params.last_x=t}}}function scale_canvas_mousemove(e){scale_canvas_drag(e,e.pageX,e.offsetY)}function scale_canvas_touchMove(e){for(var t=0;t<e.touches.length;t++){var _=e.touches[t].pageY-owrx.scale_offsetY;scale_canvas_drag(e,e.touches[t].pageX,_)}e.preventDefault()}function scale_canvas_end_drag(e,t,_){if(scale_canvas_ignore_mouse_event)scale_canvas_ignore_mouse_event=scale_canvas_drag_params.mouse_down=!1;else if(1!=scale_canvas_drag_params.mouse_down||"mouseout"!=e.type){var a=scale_canvas_drag_params.drag=!1;if(1==scale_canvas_drag_params.mouse_down){for(var i=0;i<demodulators.length;i++)a|=demodulators[i].envelope.drag_end(t);a||demodulator_set_offset_frequency(owrx.FSET_SCALE_DRAG_END,scale_offset_carfreq_from_px(t))}scale_canvas_drag_params.mouse_down=!1;e=owrx.scale_canvas.target;e&&e.style&&(e.style.cursor=null)}else owrx.scale_canvas.mouse_out=!0}function scale_canvas_mouseup(e){scale_canvas_end_drag(e,e.pageX)}function touch_hide_tooltip(e,t){var _,a=t.target;w3_contains(a,"class-tooltip")&&(_=a.childNodes[0],w3_contains(_,"class-tooltip-text")&&(t.restore_visibility_timeout=setTimeout(function(){_.style.visibility="hidden",t.restore_visibility.push(_)},t.restore_visibility_delay)))}function touch_restore_tooltip_visibility(e){kiwi_clearTimeout(e.restore_visibility_timeout),e.restore_visibility.forEach(function(e){e.style.visibility=""}),e.restore_visibility=[]}function scale_canvas_touchEnd(e){scale_canvas_end_drag(e,scale_canvas_drag_params.last_x),touch_hide_tooltip(e,owrx.scale_canvas),e.preventDefault()}function scale_container_mouseout(e){var t=e.relatedTarget;(t=isObject(t)&&null!=t&&isDefined(t.id)?t.id:null)&&(t.startsWith("id-pb-adj")||t.startsWith("id-scale"))||scale_canvas_mouseup(e)}function scale_px_from_freq(e,t){return Math.round((e-t.start)/t.bw*wf_container.clientWidth)}function scale_px_from_freq_offset(e,t){return Math.round((e-t.start_offset)/t.bw*wf_container.clientWidth)}function get_visible_freq_range(){var e,t;return out={},wf.audioFFT_active&&cur_mode&&0!=demodulators.length?(t=Math.round(audio_input_rate||12e3),t=ext_is_IQ_or_stereo_curmode()?(e=0,t):(e=ext_mode(cur_mode).LSB_SAL?0:t/4,t/2),out.center=center_freq+demodulators[0].offset_frequency+e,out.start=out.center-t,out.end=out.center+t,x_bin=freq_to_bin(out.start)):(t=bins_at_cur_zoom(),out.start=bin_to_freq(x_bin),out.center=bin_to_freq(x_bin+t/2),out.end=bin_to_freq(x_bin+t)),out.bw=out.end-out.start,out.hpp=out.bw/scale_canvas.clientWidth,out.start_offset=out.start+kiwi.offset_frac,out}var g_range,scale_markers_levels=[{hz_per_large_marker:1e7,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:0},{hz_per_large_marker:5e6,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:0},{hz_per_large_marker:1e6,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:0},{hz_per_large_marker:5e5,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:1},{hz_per_large_marker:1e5,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:1},{hz_per_large_marker:5e4,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:2},{hz_per_large_marker:1e4,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:2},{hz_per_large_marker:5e3,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:3},{hz_per_large_marker:1e3,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:3}],scale_min_space_btwn_texts=50,scale_min_space_btwn_small_markers=7;function get_scale_mark_spacing(t){out={},fcalc=function(e){return out.numlarge=t.bw/e,out.pxlarge=wf_container.clientWidth/out.numlarge,out.ratio=5,out.pxsmall=out.pxlarge/out.ratio,!(out.pxsmall<scale_min_space_btwn_small_markers)&&(out.pxsmall/2>=scale_min_space_btwn_small_markers&&"5"!=e.toString()[0]&&(out.pxsmall/=2,out.ratio*=2),out.smallbw=e/out.ratio,!0)};for(var e=scale_markers_levels.length-1;0<=e&&(mp=scale_markers_levels[e],!(fcalc(mp.hz_per_large_marker)&&out.pxlarge-mp.estimated_text_width>scale_min_space_btwn_texts));e--);return out.params=mp,out}function mk_freq_scale(){mkenvelopes(g_range=get_visible_freq_range()),scale_ctx.clearRect(0,22,scale_ctx.canvas.width,scale_ctx.canvas.height-22),scale_ctx.strokeStyle="#fff",scale_ctx.font="bold 12px sans-serif",scale_ctx.textBaseline="top",scale_ctx.fillStyle="#fff";var a,i=get_scale_mark_spacing(g_range),e=Math.ceil(g_range.start_offset/i.smallbw)*i.smallbw,t=e+kiwi.freq_offset_Hz-kiwi.offset_frac;text_y_pos=32+(kiwi_isFirefox()?3:0);function _(e){var t=e,_=i.params.pre_divide,e=i.params.decimals;(t+=kiwi.freq_offset_Hz-kiwi.offset_frac)<1e6&&(_/=1e3,e=0),a=format_frequency(i.params.format+(t<1e6?"kHz":"MHz"),t,_,e)}for(var o,n,s,r,l,d=0;!(1e3<++d);){if((l=scale_px_from_freq_offset(e,g_range))>window.innerWidth)break;scale_ctx.beginPath(),scale_ctx.moveTo(l,22),t%i.params.hz_per_large_marker==0?(isUndefined(n)&&(n=e),o=e,scale_ctx.lineWidth=3.5,scale_ctx.lineTo(l,33),_(e),s=scale_ctx.measureText(a),scale_ctx.textAlign="center",0==zoom_level&&g_range.start+i.smallbw*i.ratio>e?l<=s.width/2?scale_px_from_freq_offset(e+i.smallbw*i.ratio,g_range)-s.width>=scale_min_space_btwn_texts&&(scale_ctx.textAlign="left",scale_ctx.fillText(a,0,text_y_pos)):scale_ctx.fillText(a,l,text_y_pos):0==zoom_level&&g_range.end-i.smallbw*i.ratio<e&&l>window.innerWidth-s.width/2?window.innerWidth-s.width-scale_px_from_freq_offset(e-i.smallbw*i.ratio,g_range)>=scale_min_space_btwn_texts&&(scale_ctx.textAlign="right",scale_ctx.fillText(a,window.innerWidth,text_y_pos)):scale_ctx.fillText(a,l,text_y_pos)):(scale_ctx.lineWidth=2,scale_ctx.lineTo(l,30)),e+=i.smallbw,t+=i.smallbw,scale_ctx.stroke()}1e3<d&&(console.log("CONV_CT > 1000!!!"),kiwi_trace()),0!=zoom_level&&(scale_ctx.textAlign="center",l=scale_px_from_freq_offset(r=n-i.smallbw*i.ratio,g_range),_(r),0<l+scale_ctx.measureText(a).width/2&&scale_ctx.fillText(a,l,32),l=scale_px_from_freq_offset(r=o+i.smallbw*i.ratio,g_range),_(r),l-scale_ctx.measureText(a).width/2<window.innerWidth&&scale_ctx.fillText(a,l,32))}var window_width,waterfall_width,main_container,wf_container,canvas_annotation,canvas_phantom,annotation_div,dx_car_size=8,dx_car_border=3,dx_car_w=dx_car_h=2*dx_car_border+dx_car_size;function resize_scale(e){band_ctx.canvas.width=window.innerWidth,band_ctx.canvas.height=band_canvas_h,dx_div.style.width=px(window.innerWidth),dx_ctx.canvas.width=dx_car_w,dx_ctx.canvas.height=dx_car_h,dx_canvas.style.top=px(scale_canvas_top-dx_car_h+2),dx_canvas.style.left=0,dx_show(!(dx_canvas.style.zIndex=100)),dx_ctx.miterLimit=2,dx_ctx.lineJoin="round",dx_ctx.beginPath(),dx_ctx.lineWidth=dx_car_border-1,dx_ctx.strokeStyle="black";var t=dx_car_border,_=dx_car_size;dx_ctx.moveTo(t-1,t),dx_ctx.lineTo(t+_,t),dx_ctx.lineTo(t+_/2,t+_),dx_ctx.lineTo(t,t),dx_ctx.stroke(),dx_ctx.fillStyle="yellow",dx_ctx.fill(),scale_ctx.canvas.width=window.innerWidth,scale_ctx.canvas.height=scale_canvas_h,mkscale(),dx_schedule_update()}function format_frequency(e,t,_,a){return out=e.replace("{x}",(t/_).toFixed(a)),out}function mkscale(){mk_freq_scale(),mk_bands_scale()}function bins_at_zoom(e){return wf_fft_size<<zoom_levels_max-e}function bins_at_cur_zoom(){return bins_at_zoom(zoom_level)}function norm_to_bins(e){return Math.round(e*bins_at_cur_zoom())}function bin_to_freq(e){var t=wf_fft_size<<zoom_levels_max;return Math.round(e/t*bandwidth)}function freq_to_bin(e){var t=wf_fft_size<<zoom_levels_max;return Math.round(e/bandwidth*t)}function bins_to_pixels_frac(e,t,_){var a=t/bins_at_zoom(_);return sb_trace&&console.log("bins_to_pixels_frac bins="+t+" z="+_+" ratio="+a),1<a&&(a=1),a<-1&&(a=-1),wf_fft_size*a}function bins_to_pixels(e,t,_){_=bins_to_pixels_frac(e,t,_);return Math.round(_)}function freq_to_pixel(e){e=freq_to_bin(e)-x_bin;return 0<=e&&e<bins_at_cur_zoom()||(console.log("freq_to_pixel: bins="+e+" bins_at_cur_zoom="+bins_at_cur_zoom()),console.assert("assert fail")),bins_to_pixels(0,e,zoom_level)}function clamp_xbin(e){e<0&&(e=0);var t=(wf_fft_size<<zoom_levels_max)-bins_at_cur_zoom();return t<e&&(e=t),e}function passband_visible(){if(isUndefined(demodulators[0]))return x_bin;var e=freq_to_bin(freq_passband_center());return e=x_bin<=e&&e<x_bin+bins_at_cur_zoom()?e:-e-1}function create_canvas(e,t,_,a,i){var o=document.createElement("canvas");return o.id=e,o.width=t,o.height=_,a&&(o.style.width=px(a)),i&&(o.style.height=px(i)),o.ctx=o.getContext("2d"),o}function init_wf_container(){window_width=window.innerWidth,wf_container=w3_el("id-waterfall-container"),waterfall_width=wf_container.clientWidth,(canvas_annotation=create_canvas("id-annotation-canvas",wf_fft_size,wf_canvas_default_height,waterfall_width,wf_canvas_default_height)).style.zIndex=1,wf_container.appendChild(canvas_annotation),add_canvas_listener(canvas_annotation),w3_el("id-kiwi-body").addEventListener("keyup",mouse_freq_remove,!1),add_canvas_listener(annotation_div=w3_el("id-annotation-div")),annotation_div.style.pointerEvents="none",add_canvas_listener(canvas_phantom=w3_el("id-phantom-canvas")),canvas_phantom.style.width=px(wf_container.clientWidth),add_wf_canvas(),spec.canvas=create_canvas("id-spectrum-canvas",wf_fft_size,spec.height_spectrum_canvas,waterfall_width,spec.height_spectrum_canvas),w3_el("id-spectrum-container").appendChild(spec.canvas),spec.ctx=spec.canvas.ctx,add_canvas_listener(spec.canvas),spec.ctx.font="10px sans-serif",spec.ctx.textBaseline="middle",spec.ctx.textAlign="left",spec.af_left=50,spec.af_margins=2*spec.af_left,spec.af_canvas=create_canvas("id-spectrum-af-canvas",wf_fft_size,spec.height_spectrum_canvas,waterfall_width-spec.af_margins,spec.height_spectrum_canvas),w3_el("id-spectrum-container").appendChild(spec.af_canvas),spec.af_canvas.style.left=px(spec.af_left),spec.af_canvas.style.position="absolute",spec.af_ctx=spec.af_canvas.ctx,add_canvas_listener(spec.af_canvas),spec.dB=w3_el("id-spectrum-dB"),spec.dB.style.height=px(spec.height_spectrum_canvas),spec.dB.style.width=px(waterfall_width),spec.dB.innerHTML='<span id="id-spectrum-dB-ttip" class="class-spectrum-dB-tooltip class-tooltip-text"></span>',add_canvas_listener(spec.dB),w3_do_when_rendered("id-spectrum-dB-ttip",function(e){spec.dB_ttip=e}),document.addEventListener("mousemove",mouse_freq_add,!1)}function add_canvas_listener(e){e.addEventListener("mouseover",canvas_mouseover,!1),e.addEventListener("mouseout",canvas_mouseout,!1),e.addEventListener("mousedown",canvas_mousedown,!1),e.addEventListener("mousemove",canvas_mousemove,!1),e.addEventListener("mouseup",canvas_mouseup,!1),e.addEventListener("contextmenu",canvas_contextmenu,!1),e.addEventListener("wheel",canvas_mousewheel,!1),kiwi_isMobile()&&(e.addEventListener("touchstart",canvas_touchStart,!1),e.addEventListener("touchmove",canvas_touchMove,!1),e.addEventListener("touchend",canvas_touchEnd,!1))}function remove_canvas_listener(e){e.removeEventListener("mouseover",canvas_mouseover,!1),e.removeEventListener("mouseout",canvas_mouseout,!1),e.removeEventListener("mousedown",canvas_mousedown,!1),e.removeEventListener("mousemove",canvas_mousemove,!1),e.removeEventListener("mouseup",canvas_mouseup,!1),e.removeEventListener("contextmenu",canvas_contextmenu,!1),e.removeEventListener("wheel",canvas_mousewheel,!1),kiwi_isMobile()&&(e.removeEventListener("touchstart",canvas_touchStart,!1),e.removeEventListener("touchmove",canvas_touchMove,!1),e.removeEventListener("touchend",canvas_touchEnd,!1))}function canvas_contextmenu(e){return e.target.id,e&&e.currentTarget&&"id-dx-container"==e.currentTarget.id&&(dx.ctrl_click=!0,w3_el(e.target.id).click()),cancelEvent(e)}function canvas_mouseover(e){}function canvas_mouseout(e){var t;waterfall_setup_done&&(canvas_dragging&&(t=e.target.id.startsWith("id-spectrum-dB"),owrx.debug_drag&&canvas_log("C-MOUT"+(t?" SPEC-IGNORE":"")),t||canvas_end_drag2()),mouse_freq_remove(e))}function canvas_get_carfreq_offset(e,t){var _=e/waterfall_width;_=wf.audioFFT_active?center_freq+demodulators[0].offset_frequency+(_-=(e=ext_is_IQ_or_stereo_curmode())?.5:.25)*audio_input_rate*(e?2:1):bin_to_freq(x_bin+_*bins_at_cur_zoom());t=t?passband_offset():0;return Math.round(_-t)-bandwidth/2}function canvas_get_dspfreq(e){return canvas_get_carfreq_offset(e,!1)+center_freq}canvas_dragging=!1,canvas_drag_min_delta=1,canvas_mouse_down_or_touch=!1,canvas_ignore_mouse_event=!1;var mouse={left:0,middle:1,right:2};function canvas_start_drag(e,t,_){return owrx.debug_drag&&canvas_log("CSD"),e.button!=mouse.right||e.ctrlKey?owrx.scale_canvas.mouse_out?(event_dump(e,"CSD-scale"),void console.log("SHOULD NOT OCCUR")):(e.shiftKey&&"id-dx-container"==e.target.id?(canvas_ignore_mouse_event=!0,owrx.debug_drag&&console.log("CSD-DX IME=set-true"),dx_show_edit_panel(e,-1)):e.shiftKey&&(e.ctrlKey||e.altKey)?(canvas_ignore_mouse_event=!0,owrx.debug_drag&&console.log("CSD-lookup IME=set-true"),freq_database_lookup(canvas_get_dspfreq(t),e.ctrlKey?owrx.rcm_lookup:owrx.rcm_cluster)):e.ctrlKey?(canvas_ignore_mouse_event=!0,owrx.debug_drag&&console.log("CSD-pageScroll1 IME=set-true"),page_scroll(-page_scroll_amount)):e.altKey&&(canvas_ignore_mouse_event=!0,owrx.debug_drag&&console.log("CSD-pageScroll2 IME=set-true"),page_scroll(page_scroll_amount)),owrx.drag_count=0,canvas_mouse_down_or_touch=!0,canvas_dragging=!1,owrx.canvas.drag_last_x=owrx.canvas.drag_start_x=t,owrx.canvas.drag_last_y=owrx.canvas.drag_start_y=_,owrx.canvas.target=e.target,cancelEvent(e)):(canvas_ignore_mouse_event=!0,owrx.debug_drag&&console.log("CSD-Rclick IME=set-true"),owrx.debug_drag&&canvas_log("ordinary-RCM"),right_click_menu(t,_,2),canvas_ignore_mouse_event=!1,void(owrx.debug_drag&&console.log("CSD-Rclick IME=set-false")))}function canvas_mousedown(e){owrx.debug_drag&&canvas_log("$C-MD"),canvas_start_drag(e,e.pageX,e.pageY),e.preventDefault()}function canvas_touchStart(e){var t=e.targetTouches.length,_=Math.round(e.targetTouches[0].pageX),a=Math.round(e.targetTouches[0].pageY);owrx.debug_drag&&canvas_log("$C-TS"+t+"-x"+_+"-y"+a),owrx.double_touch_start=!1,1==t?e.target.id.startsWith("id-spectrum")?(owrx.canvas.drag_last_x=owrx.canvas.drag_start_x=_,owrx.canvas.drag_last_y=owrx.canvas.drag_start_y=a,owrx.debug_drag&&canvas_log("*SPEC*")):canvas_start_drag(e,_,a):2<=t&&(canvas_start_drag(e,_,a),canvas_ignore_mouse_event=!0,owrx.debug_drag&&console.log("CTS-doubleTouch IME=set-true"),owrx.touches_first_startx=_,a=e.touches[0].pageX-e.touches[1].pageX,_=e.touches[0].pageY-e.touches[1].pageY,owrx.pinch_distance_first=Math.round(Math.hypot(a,_)),owrx.pinch_distance_last=owrx.pinch_distance_first,owrx.double_touch_swipe=Math.abs(_)<50,owrx.double_touch_start=!0),touch_restore_tooltip_visibility(owrx.canvas),e.preventDefault()}function canvas_drag(e,t,_,a,i,o){var n,s;waterfall_setup_done&&(spectrum_tooltip_update(e,i,o),owrx.drag_count=isNumber(owrx.drag_count)?owrx.drag_count+1:0,owrx.scale_canvas.mouse_out?scale_canvas_drag(e,_,a):(s=canvas_mouse_down_or_touch?owrx.canvas.drag_start_x:_,owrx.debug_drag&&canvas_log("CD#"+owrx.drag_count+" x"+_+" y"+a+" dx"+Math.abs(_-s)+" CMDT"+(canvas_mouse_down_or_touch?1:0)+" IME"+(canvas_ignore_mouse_event?1:0)+" DG"+(canvas_dragging?1:0)),!canvas_mouse_down_or_touch||canvas_ignore_mouse_event&&!owrx.double_touch_start||(i=kiwi_isMobile()?10:1,o=owrx.drag_count>i,s=Math.abs(_-owrx.canvas.drag_start_x)>canvas_drag_min_delta,!canvas_dragging&&o&&s&&(owrx.debug_drag&&canvas_log("### dc="+owrx.drag_count+" >? "+i+" && "+Math.abs(_-owrx.canvas.drag_start_x)+" >? "+canvas_drag_min_delta+" "+(o?"T":"F")+(s?"T":"F")),canvas_dragging=!0,wf_container.style.cursor="move"),canvas_dragging&&(o=owrx.canvas.drag_last_x-_,s=owrx.canvas.drag_last_y-a,owrx.double_touch_start?owrx.double_touch_swipe?0==t&&2<=e.touches.length&&(n=Math.round(Math.abs((e.touches[0].pageX+e.touches[1].pageX)/2)),demodulator_set_offset_frequency(owrx.FSET_SCALE_TOUCH_DRAG,canvas_get_carfreq_offset(n,!0))):(n=Math.round(Math.hypot(o,s)),s=Math.abs(n-owrx.pinch_distance_last),owrx.debug_drag&&canvas_log(n.toFixed(0)+" "+s.toFixed(0)),25<s&&(owrx.debug_drag&&canvas_log("*"),zoom_step((s=n<=owrx.pinch_distance_last)?ext_zoom.OUT:ext_zoom.IN),owrx.debug_drag&&canvas_log(s?"IN":"OUT"),owrx.pinch_distance_last=n)):waterfall_pan_canvases(norm_to_bins(o/waterfall_width)),owrx.canvas.drag_last_x=_,owrx.canvas.drag_last_y=a))))}function mouse_freq_add(e){var t,_,a,i;isNumber(e.pageX)&&(owrx.last_pageX=e.pageX),isNumber(e.pageY)&&(owrx.last_pageY=e.pageY),kiwi_isMobile()||wf.audioFFT_active||(t=canvas_annotation.ctx,e.target==canvas_annotation&&any_modifier_key(e)?(_=e.offsetX,a=e.offsetY+16,t.font=px(12)+" monospace",owrx.mouse_freq.vis&&t.clearRect(owrx.mouse_freq.tx,owrx.mouse_freq.cy,owrx.mouse_freq.tw,12),i=(canvas_get_dspfreq(_)+kiwi.freq_offset_Hz)/1e3,owrx.mouse_freq.text=format_frequency("{x}",i,1,freq_field_prec(i)),1&(i=Math.ceil(t.measureText(owrx.mouse_freq.text).width))&&i++,owrx.mouse_freq.tw=i,owrx.mouse_freq.th=12,owrx.mouse_freq.tx=_-i/2,t.fillStyle="black",t.fillRect(_-i/2,a,i,12),t.fillStyle="white",t.fillText(owrx.mouse_freq.text,owrx.mouse_freq.tx,a+12-2),owrx.mouse_freq.cx=_,owrx.mouse_freq.cy=a,owrx.mouse_freq.vis=!0):mouse_freq_remove(e))}function mouse_freq_remove(e){owrx.mouse_freq.vis&&(canvas_annotation.ctx.clearRect(owrx.mouse_freq.tx,owrx.mouse_freq.cy,owrx.mouse_freq.tw,owrx.mouse_freq.th),owrx.mouse_freq.vis=!1),e&&"keyup"==e.type&&shift_event(e,"keyup")}function canvas_mousemove(e){canvas_drag(e,0,e.pageX,e.pageY,e.clientX,e.clientY)}function canvas_touchMove(e){1<=e.touches.length&&(owrx.touches_first_lastx=e.touches[0].pageX);for(var t=0;t<e.touches.length;t++){var _=Math.round(e.touches[t].pageX),a=Math.round(e.touches[t].pageY);canvas_drag(e,t,_,a,_,a)}e.preventDefault()}function canvas_end_drag2(){owrx.debug_drag&&canvas_log("C-ED2"),wf_container.style.cursor=owrx.wf_cursor,canvas_mouse_down_or_touch=!1,canvas_ignore_mouse_event=!1,owrx.debug_drag&&console.log("C-ED2 IME=set-false")}function canvas_end_drag(e,t){var _,a;owrx.scale_canvas.mouse_out&&scale_canvas_end_drag(e,t,!(owrx.scale_canvas.mouse_out=!1)),owrx.debug_drag&&canvas_log("C-ED IME"+(canvas_ignore_mouse_event?1:0)+" CD"+(canvas_dragging?1:0)),waterfall_setup_done&&(canvas_dragging?canvas_end_drag2():(owrx.debug_drag&&canvas_log("CMDT"+(canvas_mouse_down_or_touch?1:0)+" TL"+owrx.tuning_locked),canvas_mouse_down_or_touch&&!canvas_ignore_mouse_event&&(owrx.tuning_locked?((_=w3_el("id-tuning-lock-container")).style.opacity=.8,w3_show(_),(a=w3_el("id-tuning-lock")).style.marginTop=px(w3_center_in_window(a,"TL")),setTimeout(function(){_.style.opacity=0,setTimeout(function(){w3_hide(_)},500)},300)):(owrx.debug_drag&&canvas_log("*click*"),e.shiftKey&&!e.ctrlKey&&!e.altKey||owrx.wf_snap?(a=(a=canvas_get_dspfreq(t))/(e=freq_step_amount(find_band(a)).step_Hz),freqmode_set_dsp_kHz(Math.round(a)*e/1e3,null)):demodulator_set_offset_frequency(owrx.FSET_SCALE_MOUSE_CLICK,canvas_get_carfreq_offset(t,!0))))),canvas_mouse_down_or_touch=!1,canvas_ignore_mouse_event=!1,owrx.debug_drag&&console.log("C-ED IME=set-false"))}function canvas_mouseup(e){owrx.debug_drag&&console.log("C-MU"),owrx.debug_drag&&canvas_log("C-MU"),canvas_end_drag(e,e.pageX)}function canvas_touchEnd(e){var t=owrx.canvas.drag_last_x,_=owrx.canvas.drag_last_y;owrx.debug_drag&&canvas_log("C-TE-x"+t+"-DTS"+(owrx.double_touch_start?1:0)+"-DTSw"+(owrx.double_touch_swipe?1:0)+"-DRAG"+(canvas_dragging?1:0)),canvas_end_drag(e,t),spectrum_tooltip_update(e,t,_),owrx.double_touch_start&&(owrx.debug_drag&&canvas_log("DTS-D="+(canvas_dragging?"T":"F")),demodulator_set_offset_frequency(owrx.FSET_SCALE_TOUCH_DRAG_END,freq_car_Hz-center_freq),canvas_dragging||(kiwi_isMobile()&&owrx.mobile&&owrx.mobile.small&&(t=10),owrx.debug_drag&&canvas_log("*-RCM"),right_click_menu(t,_,3)),canvas_ignore_mouse_event=!1,owrx.debug_drag&&console.log("CTE-doubleTouch IME=set-false"),owrx.double_touch_start=!1),touch_hide_tooltip(e,owrx.canvas),e.preventDefault()}var canvas_mousewheel_rlimit=kiwi_rateLimit(canvas_mousewheel_cb,170);function canvas_mousewheel(e){canvas_mousewheel_rlimit(e),e.preventDefault()}function canvas_mousewheel_cb(e){var t,_,a,i;waterfall_setup_done&&(i=e.deltaX,a=e.deltaY,t=i<0||0==i&&a<0,e.target&&e.target.id&&("id-scale-canvas"==e.target.id||e.target.id.startsWith("id-pb-"))?(_=owrx.PB_LEFT_EDGE,(a=shortcut_key_mod(e))==shortcut.NO_MODIFIER?_=owrx.PB_NO_EDGE:a==shortcut.SHIFT&&(_=owrx.PB_RIGHT_EDGE),passband_increment(t,_)):(i=e.ctrlKey||0!=i,zoom_step(t?ext_zoom.IN:ext_zoom.OUT,i?void 0:e.pageX)))}function right_click_menu_init(){var e=[];e.push("DX database1"),owrx.rcm_db1=0,e.push("DX database2"),owrx.rcm_db2=1,e.push("open DX label panel"),owrx.rcm_open=2,e.push("edit last selected DX label"),owrx.rcm_edit=3,e.push("DX label filter"),owrx.rcm_filter=4,e.push("<hr>"),e.push("database lookup"),owrx.rcm_lookup=6,e.push("DX Cluster lookup"),owrx.rcm_cluster=7,e.push("<hr>"),e.push("snap to nearest"),owrx.rcm_snap=9,e.push(" lock tuning"),owrx.rcm_lock=10,e.push("restore passband"),owrx.rcm_pb=11,e.push("save waterfall as JPG"),owrx.rcm_save=12,e.push("<hr>"),e.push('<i style="pointer-events:none">cal ADC clock (admin)</i>'),owrx.rcm_cal=14,e.push('<i style="pointer-events:none">set freq offset (admin)</i>'),owrx.rcm_foff=15,e.push('<i style="pointer-events:none">save noise defaults (admin)</i>'),owrx.rcm_noise=16,owrx.right_click_menu_content=e,w3_menu("id-right-click-menu","right_click_menu_cb");e=w3_div("id-tuning-lock-container class-overlay-container w3-hide",w3_div("id-tuning-lock",w3_icon("","fa-lock",192)+"<br>Tuning locked"));w3_create_appendElement("id-w3-misc-container","div",e)}function right_click_menu(e,t,_){owrx.debug_drag&&canvas_log("RCM"+_);var a=(dx.db+1)%dx.DB_N,_=(dx.db+2)%dx.DB_N;owrx.right_click_menu_content[owrx.rcm_db1]="DX "+dx.db_short_s[a]+" database",owrx.right_click_menu_content[owrx.rcm_db2]="DX "+dx.db_short_s[_]+" database";a=freq_displayed_Hz/1e3,_=band_info(),_=a>=_.NDB_lo&&a<_.NDB_hi?"NDB":a<_.LW_lo?"VLF/LF":a<_.MW_hi?"LW/MW":"SWBC";owrx.right_click_menu_content[owrx.rcm_lookup]=_+" database lookup",owrx.right_click_menu_content[owrx.rcm_snap]=owrx.wf_snap?"no snap":"snap to nearest",w3_menu_items("id-right-click-menu",owrx.right_click_menu_content),w3_menu_popup("id-right-click-menu",function(e,t){return"keyup"==e.type&&"Escape"==e.key||"click"==e.type&&e.button!=mouse.right||"touchend"==e.type&&!t&&!w3_contains(e.target,"w3-menu")},e,t)}function right_click_menu_cb(e,t,_){switch(e=+e){case owrx.rcm_db2:dx.db=(dx.db+1)%dx.DB_N;case owrx.rcm_db1:dx.db=(dx.db+1)%dx.DB_N,dx_database_cb("",dx.db);break;case owrx.rcm_lookup:case owrx.rcm_cluster:freq_database_lookup(canvas_get_dspfreq(t),e);break;case owrx.rcm_snap:wf_snap();break;case owrx.rcm_lock:owrx.tuning_locked^=1,owrx.right_click_menu_content[owrx.rcm_lock]=(owrx.tuning_locked?" unlock":" lock")+" tuning";break;case owrx.rcm_pb:restore_passband(cur_mode),demodulator_analog_replace(cur_mode);break;case owrx.rcm_save:export_waterfall();break;case owrx.rcm_open:case owrx.rcm_edit:var a=-1,i=e==owrx.rcm_edit&&dx.db==dx.DB_STORED&&isDefined(owrx.dx_click_gid_last_stored);i&&(a=owrx.dx_click_gid_last_stored),console.log("RCM rcm_"+(i?"edit":"open")+" gid="+a+" db="+dx.db),dx_show_edit_panel(null,a),dx_schedule_update();break;case owrx.rcm_filter:dx_filter();break;case owrx.rcm_cal:admin_pwd_query(function(){var e=Math.round(freq_displayed_Hz/1e3),t=1e3*e,_=t-freq_displayed_Hz,a=Math.round(_*ext_adc_clock_Hz()/t);console.log("cal ADC clock: dsp="+freq_displayed_Hz+" car="+freq_car_Hz+" r1k_kHz="+e+" clk_diff="+_+" clk_adj="+a);t=cfg.clk_adj+a,a=1e6*t/ext_adc_clock_Hz();console.log("cal ADC clock: prev_adj="+cfg.clk_adj+" new_adj="+t+" ppm="+a.toFixed(1)),cal_adc_dialog(t,_,e,a)});break;case owrx.rcm_foff:admin_pwd_query(function(){set_freq_offset_dialog()});break;case owrx.rcm_noise:admin_pwd_query(function(){w3_call("noise_blank_save_defaults"),w3_call("noise_filter_save_defaults")})}}function freq_database_lookup(e,t){var _,a=e/1e3,i=(Math.round(e/10),Math.round(e/1e3)),o="https://",n=band_info();t==owrx.rcm_lookup?a>=n.NDB_lo&&a<n.NDB_hi?o+="rxx.classaxe.com/en/rww/signals?types=DGPS,NAVTEX,NDB&khz="+(_=i.toFixed(0))+"&limit=-1":a<n.LW_lo?(_=Math.round(e/100)/10,console.log("kHz="+a+" f="+_),o+="www.mwlist.org/vlf.php?kHz="+_.toFixed(1)):a<n.MW_hi?(_=Math.round(i/n._9_10)*n._9_10,console.log("MW kHz="+a+" f="+_),o+="www.mwlist.org/mwlist_quick_and_easy.php?area="+[0,1,3,2][n.ITU_region]+"&kHz="+_.toFixed(0)):o+="www.short-wave.info/index.php?freq="+(_=5*Math.round(i/5)).toFixed(0)+"&timbus=NOW&ip="+client_public_ip+"&porm=4":t==owrx.rcm_cluster&&(o="http://ve3sun.com/KiwiSDR/DX.php?Search="+(_=Math.floor(e)/1e3).toFixed(1)),console.log("LOOKUP "+a+" -> "+_+" "+o);o=window.open(o,"_blank");o&&o.focus()}function export_waterfall(){var e=w3_el("id-scale-canvas"),t=waterfall_width,_=Math.round(e.height),o=50,a=w3_el("id-spectrum-canvas"),n=a&&spec.source==spec.RF?a.height:0,s=document.createElement("canvas"),r=s.getContext("2d"),l=s.width=wf_fft_size,d=s.height=50+_+n+(old_canvases.length+wf_canvases.length)*wf_canvas_default_height;if(r.fillStyle="black",r.fillRect(0,0,l,d),n&&(r.drawImage(a,0,o),o+=n),r.fillStyle="gray",r.fillRect(0,o,l,_),r.drawImage(e,0,0,t,_,0,o,l,_),o+=_,wf_canvases.forEach(function(e,t){var _=e.height,a=0;0==t&&(_+=t=unpx(e.style.top),a=-t),r.drawImage(e,0,a,l,_,0,o,l,_),o+=_}),1<old_canvases.length)for(i=1;i<old_canvases.length;i++)r.drawImage(old_canvases[i],0,o),o+=old_canvases[i].height;r.font="18px Arial",r.fillStyle="lime";t=kiwi_host()+"     "+(new Date).toUTCString()+"     "+freq_displayed_kHz_str+" kHz  "+cur_mode,_=l/2-r.measureText(t).width/2;r.fillText(t,_,35);_=s.toDataURL("image/jpeg",.85),s=document.createElement("a");s.download=kiwi_timestamp_filename("",".jpg"),s.href=_,s.target="_blank",s.dataset.downloadurl=["image/jpeg",s.download,s.href].join(":"),document.body.appendChild(s),s.click(),document.body.removeChild(s)}function zoom_finally(){w3_innerHTML("id-nav-optbar-wf","WF"+zoom_level.toFixed(0)),wf_gnd_value=wf_gnd_value_base-zoomCorrection(),extint_environment_changed({zoom:1}),freqset_select()}var ZOOM_NOMINAL=10,ZOOM_BAND=6,zoom_nom=0,zoom_old_nom=0,zoom_levels_max=0,zoom_level=0,zoom_level_f=0,zoom_freq=0,zoom_maxin_s=["id-maxin","id-maxin-nom","id-maxin-max"],x_bin=0;function zoom_step(e,t){if(wf.audioFFT_active)audioFFT_update();else{var _,a,o,n=e==ext_zoom.OUT,s=e==ext_zoom.IN,r=e!=ext_zoom.TO_BAND&&e!=ext_zoom.ABS,l=zoom_level,d=x_bin,c=!0;if(e==ext_zoom.WHEEL){if(null==t)return;var f,c=!1;if((f=Math.round(zoom_level_f))==l)return;e=l<f?ext_zoom.IN:ext_zoom.OUT}if(e==ext_zoom.MAX_OUT)n=!0,x_bin=zoom_level=0;else{if(r&&(n&&0==zoom_level||s&&zoom_levels_max<=zoom_level))return void zoom_finally();if(e==ext_zoom.TO_BAND){var w,p=center_freq+demodulators[0].offset_frequency;if(null!=t)_=t.b1,a=t.b2,zoom_level=a.zoom_level,w=a.cfHz,sb_trace&&console.log("ZTB-user f="+p+" cf="+w+" b="+_.name+" z="+a.zoom_level);else{var u=cfg.init.ITU_region+1,m=dx_cfg_db(),x=kiwi_bands_db(dx.INIT_BANDS_NO);for(i=0;i<m.bands.length&&(_=m.bands[i],a=x[i],!((_.itu==kiwi.BAND_SCALE_ONLY||_.itu==kiwi.ITU_ANY||_.itu==u)&&p>=a.minHz&&p<=a.maxHz));i++);w=i!=m.bands.length?(zoom_level=a.zoom_level,a.cfHz):(zoom_level=ZOOM_BAND,p)}n=zoom_level<l,x_bin=freq_to_bin(w),x_bin-=norm_to_bins(.5)}else if(e==ext_zoom.ABS){if(null==t)return void zoom_finally();if((f=t)<0||zoom_levels_max<f||f==zoom_level)return void zoom_finally();n=f<zoom_level,zoom_level=f,x_bin=freq_to_bin(freq_passband_center()),x_bin-=norm_to_bins(.5)}else e==ext_zoom.NOM_IN||e==ext_zoom.MAX_IN?(n=(zoom_level=e==ext_zoom.NOM_IN&&null!=t&&1==t&&zoom_nom<=zoom_level?zoom_level==zoom_levels_max?zoom_nom:zoom_levels_max:e==ext_zoom.NOM_IN?zoom_nom:zoom_levels_max)<l,x_bin=freq_to_bin(freq_passband_center()),x_bin-=norm_to_bins(.5)):(dbgUs&&(sb_trace&&console.log("ZOOM IN/OUT"),sb_trace=0),o=null!=t?t/waterfall_width:0<=(o=passband_visible())?(o-x_bin)/bins_at_cur_zoom():.5,x_bin+=norm_to_bins(o),zoom_level+=e,x_bin-=norm_to_bins(o))}c&&(zoom_level_f=zoom_level);c=zoom_level==zoom_levels_max?2:zoom_nom<=zoom_level?1:0;c!=zoom_old_nom&&(w3_hide(zoom_maxin_s[zoom_old_nom]),w3_show(zoom_maxin_s[c],"w3-show-table-cell"),zoom_old_nom=c),0!=zoom_level&&0!=l||(w3_show_hide("id-maxout",0!=zoom_level,"w3-show-table-cell"),w3_show_hide("id-maxout-max",0==zoom_level,"w3-show-table-cell")),x_bin=clamp_xbin(x_bin);c=n?d-x_bin:x_bin-d,n=bins_to_pixels(1,c,n?zoom_level:l);sb_trace&&console.log("Zs z"+l+">"+zoom_level+" b="+x_bin+"/"+d+"/"+c+" bz="+bins_at_zoom(l)+" r="+c/bins_at_zoom(l)+" px="+n);c=zoom_level-l;sb_trace&&console.log("zoom_step oz="+l+" zl="+zoom_level+" dz="+c+" pdx="+n),waterfall_zoom_canvases(c,n),mkscale(),dx_schedule_update(),sb_trace&&console.log("SET Z"+zoom_level+" xb="+x_bin),wf_send("SET zoom="+zoom_level+" start="+x_bin),need_maxmindb_update=!0,writeCookie("last_zoom",zoom_level),freq_link_update(),vfo_update(),zoom_finally()}}function passband_increment(e,t){isUndefined(t)&&(t=owrx.PB_NO_EDGE);var _=ext_get_passband(),a=Math.abs(_.high-_.low),i=e?(1.25*a-a)/2:(a-.8*a)/2,o=10<i?10:1;i=Math.round(i/o)*o,console.log("PB w="+a+" inc="+i+" lo="+_.low+" hi="+_.high+" pb_edge="+t),t!=owrx.PB_NO_EDGE&&t!=owrx.PB_RIGHT_EDGE||(_.high+=e?i:-i,_.high=Math.round(_.high/o)*o),t!=owrx.PB_NO_EDGE&&t!=owrx.PB_LEFT_EDGE||(_.low+=e?-i:i,_.low=Math.round(_.low/o)*o),ext_set_passband(_.low,_.high,!0)}function zoom_click(e,t,_){var a,i;any_alternate_click_event(e)?(i=e.currentTarget,a=w3_contains(i,"id-zoom-in"),i=w3_contains(i,"id-zoom-out"),(a||i)&&passband_increment(a,(e=shortcut_key_mod(e))==shortcut.SHIFT?owrx.PB_NO_EDGE:e==shortcut.CTL_ALT?owrx.PB_RIGHT_EDGE:owrx.PB_LEFT_EDGE)):t==ext_zoom.NOM_IN?zoom_step(t,1):zoom_step(t)}function zoom_over(e){var t,_;"IMG"==e.target.nodeName&&(t=e.target,_=e.currentTarget,_=w3_contains(_,"id-zoom-in"),(e=shortcut_key_mod(e))!=shortcut.NO_MODIFIER?(e=e==shortcut.SHIFT?0:e==shortcut.CTL_ALT?1:2,t.title=owrx.zoom_titles[e][_]):t.removeAttribute("title"))}function mobile_init(){var t=owrx.mobile=ext_mobile_info();t.small&&(toggle_or_set_hide_bars(owrx.HIDE_TOPBAR),optbar_focus("optbar-off","init")),t.narrow&&(w3_hide("id-readme"),t.width<600&&toggle_or_set_hide_bars(owrx.HIDE_ALLBARS)),owrx.last_mobile={},owrx.rescale_cnt=owrx.rescale_cnt2=0,setInterval(function(){t=owrx.mobile=ext_mobile_info(owrx.last_mobile),owrx.last_mobile=t;var e;w3_el("id-control");t.orient_unchanged||(owrx.rescale_cnt++,0!=owrx.rescale_cnt2&&toggle_panel("id-control",1),e=t.narrow&&!mobile_laptop_test,mobile_scale_control_panel(t,e))},500)}function mobile_scale_control_panel(e,t){e=e||owrx.mobile;var _=w3_el("id-control");(_.panel_isScaled=t)?(_.style.right="0px",e=e.width/_.uiWidth*.95,_.style.transform="scale("+e.toFixed(2)+")",_.style.transformOrigin="bottom right",owrx.rescale_cnt2++):_.style.transform="none"}var spec={height_spectrum_canvas:200,tooltip_offset:100,canvas:null,ctx:null,spectrum_image:null,colormap:null,colormap_transparent:null,dB:null,dB_ttip:null,update:0,last_update:0,need_update:0,need_clear_avg:0,clear_avg:0,avg:[[],[]],slow_dev_color:"#d3d3d3",SPEC_RF:0,SPEC_AF:1,TRACE_0:0,TRACE_1:1,NONE:0,RF:1,AF:2,CHOICES:3,source:0,PEAK_OFF:0,PEAK_ON:1,PEAK_HOLD:2,peak_show:[0,0],peak_clear_spec:[0,0],peak_clear_btn:[0,0],peak:[[[],[]],[[],[]]],peak1_color:"yellow",peak2_color:"magenta",peak_alpha:1,dB_bands:[],redraw_dB_scale:!1};function spectrum_init(){spec.colormap=spec.ctx.createImageData(1,spec.canvas.height),spec.colormap_transparent=spec.ctx.createImageData(1,spec.canvas.height),update_maxmindb_sliders(),spectrum_dB_bands();var e,t,_,a;kiwi_isMobile();setInterval(function(){spec.update++},100),spec.spectrum_image=spec.ctx.createImageData(spec.canvas.width,spec.canvas.height),!wf.audioFFT_active&&rx_chan>=wf_chans&&(e=spec.canvas.width,t=spec.canvas.height,spec.ctx.fillStyle="black",spec.ctx.fillRect(0,0,e,t),spec.ctx.font="18px sans-serif",spec.ctx.fillStyle="white",_=wf_chans?"Spectrum not available for rx"+rx_chan:"Spectrum not allowed on this Kiwi",a=spec.ctx.measureText(_).width,spec.ctx.fillText(_,e/2-a/2,t/2)),kiwi_load_js_dir("extensions/",["waterfall/waterfall.js","colormap/colormap.js"],function(){waterfall_init(),colormap_init()})}function spectrum_dB_bands(){spec.dB_bands=[];var e=0,t=maxdb,_=mindb;t<=_&&(t=-10,_=-110);for(var a=t-_,i=_+-12,o=(o=t-i)||1,n=0,s=0,r=10*Math.floor(t/10);_-r<10;r-=10){var l=1-(r-_)/a;1<l&&(l=1);function d(e){return Math.round(e*spec.canvas.height)}var c=Math.round((r-i)/o*255),f=color_map[c],w=color_map_transparent[c],p="#"+(f>>>8).toString(16).leadingZeros(6),c=d(n),u=d(l);if(0!=c||0!=u){spec.dB_bands[e]={dB:r,y1:c,y2:u,norm:l.toFixed(2),color:p};for(var m=c;m<u;m++){for(var x=0;x<4;x++)spec.colormap.data[4*m+x]=f>>>0>>8*(3-x)&255,spec.colormap_transparent.data[4*m+x]=w>>>0>>8*(3-x)&255;if(8192<s++)break}if(n=l,e++,8192<s++)break}}spec.redraw_dB_scale=!0,w3_call("colormap_aper")}function spectrum_tooltip_update(e,t,_){var a,i;e.target==spec.dB||e.currentTarget==spec.dB||e.target==spec.dB_ttip||e.currentTarget==spec.dB_ttip?(owrx.debug_drag&&canvas_log("*STTU*"),i=spec.height_spectrum_canvas,0<=_&&_<i&&(e=t-(kiwi_isMobile()?spec.tooltip_offset:0),spec.dB_ttip.style.left=px(e),spec.dB_ttip.style.bottom=px(i+10-_),owrx.debug_drag&&canvas_log("["+e+","+_+"]"),a=(t=spec.source==spec.RF)?format_frequency("{x}",a=(canvas_get_dspfreq(e)+kiwi.freq_offset_Hz)/1e3,1,freq_field_prec(a)):(e=e/waterfall_width-.5,format_frequency("{x}",a=(e*=(waterfall_width+spec.af_margins)/waterfall_width)*audio_input_rate/1e3,1,freq_field_prec(a))),i=(i-_)/i*full_scale+mindb,spec.dB_ttip.innerHTML=a+" kHz"+(t?"":" AF")+"<br>"+i.toFixed(0)+" dBm")):owrx.debug_drag&&canvas_log("STTU-ck")}function spectrum_update(e){if(spec.source!=spec.NONE){var t,_,a;spec.last_update=spec.update;var i=spec.ctx,o=spec.canvas.width,n=o-25,s=spec.source==spec.RF?n:o,r=spec.canvas.height;for(w3_visible("id-spectrum-af-canvas",spec.source==spec.AF),i.fillStyle="black",i.fillRect(0,0,n,r),spec.af_ctx.fillStyle="black",spec.af_ctx.fillRect(0,0,spec.canvas.width,r),i.fillStyle="lightGray",spec.af_ctx.fillStyle="lightGray",p=0;p<spec.dB_bands.length;p++){var l=spec.dB_bands[p],d=Math.round(l.norm*r);i.fillRect(0,d,n,1),spec.af_ctx.fillRect(0,d,o,1)}if(spec.source==spec.AF){for(var c=ext_nom_sample_rate(),f=c%1e3,w=c-f-1e3,p=1e3+f/2;p<=w+f/2;p+=1e3)_=Math.round(spec.canvas.width*p/c),spec.af_ctx.fillRect(_,0,1,r);spec.af_ctx.fillStyle="lime",spec.af_ctx.fillRect(Math.round(spec.canvas.width/2)-1,0,3,r),spec.af_ctx.fillStyle="red",spec.af_ctx.fillRect(0,0,3,r),spec.af_ctx.fillRect(spec.canvas.width-3,0,3,r)}var u=spec.source==spec.RF?spec.SPEC_RF:spec.SPEC_AF;if(spec.clear_avg||isNaN(spec.avg[u][0])){for(_=0;_<s;_++)spec.avg[u][_]=color_index(e[_]);spec.clear_avg=!1,spec.peak_clear_spec[1]=spec.peak_clear_spec[0]=!0}for(t=0;t<2;t++){if(spec.peak_clear_spec[t]){for(_=0;_<n;_++)spec.peak[spec.SPEC_RF][t][_]=0;for(_=0;_<o;_++)spec.peak[spec.SPEC_AF][t][_]=0;spec.peak_clear_spec[t]=!1}if(spec.peak_clear_btn[t]){for(_=0;_<s;_++)spec.peak[u][t][_]=0;spec.peak_clear_btn[t]=!1}}if(spec.redraw_dB_scale){for(_=n;_<spec.canvas.width;_++)i.putImageData(spec.colormap_transparent,_,0,0,0,1,r);for(i.fillStyle="white",p=0;p<spec.dB_bands.length;p++){l=spec.dB_bands[p];d=Math.round(l.norm*r),i.fillText(l.dB,3+n,d-4)}spec.redraw_dB_scale=!1}for(spec.source==spec.AF&&(i=spec.af_ctx),spectrum_slow_dev&&(i.fillStyle=spec.slow_dev_color),_=0;_<s;_++){switch(a=color_index(wf_gnd?wf_gnd_value:e[_]),spec_filter){case wf_sp_menu_e.IIR:var m=1-Math.exp(-sp_param*a/255);m<=.01&&(m=.01);var x=spec.avg[u][_];255<(x+=m*(a-x))&&(x=255),x<0&&(x=0),a=spec.avg[u][_]=x;break;case wf_sp_menu_e.MMA:255<a&&(a=255),a<0&&(a=0),spec.avg[u][_]=(spec.avg[u][_]*(sp_param-1)+a)/sp_param,a=spec.avg[u][_];break;case wf_sp_menu_e.EMA:255<a&&(a=255),a<0&&(a=0),spec.avg[u][_]+=(a-spec.avg[u][_])/sp_param,a=spec.avg[u][_];break;case wf_sp_menu_e.OFF:default:255<a&&(a=255),a<0&&(a=0)}for(t=0;t<2;t++)spec.peak_show[t]==spec.PEAK_ON&&a>spec.peak[u][t][_]&&(spec.peak[u][t][_]=a);if(d=Math.round((1-a/255)*r),spectrum_slow_dev)i.fillRect(_,d,1,r-d);else{var h=!0;for(p=0;p<spec.dB_bands.length;p++){var b,g=spec.dB_bands[p];h&&d>g.y2||(h=!1,i.fillStyle=g.color,b=g.y2-d,i.fillRect(_,d,1,b),d=g.y2)}}}for(t=0;t<2;t++)if(spec.peak_show[t]!=spec.PEAK_OFF){for(i.lineWidth=1,i.strokeStyle=t?spec.peak2_color:spec.peak1_color,i.beginPath(),d=Math.round((1-spec.peak[u][t][0]/255)*r)-1,i.moveTo(0,d),_=1;_<s;_++)d=Math.round((1-spec.peak[u][t][_]/255)*r)-1,i.lineTo(_,d);i.globalAlpha=spec.peak_alpha,i.stroke(),i.globalAlpha=1}spec.switch_container&&(w3_show_hide("id-spectrum-container",!0),w3_show_hide("id-top-container",!1),spec.switch_container=!1)}}var waterfall_timer,waterfall_ms,waterfall_scrollable_height,wf_canvas_actual_line,waterfall_setup_done=0,wf_canvases=[],old_canvases=[],wf_cur_canvas=null,wf_canvas_default_height=200,wf_canvas_id_seq=1,wf_canvas_maxshift=0;function wf_init(){w3_do_when_cond(function(){return okay_wf_init},function(){wf_init_ready()},null,200)}function wf_init_ready(){init_wf_container(),wf.audioFFT_active=rx_chan>=wf_chans,resize_waterfall_container(!1),resize_wf_canvases(),bands_init(),panels_setup(),scale_setup(),mkcolormap(),mkscale(),spectrum_init(),dx_schedule_update(),users_init({user:1}),ident_init(),stats_init(),check_top_bar_congestion(),spectrum_show&&setTimeout(spec_show,2e3),audioFFT_setup(),waterfall_ms=900/wf_fps_max,waterfall_timer=window.setInterval(waterfall_dequeue,waterfall_ms),isNonEmptyArray(shortcut.keys)&&!override_ext&&setTimeout(keyboard_shortcut_url_keys,5e3),wf_snap(kiwi_storeGet("wf_snap")),kiwi_isMobile()&&mobile_init(),dx_init(),waterfall_setup_done=1}function add_wf_canvas(){var e=create_canvas("id-wf-canvas",wf_fft_size,wf_canvas_default_height,waterfall_width,wf_canvas_default_height);e.id_seq=wf_canvas_id_seq++,wf_canvas_actual_line=wf_canvas_default_height-1,e.style.left=0,e.openwebrx_height=wf_canvas_default_height,e.openwebrx_top=1-wf_canvas_default_height,e.style.top=px(e.openwebrx_top),e.oneline_image=e.ctx.createImageData(wf_fft_size,1),wf_container.appendChild(e),add_canvas_listener(e),wf_canvases.unshift(e),wf_cur_canvas=e,kiwi_gc_wf&&(e=null)}function wf_shift_canvases(){for(wf_canvases.forEach(function(e){e.style.top=px(e.openwebrx_top++)});wf_canvases.length;){var e=wf_canvases[wf_canvases.length-1];if(null==e||e.openwebrx_top<waterfall_scrollable_height){kiwi_gc_wf&&(e=null);break}var t=wf_canvases[wf_canvases.length-2];t&&old_canvases.unshift(t),15<old_canvases.length&&old_canvases.pop(),kiwi_gc_wf&&remove_canvas_listener(e),wf_container.removeChild(e),kiwi_gc_wf&&(e=wf_canvases[wf_canvases.length-1]=null),wf_canvases.pop()}++wf_canvas_maxshift<wf_container.clientHeight?(canvas_phantom.style.top=px(wf_canvas_maxshift),canvas_phantom.style.height=px(wf_container.clientHeight-wf_canvas_maxshift),w3_show_block(canvas_phantom)):canvas_phantom.hidden||(w3_hide(canvas_phantom),canvas_phantom.hidden=!0)}function resize_wf_canvases(){window_width=wf_container.innerWidth,waterfall_width=wf_container.clientWidth,new_width=px(waterfall_width);var e;wf_canvases.forEach(function(e){e.style.width=new_width,e.style.left=0}),canvas_annotation.width=waterfall_width,canvas_annotation.style.width=new_width,canvas_phantom.style.width=new_width,canvas_phantom.style.left=0,spec.canvas.style.width=new_width,wf.audioFFT_active&&!kiwi_isMobile()&&(e=wf.no_wf?'when "no_wf" URL option used.':0==wf_chans?"because all waterfalls disabled<br>on this Kiwi.":"on channels "+wf_chans_real+"-"+(rx_chans-1)+" of Kiwis<br>configured for "+rx_chans+" channels.",w3_innerHTML("id-annotation-div",w3_div("w3-section w3-container",w3_text("w3-large|color:cyan","Audio FFT<br>"),w3_text("w3-small|color:cyan","Zoom waterfall not available<br>"+e),w3_text("w3-small|color:cyan","<br>For details see the Kiwi forum."))))}function waterfall_timestamp(){var e,t=0==wf.ts_tz?(new Date).toUTCString().substr(17,8)+" UTC":(new Date).toString().substr(16,8)+" L",_=wf_canvas_actual_line,a=wf_cur_canvas;w3_fillText_shadow(a,t,12,_+12,"Arial",14,"lime"),_+10>a.height&&((e=wf_canvases[1])&&w3_fillText_shadow(e,t,12,_-a.height+12,"Arial",14,"lime"))}function wf_snap(e){owrx.wf_snap=isUndefined(e)?1^owrx.wf_snap:isNull(e)?0:+e,w3_el("id-waterfall-container").style.cursor=owrx.wf_cursor=owrx.wf_snap?"col-resize":"crosshair",kiwi_storeSet("wf_snap",owrx.wf_snap)}var page_scroll_amount=.8;function page_scroll(e){wf.audioFFT_active||waterfall_pan_canvases(norm_to_bins(e)),freqset_select()}function page_scroll_icon_click(e,t){any_alternate_click_event(e)?dx_label_step(t<0?-1:1):page_scroll(t)}var x_bin_server_last,waterfall_dont_scale=0,need_maxmindb_update=!1,need_clear_wf_sp_avg=!1,need_clear_wfavg=!1,clear_wfavg=!0,wfavg=[],wf_swallow_samples=[2,4,8,18],wf_swallow=0;function waterfall_add(e,t){var _;if(null!=e){var a=wf_cur_canvas;if(null!=a){var i,o=wf_fft_size;if(0==t){var n=new Uint32Array(e,4,3),s=n[0],r=n[1];kiwi_gc_wf&&(n=null);var l,d=65535&r,c=r>>16&65535,f=1,w=2,r=(n=new Uint8Array(e,16)).length;if(need_maxmindb_update&&zoom_level==d&&(update_maxmindb_sliders(),need_maxmindb_update=!1),x_bin==s&&zoom_level==d&&((need_clear_wf_sp_avg||spec.need_clear_avg)&&(spec.clear_avg=!0),(need_clear_wf_sp_avg||need_clear_wfavg)&&(clear_wfavg=!0),need_clear_wf_sp_avg=need_clear_wfavg=spec.need_clear_avg=!1),l=c&f?(i=new Uint8Array(2*r),decode_ima_adpcm_e8_u8(n,i,r,{index:0,previousValue:0}),i.subarray(10)):n,wf.no_sync=c&w,wf_swallow)return void wf_swallow--;s!=x_bin_server_last&&(x_bin_server_last=s,11<=zoom_level&&(wf_swallow=wf_swallow_samples[zoom_level-11],wf_fps!=wf_fps_max&&(wf_swallow=Math.round(wf_swallow*wf_fps/wf_fps_max))))}else l=e,spec.source==spec.RF&&spec.need_clear_avg&&(spec.clear_avg=!0,spec.need_clear_avg=!1);spec.source==spec.RF&&spec.update!=spec.last_update&&spectrum_update(l);for(var p=a.oneline_image,u=0;u<o;u++){switch(_=color_index(wf_gnd?wf_gnd_value:l[u],wf.sqrt),wf_filter){case wf_sp_menu_e.IIR:clear_wfavg&&(wfavg[u]=_);var m=1-Math.exp(-wf_param*_/255);m<=.01&&(m=.01);var x=wfavg[u];255<(x+=m*(_-x))&&(x=255),x<0&&(x=0),wfavg[u]=x,_=Math.round(wfavg[u]);break;case wf_sp_menu_e.MMA:clear_wfavg&&(wfavg[u]=_),wfavg[u]=(wfavg[u]*(wf_param-1)+_)/wf_param,_=Math.round(wfavg[u]);break;case wf_sp_menu_e.EMA:clear_wfavg&&(wfavg[u]=_),wfavg[u]+=(_-wfavg[u])/wf_param,_=Math.round(wfavg[u]);break;case wf_sp_menu_e.OFF:}p.data[4*u]=color_map_r[_],p.data[4*u+1]=color_map_g[_],p.data[4*u+2]=color_map_b[_],p.data[4*u+3]=255}clear_wfavg=clear_wfavg&&!1,a.ctx.putImageData(p,0,wf_canvas_actual_line),0==t&&w3_call("IBP_scan_plot",p),"undefined"!=typeof wfext&&wfext.tstamp&&(b=(60*(h=new Date).getUTCMinutes()+h.getUTCSeconds())%wfext.tstamp==0,0==wf.prev_sec_mark&&1==b&&waterfall_timestamp(),wf.prev_sec_mark=b);var h,b,g,w=!1;if(0!=t||wf.no_sync||(sb_trace&&console.log("WF fixup bin="+x_bin+"/"+s+" z="+zoom_level+"/"+d),zoom_level!=d&&(g=bins_to_pixels(2,t=(b=(h=zoom_level-d)<0)?s-x_bin:x_bin-s,b?zoom_level:d),sb_trace&&console.log("WF Z fix z"+d+">"+zoom_level+" out="+b+" b="+x_bin+"/"+s+"/"+t+" px="+g),waterfall_zoom(a,h,wf_canvas_actual_line,g),s+=b?-t:t,sb_trace&&console.log("WF z fixed"),w=!0),x_bin!=s&&(g=bins_to_pixels(3,x_bin-s,zoom_level),sb_trace&&console.log("WF bin fix L="+wf_canvas_actual_line+" xb="+x_bin+" xbs="+s+" pdx="+g),waterfall_pan(a,wf_canvas_actual_line,g),sb_trace&&console.log("WF bin fixed"),w=!0),sb_trace&&x_bin==s&&zoom_level==d&&(console.log("--WF FIXUP ALL DONE--"),sb_trace=0)),1<wf.need_autoscale&&wf.need_autoscale--,1==wf.need_autoscale&&!w){for(var v=[],k=wf.audioFFT_active?l.slice(256,768):l,y=k.length,q=0,T=0;T<y;T++){var E=dB_wire_to_dBm(k[T]);E<=-190||(v[q]=E,q++)}var S,M,s=v.length;s?(v.sort(function(e,t){return e-t}),S=v[Math.floor(.5*s)],M=v[Math.floor(.95*s)],console_log_dbgUs("# autoscale len="+s+" min="+v[0]+" noise="+S+" signal="+M+" max="+v[s-1]),d=v[Math.floor(.1*s)],w=v[Math.floor(.2*s)],console_log_dbgUs("# autoscale min="+v[0]+" 10%="+d+" 20%="+w+" 50%(noise)="+S+" 95%(signal)="+M+" max="+v[s-1])):(M=-110,S=-120),(M+=30)<-80&&(M=-80),S-=10,wf.audioFFT_active&&(S=dbgUs&&devl.p4?Math.round(devl.p4):-110,console_log_dbgUs("audioFFT_active: force noise = "+S.toFixed(0)+" dBm")),setmaxdb(1,M),setmindb(1,S),update_maxmindb_sliders(),wf.need_autoscale=0}wf_canvas_actual_line--,wf_shift_canvases(),wf_canvas_actual_line<0&&add_wf_canvas(),kiwi_gc_wf&&(a=e=n=i=l=null)}}}function waterfall_pan(e,t,_){function a(e,t,_){return e<t?t:_<e?_:e}var i,o,n=e.ctx,s=e.width,r=-1==t?(i=0,e.height):(i=t,1);try{sb_trace&&console.log("waterfall_pan h="+r+" dx="+_),_<0?(o=s-(_=-_),sb_trace&&console.log("PAN-L w="+o+" dx="+_),0<o&&n.drawImage(e,0,i,o,r,_,i,o,r),n.fillStyle="Black",sb_trace&&(n.fillStyle=-1==t?"Lime":"Red"),fx=a(_,0,s),n.fillRect(0,i,fx,r)):(o=s-_,sb_trace&&console.log("PAN-R w="+o+" dx="+_),0<o&&n.drawImage(e,_,i,o,r,0,i,o,r),n.fillStyle="Black",sb_trace&&(n.fillStyle=-1==t?"Lime":"Red"),fx=a(o,0,s),n.fillRect(fx,i,s,r))}catch(e){console.log("EX WFPAN "+e.toString()+" dx="+_+" y="+i+" w="+o+" h="+r)}}var last_pixels_frac=0;function waterfall_pan_canvases(e){var t,_;e&&(wf.audioFFT_active||(t=x_bin,e=bins_to_pixels_frac(4,(x_bin=clamp_xbin(x_bin+=e))-t,zoom_level)+last_pixels_frac,_=Math.round(e),last_pixels_frac=e-_,sb_trace&&console.log("PAN-CAN z="+zoom_level+" xb="+x_bin+" db="+(x_bin-t)+" f_dx="+e+" i_dx="+_+" lpf="+last_pixels_frac),_&&(wf_canvases.forEach(function(e){waterfall_pan(e,-1,_)}),wf_send("SET zoom="+zoom_level+" start="+x_bin),mkscale(),need_clear_wf_sp_avg=!0,dx_schedule_update(),extint_environment_changed({waterfall_pan:1}),passband_visible()<0&&check_band(!0))))}function waterfall_zoom(e,t,_,a){function i(e,t,_){return e<t?t:_<e?_:e}var o,n,s,r,l=e.ctx,d=e.width,c=1<<Math.abs(t),f=d/c,w=-1==_?(n=0,e.height):(n=_,1);try{sb_trace&&console.log("waterfall_zoom w="+d+" h="+w+" pw="+f+" zf="+c),t<0?(sb_trace&&console.log("WFZ-out srcX=0/"+d+" dstX="+a+"/"+(a+f)+" (pw="+f+")"),l.drawImage(e,0,n,d,w,a,n,f,w),l.fillStyle="Black",sb_trace&&(console.log("chocolate 0:"+a),l.fillStyle="chocolate"),o=i(a,0,d),l.fillRect(0,n,o,n+w),sb_trace&&(console.log("brown "+(a+f)+":"+d),l.fillStyle="brown"),o=i(a+f,0,d),l.fillRect(o,n,d,n+w)):0!=d&&(sb_trace&&console.log("WFZ-in srcX="+a+"/"+(a+f)+"(pw="+f+") dstX=0/"+d),r=s=!1,d<a+f&&(o=Math.round((d-a)*c),sb_trace&&console.log("CLAMP HI fx="+o),s=!0),a<0&&(o=Math.round(-a*c),sb_trace&&console.log("CLAMP LO fx="+o),r=!0),l.drawImage(e,a,n,f,w,0,n,d,w),l.fillStyle="Black",sb_trace&&(l.fillStyle="deepPink"),s&&l.fillRect(o,n,d,n+w),r&&l.fillRect(0,n,o,n+w))}catch(e){console.log("EX WFZ "+e.toString()+" dz="+t+" x="+a+" y="+n+" w="+d+" h="+w)}}function waterfall_zoom_canvases(t,_){sb_trace&&console.log("ZOOM-CAN z"+zoom_level+" xb="+x_bin+" x="+_),wf_canvases.forEach(function(e){waterfall_zoom(e,t,-1,_)}),need_clear_wf_sp_avg=!0}function waterfall_height(){var e=w3_el("id-top-container").clientHeight,t=w3_el("id-non-waterfall-container").clientHeight,_=w3_el("id-scale-container").clientHeight;return owrx.scale_offsetY=e+t-_,window.innerHeight-e-t}function resize_waterfall_container(e){e&&!waterfall_setup_done||(e=waterfall_height(),waterfall_scrollable_height=0<=e?(canvas_annotation.style.height=wf_container.style.height=px(e),(canvas_annotation.height=e)*wf.scroll_multiple):0)}var waterfall_delay=0,waterfall_queue=[],waterfall_last_add=0;function waterfall_add_queue(e,t,_){if("DAT"!=_){var a=new Uint32Array(e,4,3)[2];kiwi_gc_wf&&0;var i=Date.now(),_=waterfall_last_add?i-waterfall_last_add:0;waterfall_last_add=i,waterfall_queue.push({data:e,audioFFT:0,seq:a,spacing:_}),kiwi_gc_wf&&(e=null)}else{var o=new Uint8Array(e,4),e=o[0];if(0==e){for(var n=0;n<768;n++)downloaded_colormap[n]=o[n+1];mkcolormap(),console.log("W/F DAT downloaded_colormap")}else console.log("W/F DAT unknown cmd="+e)}}var init_zoom_set=!1,waterfall_last_out=0,wf_dq_onesec=0;function waterfall_dequeue(){if(!init_zoom_set&&demodulators[0]&&(init_zoom=parseInt(init_zoom),(init_zoom<0||init_zoom>zoom_levels_max)&&(init_zoom=0),zoom_step(ext_zoom.ABS,init_zoom),init_zoom_set=!0),waterfall_setup_done&&0!=waterfall_queue.length)for(;0!=waterfall_queue.length;){var e=Date.now();if(!wf.no_sync){var t=waterfall_queue[0].seq;if(audio_ext_sequence+waterfall_delay<t)return;if(t==audio_ext_sequence&&e<waterfall_last_out+waterfall_queue[0].spacing)return}waterfall_last_out=e;t=waterfall_queue[0].data;kiwi_gc_wf&&(waterfall_queue[0].data=null);e=waterfall_queue[0].audioFFT;waterfall_queue.shift(),waterfall_add(t,e),kiwi_gc_wf&&0}}var downloaded_colormap=new Uint8Array(768);turbo_colormap_data=[.18995,.07176,.23217,.19483,.08339,.26149,.19956,.09498,.29024,.20415,.10652,.31844,.2086,.11802,.34607,.21291,.12947,.37314,.21708,.14087,.39964,.22111,.15223,.42558,.225,.16354,.45096,.22875,.17481,.47578,.23236,.18603,.50004,.23582,.1972,.52373,.23915,.20833,.54686,.24234,.21941,.56942,.24539,.23044,.59142,.2483,.24143,.61286,.25107,.25237,.63374,.25369,.26327,.65406,.25618,.27412,.67381,.25853,.28492,.693,.26074,.29568,.71162,.2628,.30639,.72968,.26473,.31706,.74718,.26652,.32768,.76412,.26816,.33825,.7805,.26967,.34878,.79631,.27103,.35926,.81156,.27226,.3697,.82624,.27334,.38008,.84037,.27429,.39043,.85393,.27509,.40072,.86692,.27576,.41097,.87936,.27628,.42118,.89123,.27667,.43134,.90254,.27691,.44145,.91328,.27701,.45152,.92347,.27698,.46153,.93309,.2768,.47151,.94214,.27648,.48144,.95064,.27603,.49132,.95857,.27543,.50115,.96594,.27469,.51094,.97275,.27381,.52069,.97899,.27273,.5304,.98461,.27106,.54015,.9893,.26878,.54995,.99303,.26592,.55979,.99583,.26252,.56967,.99773,.25862,.57958,.99876,.25425,.5895,.99896,.24946,.59943,.99835,.24427,.60937,.99697,.23874,.61931,.99485,.23288,.62923,.99202,.22676,.63913,.98851,.22039,.64901,.98436,.21382,.65886,.97959,.20708,.66866,.97423,.20021,.67842,.96833,.19326,.68812,.9619,.18625,.69775,.95498,.17923,.70732,.94761,.17223,.7168,.93981,.16529,.7262,.93161,.15844,.73551,.92305,.15173,.74472,.91416,.14519,.75381,.90496,.13886,.76279,.8955,.13278,.77165,.8858,.12698,.78037,.8759,.12151,.78896,.86581,.11639,.7974,.85559,.11167,.80569,.84525,.10738,.81381,.83484,.10357,.82177,.82437,.10026,.82955,.81389,.0975,.83714,.80342,.09532,.84455,.79299,.09377,.85175,.78264,.09287,.85875,.7724,.09267,.86554,.7623,.0932,.87211,.75237,.09451,.87844,.74265,.09662,.88454,.73316,.09958,.8904,.72393,.10342,.896,.715,.10815,.90142,.70599,.11374,.90673,.69651,.12014,.91193,.6866,.12733,.91701,.67627,.13526,.92197,.66556,.14391,.9268,.65448,.15323,.93151,.64308,.16319,.93609,.63137,.17377,.94053,.61938,.18491,.94484,.60713,.19659,.94901,.59466,.20877,.95304,.58199,.22142,.95692,.56914,.23449,.96065,.55614,.24797,.96423,.54303,.2618,.96765,.52981,.27597,.97092,.51653,.29042,.97403,.50321,.30513,.97697,.48987,.32006,.97974,.47654,.33517,.98234,.46325,.35043,.98477,.45002,.36581,.98702,.43688,.38127,.98909,.42386,.39678,.99098,.41098,.41229,.99268,.39826,.42778,.99419,.38575,.44321,.99551,.37345,.45854,.99663,.3614,.47375,.99755,.34963,.48879,.99828,.33816,.50362,.99879,.32701,.51822,.9991,.31622,.53255,.99919,.30581,.54658,.99907,.29581,.56026,.99873,.28623,.57357,.99817,.27712,.58646,.99739,.26849,.59891,.99638,.26038,.61088,.99514,.2528,.62233,.99366,.24579,.63323,.99195,.23937,.64362,.98999,.23356,.65394,.98775,.22835,.66428,.98524,.2237,.67462,.98246,.2196,.68494,.97941,.21602,.69525,.9761,.21294,.70553,.97255,.21032,.71577,.96875,.20815,.72596,.9647,.2064,.7361,.96043,.20504,.74617,.95593,.20406,.75617,.95121,.20343,.76608,.94627,.20311,.77591,.94113,.2031,.78563,.93579,.20336,.79524,.93025,.20386,.80473,.92452,.20459,.8141,.91861,.20552,.82333,.91253,.20663,.83241,.90627,.20788,.84133,.89986,.20926,.8501,.89328,.21074,.85868,.88655,.2123,.86709,.87968,.21391,.8753,.87267,.21555,.88331,.86553,.21719,.89112,.85826,.2188,.8987,.85087,.22038,.90605,.84337,.22188,.91317,.83576,.22328,.92004,.82806,.22456,.92666,.82025,.2257,.93301,.81236,.22667,.93909,.80439,.22744,.94489,.79634,.228,.95039,.78823,.22831,.9556,.78005,.22836,.96049,.77181,.22811,.96507,.76352,.22754,.96931,.75519,.22663,.97323,.74682,.22536,.97679,.73842,.22369,.98,.73,.22161,.98289,.7214,.21918,.98549,.7125,.2165,.98781,.7033,.21358,.98986,.69382,.21043,.99163,.68408,.20706,.99314,.67408,.20348,.99438,.66386,.19971,.99535,.65341,.19577,.99607,.64277,.19165,.99654,.63193,.18738,.99675,.62093,.18297,.99672,.60977,.17842,.99644,.59846,.17376,.99593,.58703,.16899,.99517,.57549,.16412,.99419,.56386,.15918,.99297,.55214,.15417,.99153,.54036,.1491,.98987,.52854,.14398,.98799,.51667,.13883,.9859,.50479,.13367,.9836,.49291,.12849,.98108,.48104,.12332,.97837,.4692,.11817,.97545,.4574,.11305,.97234,.44565,.10797,.96904,.43399,.10294,.96555,.42241,.09798,.96187,.41093,.0931,.95801,.39958,.08831,.95398,.38836,.08362,.94977,.37729,.07905,.94538,.36638,.07461,.94084,.35566,.07031,.93612,.34513,.06616,.93125,.33482,.06218,.92623,.32473,.05837,.92105,.31489,.05475,.91572,.3053,.05134,.91024,.29599,.04814,.90463,.28696,.04516,.89888,.27824,.04243,.89298,.26981,.03993,.88691,.26152,.03753,.88066,.25334,.03521,.87422,.24526,.03297,.8676,.2373,.03082,.86079,.22945,.02875,.8538,.2217,.02677,.84662,.21407,.02487,.83926,.20654,.02305,.83172,.19912,.02131,.82399,.19182,.01966,.81608,.18462,.01809,.80799,.17753,.0166,.79971,.17055,.0152,.79125,.16368,.01387,.7826,.15693,.01264,.77377,.15028,.01148,.76476,.14374,.01041,.75556,.13731,.00942,.74617,.13098,.00851,.73661,.12477,.00769,.72686,.11867,.00695,.71692,.11268,.00629,.7068,.1068,.00571,.6965,.10102,.00522,.68602,.09536,.00481,.67535,.0898,.00449,.66449,.08436,.00424,.65345,.07902,.00408,.64223,.0738,.00401,.63082,.06868,.00401,.61923,.06367,.0041,.60746,.05878,.00427,.5955,.05399,.00453,.58336,.04931,.00486,.57103,.04474,.00529,.55852,.04028,.00579,.54583,.03593,.00638,.53295,.03169,.00705,.51989,.02756,.0078,.50664,.02354,.00863,.49321,.01963,.00955,.4796,.01583,.01055];var spectrum_scale_color_map_transparency=200,color_map=new Uint32Array(256),color_map_transparent=new Uint32Array(256),color_map_r=new Uint8Array(256),color_map_g=new Uint8Array(256),color_map_b=new Uint8Array(256);function mkcolormap(){var e;wf.cmap>=kiwi.cmap_e.custom_1&&(e=wf.custom_colormaps[wf.cmap-kiwi.cmap_e.custom_1]);for(var t,_,a,i,o,n,s=0;s<256;s++){switch(wf.cmap){case kiwi.cmap_e.kiwi:n=s<32?(o=r=0,255*s/31):s<72?(r=0,o=255*(s-32)/39,255):s<96?(r=0,(o=255)-255*(s-72)/23):s<116?(r=255*(s-96)/19,o=255,0):s<184?(o=(r=255)-255*(s-116)/67,0):(r=255,o=0,128*(s-184)/70);break;case kiwi.cmap_e.CuteSDR:n=s<43?(o=r=0,255*s/43):s<87?(r=0,o=255*(s-43)/43,255):s<120?(r=0,(o=255)-255*(s-87)/32):s<154?(r=255*(s-120)/33,o=255,0):s<217?(o=(r=255)-255*(s-154)/62,0):(r=255,o=0,128*(s-217)/38);break;case kiwi.cmap_e.greyscale:black_level=0,white_level=48;var r=o=n=black_level+(255-black_level+white_level)*s/255;break;case kiwi.cmap_e.linear:r=255*(s/255)+0*((255-s)/255),r*=1+s/255*0,o=0*(s/255)+255*((255-s)/255),o*=1+s/255*0,n=255*(s/255)+0*((255-s)/255),n*=1+s/255*0;break;case kiwi.cmap_e.turbo:r=255*turbo_colormap_data[3*s+0],o=255*turbo_colormap_data[3*s+1],n=255*turbo_colormap_data[3*s+2];break;case kiwi.cmap_e.SdrDx:l=s<=20?(n=.5,i=o=r=a=_=t=0,20):s<=60?(a=.5,o=r=_=t=0,n=1,i=21,60):s<=150?(o=r=a=1,n=_=t=0,i=61,150):s<=180?(r=_=t=1,n=o=a=0,i=151,180):s<=210?(a=_=0,n=o=r=t=1,i=181,210):(n=o=r=a=_=t=1,i=211,255);var l=(s-i)/(l-i);r=255*(t+(r-t)*l),o=255*(_+(o-_)*l),n=255*(a+(n-a)*l);break;default:r=e[3*s+0],o=e[3*s+1],n=e[3*s+2]}r=Math.round(r),r=w3_clamp(r,0,255),o=Math.round(o),o=w3_clamp(o,0,255),n=Math.round(n),n=w3_clamp(n,0,255),color_map[s]=r<<24|o<<16|n<<8|255,color_map_transparent[s]=r<<24|o<<16|n<<8|spectrum_scale_color_map_transparency,color_map_r[s]=r,color_map_g[s]=o,color_map_b[s]=n}}function dB_wire_to_dBm(e){return e<0&&(e=0),255<e&&(e=255),-(255-e)+cfg.waterfall_cal}function color_index(e,t){e=dB_wire_to_dBm(e);e<mindb&&(e=mindb),maxdb<e&&(e=maxdb);var _=(e-mindb)/full_scale,a=_;if(isDefined(t))try{switch(+t){case 0:default:break;case 1:a=Math.sqrt(_);break;case 2:.21<_&&_<.5&&(a=.2+.09*(4+Math.log10(_-.2)));break;case 3:.31<_&&_<.6&&(a=.3+.07*(5+Math.log10(_-.3)));break;case 4:.41<_&&_<.7&&(a=.4+.055*(6+Math.log10(_-.4)))}}catch(e){a=_}e=255*a;return(e=Math.round(e))<0&&(e=0),255<e&&(e=255),e}function waterfall_color_index_max_min(e,t,_){(e=-(255-e))<_&&(e=_),t<e&&(e=t);t-=_,t=255*((e-_)/(t=t||1));return(t=Math.round(t))<0&&(t=0),255<t&&(t=255),t}function color_index_max_min(e,t,_){e<_&&(e=_),t<e&&(e=t);t-=_,t=255*((e-_)/(t=t||1));return(t=Math.round(t))<0&&(t=0),255<t&&(t=255),t}var freq_displayed_Hz,freq_displayed_kHz_str,freq_displayed_kHz_str_with_freq_offset,freq_car_Hz,freqset_tout,freq_dsp_set_last,afft={init:!1,comp_1x:!1,prev_lsb:!1,audioFFT_dynload:{},offt:0,i_re:0,i_im:0,o_re:0,o_im:0,window_512:[],window_1k:[],window_2k:[],pwr_dB:[],dBi:[],CUTESDR_MAX_VAL:32767};function audioFFT_setup(){if(wf.audioFFT_active){var e,t;zoom_level=0,wf.aper!=kiwi.aper_e.auto&&(e=readCookie("last_AF_max_dB",maxdb),t=readCookie("last_AF_min_dB",mindb_un),setmaxdb(1,e),setmindb(1,t),update_maxmindb_sliders());function _(e,t){return.5-.5*Math.cos(2*Math.PI*e/(t-1))}for(i=0;i<512;i++)afft.window_512[i]=_(i,512);for(i=0;i<1024;i++)afft.window_1k[i]=_(i,1024);for(i=0;i<2048;i++)afft.window_2k[i]=_(i,2048)}}function audioFFT_update(){mkscale(),dx_schedule_update(),freq_link_update(),w3_innerHTML("id-nav-optbar-wf","WF"),freqset_select(),wf.audioFFT_clear_wf&&(wf_canvases.forEach(function(e){e.ctx.fillStyle="Black",e.ctx.fillRect(0,0,e.width,e.height)}),spec.need_clear_avg=!0,wf.audioFFT_clear_wf=!1,wf.aper==kiwi.aper_e.auto&&wf.audioFFT_active&&(wf.need_autoscale=16))}function wf_audio_FFT(e,t){if(wf.audioFFT_active&&isDefined(cur_mode)&&kiwi_load_js_polled(afft.audioFFT_dynload,"pkgs/js/Ooura_FFT32.js")){var _,a,i,o,n=ext_is_IQ_or_stereo_curmode(),s=ext_mode(cur_mode).LSB_SAL,r=!afft.init||n!=afft.iq||audio_compression!=afft.comp;if(r&&(console.log("audio_FFT: SWITCHING iq="+n+" comp="+audio_compression),n?(afft.size=1024,afft.offt=ooura32.FFT(afft.size,{type:"complex",radix:4}),afft.i_re=ooura32.vectorArrayFactory(afft.offt),afft.i_im=ooura32.vectorArrayFactory(afft.offt)):(afft.size=audio_compression?afft.comp_1x?2048:1024:512,afft.offt=ooura32.FFT(afft.size,{type:"real",radix:4}),afft.i_re=ooura32.scalarArrayFactory(afft.offt)),afft.o_re=ooura32.vectorArrayFactory(afft.offt),afft.o_im=ooura32.vectorArrayFactory(afft.offt),afft.scale=20/(afft.size*afft.size*afft.size*afft.CUTESDR_MAX_VAL*afft.CUTESDR_MAX_VAL),afft.init||wf.aper==kiwi.aper_e.auto||""!=wf_mm||(wf.need_autoscale=16),afft.iq=n,afft.comp=audio_compression,afft.init=!0),r||s!=afft.prev_lsb){for(_=0;_<1024;_++)afft.pwr_dB[_]=0;afft.prev_lsb=s}if(afft.iq){for(a=_=0;_<1024;_+=2,a++)afft.i_re[a]=e[_]*afft.window_512[a],afft.i_im[a]=e[_+1]*afft.window_512[a];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.i_im.buffer,afft.o_re.buffer,afft.o_im.buffer),a=0,i=512;a<256;a++,i++){var l=(c=afft.o_re[a])*c+(f=afft.o_im[a])*f,d=10*Math.log10(l*afft.scale+1e-30);d=Math.round(255+d),afft.pwr_dB[i]=d}for(i=a=256;a<512;a++,i++){l=(c=afft.o_re[a])*c+(f=afft.o_im[a])*f,d=10*Math.log10(l*afft.scale+1e-30);d=Math.round(255+d),afft.pwr_dB[i]=d}waterfall_queue.push({data:afft.pwr_dB,audioFFT:1,seq:0,spacing:0})}else if(audio_compression){if(afft.comp_1x){for(_=0;_<2048;_++)afft.i_re[_]=e[_]*afft.window_2k[_];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.o_re.buffer,afft.o_im.buffer),o=s?(i=512,-1):(i=256,1),a=0;a<1024;a++){l=(c=afft.o_re[a])*c+(f=afft.o_im[a])*f;afft.dBi[1&a]=Math.round(255+10*Math.log10(l*afft.scale+1e-30)),1&a&&(afft.pwr_dB[i]=Math.max(afft.dBi[0],afft.dBi[1]),i+=o)}}else{for(_=0;_<1024;_++)afft.i_re[_]=e[_]*afft.window_1k[_];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.o_re.buffer,afft.o_im.buffer),o=s?(i=512,-1):(i=256,1),a=0;a<512;a++,i+=o){l=(c=afft.o_re[a])*c+(f=afft.o_im[a])*f;afft.pwr_dB[i]=Math.round(255+10*Math.log10(l*afft.scale+1e-30))}for(waterfall_queue.push({data:afft.pwr_dB,audioFFT:1,seq:0,spacing:0}),_=1024;_<2048;_++)afft.i_re[_]=e[_]*afft.window_2k[_-1024];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.o_re.buffer,afft.o_im.buffer),o=s?(i=512,-1):(i=256,1),a=0;a<512;a++,i+=o){l=(c=afft.o_re[a])*c+(f=afft.o_im[a])*f;afft.pwr_dB[i]=Math.round(255+10*Math.log10(l*afft.scale+1e-30))}}waterfall_queue.push({data:afft.pwr_dB,audioFFT:1,seq:0,spacing:0})}else{for(_=0;_<512;_++)afft.i_re[_]=e[_]*afft.window_512[_];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.o_re.buffer,afft.o_im.buffer),o=s?(i=512,-2):(i=256,2),a=0;a<256;a++,i+=o){var c,f,l=(c=afft.o_re[a])*c+(f=afft.o_im[a])*f;afft.pwr_dB[i]=afft.pwr_dB[i+1]=Math.round(255+10*Math.log10(l*afft.scale+1e-30))}waterfall_queue.push({data:afft.pwr_dB,audioFFT:1,seq:0,spacing:0})}}}function freq_dsp_to_car(e){var t=demodulators[0];if(isUndefined(t))return console.log("freq_dsp_to_car no demod?"),e;var _=t.low_cut+(t.high_cut-t.low_cut)/2;return fcar=t.isCW?e-_:e,fcar<0&&(fcar=0),fcar>bandwidth&&(fcar=bandwidth),fcar}function freq_car_to_dsp(e){var t=demodulators[0];if(isUndefined(t))return e;var _=t.low_cut+(t.high_cut-t.low_cut)/2;return fdsp=t.isCW?e+_:e,fdsp}function passband_offset(){var e=0,t=demodulators[0];return isDefined(t)&&(e=t.usePBCenter?t.low_cut+(t.high_cut-t.low_cut)/2:0),e}function freq_passband_center(){var e=0,t=demodulators[0];return isDefined(t)&&(e=center_freq+t.offset_frequency,e+=t.low_cut+(t.high_cut-t.low_cut)/2),e}function passband_offset_dxlabel(e,t,_,a){0==_&&0==a&&(_=(i=kiwi_passbands(e)).lo,a=i.hi);var i=!0;return t.startsWith("fax")&&(i=!1),ext_mode(e).SSB&&i?_+(a-_)/2:0}function freqmode_set_dsp_kHz(e,t,_){var a=w3_opt(_,"dont_clear_wf",!1),i=w3_opt(_,"open_ext",!1),o=w3_opt(_,"no_set_freq",0),n=w3_opt(_,"no_clear_last_gid",0);e*=1e3,0==a&&(wf.audioFFT_clear_wf=!0),n||(owrx.dx_click_gid_last_until_tune=void 0),dx.last_stepped_gid=-1,!isArg(t)||t==cur_mode&&1!=i?(freq_car_Hz=freq_dsp_to_car(e),o||demodulator_set_offset_frequency(owrx.FSET_SET_FREQ,freq_car_Hz-center_freq)):ext_set_mode(t,e,_)}function freqset_car_Hz(e){freq_car_Hz=e}function freq_field_prec(e){var t=1e5-(cfg.max_freq?32e3:3e4);return!(kiwi.freq_offset_kHz>=t)&&cfg.show_1Hz?3:2}function freq_field_width(){var e=1e5-(cfg.max_freq?32e3:3e4);return(kiwi.freq_offset_kHz>=e||cfg.show_1Hz?6.25:5.75)+"em"}function freqset_update_ui(e){var t,_=(freq_displayed_Hz=freq_car_to_dsp(freq_car_Hz))/1e3;freq_displayed_kHz_str=_.toFixed(freq_field_prec(_)),waterfall_setup_done&&(t=w3_el("id-freq-input"),isUndefined(t)||null==t||(_=(freq_displayed_Hz+kiwi.freq_offset_Hz)/1e3,freq_displayed_kHz_str_with_freq_offset=_.toFixed(freq_field_prec(_)),t.value=freq_displayed_kHz_str_with_freq_offset,freqset_select(),0<=(t=-passband_visible()-1)&&waterfall_pan_canvases(t-(x_bin+bins_at_cur_zoom()/2)),check_band(),writeCookie("last_freq",freq_displayed_kHz_str_with_freq_offset),freq_dsp_set_last=freq_displayed_kHz_str_with_freq_offset,freq_step_update_ui(),freq_link_update(),vfo_update(),e!=owrx.FSET_NOP&&e!=owrx.FSET_SCALE_DRAG&&e!=owrx.FSET_SCALE_TOUCH_DRAG&&freq_memory_update(freq_displayed_kHz_str_with_freq_offset),kiwi_clearTimeout(owrx.popup_keyboard_active_timeout),owrx.popup_keyboard_active_timeout=setTimeout(function(){owrx.popup_keyboard_active=!1},2e3)))}function vfo_update(e){var t;owrx.vfo_first&&(_=freq_displayed_kHz_str_with_freq_offset+cur_mode+"z"+zoom_level,t=parseInt(initCookie("last_vfo_A",_)),_=parseInt(initCookie("last_vfo_B",_)),freq_displayed_kHz_str_with_freq_offset!=t&&freq_displayed_kHz_str_with_freq_offset==_&&(owrx.vfo_ab=1,w3_flip_colors("id-freq-vfo","w3-aqua w3-orange",owrx.vfo_ab),w3_innerHTML("id-freq-vfo","AB"[owrx.vfo_ab])),owrx.vfo_first=!1);var _=1==e?1:0,e=freq_displayed_kHz_str_with_freq_offset+cur_mode+"z"+zoom_level;writeCookie("last_vfo_"+"AB"[owrx.vfo_ab^_],e)}function popup_keyboard_touchstart(e){owrx.popup_keyboard_active=!0}function freqset_select(){var e=document.activeElement,t=e&&w3_contains(e,"w3-ext-retain-input-focus")&&!extint.displayed,_=e&&(w3_contains(e,"w3-retain-input-focus")||w3_contains(e,"w3-ext-retain-input-focus"));extint.scanning||e&&_&&!t||w3_field_select("id-freq-input",{mobile:1,log:1})}function modeset_update_ui(e){null!=owrx.last_mode_el&&(owrx.last_mode_el.style.color="white");var t=ext_mode(e),_=w3_el("id-mode-"+t.str);_.innerHTML=e.toUpperCase(),_&&_.style&&(_.style.color="lime"),owrx.last_mode_el=_,owrx.last_mode_col=parseInt(_.id),squelch_setup(toggle_e.FROM_COOKIE),writeCookie("last_mode",e),freq_link_update(),vfo_update();var a=ext_is_IQ_or_stereo_mode(e);w3_els("id-button-compression",function(e){w3_disable(e,a)}),w3_els("id-deemp",function(e){w3_disable(e,a)}),w3_hide2("id-sam-carrier-container",!t.SAx),w3_hide2("id-chan-null","sam"!=e),w3_hide2("id-SAM-opts",t.SAx),w3_hide2("id-deemp1-ofm",t.NBFM),w3_hide2("id-deemp2-ofm",t.NBFM),w3_hide2("id-deemp1-nfm",!t.NBFM),w3_hide2("id-deemp2-nfm",!t.NBFM)}function try_freqset_update_ui(e){waterfall_setup_done?(freqset_update_ui(e),wf.audioFFT_active?(cur_mode!=wf.audioFFT_prev_mode&&(wf.audioFFT_clear_wf=!0),audioFFT_update(),wf.audioFFT_prev_mode=cur_mode):mkenvelopes(get_visible_freq_range())):setTimeout(try_freqset_update_ui,1e3,e)}function try_modeset_update_ui(e){waterfall_setup_done?modeset_update_ui(e):setTimeout(function(){try_modeset_update_ui(e)},1e3)}function freq_link_update(){var e=kiwi_url_origin()+"/?f="+freq_displayed_kHz_str_with_freq_offset+cur_mode+"z"+zoom_level;w3_innerHTML("id-freq-link",w3_icon("w3-text-css-lime||title="+dq("copy to clipboard:\n"+e),"fa-external-link-square",15,"","freq_link_update_cb",e))}function freq_link_update_cb(e,t,_){_||w3_copy_to_clipboard(t)}function freqset_complete(e){var t=w3_el("id-freq-input");if(kiwi_clearTimeout(freqset_tout),!isUndefined(t)&&null!=t){var _,a=kiwi_is_iPhone(),i=t.value.includes("/"),o=t.value.includes(":");if(!a||i||o?(n=(r=t.value.split(/[\/\:]/))[0],_=2<=r.length?r[1].split(","):null):(n=1==(r=t.value.split(".")).length?r[0]:r[0]+"."+r[1],(_=r).shift(),_.shift(),0==_.length&&(_=null),i=!0),"/"==t.value||a&&".."==t.value)return restore_passband(cur_mode),demodulator_analog_replace(cur_mode),void freqset_update_ui(owrx.FSET_NOP);var n,s,r=!0;""!=n&&0<(n=n.replace(",",".").parseFloatWithUnits("M",.001))&&!isNaN(n)&&0<(n-=kiwi.freq_offset_kHz)&&!isNaN(n)&&(freqmode_set_dsp_kHz(n,null),w3_field_select(t,{mobile:1,log:2}),r=!1),r&&freqset_update_ui(owrx.FSET_NOP),_&&(a=_[0].parseFloatWithUnits("k"),n=NaN,1<_.length&&(n=_[1].parseFloatWithUnits("k")),r=((t=ext_get_passband()).high-t.low)/2,t=t.low+r,i?1==_.length&&(a=t-(s=a/2),n=t+s):(t=a,n=1==_.length?(a=t-r,t+r):(a=t-(s=Math.abs(n/2)),t+s)),ext_set_passband(a,n,!0))}}var ignore_next_keyup_event=!1;function freqset_keyup(e,t){if(kiwi_clearTimeout(freqset_tout),null!=t&&null!=t.key){var _=t.key.length;if(any_alternate_click_event_except_shift(t)||1!=_&&"Backspace"!=t.key)return"Escape"==t.key&&freqset_update_ui(owrx.FSET_NOP),void(ignore_next_keyup_event=!1)}ignore_next_keyup_event?ignore_next_keyup_event=!1:kiwi_isMobile()||(freqset_tout=setTimeout(function(){freqset_complete("t/o")},3e3))}var freq_step_last_mode,freq_step_last_band,num_step_buttons=6,up_down={am:[0,-1,-.1,.1,1,0],amn:[0,-1,-.1,.1,1,0],sam:[0,-1,-.1,.1,1,0],sal:[0,-1,-.1,.1,1,0],sau:[0,-1,-.1,.1,1,0],sas:[0,-1,-.1,.1,1,0],qam:[0,-1,-.1,.1,1,0],drm:[0,-1,-.1,.1,1,0],usb:[0,-.1,-.01,.01,.1,0],usn:[0,-.1,-.01,.01,.1,0],lsb:[0,-.1,-.01,.01,.1,0],lsn:[0,-.1,-.01,.01,.1,0],cw:[0,-.1,-.01,.01,.1,0],cwn:[0,-.1,-.01,.01,.1,0],nbfm:[-5,-1,-.1,.1,1,5],nnfm:[-5,-1,-.1,.1,1,5],iq:[0,-1,-.1,.1,1,0]},NDB_400_1000_mode=1;function freq_step_amount(e){var t,_=ext_mode(cur_mode),a=_.SSB_CW?1e3:5e3,i=_.SSB_CW?" 1k default":" 5k default",o=2==cfg.init.ITU_region+1&&e&&"75m"==e.name;return e&&"NDB"==e.name?(_.CW&&(a=NDB_400_1000_mode),i=" NDB"):!e||"LW"!=e.name&&"MW"!=e.name?(t=e?band_svc_lookup(e.svc):null)&&t.o.name.includes("Broadcast")&&!o?_.AM_SAx_IQ_DRM&&(a=5e3,i=" SWBC 5k"):e&&0!=e.chan&&(a=1e3*e.chan,i=" band="+e.name+" chan_kHz="+e.chan):(_.AM_SAx_IQ_DRM&&(a=step_9_10?9e3:1e4),i=" LW/MW"),{step_Hz:a,s:i}}function special_step(e,t,_){_=freq_step_amount(e),e=_.step_Hz;return _.s,t<num_step_buttons/2&&(e=-e),e}function freqstep(e,t){var _=1e3*up_down[cur_mode][e];0==_&&(_=special_step(find_band(freq_displayed_Hz),e,"freqstep"));var a=freq_displayed_Hz,i=Math.abs(_),o=0<=_?1:0,e=a/i;e=(o?Math.ceil(e):Math.floor(e))*i,i==NDB_400_1000_mode?1!=t?(i=a%1e3,i=o?i<400?400:i<600?600:1e3:0==i?-400:i<=400?0:i<=600?400:600,a=(e=1e3*Math.floor(a/1e3))+i):a+=1e3*Math.sign(_):1!=t&&freq_displayed_Hz!=e?a=e:a+=_,freqmode_set_dsp_kHz(a/1e3,null,{dont_clear_wf:!0})}function freq_step_update_ui(e){if(!isUndefined(cur_mode)&&null!=kiwi_passbands(cur_mode)){var t=find_band(freq_displayed_Hz);if(e||freq_step_last_mode!=cur_mode||freq_step_last_band!=t){e=!(!t||"LW"!=t.name&&"MW"!=t.name||!ext_mode(cur_mode).AM_SAx_IQ_DRM);kiwi_isMobile()?w3_hide2("id-9-10-cell",!e):(w3_hide2("id-9-10-cell",!1),w3_disable("id-9-10-cell",!e));for(var _=0;_<num_step_buttons;_++){var a=1e3*up_down[cur_mode][_];0==a&&(a=special_step(t,_,"freq_step_update_ui"));var i=Math.abs(a),o=0<=a?1:0,o=1e3<=i?(o?"+":"")+(a/1e3).toString()+"k":i!=NDB_400_1000_mode?(o?"+":"")+a.toString():(o?"+":"-")+"400/"+(o?"+":"-")+"1000";w3_el("id-step-"+_).title=o}freq_step_last_mode=cur_mode,freq_step_last_band=t}}}function freq_memory_init(){var _,a;isNonEmptyString(owrx.override_fmem)?(_=owrx.override_fmem.split(","),a=cfg.show_1Hz?3:2,_.forEach(function(e,t){isNumber(e)&&(e=e.toString());e=e.parseFloatWithUnits("kM",.001);isNumber(e)&&(_[t]=w3_clamp(e,1,cfg.max_freq?32e3:3e4).toFixed(a))})):_=kiwi_JSON_parse("freq_memory_init",readCookie("freq_memory")),_&&(owrx.freq_memory=kiwi_dedup_array(_,function(e){var t={err:!1};return e=+e,!isNumber(e)||e<=0?t.err=!0:t.v=e.toString(),t}))}function freq_memory_menu_init(){w3_menu("id-freq-memory-menu","freq_memory_menu_cb")}function freq_memory_menu_show(e){var t,_;w3_isVisible("id-freq-memory-menu")?owrx.freq_memory_menu_shown=0:(owrx.freq_memory_menu_shown=1,t=owrx.last_pageX,_=owrx.last_pageY,1!=e&&(t+=0<=t-128?-128:16),(e=kiwi_dup_array(owrx.freq_memory)).push("clear all"),e.push("VFO A=B"),w3_menu_items("id-freq-memory-menu",e,Math.min(e.length,10)),w3_menu_popup("id-freq-memory-menu",function(e,t){var _="keyup"==e.type&&("m"!=e.key||!owrx.freq_memory_menu_shown),a=w3_contains(e.target,"w3-menu"),i=w3_contains(e.target,"w3-menu-button"),o=owrx.freq_memory_menu_shown,e="click"==e.type||("mousedown"==e.type||"touchstart"==e.type)&&!i||"touchend"==e.type;return _||!(!e||t||a&&o)},t,_))}function freq_memory_update(e){isNumber(+e)&&(e<1&&(e="1"),e!=owrx.freq_memory[0]&&(owrx.freq_memory.unshift(e),owrx.freq_memory=kiwi_dedup_array(owrx.freq_memory)),25<owrx.freq_memory.length&&owrx.freq_memory.pop(),writeCookie("freq_memory",JSON.stringify(owrx.freq_memory)))}function freq_memory_menu_cb(e,t){var _,a;-1!=(e=+e)&&(a=!1,e==owrx.freq_memory.length?(_=owrx.freq_memory[0],a=!0,owrx.freq_memory=[_]):e==owrx.freq_memory.length+1?vfo_update(!0):e<=owrx.freq_memory.length-1&&(_=owrx.freq_memory[e],a=!0,owrx.freq_memory.unshift(_),owrx.freq_memory=kiwi_dedup_array(owrx.freq_memory),25<owrx.freq_memory.length&&owrx.freq_memory.pop()),a&&freqmode_set_dsp_kHz(_-kiwi.freq_offset_kHz))}function band_info(){var e,t,_=+cfg.init.AM_BCB_chan?10:9,a=cfg.init.ITU_region+1,i=1==a?(e=283.5,t=526.5,1606.5):2==a?(e=190.5,t=540-_/2,1700+_/2):(e=190.5,t=540-_/2,1602+_/2);return{ITU_region:a,_9_10:_,LW_lo:148.5,NDB_lo:e,NDB_hi:t,MW_hi:i}}function band_svc_lookup(_){var a=null,e=dx_cfg_db();return e.band_svc.forEach(function(e,t){e.key==_&&(a=t)}),null==a?(console.log("$$$ band_svc_lookup NO KEY MATCH for <"+_+">"),null):{o:e.band_svc[a],i:a}}function bands_init(){var e,t,_,a,i=dx_cfg_db();if(i.bands&&i.band_svc&&i.dx_type)return console.log("BANDS: using stored _dxcfg.bands db="+dx.db+" ---------------------------------"),bands_addl_info(0),void dx_color_init();console.log("BANDS: using old config.js/bands db="+dx.db+"-------------------------------------"),dxcfg.dx_type=[];var o=-1;for(dx.legacy_stored_types.forEach(function(e,t){dxcfg.dx_type[t]={key:t,name:dx.legacy_stored_types[t],color:dx.legacy_stored_colors[t]},o=t}),e=dx_type2idx(dx.DX_MASKED),s=o+1;s<e;s++)dxcfg.dx_type[s]={key:s,name:"",color:""};dxcfg.dx_type[e]={key:s,name:"masked",color:"lightGrey"},dx_color_init(),dxcfg.band_svc=[],w3_obj_enum(svc,function(e,t,_){"X"==e&&"Beacons"==_.name&&(svc.L=svc.X,e="L",delete svc.X),svc[e].key=e,dxcfg.band_svc[t]={key:e,name:_.name,color:_.color},"Industrial/Scientific"==_.name&&(dxcfg.band_svc[t].name="ISM",dxcfg.band_svc[t].longName="Industrial/Scientific")});for(var n=[],s=e=0;s<bands.length;s++){if("LW"==(_=bands[s]).name&&"E"==_.region&&(_.region="1"),"LW"==_.name&&">"==_.region&&(_.region="23"),"MW"!=_.name||"3"!=_.region&&">3"!=_.region||(_.region="13"),"NDB"==_.name&&"E"==_.region&&(_.region="1"),"NDB"==_.name&&"U"==_.region&&(_.region="2"),"NDB"==_.name&&">"==_.region&&(_.region="3"),"MF"==_.name&&">23"==_.region&&(_.region="*"),_.name.startsWith("Time ")&&"*"==_.region&&(_.region="m"),_.region){var r=_.region.length;if(1==r){n[e]=kiwi_shallow_copy(_),a=n[e],e++;var l=a.region.charAt(0);a.itu="1"<=l&&l<="3"?ord(l,"1")+1:"*"==l||">"==l?kiwi.ITU_ANY:"m"==l?kiwi.BAND_MENU_ONLY:kiwi.BAND_SCALE_ONLY}else for(t=0;t<r;t++)">"!=(l=_.region.charAt(t))&&(n[e]=kiwi_shallow_copy(_),a=n[e],e++,a.itu="1"<=l&&l<="3"?ord(l,"1")+1:kiwi.BAND_SCALE_ONLY)}else n[e]=kiwi_shallow_copy(_),(a=n[e]).itu=kiwi.ITU_ANY,e++;isNumber(a.sel)&&(a.sel=a.sel.toFixed(2)),isUndefined(a.s)&&(a.s=svc.L),"L"!=a.s.key&&"X"!=a.s.key||!a.sel.includes("cw")||"m"!=a.region||(a.name.includes("IBP")||(a.name="IBP "+a.name),a.sel.includes("cwn")||(a.sel=a.sel.replace("cw","cwn"))),a.name.includes("IBP")&&(a.s="L")}for(s=0;s<n.length;s++)a=n[s],isString(a.s)?a.svc=a.s:isObject(a.s)&&(a.svc=a.s.key),delete a.s,delete a.region;for(dxcfg.bands=[],s=0;s<n.length;s++){var d=(_=n[s]).sel||"";dxcfg.bands.push({min:_.min,max:_.max,name:_.name,svc:_.svc,itu:_.itu,sel:d,chan:_.chan})}console.log("_bands_new:"),console.log(n),bands_addl_info(0)}function dx_cfg_db(){return dx.db==dx.DB_COMMUNITY?dxcomm_cfg:dxcfg}function kiwi_bands_db(e){return e==dx.INIT_BANDS_YES&&(dx.db==dx.DB_STORED?kiwi.bands=[]:dx.db==dx.DB_COMMUNITY&&(kiwi.bands_community=[])),dx.db==dx.DB_COMMUNITY?kiwi.bands_community:kiwi.bands}function bands_addl_info(e){var t,_,a=kiwi.freq_offset_kHz;if(console.log("BANDS: creating additional band info"),e&&dx.db!=dx.DB_STORED)console.log("bands_addl_info: isAdmin=1 but dx.db="+dx.db+" !!!");else for(var i=dx_cfg_db(),o=kiwi_bands_db(dx.INIT_BANDS_YES),n=0;n<i.bands.length;n++){t=i.bands[n],_=o[n]={},i.bands[n].chan=isUndefined(t.chan)?0:t.chan;var s=t.min,r=t.max;a&&t.min>=a?(s-=a,r-=a,_.isOffset=!0):32e3<t.min?_.isOffset=!0:1!=_.isOffset&&(_.isOffset=!1),_.minHz=1e3*s,_.maxHz=1e3*r,_.chanHz=1e3*t.chan;for(var l=_.maxHz-_.minHz,d=zoom_nom;0<=d;d--)if(l<=.8*(bandwidth/(1<<d)))break;_.zoom_level=d,_.cfHz=_.minHz+(_.maxHz-_.minHz)/2;r=band_svc_lookup(t.svc);null!=r?(r=r.o.longName||r.o.name,_.longName=t.name+" "+r):_.longName=t.name}}var maxdb,mindb_un,mindb,full_scale,band_menu=[];function setup_band_menu(){var e=0,t=null,_='<option value="0" selected disabled>select band</option>';band_menu[e++]=null;for(var a=cfg.init.ITU_region+1,i=dx_cfg_db(),o=kiwi_bands_db(dx.INIT_BANDS_NO),n=0;n<i.bands.length;n++){var s=i.bands[n],r=o[n];if(kiwi.isOffset){if(!r.isOffset)continue}else if(r.isOffset)continue;if(s.itu==kiwi.BAND_MENU_ONLY||s.itu==kiwi.ITU_ANY||s.itu==a){if(t!=s.svc){t=s.svc;var l=band_svc_lookup(s.svc);if(!l)continue;_+="<option value="+dq(e)+" disabled>"+l.o.name.toUpperCase()+"</option>",band_menu[e++]=null}_+="<option value="+dq(e)+">"+s.name+"</option>",band_menu[e]={},band_menu[e].b1=s,band_menu[e].b2=r,e++}}return _}function mk_band_menu(){band_menu=[],owrx.last_selected_band=0,w3_innerHTML("id-select-band",setup_band_menu())}function find_band(e){for(var t=cfg.init.ITU_region+1,_=dx_cfg_db(),a=kiwi_bands_db(dx.INIT_BANDS_NO),i=0;i<_.bands.length;i++){var o=_.bands[i],n=a[i];if(o.itu==kiwi.BAND_SCALE_ONLY||o.itu==kiwi.ITU_ANY||o.itu==t){var s="MW"==o.name?171e4:n.maxHz;if(e>=n.minHz&&e<=s)return o}}return null}function mk_bands_scale(){var e=band_ctx.canvas.width,t=band_scale_top,_=band_scale_h,a=t+band_scale_text_top,i=g_range.start,o=g_range.end;band_ctx.globalAlpha=1,band_ctx.fillStyle="White",band_ctx.fillRect(0,band_canvas_top,e,band_canvas_h);for(var n=cfg.init.ITU_region+1,s=dx_cfg_db(),r=kiwi_bands_db(dx.INIT_BANDS_NO),l=0;l<s.bands.length;l++){var d,c,f,w,p,u,m=s.bands[l],x=r[l];if(kiwi.isOffset){if(!x.isOffset)continue}else if(x.isOffset)continue;m.itu!=kiwi.BAND_SCALE_ONLY&&m.itu!=kiwi.ITU_ANY&&m.itu!=n||(w=-1,u=x.minHz,f=i<=(p=x.maxHz)&&p<=o?1:0,(c=i<=u&&u<=o?1:0)&&f?(w=u,d=p):!c&&f?(w=i,d=p):c&&!f?(w=u,d=o):u<i&&o<p&&(w=i,d=o),-1!=w&&(u=scale_px_from_freq(w,g_range),(p=scale_px_from_freq(d,g_range)-u)<3||(w=band_svc_lookup(m.svc),band_ctx.fillStyle=w?w.o.color:"grey",band_ctx.globalAlpha=.2,band_ctx.fillRect(u,t,p,_),band_ctx.globalAlpha=1,band_ctx.font="bold 12px sans-serif",band_ctx.textBaseline="top",w=u+p/2,u=x.longName,p>=(x=band_ctx.measureText(u)).width+4||(u=m.name,p>=(x=band_ctx.measureText(u)).width+4||(u=null)),u&&band_ctx.fillText(u,w-x.width/2,a))))}}function parse_freq_pb_mode_zoom(e){return new RegExp("([0-9.,kM]*)([/:][-0-9.,k]*)?([^z]*)?z?([0-9]*)").exec(e)}function band_scroll(e){for(var t,_=owrx.last_selected_band;(_+=e)<0&&(_=band_menu.length-1),_>=band_menu.length&&(_=0),t=band_menu[_],null==t;);select_band(_),w3_set_value("id-select-band",_)}function select_band(e,t){var _,a,i,o,n,s=+e;if(isNumber(s))null!=(n=band_menu[s])?(o=n.b1,i=n.b2,dbgUs&&(console.log(n),console.log(o),console.log(i)),_=i.cfHz/1e3,a=t,i=null,""!=o.sel&&((o=parse_freq_pb_mode_zoom(o.sel))[1]&&(_=parseFloat(o[1])),o[3]&&isUndefined(t)&&(a=o[3].toLowerCase()),o[4]&&(i=+o[4])),owrx.last_selected_band=s,dbgUs&&(sb_trace=0),freqmode_set_dsp_kHz(_,a),isNumber(i)?zoom_step(ext_zoom.ABS,i):zoom_step(ext_zoom.TO_BAND,n)):check_band(!0);else{for(var r=0;r<band_menu.length-1&&(!band_menu[r]||band_menu[r].b1.name!=e);r++);r<band_menu.length-1&&select_band(r,t)}}function check_band(e){var t,_,a;owrx.last_selected_band&&((a=band_menu[owrx.last_selected_band]).b1,t=a.b2,_=freq_car_Hz,a=freq_passband_center(),(null!=e&&-1==e||(_<t.minHz||_>t.maxHz)&&(a<t.minHz||a>t.maxHz))&&(w3_select_value("id-select-band",0),owrx.last_selected_band=0))}function tune(e,t,_,a){ext_tune(e,t,ext_zoom.ABS,_,a)}function init_scale_dB(){maxdb=init_max_dB,mindb_un=init_min_dB,mindb=mindb_un-zoomCorrection(),full_scale=(full_scale=maxdb-mindb)||1,wf.save_maxdb=maxdb,wf.save_mindb_un=mindb_un,wf.auto_ceil.val=+initCookie("last_ceil_dB",cfg.init.ceil_dB),wf.auto_floor.val=+initCookie("last_floor_dB",cfg.init.floor_dB)}band_canvas_h=30,band_canvas_top=0,band_scale_h=20,band_scale_top=5,band_scale_text_top=5,dx_container_h=80,dx_container_top=band_canvas_h,dx_label_top=5,dx_line_h=dx_container_h-dx_label_top,scale_canvas_h=47,scale_canvas_top=band_canvas_h+dx_container_h,scale_container_h=band_canvas_h+dx_container_h+scale_canvas_h;var cal_adc_new_adj,confirmation={displayed:!1,close_cb:null};function confirmation_panel_init(){w3_el("id-panels-container").innerHTML+=w3_div('id-confirmation class-panel|border: 1px solid white|data-panel-name="confirmation" data-panel-pos="center" data-panel-order="0" data-panel-size="600,100"'),w3_innerHTML("id-confirmation",w3_divs("id-confirmation-container/class-panel-inner")+w3_div("id-confirmation-vis class-vis"))}function confirmation_panel_set_close_func(e){w3_el("id-confirmation-close").onclick=e,confirmation.close_cb=e}function confirmation_panel_init2(){confirmation_panel_set_close_func(confirmation_panel_close),w3_el("id-kiwi-body").addEventListener("keyup",function(e){"Escape"==e.key&&(confirmation.close_cb(),toggle_or_set_hide_panels(0))},!0)}function confirmation_show_content(e,t,_,a,i){confirmation.displayed&&w3_color("id-confirmation",null,""),w3_innerHTML("id-confirmation-container",e),w3_color("id-confirmation",null,i),a&&confirmation_panel_set_close_func(a),confirmation_panel_show(t,_),toggle_or_set_hide_panels(0)}function confirmation_panel_show(e,t){el=w3_el("id-confirmation"),el.style.zIndex=1020,isNoArg(e)&&(e=525),isNoArg(t)&&(t=80),confirmation_panel_resize(e,t),confirmation.displayed=!confirmation.displayed,toggle_panel("id-confirmation")}function confirmation_panel_resize(e,t){var _=w3_el("id-confirmation");panel_set_width_height("id-confirmation",e,t),_.style.left=px(window.innerWidth/2-_.activeWidth/2),_.style.bottom=px(window.innerHeight/2-_.uiHeight/2)}function confirmation_panel_close(){confirmation.displayed&&(w3_color("id-confirmation",null,""),toggle_panel("id-confirmation"),confirmation_panel_set_close_func(confirmation_panel_close),confirmation.displayed=!1)}function set_freq_offset_dialog(){confirmation_show_content(w3_col_percent("/w3-text-aqua",w3_input_get("w3-margin-T-6","Frequency scale offset (kHz, 1 Hz resolution)","cfg.freq_offset","w3_float_set_cfg_cb|3"),80),525,80),w3_field_select("id-cfg.freq_offset",{mobile:1})}function cal_adc_dialog(e,t,_,a){var i;confirmation_show_content((cfg.ADC_clk2_corr!=kiwi.ADC_CLK_CORR_DISABLED&&3<ext_adc_gps_clock_corr()?1:0)?w3_col_percent("/w3-valign",w3_div("w3-show-inline-block","GPS is automatically correcting ADC clock. <br> No manual calibration available.")+w3_button("w3-red w3-margin-left","Close","confirmation_panel_close"),80):(cal_adc_new_adj=e)<-(i=100*ext_adc_clock_nom_Hz()/1e6)||i<e?(console.log("cal ADC clock: ADJ TOO LARGE"),w3_col_percent("/w3-valign",w3_div("w3-show-inline-block","ADC clock adjustment too large: "+t+" Hz<br>(ADC clock "+a.toFixed(1)+" ppm, limit is +/- 100 ppm)")+w3_button("w3-red w3-margin-left","Close","confirmation_panel_close"),80)):w3_col_percent("/w3-valign",w3_div("w3-show-inline-block","ADC clock will be adjusted by<br>"+t+" Hz to "+_+" kHz<br>(ADC clock "+a.toFixed(1)+" ppm)")+w3_button("w3-green w3-margin-left","Confirm","cal_adc_confirm")+w3_button("w3-red w3-margin-left","Cancel","confirmation_panel_close"),80),525,70)}function cal_adc_confirm(){ext_send("SET clk_adj="+cal_adc_new_adj),ext_set_cfg_param("cfg.clk_adj",cal_adc_new_adj,EXT_SAVE),confirmation_panel_close()}function admin_pwd_query(e){ext_hasCredential("admin",admin_pwd_cb,e,ws_wf)}function admin_pwd_cb(e,t){console.log("admin_pwd_cb badp="+e),e!=kiwi.BADP_OK?(confirmation_show_content(w3_col_percent("/w3-text-aqua",w3_input("kiwi-pw","Admin password","admin.pwd","","admin_pwd_cb2"),80),525,80),w3_field_select("id-admin.pwd",{mobile:1})):t()}function admin_pwd_cb2(e,t){w3_string_cb(e,t),confirmation_panel_close(),ext_valpwd("admin",t,ws_wf)}var dx={step_dbg:0,step_superDARN:0,sig_bw_vis:"hidden",sig_bw_left:"0px",url_p:null,help:!1,DB_STORED:0,DB_EiBi:1,DB_COMMUNITY:2,DB_N:3,db:0,db_s:["stored (writeable)","EiBi-A23 (read-only)","community (downloaded)"],db_short_s:["stored","EiBi","community"],ignore_dx_update:!1,last_community_download:"",INIT_BANDS_NO:0,INIT_BANDS_YES:1,DX_STEP:2,DX_MKRS:4,DX_JSON:0,DX_CSV:1,IDX_USER:null,UPD_MOD:0,UPD_ADD:1,o:{},legacy_stored_types:["active","watch-list","sub-band","DGPS","special event","interference"],legacy_stored_colors:["cyan","lightPink","aquamarine","lavender","violet","violet","lightGrey"],stored_colors_light:[],stored_lightness:.95,filter_tod:[1,1,1],dow_colors:["lightCoral","lightSalmon","gold","yellowGreen","springGreen","deepSkyBlue","violet"],eibi_colors:[],eibi_hue:["cyan",300,"deepSkyBlue","silver",50,"peachPuff","mediumAquaMarine",270,180,70,"springGreen",0],eibi_light:[0,80,0,0,70,0,0,80,80,45,0,75],eibi_colors_light:[],eibi_lightness:.9,eibi_svc_s:["Bcast","Utility","Time","ALE","HFDL","Milcom","CW","FSK","Fax","Aero","Marine","Spy"],eibi_ext:["","","time","ale","hfdl","","cw","fsk","fax","","",""],DX_MODE:15,DX_TYPE:496,DX_TYPE_SFT:4,DX_N_STORED:16,DX_STORED:0,DX_QUICK_0:0,DX_QUICK_1:1,DX_MASKED:240,DX_N_EiBi:12,DX_EiBi:256,DX_BCAST:256,DX_UTIL:272,DX_TIME:288,DX_ALE:304,DX_HFDL:320,DX_MILCOM:336,DX_CW:352,DX_FSK:368,DX_FAX:384,DX_AERO:400,DX_MARINE:416,DX_SPY:432,DX_DOW_SFT:9,DX_DOW:65024,DX_MON:32768,DX_FLAGS:4294901760,DX_FILTERED:65536,DX_HAS_EXT:131072,DX_MODE_16:262144,eibi_types_mask:4294967295,list:[],displayed:[],sig_bw_render_gid:-1,last_stepped_gid:-1,filter_ident:"",filter_notes:"",filter_case:0,filter_wild:0,filter_grep:0,ctrl_click:!1};function dx_init(){dx.DX_DOW_BASE=dx.DX_DOW>>dx.DX_DOW_SFT,null!=(dx.url_p=kiwi_url_param("dx","",null))?(dx.db=dx.DB_EiBi,w3_do_when_cond(function(){var e=w3_el("id-ext-controls");return!!e&&e.init},function(){var _;console.log('DX url_p="'+dx.url_p+'"'),""!=dx.url_p&&dx.url_p.split(",").forEach(function(e,t){console.log("DX url_p=<"+e+">"),w3_ext_param("help",e).match?dx.help=!0:0==t&&0==e||w3_ext_param("sto",e).match?(dx.db=dx.DB_STORED,dx.filter_tod[dx.db]=0):0==t&&2==e||w3_ext_param("com",e).match?(dx.db=dx.DB_COMMUNITY,dx.filter_tod[dx.db]=0):w3_ext_param("none",e).match?(dx.eibi_types_mask=0,console.log("SET none dx.eibi_types_mask="+dx.eibi_types_mask)):(_=w3_ext_param("filter",e)).match&&(dx.filter_tod[dx.db]=_.has_value?_.num:1,console.log("SET filter_tod="+dx.filter_tod[dx.db]+" r.has_value="+_.has_value+" r.num="+_.num)),w3_ext_param_array_match_str(dx.eibi_svc_s,e,function(e,t){var _=dx.eibi_types_mask&1<<e;_?dx.eibi_types_mask&=~(1<<e):dx.eibi_types_mask|=1<<e,console.log("MATCH "+t+" v="+_.toHex(8)+"("+e+") dx.eibi_types_mask="+dx.eibi_types_mask.toHex(8))})}),console.log("FINAL dx.eibi_types_mask="+dx.eibi_types_mask.toHex(8)+" dx.help="+dx.help),dx_show_edit_panel(null,-1),dx_schedule_update()},null,500)):dx.db=kiwi_storeGet("last_db",cfg.dx_default_db),dx_database_cb("",dx.db),dx.step_superDARN&&setTimeout(function(){dx.filter_ident="superDARN",dx_filter_cb()},1e3)}function dx_decode_mode(e){return(e&dx.DX_MODE_16?16:0)|e&dx.DX_MODE}function dx_encode_mode(e){return(16<=e?dx.DX_MODE_16:0)|e&dx.DX_MODE}function dx_type2idx(e){return(e=e&dx.DX_TYPE)>=dx.DX_EiBi&&(e-=dx.DX_EiBi),e>>dx.DX_TYPE_SFT}function dx_eibi_type2mask(e){return 1<<dx_type2idx(e)}function dx_set_type(e){dx.eibi_types_mask=dx_eibi_type2mask(e)}function dx_is_single_type(e){return dx.db==dx.DB_EiBi&&dx.eibi_types_mask==dx_eibi_type2mask(e)}function dx_color_init(){if(dx.db!=dx.DB_EiBi)for(var e=dx_cfg_db(),t=0;t<e.dx_type.length;t++){var _=e.dx_type[t],_=""==_.color?"white":_.color,_=w3color(_);_.valid&&(_.lightness=dx.stored_lightness,dx.stored_colors_light[t]=_.toHslString())}else{dx.eibi_hue.forEach(function(e,t){isString(e)?dx.eibi_colors[t]=e:dx.eibi_colors[t]="hsl("+e+",100%,"+dx.eibi_light[t]+"%)";e=w3color(dx.eibi_colors[t]);e.lightness=dx.eibi_lightness,dx.eibi_colors_light[t]=e.toHslString()});for(t=0;t<dx.DX_N_EiBi;t++)w3_color("eibi-cbox"+t+"-label","black",dx.eibi_colors[t])}}function dx_update_request(){w3_do_when_cond(function(){return waterfall_setup_done},function(){dx_update(),bands_init(),mk_bands_scale(),mk_band_menu()},null,200)}function dx_show(e,t){w3_visible(dx_canvas,e),dx.sig_bw_vis=dx_canvas.style.visibility,dx.sig_bw_left=dx_canvas.style.left,w3_hide2("id-dx-sig",!e),isArg(t)&&(dx.sig_bw_render_gid=t)}var dx_update_timeout,dx_update_delay=350;function dx_schedule_update(){kiwi_clearTimeout(dx_update_timeout),dx_div.innerHTML="",dx_show(!1),dx_update_timeout=setTimeout(dx_update,dx_update_delay)}function dx_update(){dx.db,dx.DB_EiBi;var e=ext_panel_displayed("HFDL")&&dx_is_single_type(dx.DX_HFDL)&&4<=zoom_level?0:1,t=(g_range.start/1e3+kiwi.freq_offset_kHz).toFixed(3),_=(g_range.end/1e3+kiwi.freq_offset_kHz).toFixed(3);wf_send("SET MARKER db="+dx.db+" min="+t+" max="+_+" zoom="+zoom_level+" width="+waterfall_width+" eibi_types_mask="+dx.eibi_types_mask.toHex()+" filter_tod="+dx.filter_tod[dx.db]+" anti_clutter="+e),dx.step_dbg&&console.log("UPDATE list"),kiwi_clearTimeout(dx.dx_refresh_timeout),dx.filter_tod[dx.db]&&(e=3e5-Date.now()%3e5,dx.dx_refresh_timeout=setTimeout(function(){dx_div.innerHTML="",dx_show(!1),dx_update()},2e3+e))}var dx_ibp_list,dx_ibp_interval,dx_ibp_server_time_ms,dx_keys,smeter_width,dx_ibp_local_time_epoch_ms=0,dx_ibp_freqs={14:0,18:1,21:2,24:3,28:4},dx_ibp_lastsec=0,dx_ibp_stations={"4U1UN":{value:0,text:"New York"},VE8AT:{value:1,text:"Nunavut"},W6WX:{value:2,text:"California"},KH6RS:{value:3,text:"Hawaii"},ZL6B:{value:4,text:"New Zealand"},VK6RBP:{value:5,text:"Australia"},JA2IGY:{value:6,text:"Japan"},RR9O:{value:7,text:"Siberia"},VR2B:{value:8,text:"Hong Kong"},"4S7B":{value:9,text:"Sri Lanka"},ZS6DN:{value:10,text:"South Africa"},"5Z4B":{value:11,text:"Kenya"},"4X6TU":{value:12,text:"Israel"},OH2B:{value:13,text:"Finland"},CS3B:{value:14,text:"Madeira"},LU4AA:{value:15,text:"Argentina"},OA4B:{value:16,text:"Peru"},YV5B:{value:17,text:"Venezuela"}};function dx_label_render_cb(s){var e=s[0],t=dx_cfg_db(),n=(dx.db,dx.DB_STORED,dx.db==dx.DB_EiBi),r=n?40:35;if(console_log_lbl=function(e){0},dx_color_init(),e.t!=dx.DX_STEP){if(kiwi_clearInterval(dx_ibp_interval),dx_ibp_list=[],dx_ibp_server_time_ms=1e3*e.s+ +e.m,dx_ibp_local_time_epoch_ms=Date.now(),n&&isDefined(e.ec))for(E=0;E<dx.DX_N_EiBi;E++)isDefined(e.ec[E])&&w3_innerHTML("eibi-cbox"+E+"-label",dx.eibi_svc_s[E]+" ("+e.ec[E]+")");dx.types_n=e.tc,dx_filter_field_err(+e.f);var _=120;dx_div.innerHTML="",dx.displayed=[],dx.last_freq=0,dx.last_ident="",dx.last_f_base=-1,dx.post_render=[],dx.color_fixup=[],dx.f_same=[];function a(e,t,_){var a,i=Math.ceil(r/6);for(dx.font&&(dx.f_same.forEach(function(e,t){e=s[++e];e.di=kiwi_decodeURIComponent("",e.i),e.tw=getTextWidth(e.di,dx.font)}),dx.f_same.sort(function(e,t){e=s[e+1];return s[t+1].tw-e.tw})),a=0;a<=dx.f_same.length;a++){var o=dx.f_same[a],n=a%(i+1);dx.post_render[o]={top:dx_label_top+6*n,ltop:dx_label_top,x:e+5*n,z:t+a},n==i&&(e+=r)}}var i,o=0,l=Math.floor(wf_container.clientWidth/2)-1,d=2+l,c=[];for(0,E=1;E<s.length;E++){I=E-1;var f,w,p,u,m,x,h,b=(D=s[E]).f,g=(L=D.fl)&dx.DX_TYPE,v=dx_type2idx(g),k=L&dx.DX_FILTERED,y=D.i;n&&y==dx.last_ident&&b==dx.last_freq?(console_log_lbl("1111 dx_idx="+I+" "+b+" SAME AS LAST filtered="+(k?1:0)+" "+y),0==k&&(dx.color_fixup[dx.last_idx]=dx.eibi_colors[v])):(dx.last_idx=I,dx.last_freq=b,dx.last_ident=y,console_log_lbl("1111 dx_idx="+I+" "+b+" OK filtered="+(k?1:0)+" "+y),f=D.g,u=b-kiwi.freq_offset_kHz,w=D.o,z=isDefined(D.n)?D.n:"",x=isDefined(D.p)?D.p:"",n&&L&dx.DX_HAS_EXT&&(p=dx.eibi_ext[dx_type2idx(g)],y.includes("CHU")&&(p="fsk"),x=p+",*"),p=scale_px_from_freq(g=(m=1e3*u)+passband_offset_dxlabel(kiwi.modes_lc[dx_decode_mode(L)],x,D.lo,D.hi),g_range)-1,u=0,m=m-w,w&&(u=scale_px_from_freq(m,g_range)),n&&g==dx.last_f_base?(dx.f_same.push(I),i=p,0==o&&(o=_)):n&&(2<dx.f_same.length&&a(i,o,dx.last_f_base),dx.f_same=[],dx.f_same.push(I),o=0),A=dx_label_top+r*(1&I),dx.post_render[I]={top:A,ltop:A,x:p},dx.last_f_base=g,h=n?(k?dx.eibi_colors_light:dx.eibi_colors)[v]:(""==(h=t.dx_type[v].color)&&(h="white"),k?dx.stored_colors_light[v]:h),n||0!=v||"IBP"!=y&&"IARU%2fNCDXF"!=y||(h="aquamarine"),console_log_lbl("DX "+I+" f="+b+" k="+w+" FL="+L.toHex(8)+" m="+kiwi.modes_uc[dx_decode_mode(L)]+" <"+y+"> <"+z+">"),m=1e3*b-w,m/=1e3,v=l<=p&&p<=d?1:0,dx.list[f]={gid:f,carrier:m,lo:D.lo,hi:D.hi,freq:b,f_label:g,mkr_off:w,sig_bw:D.s,flags:L,begin:D.b,end:D.e,ident:y,notes:z,params:x,color:h,center:v},console_log_lbl("dx_label_render_cb db="+dx.db+" dx_idx="+I+"/"+s.length+" gid="+f+" dx.list.len="+dx.list.length+" "+b.toFixed(2)+" x="+l+"|"+p+"|"+d+" center="+v),dx.displayed[I]=dx.list[f],console_log_lbl(dx.list[f]),x=""!=x,k=w3_sb("w3-custom-events w3-hold cl-dx-label",x?"dx-has-ext":"",k?"cl-dx-label-filtered":"",x&&!k?"cl-dx-label-ext":""),h=sprintf('|left:%s; z-index:%d; background:%s|id="id-dx-label_%s"',px(p-10),_,h,I),c[I]=w3_button_path(k+h,"dx-"+f,"","dx_evt",w3_sbc(",",f,u))+w3_div(sprintf('cl-dx-line|left:%s; z-index:110|id="id-dx-line_%s"',px(p),I)),_++)}n&&2<dx.f_same.length&&a(i,o),console_log_lbl(dx.list),console_log_lbl(dx.displayed),w3_innerHTML(dx_div,w3_div("id-dx-sig cl-dx-sig w3-hide")),dx.step_dbg&&console.log("RENDER START func="+e.t+" len="+(s.length-1)+" sig_bw_render_gid="+dx.sig_bw_render_gid);for(var q=0,T="",E=0;E<s.length-1;E++)isDefined(c[E])&&(w3_create_appendElement(dx_div,"div",c[E]),f=dx.displayed[E].gid,dx.step_dbg&&(T+=" "+f+"("+E+")"),f==dx.sig_bw_render_gid&&(dx.step_dbg&&console.log("RENDER dx_sig_bw() gid="+f),dx_sig_bw(f),dx.last_stepped_gid=f),q++);dx.step_dbg&&console.log("RENDER "+q+" labels"+T),dx.last_freq=0,dx.last_ident="",dx.font||(M=w3_el("id-dx-label_0"))&&(dx.font=css_style(M,"font-size")+" "+css_style(M,"font-family"),console_log_lbl("dx.font=<"+dx.font+">"));function S(e){var t="",_=e.fl&dx.DX_DOW;if(_==dx.DX_DOW&&(_=0),0==e.b&&0==e.e&&(e.e=2400,kiwi_trace("$SHOULD NOT OCCUR")),_)for(var a=0;a<7;a++)t+=dx.DX_MON>>a&_?"MTWTFSS"[a]:"_";else t="7-days";var i,o=e.b.leadingZeros(4)+"-"+e.e.leadingZeros(4)+" "+t;return n&&((i="")!=e.l&&"-"!=e.l.charAt(0)&&(i=" lang: "+e.l),o+=i+" target: "+e.t),o}for(E=1;E<s.length;E++){var M,D,z,F,A,C,B,I=E-1,y=(D=s[E]).i,b=D.f,L=D.fl;n&&y==dx.last_ident&&b==dx.last_freq?(console_log_lbl("2222 dx_idx="+I+" last_dx_idx="+dx.last_dx_idx+" "+D.f+" SAME AS LAST "+y),(M=w3_el("id-dx-label_"+dx.last_dx_idx)).title+="\n"+S(D)):(dx.last_dx_idx=I,dx.last_freq=b,dx.last_ident=y,n&&console_log_lbl("2222 dx_idx="+I+" "+D.f+" OK "+y),z=isDefined(D.n)?D.n:"",(M=w3_el("id-dx-label_"+I))&&(""==(F=kiwi_decodeURIComponent("dx_ident2",y).trim())&&(F="&nbsp;&nbsp;"),M.innerHTML=F.replace(/\\n/g,"<br>"),F=dx_type2idx(D.fl&dx.DX_TYPE),n?M.title=dx.eibi_svc_s[F]+" // home country: "+D.c+"\n"+S(D):(F=(F=(F=kiwi_decodeURIComponent("dx_notes",z)).replace(/<br>/g,"\n")).replace(/\\n/g,"\n"),(D.fl&dx.DX_DOW)==dx.DX_DOW&&0==D.b&&0==D.b&&2400==D.e||(F=w3_nl(F)+S(D)),M.title=F),I<dx.post_render.length&&(C=dx.post_render[I])&&(A=C.top,B=C.x-10,M.style.top=px(A),M.style.left=px(B),isDefined(C.z)&&(M.style.zIndex=C.z),B=w3_el("id-dx-line_"+I),A=C.ltop,B.style.top=px(A),B.style.height=px(dx_container_h-A)),I<dx.color_fixup.length&&(C=dx.color_fixup[I])&&(M.style.backgroundColor=C),n||"IBP"!=y&&"IARU%2fNCDXF"!=y||(B=dx_ibp_freqs[Math.trunc(b/1e3)],dx_ibp_list.push({idx:I,off:B}),kiwi_clearInterval(dx_ibp_interval),dx_ibp_interval=setInterval(function(){var e=new Date(dx_ibp_server_time_ms+(Date.now()-dx_ibp_local_time_epoch_ms)),t=e.getMinutes(),_=e.getSeconds(),e=_%10;if(0==e&&9==dx_ibp_lastsec)for(var a=t%3*6+Math.trunc(_/10),i=0;i<dx_ibp_list.length;i++){var o,n,s=a-dx_ibp_list[i].off;s<0&&(s=18+s),M=w3_el("id-dx-label_"+dx_ibp_list[i].idx),w3_obj_enum(dx_ibp_stations,function(e,t,_){t==s&&(o=e,n=_.text)}),M&&(M.innerHTML="IBP: "+o+" "+n)}dx_ibp_lastsec=e},500))))}}else{var N,H=s[1];H?(dx.step_dbg&&console.log("dx_label_render_cb: DX_STEP [[[RESP]]] gid="+H.g+" f="+H.f),dx.step_dbg&&console.log(JSON.stringify(H)),N=kiwi.modes_lc[dx_decode_mode(H.fl)],freqmode_set_dsp_kHz(H.f,N),0!=H.lo&&0!=H.hi?ext_set_passband(H.lo,H.hi):(N=kiwi_passbands(N),ext_set_passband(N.lo,N.hi)),dx.sig_bw_render_gid=H.g):(dx.step_dbg&&console.log("dx_label_render_cb: DX_STEP [[[RESP]]]: NO LABEL FOUND"),dx.sig_bw_render_gid=-1)}}function dx_filter(){confirmation_show_content(w3_div("w3-medium w3-text-aqua w3-bold","DX label filter")+w3_divs("w3-text-aqua",w3_col_percent("",w3_divs("/w3-margin-T-8",w3_input("w3-label-inline/id-dx-filter-ident w3-retain-input-focus w3-input-any-change w3-padding-small","Ident","dx.filter_ident",dx.filter_ident,"dx_filter_cb"),w3_input("w3-label-inline/id-dx-filter-notes w3-retain-input-focus w3-input-any-change w3-padding-small","Notes","dx.filter_notes",dx.filter_notes,"dx_filter_cb")),90),w3_inline("w3-halign-space-around w3-margin-T-8 w3-text-white/",w3_checkbox("w3-retain-input-focus w3-label-inline w3-label-not-bold","case sensitive","dx.filter_case",dx.filter_case,"dx_filter_opt_cb"),w3_inline("",w3_text("","pattern match:"),w3_checkbox("w3-margin-left w3-retain-input-focus w3-label-inline w3-label-not-bold","grep","dx.filter_grep",dx.filter_grep,"dx_filter_opt_cb")))),450,140,dx_filter_panel_close),w3_field_select("id-dx-filter-ident",{mobile:1})}function dx_filter_panel_close(){var e=document.activeElement;e&&e.id&&(e.id.startsWith("id-dx-filter")||e.id.startsWith("id-dx.filter"))&&e.blur(),confirmation_panel_close()}function dx_filter_cb(e,t,_,a){_||(e&&w3_string_cb(e,t),t=""!=dx.filter_ident||""!=dx.filter_notes,wf_send("SET DX_FILTER i="+encodeURIComponent(dx.filter_ident+"x")+" n="+encodeURIComponent(dx.filter_notes+"x")+" c="+dx.filter_case+" w="+dx.filter_wild+" g="+dx.filter_grep),w3_remove_then_add("id-dx-container","whiteSmoke cl-dx-filtered",t?"cl-dx-filtered":"whiteSmoke"),t||a||dx_filter_panel_close())}function dx_filter_opt_cb(e,t,_){_||(t=+t,w3_bool_cb(e,t),dx_filter_cb("dx.filter_ident",dx.filter_ident,!1,!0),w3_checkbox_set(e,t),t&&"dx.filter_case"!=e&&dx_filter_opt_cb("dx.filter_wild"==e?"dx.filter_grep":"dx.filter_wild",0),w3_field_select("id-dx-filter-ident",{mobile:1}))}function dx_filter_field_err(e){w3_set_props("id-dx-filter-ident","w3-pink",1&e),w3_set_props("id-dx-filter-notes","w3-pink",2&e)}function dx_label_step(e){dx.db,dx.DB_EiBi;var t,_,a=freq_passband_center();if(1==e){for(t=0;t<dx.displayed.length;t++)if(_=dx.displayed[t]){var i=Math.round(_.f_label),o=_.gid==dx.last_stepped_gid,n=a<i;if(!o&&n)break}if(t==dx.displayed.length)return wf_send("SET MARKER db="+dx.db+" dir=1 freq="+(freq_displayed_Hz/1e3).toFixed(3)+" eibi_types_mask="+dx.eibi_types_mask.toHex()+" filter_tod="+dx.filter_tod[dx.db]),dx.step_dbg&&console.log(">>> STEP DX_STEP [[[REQ]]]"),void(dx.last_stepped_gid=-1)}else{for(t=dx.displayed.length-1;0<=t;t--)if(_=dx.displayed[t]){i=Math.round(_.f_label),o=_.gid==dx.last_stepped_gid,n=i<a;if(!o&&n)break}if(t<0)return wf_send("SET MARKER db="+dx.db+" dir=-1 freq="+(freq_displayed_Hz/1e3).toFixed(3)+" eibi_types_mask="+dx.eibi_types_mask.toHex()+" filter_tod="+dx.filter_tod[dx.db]),dx.step_dbg&&console.log("<<< STEP DX_STEP [[[REQ]]]"),void(dx.last_stepped_gid=-1)}e=kiwi.modes_lc[dx_decode_mode(_.flags)];dx.step_dbg&&console.log("STEP FOUND #"+t+" f="+(i/1e3).toFixed(2)+" f_pbc_Hz="+(a/1e3).toFixed(2)+" dl.freq="+_.freq+" "+_.ident+" "+e+" "+_.lo+" "+_.hi),freqmode_set_dsp_kHz(_.freq,e),0!=_.lo&&0!=_.hi?ext_set_passband(_.lo,_.hi):(e=kiwi_passbands(e),ext_set_passband(e.lo,e.hi)),dx.step_dbg&&console.log("STEP RENDER dx_sig_bw() gid="+_.gid),dx_sig_bw(_.gid),dx.last_stepped_gid=_.gid}function dx_admin_pwd_cb(e,t){w3_string_cb(e,t),ext_valpwd("admin",t,ws_wf)}function dx_show_edit_panel(e,t,_){dx_keys=e?{shift:e.shiftKey,alt:e.altKey,ctrl:e.ctrlKey,meta:e.metaKey}:{shift:0,alt:0,ctrl:0,meta:0},dx.o.gid=t,dx.db==dx.DB_STORED?ext_hasCredential("admin",function(e){e!=kiwi.BADP_OK?(extint_panel_hide(),e=w3_inline("",w3_div("w3-medium w3-text-aqua w3-bold","DX labels"),w3_select("w3-margin-L-32/w3-label-inline w3-text-white /w3-text-red","database:","","dx.db",dx.db,dx.db_s,"dx_database_cb"))+w3_div("w3-margin-T-16",w3_checkbox("/w3-label-inline w3-label-not-bold w3-text-white/","filter by time/day-of-week",dx.DB_STORED.toString()+"-filter-tod",dx.filter_tod[dx.DB_STORED],"dx_time_dow_cb"))+w3_div("w3-margin-T-16",w3_input("//w3-margin-T-8 w3-padding-small|width:80%","Admin password","dx.pwd","","dx_admin_pwd_cb"),w3_text("w3-margin-T-4","editing the stored DX labels of this Kiwi requires admin privileges")),ext_panel_set_name("dx"),ext_panel_show(e,null,null,null,!0),ext_set_controls_width_height(550,290),1!=_&&w3_field_select("id-dx.pwd",{mobile:1})):dx_show_edit_panel2()},null,ws_wf):dx_show_edit_panel2()}function dx_show_edit_panel2(){if(dx.db!=dx.DB_COMMUNITY){var e=dx.o.gid,t=isArg(cur_mode)?cur_mode:"am",_=isArg(freq_displayed_kHz_str)?freq_displayed_kHz_str:"10000";if(-1==e?(console.log("DX EDIT new f="+freq_car_Hz+"|"+freq_displayed_Hz+"|"+_+" m="+t),dx.o.fr=+_+kiwi.freq_offset_kHz,dx.o.lo=dx.o.hi=dx.o.o=dx.o.s=0,dx.o.fm=kiwi.modes_idx[t],dx.o.ft=dx.DX_QUICK_0,dx.o.fd=dx.DX_DOW_BASE,dx.o.begin=0,dx.o.end=0,dx.o.i=dx.o.n=dx.o.p=""):(t=dx.list[e],console.log("DX EDIT entry #"+e+" prev: f="+t.freq+"|"+t.carrier.toFixed(2)+" flags="+t.flags.toHex()+" i="+t.ident+" n="+t.notes),dx.o.fr=t.carrier.toFixed(2),dx.o.lo=t.lo,dx.o.hi=t.hi,dx.o.o=t.mkr_off,dx.o.s=t.sig_bw,dx.o.fm=dx_decode_mode(t.flags),dx.o.ft=(t.flags&dx.DX_TYPE)>>dx.DX_TYPE_SFT,dx.o.fd=(t.flags&dx.DX_DOW)>>dx.DX_DOW_SFT,0==dx.o.fd&&(dx.o.fd=dx.DX_DOW_BASE,kiwi_trace("$SHOULD NOT OCCUR")),dx.o.begin=t.begin,dx.o.end=t.end,dx.o.i=kiwi_decodeURIComponent("dx_ident",t.ident),dx.o.n=kiwi_decodeURIComponent("dx_notes",t.notes),dx.o.p=kiwi_decodeURIComponent("dx_params",t.params)),dx.o.mm=w3_array_el_seq(kiwi.mode_menu,kiwi.modes_uc[dx.o.fm]),dx.db==dx.DB_STORED&&-1!=e&&dx_keys.shift&&dx_keys.alt){var a=(a=dx.o.ft)==dx.DX_QUICK_0?dx.DX_QUICK_1:dx.DX_QUICK_0;dx.o.ft=a;a=dx.o.fd<<dx.DX_DOW_SFT|a<<dx.DX_TYPE_SFT|dx_encode_mode(dx.o.fm);return void dx_send_update("DX_QUICK",dx.o.gid,dx.o.fr,a,dx.o)}dx.o.fr=parseFloat(dx.o.fr).toFixed(2),dx.o.pb="",(dx.o.lo||dx.o.hi)&&(dx.o.lo==-dx.o.hi?dx.o.pb=(2*Math.abs(dx.o.hi)).toFixed(0):dx.o.pb=dx.o.lo.toFixed(0)+", "+dx.o.hi.toFixed(0))}extint_panel_hide();a=w3_inline("",w3_div("w3-medium w3-text-aqua w3-bold","DX labels"),w3_select("w3-margin-L-32/w3-label-inline w3-text-white /w3-text-red","database:","","dx.db",dx.db,dx.db_s,"dx_database_cb",0));if(dx.db==dx.DB_STORED){var i="",o=dx.o.fd;0==o&&(o=dx.o.fd=dx.DX_DOW_BASE),console.log("DX g="+e+" dow="+o+"|"+o.toHex(2)+" f="+(+dx.o.fr).toFixed(2)+" b="+dx.o.begin+" e="+dx.o.end+" "+dx.o.i);for(var n,s,r=0;r<7;r++){var l=o&1<<6-r,d=l?"black":"white",l=l?dx.dow_colors[r]:"darkGrey";i+=w3_button("w3-dummy//w3-round w3-padding-tiny"+(r?" w3-margin-L-4":"")+"|color:"+d+"; background:"+l,"MTWTFSS"[r],"dx_dow_button",r)}i=w3_inline("",i);var e=+dx.o.begin,c=+dx.o.end;0!=e||0!=c&&2400!=c?(n=e.toFixed(0).leadingZeros(4),s=c.toFixed(0).leadingZeros(4)):n=s="";var f=kiwi_deep_copy(dxcfg.dx_type);if(dx.types_n)for(r=0;r<dx.DX_N_STORED;r++)0!=dx.types_n[r]&&""==f[r].name&&(f[r].name="(T"+r+")");c=w3_divs("w3-text-white/w3-margin-T-8",w3_inline("w3-halign-space-between/",w3_input("w3-padding-small||size=10","Freq","dx.o.fr",dx.o.fr,"dx_freq_cb"),w3_select("w3-text-red","Mode","","dx.o.mm",dx.o.mm,kiwi.mode_menu,"dx_sel_cb"),w3_input("w3-padding-small||size=10","Passband","dx.o.pb",dx.o.pb,"dx_passband_cb"),w3_select("w3-text-red","Type","","dx.o.ft",dx.o.ft,f,"dx_sel_cb"),w3_input("w3-padding-small||size=8","Offset","dx.o.o",dx.o.o,"dx_num_cb")),w3_input("w3-label-inline/w3-padding-small","Ident","dx.o.i","","dx_string_cb"),w3_input("w3-label-inline/w3-padding-small","Notes","dx.o.n","","dx_string_cb"),w3_inline("w3-halign-space-between/",w3_input("w3-label-inline/w3-padding-small||size=40","Extension","dx.o.p","","dx_string_cb"),w3_input("/w3-flex-noshrink w3-label-inline/w3-padding-small||size=5","Sig bw","dx.o.s",dx.o.s,"dx_num_cb")),w3_inline("w3-hspace-16",w3_text("w3-text-white w3-bold","Schedule (UTC)"),i,w3_input("w3-label-inline/w3-padding-small","Begin","dx.o.begin",n,"dx_sched_time_cb"),w3_input("w3-label-inline/w3-padding-small","End","dx.o.end",s,"dx_sched_time_cb")),w3_inline("w3-hspace-16",w3_button("id-dx-modify w3-yellow","Modify","dx_modify_cb"),w3_button("id-dx-add w3-green","Add","dx_add_cb"),w3_button("w3-red","Delete","dx_delete_cb"),w3_div("w3-margin-T-4",w3_checkbox("/w3-label-inline w3-label-not-bold w3-text-white/","filter by time/day-of-week",dx.DB_STORED.toString()+"-filter-tod",dx.filter_tod[dx.DB_STORED],"dx_time_dow_cb"),w3_text("w3-margin-T-4","Create new label with Add button"))))}else c=dx.db==dx.DB_EiBi?(n="w3-halign-space-around/|flex-basis:130px",s=function(e){var t=dx_type2idx(e),e=dx.eibi_types_mask&1<<t?1:0;return w3_checkbox("/w3-label-inline w3-label-not-bold w3-round w3-padding-small/",dx.eibi_svc_s[t],"eibi-cbox"+t,e,"dx_eibi_svc_cb",t)},w3_inline("",w3_checkbox("w3-margin-TB-16/w3-label-inline w3-label-not-bold w3-text-white/w3-hspace-32","select all","eibi-all",4294967295==dx.eibi_types_mask,"dx_eibi_all_cb"),w3_checkbox("/w3-label-inline w3-label-not-bold w3-text-white/w3-margin-L-32","filter by time/day-of-week",dx.DB_EiBi.toString()+"-filter-tod",dx.filter_tod[dx.DB_EiBi],"dx_time_dow_cb"))+w3_div("w3-valign-col w3-round w3-padding-TB-10 w3-gap-10|background:whiteSmoke",w3_inline(n,s(dx.DX_BCAST),s(dx.DX_UTIL),s(dx.DX_TIME)),w3_inline(n,s(dx.DX_ALE),s(dx.DX_HFDL),s(dx.DX_MILCOM)),w3_inline(n,s(dx.DX_CW),s(dx.DX_FSK),s(dx.DX_FAX)),w3_inline(n,s(dx.DX_AERO),s(dx.DX_MARINE),s(dx.DX_SPY)))):w3_div("w3-margin-TB-16",w3_checkbox("/w3-label-inline w3-label-not-bold w3-text-white/","filter by time/day-of-week",dx.DB_COMMUNITY.toString()+"-filter-tod",dx.filter_tod[dx.DB_COMMUNITY],"dx_time_dow_cb"),w3_text("w3-margin-top w3-text-css-yellow","The community database is read-only and downloaded periodically. <br>"+dx.last_community_download));ext_panel_set_name("dx"),ext_panel_show(a+c,null,function(){if(dx.db==dx.DB_STORED)w3_el("dx.o.i").value=dx.o.i,w3_el("dx.o.n").value=dx.o.n,w3_el("dx.o.p").value=dx.o.p;else if(dx.db==dx.DB_EiBi)for(var e=0;e<dx.DX_N_EiBi;e++)w3_color("eibi-cbox"+e+"-label","black",dx.eibi_colors[e])},function(){},!0),ext_set_controls_width_height(550,290),dx.help&&(extint_help_click_now(),dx.help=!1)}function dx_database_cb(e,t,_,a,i){_||(dx.list=[],console_log_dbgUs("DX DB-SWITCHED db="+dx.db+" key_mod="+a),a==shortcut.CTL_ALT||a==shortcut.SHIFT_PLUS_CTL_ALT?(dx.filter_tod[dx.db]^=1,dx_time_dow_cb(dx.db.toString()+"-filter-tod",dx.filter_tod[dx.db])):(dx.db=+t,a==shortcut.SHIFT?dx_show_edit_panel(null,-1,i):ext_panel_displayed("dx")&&dx_close_edit_panel()),kiwi_storeSet("last_db",dx.db),bands_init(),mk_bands_scale(),mk_band_menu(),dx_schedule_update())}function dx_eibi_all_cb(e,t,_){if(!_)for(var a=t?1:0,i=0;i<dx.DX_N_EiBi;i++)dx_eibi_svc_cb("eibi-cbox"+i,a,!1,i)}function dx_time_dow_cb(e,t,_){_||(_=parseInt(e),dx.filter_tod[_]=t?1:0,w3_checkbox_set(e,t),dx_schedule_update())}function dx_eibi_svc_cb(e,t,_,a){_||(_=+a,a=t?1:0,w3_checkbox_set(e,t),a?dx.eibi_types_mask|=1<<_:dx.eibi_types_mask&=~(1<<_),dx_schedule_update())}function dx_close_edit_panel(e){e&&w3_radio_unhighlight(e),extint_panel_hide()}function dx_send_update(e,t,_,a,i){dx.retry=isNull(i)?{}:kiwi_deep_copy(i),dx.retry.gid=t,dx.retry.fr=_,dx.retry.flags=a,wf_send(-1!=t&&-1==_?"SET DX_UPD g="+t+" f=-1":"SET DX_UPD g="+t+" f="+_+" lo="+i.lo.toFixed(0)+" hi="+i.hi.toFixed(0)+" o="+i.o.toFixed(0)+" s="+i.s.toFixed(0)+" fl="+a+" b="+i.begin+" e="+i.end+" i="+encodeURIComponent(i.i+"x")+" n="+encodeURIComponent(i.n+"x")+" p="+encodeURIComponent(i.p+"x"))}function dx_send_update_retry(){dx_send_update("dx_send_update_retry",dx.retry.gid,dx.retry.fr,dx.retry.flags,dx.retry)}function dx_button_highlight(){w3_el(-1==dx.o.gid?"id-dx-add":"id-dx-modify").style.border="5px double red"}function dx_modify_cb(e,t){var _,a;console_log_dbgUs("DX COMMIT modify entry #"+dx.o.gid+" f="+dx.o.fr),console_log_dbgUs(dx.o),-1!=dx.o.gid&&(_=dx.o.fd<<dx.DX_DOW_SFT|dx.o.ft<<dx.DX_TYPE_SFT|dx_encode_mode(dx.o.fm),dx.o.fr<0&&(dx.o.fr=0),dx_send_update("DX_MODIFY",dx.o.gid,dx.o.fr,_,dx.o),a=w3_el("id-dx-modify"),setTimeout(function(){dx_close_edit_panel(e),a.style.border=""},250))}function dx_add_cb(e,t){var _=dx.o.fd<<dx.DX_DOW_SFT|dx.o.ft<<dx.DX_TYPE_SFT|dx_encode_mode(dx.o.fm);dx.o.fr<0&&(dx.o.fr=0),dx_send_update("DX_ADD",-1,dx.o.fr,_,dx.o),setTimeout(function(){dx_close_edit_panel(e)},250),owrx.dx_click_gid_last_until_tune=owrx.dx_click_gid_last_stored=void 0,dx_show(!1,-1)}function dx_delete_cb(e,t){-1!=dx.o.gid&&(dx_send_update("DX_DELETE",dx.o.gid,-1,0,null),setTimeout(function(){dx_close_edit_panel(e)},250),owrx.dx_click_gid_last_until_tune=owrx.dx_click_gid_last_stored=void 0,dx_show(!1,-1))}function dx_evt(e,t,_,a){var t=t.split(","),i=t[0],o=t[1],n=!0;switch(a.type){case"mouseenter":n=dx_enter(a,o);break;case"mouseleave":n=dx_leave(a,o);break;case"click":case"hold":case"touchend":n=dx_click(a,i);break;default:n=ignore(a)}return n}function dx_sig_bw(e){var t=0<=e?dx.list[e]:null;if(t&&isArg(t.sig_bw)&&0!=t.sig_bw){var _=w3_el("id-dx-sig");if(!_)return dx.sig_bw_render_gid=e,void(dx.step_dbg&&console.log("$dx_sig_bw OFF SCREEN sig_bw_render_gid="+e));var a=t.sig_bw/2,i=t.freq-kiwi.freq_offset_kHz,o=1e3*i,n=scale_px_from_freq(1e3*(i-a),g_range),a=scale_px_from_freq(1e3*(i+a),g_range),o=o+passband_offset_dxlabel(kiwi.modes_lc[dx_decode_mode(t.flags)],t.params,t.lo,t.hi);_.style.left=px(n),_.style.width=px(a-n),_.style.background=t.color,0==t.mkr_off&&(dx_canvas.style.left=px(scale_px_from_freq(o,g_range)-dx_car_w/2),dx_show(!0),dx.step_dbg&&console.log("$dx_sig_bw SHOW gid="+e),dx.sig_bw_render_gid=e)}else dx.step_dbg&&console.log("$dx_sig_bw OFF"),dx_show(!1),dx.sig_bw_render_gid=-1}function dx_click(e,t){var _,a,i,o,n,s,r="hold"==e.type;return!r&&e.shiftKey&&dx.db==dx.DB_STORED?dx_show_edit_panel(e,t):(w3_menu_close("dx_click"),dx_sig_bw(t),owrx.dx_click_gid_last_stored=dx.db==dx.DB_STORED?t:void 0,owrx.dx_click_gid_last_until_tune=t,a=(_=(s=dx.list[t]).freq)-kiwi.freq_offset_kHz,i=kiwi.modes_lc[dx_decode_mode(s.flags)],o=s.lo,n=s.hi,t=s.params,extint.extname=extint.param=null,isArg(t)&&(s=""==(t=decodeURIComponent(t))?[]:t.split(","),"drm"==i?(extint.extname="drm",s.push("lo:"+o),s.push("hi:"+n)):(extint.extname=s[0],s=s.slice(1)),"*"==s[0]&&(s[0]=_.toFixedNZ(2)),extint.param=s.join(",")),extint.extname,dx.db,dx.DB_EiBi,extint.mode_prior_to_dx_click=cur_mode,freqmode_set_dsp_kHz(a,i,{open_ext:!0,no_clear_last_gid:1}),(o||n)&&ext_set_passband(o,n,!1,a),r=kiwi_isMobile()?r:!r&&!any_alternate_click_event(e),"drm"!=i&&r&&!dx.ctrl_click&&t&&(console_log_dbgUs("dx_click ext="+extint.extname+" <"+extint.param+">"),extint_open(extint.extname,250)),dx.ctrl_click=!1),cancelEvent(e)}function dx_enter(e,t){e=e.target;dx.z_save=e.style.zIndex,e.style.zIndex=999,dx.bg_color_save=e.style.backgroundColor,e.style.backgroundColor=w3_contains(e,"cl-dx-label-filtered")?"lightGrey":w3_contains(e,"dx-has-ext")?"magenta":"yellow";e=w3_el("id-dx-line_"+e.id.parseIntEnd());e.zIndex=998,e.style.width="3px",+t&&(dx_canvas.style.left=px(t-dx_car_w/2),w3_visible(dx_canvas,!0))}function dx_leave(e,t){e=e.target;e.style.zIndex=dx.z_save,e.style.backgroundColor=dx.bg_color_save;e=w3_el("id-dx-line_"+e.id.parseIntEnd());e.zIndex=110,e.style.width="1px",+t&&(dx_canvas.style.visibility=dx.sig_bw_vis,dx_canvas.style.left=dx.sig_bw_left)}function dx_help(e){return e&&(confirmation_show_content(w3_text("w3-medium w3-bold w3-text-aqua","DX label help")+w3_div("w3-margin-T-8 w3-scroll-y|height:90%",w3_div("w3-margin-R-8",'There are three types of DX labels seen in the area above the frequency scale: <br>1) Labels from a stored database, editable by the Kiwi owner/admin. <br>2) Labels from a read-only copy of the <a href="http://www.eibispace.de" target="_blank">EiBi database</a> that cannot be modified. <br>3) Labels from a downloaded, read-only, community database aggregated from contributions made on the Kiwi forum. <br><br>The DX label control panel has a <i>database</i> menu to select between these three. Similarly, there are selection entries in the right-click menu (double-finger tap on mobile devices). The keyboard shortcut keys "\\" and "|" also switch between the databases with the later also opening the control panel.<br><br>When zoomed out the number of labels shown is limited to prevent overwhelming the display. This is why some labels will only appear as you zoom in. The same is true if too many EiBi categories are selected enabling a large number of labels.<br><br>Information about using the controls for editing the stored labels can be found <a href="http://kiwisdr.com/quickstart/index.html#id-user-marker" target="_blank">here</a>.<br><br>Because there are so many EiBi labels (about 6000) they are organized into 12 categories with visibility selected by checkboxes on the control panel.<br><br>Labels from any of the databases can be filtered by their schedule (UTC time & day-of-week) specified in the database. If filtering is disabled labels outside their scheduled time appear with a lighter category color and a dashed border. When filtering is enabled the label display will refresh every 5 minutes so it reflects the current schedule.<br><br>When a label is moused-over a popup is shown with additional information. On Safari and Chrome the popups take a few seconds to appear. EiBi information includes the station\'s home country, transmission schedule, language and target area (if any). Information about the EiBi database, including descriptions of the language and target codes seen in the mouse-over popups, <a href="http://kiwisdr.com/files/EiBi/README.txt" target="_blank">can be found here.</a><br><br>Labels that have an extension specified have a black bar on the right part of the label. <br>This is for consistency between the desktop and mobile interfaces. <br>Other behavior is device specific: <br><br>Desktop:<ul><li>Extension labels are magenta when moused-over as opposed to the usual yellow.</li><li>Labels outside their scheduled time (if any) will mouse-over grey.</li><li>Clicking the label sets the freq/mode and opens the extension.</li><li>For the stored database shift-clicking opens the label edit panel (admin only).</li><li>PC</li><ul><li>Alt-click sets the freq/mode without openning the extension.</li><li>Shift-alt-click to toggle the label active (admin only).</li></ul><li>Mac</li><ul><li>Alt/option-click sets the freq/mode without openning the extension.</li><li>Shift-alt/option-click to toggle the label active (admin only).</li><li>On Mac the control key can be used in place of alt/option.</li></ul></ul>Mobile:<ul><li>Touching a label sets the freq/mode.</li><li>Touch-hold a label to set freq/mode and open the extension.</li><li>After touching a label use the right-click menu to open edit panel for that label.</li></ul>For stored labels the extension is set per-label in the label edit panel and the extension opened when the label is clicked. For EiBi labels an extension is automatically assumed for many of the categories, but is only opened if the label is shift-clicked (note difference from stored label behavior, a non-shift click simply selects the frequency/mode).<br><br>URL parameters: (use "dx=<i>comma separated parameters</i>" in the browser URL)<br>Select database: '+w3_text("|color:orange","[012] <i>or</i> stored eibi community")+"<br>All: "+w3_text("|color:orange","filter[:0] <br>")+"<br> EiBi: "+w3_text("|color:orange","none bcast utility time ale hfdl milcom cw fsk fax aero marine spy <br>")+'<br>An optional first digit specifies the database to display (EiBi "1" is the default). Or use the database name. For EiBi: By default all the category checkboxes and "<i>filter by time/day-of-week</i>" are checked. Specifying <i>none</i> will uncheck all the categories. Specifying the individual category names will then toggle the checkbox state.<br><br>For example, to select only the EiBi ALE and Fax categories: <i>dx=none,ale,fax</i> <br>To select all except the CW and Time categories: <i>dx=cw,time</i> <br>To just bring up the EiBi control panel: <i>dx</i> (e.g. <i>my_kiwi:8073/?dx</i>)<br>Keywords are case-insensitive and can be abbreviated. For example: <br><i>dx=n,bc,f:0</i> (show only broadcast stations without time/day filtering) <br>To select the stored label database: <i>dx=0</i> or <i>dx=sto</i><br>')),650,375),w3_el("id-confirmation-container").style.height="100%"),!0}var sMeter_ctx,smeter_ovfl,SMETER_RHS=38,SMETER_SCALE_HEIGHT=29,SMETER_BIAS=127,SMETER_INPUT_MAX=3.4,SMETER_INPUT_RANGE=SMETER_BIAS+SMETER_INPUT_MAX,SMETER_DISPLAY_MAX=-6,SMETER_DISPLAY_RANGE=SMETER_BIAS+SMETER_DISPLAY_MAX,bars={dBm:[-121,-109,-97,-85,-73,-63,-53,-33,-13],text:["S1","S3","S5","S7","S9","+10","+20","+40","+60"]};function smeter_dBm_biased_to_x(e){return SMETER_DISPLAY_RANGE<e&&(e=SMETER_DISPLAY_RANGE),Math.round(e/SMETER_DISPLAY_RANGE*smeter_width)}function smeter_init(e){owrx.force_no_agc_thresh_smeter=e;var t=w3_el("id-control-smeter");if(t){w3_innerHTML(t,'<canvas id="id-smeter-scale" class="class-smeter-scale" width="0" height="0"></canvas>',w3_div("id-smeter-ovfl w3-hide","OV"),w3_div("id-smeter-dbm-value"),w3_div("id-smeter-dbm-units","dBm"));var _=w3_el("id-smeter-scale");smeter_ovfl=w3_el("smeter-ovfl");var a=divControl?divControl.activeWidth:350,i=html_LR_border_pad(_),o=smeter_width=a-SMETER_RHS-i,e=SMETER_SCALE_HEIGHT,n=e-8,a=o+SMETER_RHS;t.style.width=px(a+i),(sMeter_ctx=_.getContext("2d")).canvas.width=a,sMeter_ctx.canvas.height=e,sMeter_ctx.fillStyle="gray",sMeter_ctx.globalAlpha=1,sMeter_ctx.fillRect(0,0,a,e),sMeter_ctx.font="11px Verdana",sMeter_ctx.textBaseline="middle",sMeter_ctx.textAlign="center",sMeter_ctx.fillStyle="white";for(var s=0;s<bars.text.length;s++){var r=smeter_dBm_biased_to_x(bars.dBm[s]+SMETER_BIAS);line_stroke(sMeter_ctx,1,3,"white",r,n-8,r,8+n),sMeter_ctx.fillText(bars.text[s],r,n-15)}line_stroke(sMeter_ctx,0,5,"black",0,n,o,n),kiwi_clearInterval(owrx.smeter_interval),owrx.smeter_interval=setInterval(update_smeter,100)}}var ident_tout,sm_px=0,sm_timeout=0,sm_interval=10,sm_ovfl_showing=!1;function update_smeter(){var e,t=smeter_dBm_biased_to_x(owrx.sMeter_dBm_biased),_=SMETER_SCALE_HEIGHT-8,a=smeter_width;sMeter_ctx.globalAlpha=1,line_stroke(sMeter_ctx,0,5,"lime",0,_,t,_),cfg.agc_thresh_smeter&&1!=owrx.force_no_agc_thresh_smeter&&(e=smeter_dBm_biased_to_x(-(ext_mode(cur_mode).CW?threshCW:thresh)),line_stroke(sMeter_ctx,0,2,"white",0,_-3,a-e,_-3),line_stroke(sMeter_ctx,0,2,"black",a-e,_-3,a,_-3)),0==sm_timeout--?(sm_timeout=sm_interval,t<sm_px&&line_stroke(sMeter_ctx,0,5,"black",t,_,sm_px,_),sm_px=t):t<sm_px?line_stroke(sMeter_ctx,0,5,"red",t,_,sm_px,_):(sm_px=t,sm_timeout=sm_interval),audio_ext_adc_ovfl&&!sm_ovfl_showing?(w3_hide("id-smeter-dbm-units"),w3_show("id-smeter-ovfl"),w3_call("S_meter_adc_ovfl",!0),sm_ovfl_showing=!0):!audio_ext_adc_ovfl&&sm_ovfl_showing&&(w3_hide("id-smeter-ovfl"),w3_show("id-smeter-dbm-units"),w3_call("S_meter_adc_ovfl",!1),sm_ovfl_showing=!1),w3_innerHTML("id-smeter-dbm-value",owrx.sMeter_dBm.toFixed(0))}var ident_user="",send_ident=!1;function ident_init(){var e=Math.max(cfg.ident_len,kiwi.ident_min);user_url&&(user_url=kiwi_decodeURIComponent("user_url",user_url),user_url=kiwi_strip_tags(user_url,"").substring(0,e),writeCookie("ident",user_url));var t=initCookie("ident",""),t=kiwi_strip_tags(t,"").substring(0,e);t=kiwi_strip_tags(t,"").substring(0,e);var _=w3_el("id-ident-input1"),a=w3_el("id-ident-input2");w3_attribute(_,"maxlength",e),w3_attribute(a,"maxlength",e),_.value=t,a.value=t,ident_user=t,send_ident=!0}function ident_complete(e,t){var _=w3_el("id-ident-input"+t),a=w3_el("id-ident-input"+(1==t?2:1)),i=_.value,t=Math.max(cfg.ident_len,kiwi.ident_min),i=kiwi_strip_tags(i,"").substring(0,t);_.value=i,a.value=i,kiwi_clearTimeout(ident_tout),w3_schedule_highlight(_),w3_schedule_highlight(a),freqset_select(),writeCookie("ident",i),ident_user=i,send_ident=!0}function ident_keyup(e,t,_){if(kiwi_clearTimeout(ident_tout),null!=t&&null!=t.key){var a=t.key.length;if(any_alternate_click_event_except_shift(t)||1!=a&&"Backspace"!=t.key&&"Shift"!=t.key)return void("Enter"==t.key&&ident_complete("Enter",_))}send_ident||(ident_tout=setTimeout(function(){ident_complete("t/o",_)},5e3))}var shortcut={nav_off:0,keys:null,NO_MODIFIER:0,SHIFT:1,CTL_ALT:2,SHIFT_PLUS_CTL_ALT:3,KEYCODE_ALT:18};function shortcut_key_mod(e){var t=e.shiftKey,_=e.ctrlKey,a=e.altKey,a=(e.metaKey,_||a);return t&&!a?shortcut.SHIFT:!t&&a?shortcut.CTL_ALT:t&&a?shortcut.SHIFT_PLUS_CTL_ALT:shortcut.NO_MODIFIER}function keyboard_shortcut_init(){kiwi_isMobile()&&!mobile_laptop_test||kiwi_isFirefox()<47||kiwi_isChrome()<=49||kiwi_isOpera()<=36||(shortcut.help=w3_div("",w3_inline_percent("w3-padding-tiny w3-bold w3-text-aqua","Keys",25,"Function"),w3_inline_percent("w3-padding-tiny","g =",25,"select frequency entry field"),w3_inline_percent("w3-padding-tiny","j i LR-arrow-keys",25,"frequency step down/up, add shift or alt for faster<br>&nbsp;&nbsp;&nbsp;shift plus alt to step to next/prev DX label"),w3_inline_percent("w3-padding-tiny","m n N",25,"toggle frequency memory menu, VFO A/B, VFO A=B"),w3_inline_percent("w3-padding-tiny","b B",25,"scroll band menu"),w3_inline_percent("w3-padding-tiny","e E",25,"scroll extension menu"),w3_inline_percent("w3-padding-tiny","a A d l u c f q",25,"toggle modes: AM SAM DRM LSB USB CW NBFM IQ<br>add alt to toggle backwards (e.g. SAM modes)"),w3_inline_percent("w3-padding-tiny","p P alt-p",25,"passband narrow/widen, restore default"),w3_inline_percent("w3-padding-tiny","UD-arrow-keys",25,"passband adjust both, right(shift), left(alt) edges"),w3_inline_percent("w3-padding-tiny","r",25,"toggle audio recording"),w3_inline_percent("w3-padding-tiny","z Z",25,"zoom in/out, add alt for max in/out"),w3_inline_percent("w3-padding-tiny","< >",25,"waterfall page down/up"),w3_inline_percent("w3-padding-tiny","w W",25,"waterfall min dB slider -/+ 1 dB, add alt for -/+ 10 dB"),w3_inline_percent("w3-padding-tiny","S D",25,"waterfall auto-scale, spectrum slow device mode"),w3_inline_percent("w3-padding-tiny","s alt-s",25,"spectrum RF/AF/off toggle, add alt to toggle backwards"),w3_inline_percent("w3-padding-tiny","v V space",25,"volume less/more, mute"),w3_inline_percent("w3-padding-tiny","o",25,'toggle between option bar "off" and "stats" mode,<br>others selected by related shortcut key'),w3_inline_percent("w3-padding-tiny","!",25,"toggle aperture manual/auto menu"),w3_inline_percent("w3-padding-tiny","@",25,"DX label filter"),w3_inline_percent("w3-padding-tiny","\\ |",25,'toggle (& open) DX stored/EiBi/community database<br>&nbsp;&nbsp;&nbsp;alt to toggle "filter by time/day-of-week" checkbox'),w3_inline_percent("w3-padding-tiny","x y",25,"toggle visibility of control panels, top bar"),w3_inline_percent("w3-padding-tiny","esc",25,"close/cancel action"),w3_inline_percent("w3-padding-tiny","? h",25,"toggle this help list"),w3_inline_percent("w3-padding-tiny","H",25,"Open extension help"),w3_inline_percent("w3-padding-tiny w3-bold w3-text-aqua","",25,"Windows, Linux: use alt key, not control key"),w3_inline_percent("w3-padding-tiny w3-bold w3-text-aqua","",25,"Mac: use alt/option or control key")),w3_el("id-kiwi-body").addEventListener("keydown",keyboard_shortcut_event,!0))}function keyboard_shortcut_help(){confirmation_show_content(shortcut.help,550,625)}function keyboard_shortcut_nav(e){w3_el("id-nav-optbar-"+e).click(),shortcut.nav_click=!0}function keyboard_shortcut_url_keys(){var e;isNonEmptyArray(shortcut.keys)?(e=shortcut.keys.shift(),console.log("URL shortcut key="+e),keyboard_shortcut(e,0,0),setTimeout(keyboard_shortcut_url_keys,200)):shortcut.keys=null}function keyboard_shortcut(e,t,_,a){var i=_?-1:1,o=shortcut.nav_click=!1;switch(e){case"a":mode_button(null,w3_el("id-button-am"),i);break;case"A":mode_button(null,w3_el("id-button-sam"),i);break;case"d":ext_set_mode("drm",null,{open_ext:!0});break;case"l":mode_button(null,w3_el("id-button-lsb"),i);break;case"u":mode_button(null,w3_el("id-button-usb"),i);break;case"c":mode_button(null,w3_el("id-button-cw"),i);break;case"f":mode_button(null,w3_el("id-button-nbfm"),i);break;case"q":ext_set_mode("iq");break;case"j":case"J":case"ArrowLeft":t!=shortcut.SHIFT_PLUS_CTL_ALT?freqstep(owrx.wf_snap?t:2-t):dx_label_step(-1);break;case"i":case"I":case"ArrowRight":t!=shortcut.SHIFT_PLUS_CTL_ALT?freqstep(owrx.wf_snap?5-t:3+t):dx_label_step(1);break;case"p":case"P":t==shortcut.CTL_ALT?(restore_passband(cur_mode),demodulator_analog_replace(cur_mode)):passband_increment("P"==e,owrx.PB_NO_EDGE);break;case"ArrowUp":case"ArrowDown":var n=owrx.PB_LEFT_EDGE;t==shortcut.NO_MODIFIER?n=owrx.PB_NO_EDGE:t==shortcut.SHIFT&&(n=owrx.PB_RIGHT_EDGE),passband_increment("ArrowUp"==e,n);break;case"v":setvolume(1,kiwi.volume-5),toggle_or_set_mute(0),keyboard_shortcut_nav("audio");break;case"V":setvolume(1,kiwi.volume+5),toggle_or_set_mute(0),keyboard_shortcut_nav("audio");break;case" ":toggle_or_set_mute(),shortcut.nav_click=!0;break;case"g":case"=":freqset_select();break;case"m":freq_memory_menu_show(!0);break;case"b":band_scroll(1);break;case"B":band_scroll(-1);break;case"n":freq_vfo_cb();break;case"N":vfo_update(!0);break;case"<":page_scroll(-page_scroll_amount);break;case">":page_scroll(+page_scroll_amount);break;case"z":zoom_step(_?ext_zoom.NOM_IN:ext_zoom.IN);break;case"Z":zoom_step(_?ext_zoom.MAX_OUT:ext_zoom.OUT);break;case"w":incr_mindb(1,_?-10:-1),keyboard_shortcut_nav("wf");break;case"W":incr_mindb(1,_?10:1),keyboard_shortcut_nav("wf");break;case"s":toggle_or_set_spec(null,null,i),keyboard_shortcut_nav("wf");break;case"S":wf_autoscale_cb(),keyboard_shortcut_nav("wf");break;case"D":toggle_or_set_slow_dev(),keyboard_shortcut_nav("wf");break;case"!":keyboard_shortcut_nav("wf"),wf_aper_cb("wf.aper",1^wf.aper,!1);break;case"o":keyboard_shortcut_nav(shortcut.nav_off?"status":"off"),shortcut.nav_off^=1;break;case"r":toggle_or_set_rec();break;case"x":toggle_or_set_hide_panels();break;case"y":toggle_or_set_hide_bars();break;case"@":dx_filter(),shortcut.nav_click=!0;break;case"e":extension_scroll(1);break;case"E":extension_scroll(-1);break;case"?":case"h":keyboard_shortcut_help();break;case"H":extint.current_ext_name&&w3_call(extint.current_ext_name+"_help",!0);break;case"|":ext_panel_displayed("dx")||(o=!0);case"\\":t!=shortcut.CTL_ALT&&t!=shortcut.SHIFT_PLUS_CTL_ALT||(o=!0),o||(dx.db=(dx.db+1)%dx.DB_N),dx_database_cb("",dx.db,!1,t,!0);break;default:1==e.length&&a!=shortcut.KEYCODE_ALT&&console.log("no shortcut key <"+e+">")}ignore_next_keyup_event=!0}function keyboard_shortcut_event(e){if(e.target){var t=e.key;if("Escape"!=t&&!t.match(/F[1-9][12]?/)){shift_event(e,"keydown");var _=e.target.id;""==_&&w3_iterate_classList(e.target,function(e,t){e.startsWith("id-")&&(_=e)});var a=e.shiftKey,i=e.ctrlKey,o=e.altKey,n=e.metaKey,s=i||o,r=shortcut_key_mod(e),l="0"<=t&&t<="9"&&!i||"."==t||","==t||"/"==t||":"==t||"-"==t||"k"==t||"M"==t||"Enter"==t||"Backspace"==t||"Delete"==t;if("INPUT"!=e.target.nodeName||"id-freq-input"==_&&!l){if(kiwi_isMacOS()){if(n)return}else if(i)return;return o&&!t.startsWith("Arrow")&&(t=String.fromCharCode(e.keyCode).toLowerCase(),a&&(t=t.toUpperCase())),keyboard_shortcut(t,r,s,e.keyCode),cancelEvent(e)}}}}function extension_scroll(e){console.log("extension_scroll dir="+e),console.log(extint_names);var t=w3_el("id-select-ext");console.log(t);var _,a=t.childNodes;console.log(a);var i=+t.value+1;for(console.log("extension_scroll initial i="+i);(i+=e)<1&&(i=a.length-1),i>=a.length&&(i=1),_=a[i],_.disabled;);var o=+_.value,t=+_.getAttribute("kiwi_idx");console.log("extension_scroll i="+i+" val="+o+" idx="+t+" "+_.innerHTML),w3_select_value("id-select-ext",o),owrx.sel_ext_to&&kiwi_clearTimeout(owrx.sel_ext_to),owrx.sel_ext_to=setTimeout(function(){extint_select(o)},2e3)}var ac_play_button,panel_margin=10;function check_suspended_audio_state(){try{if(window.AudioContext=window.AudioContext||window.webkitAudioContext,ac_play_button=new AudioContext,kiwi_isSafari()){var t=ac_play_button.createBufferSource();t.connect(ac_play_button.destination);try{t.start(0)}catch(e){t.noteOn(0)}}setTimeout(test_audio_suspended,500)}catch(e){console.log("#### no AudioContext?")}}function test_audio_suspended(){var e;"running"!=ac_play_button.state&&(e=w3_div('id-play-button-container class-overlay-container||onclick="play_button()"',w3_div("id-play-button",'<img src="gfx/openwebrx-play-button.png" width="150" height="150" /><br><br>'+(kiwi_isMobile()?"Tap to":"Click to")+" start OpenWebRX")),w3_create_appendElement("id-kiwi-body","div",e),el=w3_el("id-play-button"),el.style.marginTop=px(w3_center_in_window(el)))}function play_button(){try{if(kiwi_is_iOS()){var e=audio_context,t=e.createBufferSource();t.connect(e.destination);try{t.start(0)}catch(e){t.noteOn(0)}}else try{audio_context&&audio_context.resume()}catch(e){console.log("#### audio_context.resume() FAILED")}}catch(e){add_problem("audio start")}w3_el("id-play-button-container").style.opacity=0,setTimeout(function(){w3_hide("id-play-button-container")},1100),audio_reset(),freqset_select()}function panels_setup(){var o;w3_el("id-ident").innerHTML=w3_input('w3-label-not-bold/w3-custom-events|padding:1px|size=20 onchange="ident_complete(\'el\', 1)" onkeyup="ident_keyup(this, event, 1)"',"Your name or callsign:","ident-input1");var e=kiwi_isMobile()?" inputmode="+dq(kiwi_is_iOS()?"decimal":"tel")+' ontouchstart="popup_keyboard_touchstart(event)" onclick="this.select()"':"";w3_el("id-control-freq1").innerHTML=w3_inline("w3-halign-space-between/",w3_div("id-freq-cell",'<form id="id-freq-form" name="form_freq" action="#" onsubmit="freqset_complete(0); return false;">'+w3_input("w3-custom-events w3-font-16px|margin: 2px 0 0 2px; padding:0 4px; width:"+freq_field_width()+'|type="text"'+e+' onchange="freqset_complete(1)" onkeyup="freqset_keyup(this, event)"',"","id-freq-input")+"</form>")+'<select id="id-select-band" class="w3-pointer w3-select-menu" onchange="select_band(this.value)">'+setup_band_menu()+'</select><select id="id-select-ext" class="w3-pointer w3-select-menu" onchange="freqset_select(); extint_select(this.value)"><option value="-1" selected disabled>extension</option>'+extint_select_build_menu()+"</select>"),check_suspended_audio_state(),w3_el("id-control-freq2").innerHTML=w3_inline("w3-halign-space-between w3-margin-T-4/",w3_icon("id-freq-menu w3-menu-button","fa-bars w3-text-white",20,"","freq_memory_menu_show"),w3_button('id-freq-vfo w3-text-in-circle w3-wh-20px w3-aqua||title="VFO A&slash;B"',"A","freq_vfo_cb"),kiwi_isMobile()?null:w3_div("id-freq-link|padding-left:0px"),w3_div("id-9-10-cell w3-hide",w3_div('id-button-9-10 class-button-small||title="LW/MW 9/10 kHz tuning step" onclick="button_9_10()"',"10")),w3_div("id-step-freq",'<img id="id-step-0" src="icons/stepdn.20.png" onclick="freqstep(0, event.shiftKey)" />','<img id="id-step-1" src="icons/stepdn.18.png" onclick="freqstep(1, event.shiftKey)" style="padding-bottom:1px" />','<img id="id-step-2" src="icons/stepdn.16.png" onclick="freqstep(2, event.shiftKey)" style="padding-bottom:2px" />','<img id="id-step-3" src="icons/stepup.16.png" onclick="freqstep(3, event.shiftKey)" style="padding-bottom:2px" />','<img id="id-step-4" src="icons/stepup.18.png" onclick="freqstep(4, event.shiftKey)" style="padding-bottom:1px" />','<img id="id-step-5" src="icons/stepup.20.png" onclick="freqstep(5, event.shiftKey)" />'),w3_div("",w3_button('id-button-spectrum class-button|font-size: 12px|title="toggle spectrum display"',"Spec","toggle_or_set_spec")),w3_div("",w3_div('fa-stack||title="record"',w3_icon("id-rec1","fa-repeat fa-stack-1x w3-text-pink",22,"","toggle_or_set_rec"))),w3_div('|width:8%|title="mute"',w3_div("id-mute-no fa-stack|width:100%; color:lime",w3_icon("","fa-volume-up fa-stack-2x",24,"inherit","toggle_or_set_mute")),w3_div("id-mute-yes fa-stack w3-hide|width:100%;color:magenta;",w3_icon("","fa-volume-off fa-stack-2x fa-nudge-left",24,"","toggle_or_set_mute"),w3_icon("","fa-times fa-right",12,"","toggle_or_set_mute")),w3_div("id-mute-exclaim fa-stack w3-hide|width:100%; color:yellow",w3_icon("","fa-exclamation-triangle fa-stack-1x",20,"inherit","freqset_select")))),button_9_10(step_9_10=isNaN(override_9_10)?null==(n=ext_get_cfg_param("init.AM_BCB_chan"))||null==n||n?0:1:override_9_10),o="",mode_buttons.forEach(function(e,t){var _=e.s[0],a=_.toLowerCase(),i=e.dis||"drm"==a&&!kiwi.DRM_enable,e=i?"":' onclick="mode_button(event, this)"';e+=' onmouseover="mode_over(event, this)"',o+=w3_div("id-button-"+a+" id-mode-"+ext_mode(a).str+" class-button"+(i?" class-button-disabled":"")+' ||id="'+t+'-id-mode-col"'+e+' onmousedown="cancelEvent(event)"',_)}),w3_el("id-control-mode").innerHTML=w3_inline("w3-halign-space-between/",o);var t=wf.audioFFT_active?" w3-disabled":"",_=wf.audioFFT_active?' w3-disabled||onclick="audioFFT_update()"':"";w3_el("id-control-zoom").innerHTML=w3_inline("w3-halign-space-between/",w3_div("id-zoom-in class-icon"+t+'||onclick="zoom_click(event,1)" onmouseover="zoom_over(event)" title="zoom in"','<img src="icons/zoomin.png" width="32" height="32" />'),w3_div("id-zoom-out class-icon"+t+'||onclick="zoom_click(event,-1)" onmouseover="zoom_over(event)" title="zoom out"','<img src="icons/zoomout.png" width="32" height="32" />'),w3_div("id-maxin"+_,w3_div('class-icon||onclick="zoom_click(event,8)" title="max in"','<img src="icons/maxin.png" width="32" height="32" />')),w3_div("id-maxin-nom w3-hide"+_,w3_div('class-icon||onclick="zoom_click(event,8)" title="max in"','<img src="icons/maxin.nom.png" width="32" height="32" />')),w3_div("id-maxin-max w3-hide"+_,w3_div('class-icon||onclick="zoom_click(event,8)" title="max in"','<img src="icons/maxin.max.png" width="32" height="32" />')),w3_div("id-maxout"+_,w3_div('class-icon||onclick="zoom_click(event,-9)" title="max out"','<img src="icons/maxout.png" width="32" height="32" />')),w3_div("id-maxout-max w3-hide"+_,w3_div('class-icon||onclick="zoom_click(event,-9)" title="max out"','<img src="icons/maxout.max.png" width="32" height="32" />')),w3_div("class-icon"+t+'||onclick="zoom_click(event,0)" title="zoom to band"','<img src="icons/zoomband.png" width="32" height="16" style="padding-top:13px; padding-bottom:13px;"/>'),w3_div("class-icon"+t+'||onclick="page_scroll_icon_click(event,'+-page_scroll_amount+')" title="page down\nalt: label step"','<img src="icons/pageleft.png" width="32" height="32" />'),w3_div("class-icon"+t+'||onclick="page_scroll_icon_click(event,'+page_scroll_amount+')" title="page up\nalt: label step"','<img src="icons/pageright.png" width="32" height="32" />'));var a,i=["w3-pink","w3-blue","w3-purple","w3-aqua","w3-yellow","w3-black","w3-red","w3-amber","w3-green","w3-orange","w3-lime","w3-indigo","w3-brown","w3-teal"],e=0,n=" w3-center|width:15.2%",_=n+";margin-right:6px";w3_el("id-optbar").innerHTML=w3_navbar("cl-optbar",w3_navdef(i[e++]+_,"WF","optbar-wf","optbar"),w3_nav(i[e++]+_,"Audio","optbar-audio","optbar"),w3_nav(i[e++]+_,"AGC","optbar-agc","optbar"),w3_nav(i[e++]+_,"Users","optbar-users","optbar"),w3_nav(i[+e]+_,"Stats","optbar-status","optbar"),w3_nav(i[5]+n,"Off","optbar-off","optbar")),wf_filter=readCookie("last_wf_filter",wf_sp_menu_e.OFF),spec_filter=readCookie("last_spec_filter",wf_sp_menu_e.IIR),isString(spectrum_show)&&(a=spectrum_show.toLowerCase(),wf_sp_menu_s.forEach(function(e,t){a==e.toLowerCase()&&(spec_filter=t)})),wf.max_min_sliders=w3_col_percent("w3-valign/class-slider",w3_text("w3-text-css-orange","WF max"),19,w3_slider("id-input-maxdb w3-wheel","","",maxdb,-100,20,1,"setmaxdb_cb"),60,w3_div("id-field-maxdb class-slider"),19)+w3_col_percent("w3-valign/class-slider",w3_text("w3-text-css-orange","WF min"),19,w3_slider("id-input-mindb w3-wheel","","",mindb,-190,-30,1,"setmindb_cb"),60,w3_div("id-field-mindb class-slider"),19),wf.floor_ceil_sliders=w3_col_percent("w3-valign/class-slider",w3_text("w3-text-css-orange","WF ceil"),19,w3_slider("id-input-ceildb w3-wheel","","",wf.auto_ceil.val,-30,30,1,"setceildb_cb"),60,w3_div("id-field-ceildb class-slider"),19)+w3_col_percent("w3-valign/class-slider",w3_text("w3-text-css-orange","WF floor"),19,w3_slider("id-input-floordb w3-wheel","","",wf.auto_floor.val,-30,30,1,"setfloordb_cb"),60,w3_div("id-field-floordb class-slider"),19),w3_el("id-optbar-wf").innerHTML=w3_div("id-aper-data w3-hide w3-margin-B-5|left:0px; width:256px; height:16px; background-color:#575757; overflow:hidden; position:relative;",'<canvas id="id-aper-canvas" width="256" height="16" style="position:absolute"></canvas>')+w3_col_percent("",w3_div("",w3_div("id-wf-sliders",wf.max_min_sliders),w3_col_percent("w3-valign/class-slider",w3_text("w3-text-css-orange","WF rate"),19,w3_slider("id-slider-rate w3-wheel"+t,"","",wf_speed,0,4,1,"setwfspeed_cb"),60,w3_div("slider-rate-field class-slider"),19),w3_col_percent("w3-valign/class-slider",w3_button("id-wf-sp-button class-button w3-font-12px","Spec &Delta;","toggle_or_set_wf_sp_button"),19,w3_slider("id-wf-sp-slider w3-wheel","","wf_sp_param",wf_sp_param,0,10,1,"wf_sp_slider_cb"),60,w3_div("id-wf-sp-slider-field class-slider"),19)),84,w3_divs("/w3-tspace-4 w3-hcenter w3-font-11_25px",w3_button('id-button-wf-autoscale class-button||title="waterfall auto scale"',"Auto<br>Scale","wf_autoscale_cb"),w3_button('id-button-slow-dev class-button||title="slow device mode"',"Slow<br>Dev","toggle_or_set_slow_dev"),w3_inline("",w3_button('id-button-spec-peak0 class-button w3-noactive w3-hold|border: 2px solid yellow; padding: 1px 3px|title="toggle peak hold\n#1: off-on-hold\nshift: toggle backwards"',"P1","toggle_or_set_spec_peak",0),w3_button('id-button-spec-peak1 w3-margin-L-4 class-button w3-noactive w3-hold|border: 2px solid magenta; padding: 1px 3px|title="toggle peak hold\n#2: off-on-hold\nshift: toggle backwards"',"P2","toggle_or_set_spec_peak",1))),16)+w3_inline("w3-halign-space-between w3-margin-T-2/",w3_select('w3-text-red||title="colormap selection"',"","color<br>map","wf.cmap",wf.cmap,kiwi.cmap_s,"wf_cmap_cb"),w3_select('w3-text-red||title="aperture selection"',"","aper","wf.aper",wf.aper,kiwi.aper_s,"wf_aper_cb"),w3_select('w3-text-red||title="waterfall filter selection"',"","wf","wf_filter",wf_filter,wf_sp_menu_s,"wf_sp_menu_cb",1),w3_select('w3-text-red||title="spectrum filter selection"',"","spec","spec_filter",spec_filter,wf_sp_menu_s,"wf_sp_menu_cb",0),w3_icon('id-wf-gnd w3-momentary||title="disable waterfall input"',"fa-caret-down",22,"white","wf_gnd_cb",1),w3_button('id-button-wf-more class-button w3-text-orange||onclick="extint_open(\'waterfall\'); freqset_select();" title="more waterfall params"',"More")),setwfspeed_cb("",wf_speed,1),toggle_or_set_slow_dev(toggle_e.FROM_COOKIE|toggle_e.SET,0),toggle_or_set_spec_peak(toggle_e.FROM_COOKIE|toggle_e.SET_URL,peak_initially1,0),toggle_or_set_spec_peak(toggle_e.FROM_COOKIE|toggle_e.SET_URL,peak_initially2,1),toggle_or_set_wf_sp_button(toggle_e.FROM_COOKIE|toggle_e.SET,0);de_emphasis=readCookie("last_de_emphasis",0),de_emphasis=w3_clamp(de_emphasis,0,2,0),de_emphasis_nfm=readCookie("last_de_emphasis_nfm",0),de_emphasis_nfm=w3_clamp(de_emphasis_nfm,0,2,0),kiwi.pan=readCookie("last_pan",0),w3_el("id-optbar-audio").innerHTML=w3_inline_percent("w3-valign/w3-last-halign-end",w3_text("w3-text-css-orange cl-closer-spaced-label-text","Noise"),17,w3_select_conditional('w3-text-red||title="noise blanker selection"',"","blanker","nb_algo",0,[["off",1],["std",1],["Wild",1]],"nb_algo_cb","m"),24,w3_div("w3-hcenter",w3_div('class-button w3-text-orange||onclick="extint_open(\'noise_blank\'); freqset_select();" title="noise blanker parameters"',"More")),19,w3_div("w3-hcenter ",w3_select_conditional('w3-text-red||title="noise filter selection"',"","filter","nr_algo",0,[["off",1],["wdsp",1],["LMS",1],["spec",1]],"nr_algo_cb","m")),27,w3_div('class-button w3-text-orange||onclick="extint_open(\'noise_filter\'); freqset_select();" title="noise filter parameters"',"More"))+w3_inline_percent("id-vol w3-valign w3-margin-T-2 w3-hide/class-slider w3-last-halign-end",w3_text("w3-text-css-orange","Volume"),17,w3_slider("id-input-volume w3-wheel","","",kiwi.volume,0,200,1,"setvolume_cb"),50,"&nbsp;",8,w3_div("",w3_select('id-deemp id-deemp1-ofm w3-text-red||title="de-emphasis"',"","de-<br>emp","de_emphasis",de_emphasis,de_emphasis_s,"de_emp_cb",0),w3_select('id-deemp id-deemp1-nfm w3-text-red w3-hide||title="de-emphasis"',"","de-<br>emp","de_emphasis_nfm",de_emphasis_nfm,de_emphasis_nfm_s,"de_emp_cb",1)))+w3_inline_percent("id-vol-comp w3-valign w3-margin-T-2/class-slider w3-last-halign-end",w3_text("w3-text-css-orange","Volume"),17,w3_slider("id-input-volume w3-wheel","","",kiwi.volume,0,200,1,"setvolume_cb"),50,w3_div("",w3_select('id-deemp id-deemp2-ofm w3-text-red||title="de-emphasis"',"","de-<br>emp","de_emphasis",de_emphasis,de_emphasis_s,"de_emp_cb",0),w3_select("id-deemp id-deemp2-nfm w3-text-red w3-hide","","de-<br>emp","de_emphasis_nfm",de_emphasis_nfm,de_emphasis_nfm_s,"de_emp_cb",1)),28,w3_button('id-button-compression class-button w3-hcenter||title="compression"',"Comp","toggle_or_set_compression"))+w3_inline_percent("id-pan w3-valign w3-hide/class-slider w3-last-halign-end",w3_text("w3-text-css-orange","Pan"),17,w3_slider("id-pan-value w3-wheel","","",kiwi.pan,-1,1,.01,"setpan_cb"),50,"&nbsp;",3,w3_div("id-pan-field"),8,"&nbsp;",7,w3_button('id-button-compression class-button w3-hcenter||title="compression"',"Comp","toggle_or_set_compression"))+w3_inline_percent("id-squelch w3-valign/class-slider w3-last-halign-end",w3_text("id-squelch-label","Squelch"),15,w3_icon('||title="toggle squelch"',"fa-caret-down",22,"lime","squelch_zero_cb",1),3,w3_slider("id-squelch-value w3-wheel","","",squelch,0,99,1,"set_squelch_cb"),42,w3_div("id-squelch-field w3-center class-slider"),14,w3_select('id-pre-rec w3-margin-R-4 w3-hide w3-text-red||title="pre-record time"',"","pre","pre_record",pre_record,pre_record_s,"pre_record_cb"),16,w3_select('id-squelch-tail w3-hide w3-text-red||title="squelch tail length"',"","tail","squelch_tail",squelch_tail,squelch_tail_s,"squelch_tail_cb"))+w3_inline_percent("id-sam-carrier-container w3-hide w3-valign/",w3_inline("w3-halign-space-between/w3-last-halign-end",w3_text("w3-text-css-orange","SAM"),w3_text("id-sam-carrier")),50,w3_div(),5,w3_inline("w3-halign-space-between/w3-last-halign-end",w3_select('w3-text-red||title="PLL speed"',"","PLL","owrx.sam_pll",owrx.sam_pll,owrx.sam_pll_s,"sam_pll_cb"),w3_button('class-button w3-hcenter||title="PLL reset"',"Reset","sam_pll_reset_cb")))+w3_inline("w3-margin-T-2 w3-valign w3-halign-end/class-slider",w3_select('id-chan-null w3-text-red w3-margin-R-6 w3-hide||title="channel null"',"","channel<br>null","owrx.chan_null",owrx.chan_null,owrx.chan_null_s,"chan_null_cb"),w3_select('id-ovld-mute w3-text-red||title="overload mute"',"","ovld<br>mute","owrx.ovld_mute",owrx.ovld_mute,owrx.ovld_mute_s,"ovld_mute_cb")),kiwi_load_js_dir("extensions/",["noise_blank/noise_blank.js","noise_filter/noise_filter.js"],function(){noise_blank_init(),noise_filter_init()}),toggle_or_set_compression(toggle_e.FROM_COOKIE|toggle_e.SET,1),squelch_setup(toggle_e.FROM_COOKIE),audio_panner_ui_init(),w3_el("id-optbar-agc").innerHTML=w3_col_percent("w3-valign w3-margin-B-4/class-slider",'<div id="id-button-agc" class="class-button" onclick="toggle_agc(event)" onmousedown="cancelEvent(event)" onmouseover="agc_over(event)">AGC</div>',13,'<div id="id-button-hang" class="class-button" onclick="toggle_or_set_hang();">Hang</div>',17,w3_divs("w3-show-inline-block/id-label-man-gain cl-closer-spaced-label-text","Manual<br>gain"),15,w3_slider("id-input-man-gain w3-wheel","","",manGain,0,120,1,"setManGain_cb"),40,w3_div("id-field-man-gain w3-show-inline-block",manGain.toString())+" dB",15)+w3_div("",w3_col_percent("w3-valign/class-slider",w3_div("label-threshold w3-show-inline-block","Threshold"),20,w3_slider("id-input-threshold w3-wheel","","",thresh,-130,0,1,"setThresh_cb"),52,w3_div("id-field-threshold w3-show-inline-block",thresh.toString())+" dBm"),w3_col_percent("w3-valign/class-slider",w3_div("label-threshCW w3-show-inline-block","Thresh CW"),20,w3_slider("id-input-threshCW w3-wheel","","",threshCW,-130,0,1,"setThreshCW_cb"),52,w3_div("id-field-threshCW w3-show-inline-block",threshCW.toString())+" dBm"),w3_col_percent("w3-valign/class-slider",w3_div("label-slope w3-show-inline-block","Slope"),20,w3_slider("id-input-slope w3-wheel","","",slope,0,10,1,"setSlope_cb"),52,w3_div("id-field-slope w3-show-inline-block",slope.toString())+" dB"),w3_col_percent("w3-valign/class-slider",w3_div("label-decay w3-show-inline-block","Decay"),20,w3_slider("id-input-decay w3-wheel","","",decay,20,5e3,10,"setDecay_cb"),52,w3_div("id-field-decay w3-show-inline-block",decay.toString())+" msec")),setup_agc(toggle_e.FROM_COOKIE|toggle_e.SET),w3_click_nav(kiwi_toggle(toggle_e.FROM_COOKIE|toggle_e.SET,"optbar-wf","optbar-wf","last_optbar"),"optbar","init"),w3_el("id-news").style.backgroundColor=news_color,w3_el("id-news-inner").innerHTML='<span style="font-size: 14pt; font-weight: bold;">KiwiSDR now available on <a href="https://www.kickstarter.com/projects/1575992013/kiwisdr-beaglebone-software-defined-radio-sdr-with" target="_blank"><img class="class-KS" src="icons/kickstarter-logo-light.150x18.png" /></a></span>',w3_el("id-readme").style.backgroundColor=readme_color,w3_el("id-readme-inner").innerHTML='<span style="font-size: 15pt; font-weight: bold;">Welcome!</span>&nbsp;&nbsp;&nbsp;Project website: <a href="http://kiwisdr.com" target="_blank">kiwisdr.com</a>&nbsp;&nbsp;&nbsp;&nbsp;Here are some tips:<ul style="padding-left: 12px;"><li> Windows: Firefox, Chrome & Edge work; IE does not work. </li><li> Mac & Linux: Safari, Firefox, Chrome & Opera should work fine. </li><li> Open and close the panels by using the circled arrows at the top right corner. </li><li> You can click and/or drag almost anywhere on the page to change settings. </li><li> Enter a numeric frequency in the box marked "kHz" at right. </li><li> Or use the "select band" menu to jump to a pre-defined band. </li><li> Use the zoom icons to control the waterfall span. </li><li> Tune by clicking on the waterfall, spectrum or the cyan/red-colored station labels. </li><li> Control-shift or alt-shift click in the waterfall to lookup frequency in online databases. </li><li> Control or alt click to page spectrum down and up in frequency. </li><li> Adjust the "WF min" slider for best waterfall colors or use the "Auto Scale" button. </li><li> Type \'h\' or \'?\' to see the list of keyboard shortcuts. </li><li> See the <a href="http://www.kiwisdr.com/quickstart/" target="_blank">Operating information</a> page and <a href="http://kiwisdr.com/docs/KiwiSDR/KiwiSDR.design.review.pdf" target="_blank">Design review document</a>. </li></ul>';n=ext_get_cfg_param("contact_admin");isUndefined(n)&&(n=!0);t=ext_get_cfg_param("admin_email");null!=(t="undefined"!=n&&null!=n&&1==n&&"undefined"!=t&&null!=t?t:null)&&(t=encodeURIComponent(encodeURIComponent(enc(t)))),w3_el("id-optbar-status").innerHTML=w3_div("id-status-msg")+w3_div("",w3_text("w3-text-css-orange","Links"),w3_text("",(t?"<a href=\"javascript:sendmail('"+t+"');\">Owner/Admin</a> | ":"")+'<a href="http://kiwisdr.com" target="_blank">KiwiSDR</a> | <a href="http://forum.kiwisdr.com/discussions" target="_blank">Forum</a> | <a href="https://kiwiirc.com/client/chat.freenode.net/#kiwisdr" target="_blank">Chat</a> '))+w3_div("id-status-adc")+w3_div("id-status-config")+w3_div("id-status-gps")+w3_inline("w3-valign",w3_div("id-status-audio")," ",w3_div("id-status-problems"))+w3_div("id-status-stats-cpu")+w3_div("id-status-stats-xfer"),setTimeout(function(){setInterval(status_periodic,5e3)},1e3)}var prev_optbar=null;function optbar_focus(e,t){writeCookie("last_optbar",e),"optbar-off"==e?("init"!=t&&"optbar-off"==prev_optbar&&toggle_or_set_hide_bars(),w3_hide("id-optbar-content"),w3_el("id-control-top").style.paddingBottom="8px"):(w3_show_block("id-optbar-content"),w3_el("id-control-top").style.paddingBottom=""),w3_el("id-control").style.height="",prev_optbar=e,freqset_select()}function optbar_blur(e){}function zoomCorrection(){return 3*zoom_level}var WF_SPEED_OFF=0,WF_SPEED_1HZ=1,WF_SPEED_SLOW=2,WF_SPEED_MED=3,WF_SPEED_FAST=4,wf_speed=WF_SPEED_FAST,wf_speeds=["off","1 Hz","slow","med","fast"],wf={no_wf:!1,url_tstamp:0,ts_tz:0,scroll_multiple:3,no_sync:!1,cmap:0,cmap_override:-1,custom_colormaps:[new Uint8Array(768),new Uint8Array(768),new Uint8Array(768),new Uint8Array(768)],aper:0,aper_algo:3,aper_param:0,sqrt:0,contr:0,last_zoom:-1,need_autoscale:0,auto_ceil:{min:0,val:5,max:30},auto_floor:{min:-30,val:0,max:0},auto_maxdb:0,auto_mindb:0,audioFFT_active:!1,audioFFT_prev_mode:"",audioFFT_clear_wf:!1},wf_contr_s={0:"normal",1:"scheme 1",2:"scheme 2",3:"scheme 3",4:"scheme 4"};function wf_contr_cb(e,t,_){}var wf_gnd=0,wf_gnd_value_base=150,wf_gnd_value=wf_gnd_value_base;function wf_gnd_cb(e,t,_){t=+t,w3_color(e,t?"white":"lime"),wf_gnd=!t,0==t&&freqset_select()}var wf_sp_param=0,wf_param=0,sp_param=0,wf_sp_which=0,wf_filter=0,spec_filter=0,wf_sp_menu_s=["IIR","MMA","EMA","off"],wf_sp_menu_e={IIR:0,MMA:1,EMA:2,OFF:3},wf_sp_slider_s=["gain","avgs","avgs",""],wf_sp_slider_d=[1,0,0,0],wf_sp_filter_p=[{IIR_min:0,IIR_max:1,IIR_step:.1,IIR_def:.2,IIR_val:void 0,MMA_min:1,MMA_max:32,MMA_step:1,MMA_def:8,MMA_val:void 0,EMA_min:1,EMA_max:32,EMA_step:1,EMA_def:8,EMA_val:void 0,off_min:0,off_max:0,off_step:0,off_def:0,off_val:void 0},{IIR_min:0,IIR_max:2,IIR_step:.1,IIR_def:.8,IIR_val:void 0,MMA_min:1,MMA_max:16,MMA_step:1,MMA_def:2,MMA_val:void 0,EMA_min:1,EMA_max:16,EMA_step:1,EMA_def:2,EMA_val:void 0,off_min:0,off_max:0,off_step:0,off_def:0,off_val:void 0}];function spec_show(){toggle_or_set_spec(toggle_e.SET,spec.RF);var e=-1;spectrum_param=parseFloat(spectrum_param),isNaN(spectrum_param)||-1==spectrum_param||(e=spectrum_param),wf_sp_which=0;var t=wf_sp_menu_s[spec_filter],_=wf_sp_filter_p[0];e>=_[t+"_min"]&&e<=_[t+"_max"]&&(wf_sp_slider_cb("id-wf-sp-slider",e,!0,!1),toggle_or_set_wf_sp_button(toggle_e.SET,0))}function wf_sp_menu_cb(e,t,_,a){t=+t,(wf_sp_which=+a)?wf_filter=t:spec_filter=t;a=wf_sp_which?wf_filter:spec_filter,t=wf_sp_menu_s[a];wf_sp_slider_cb("id-wf-sp-slider",wf_sp_filter_p[wf_sp_which][t+"_val"],!0,!1),toggle_or_set_wf_sp_button(toggle_e.SET,wf_sp_which),writeCookie(wf_sp_which?"last_wf_filter":"last_spec_filter",a.toString()),wf_sp_which?need_clear_wfavg=!0:spec.need_clear_avg=!0,freqset_select()}function spectrum_filter(e){wf_sp_menu_cb("",e,!1,0)}function toggle_or_set_wf_sp_button(e,t){isNumber(e)?wf_sp_which=+kiwi_toggle(e,+t,+t,"last_wf_sp_filter"):wf_sp_which^=1,w3_innerHTML("id-wf-sp-button",wf_sp_which?"WF &Delta;":"Spec &Delta;");t=wf_sp_menu_s[wf_sp_which?wf_filter:spec_filter];wf_sp_slider_cb("id-wf-sp-slider",wf_sp_filter_p[wf_sp_which][t+"_val"],!0,!1),freqset_select()}function wf_sp_slider_cb(e,t,_,a){var i,o,n,s;a||(t=+t,o=wf_sp_menu_s[i=wf_sp_which?wf_filter:spec_filter],n=wf_sp_filter_p[wf_sp_which],null!=t&&!isNaN(t)||(t=n[o+"_def"],s=parseFloat(readCookie(wf_sp_which?"last_wf_filter":"last_spec_filter")),a=parseFloat(readCookie(wf_sp_which?"last_wf_filter_param":"last_spec_filter_param")),s!=i||isNaN(a)||(t=a)),wf_sp_which?wf_param=t:sp_param=t,n[o+"_val"]=t,w3_slider_setup("id-wf-sp-slider",n[o+"_min"],n[o+"_max"],n[o+"_step"],t),w3_el("id-wf-sp-slider-field").innerHTML=i==wf_sp_menu_e.OFF?"":t.toFixed(wf_sp_slider_d[i])+" "+wf_sp_slider_s[i],_&&(writeCookie(wf_sp_which?"last_wf_filter_param":"last_spec_filter_param",t.toFixed(2)),freqset_select()))}function wf_sp_slider_wheel_cb(){var e=w3_el("id-wf-sp-slider");wf_sp_slider_cb("",w3_slider_wheel("wf_sp_slider_wheel_cb",e,wf_sp_which?wf_param:sp_param,+e.step,5*+e.step),1)}function wf_cmap_cb(e,t,_){_||(t=+t,wf.cmap=w3_clamp(t,0,kiwi.cmap_s.length-1,0),w3_select_value(e,t,{all:1}),writeCookie("last_cmap",t),mkcolormap(),spectrum_dB_bands(),update_maxmindb_sliders(),wf_send("SET cmap="+wf.cmap),w3_call("colormap_select"),freqset_select())}function wf_aper_cb(e,t,_){_||(t=+t,wf.aper=w3_clamp(t,0,kiwi.aper_s.length-1,0),w3_select_value(e,t),writeCookie("last_aper",t),t=wf.aper==kiwi.aper_e.auto,w3_innerHTML("id-wf-sliders",t?wf.floor_ceil_sliders:wf.max_min_sliders),w3_color("id-button-wf-autoscale",null,t?w3_selection_green:""),t?(wf.save_maxdb=maxdb,wf.save_mindb_un=mindb_un,wf.audioFFT_active&&(wf.need_autoscale=16)):(setmaxdb(1,wf.save_maxdb),setmindb(1,wf.save_mindb_un-zoomCorrection())),spectrum_dB_bands(),update_maxmindb_sliders(),w3_show_hide_inline("id-wfext-maxmin",t),w3_show_hide_inline("id-wfext-maxmin-spacer",!t),colormap_update(),freqset_select())}function setwfspeed_cb(e,t,_){wf.audioFFT_active?freqset_select():(wf_speed=+t,w3_set_value("slider-rate",wf_speed),(t=w3_el("slider-rate-field")).innerHTML=wf_speeds[wf_speed],t.style.color=wf_speed?"white":"orange",wf_send("SET wf_speed="+wf_speed.toFixed(0)),_&&freqset_select())}function setwfspeed_wheel_cb(){setwfspeed_cb("",w3_slider_wheel("setwfspeed_wheel_cb","id-slider-rate",wf_speed,1,1),1)}function setmaxdb_cb(e,t,_,a){setmaxdb(_,t,!1)}function setmaxdb(e,t,_){var a=parseFloat(t),i=!1;if(wf.aper==kiwi.aper_e.auto)maxdb=a+wf.auto_ceil.val;else{var o=w3_el("id-input-maxdb"),n=w3_el("id-field-maxdb"),t=w3_el("id-field-mindb");if(!o||!n||!t)return;i=!0,a<=mindb?(maxdb=mindb+1,o.value=maxdb,n.innerHTML=maxdb.toFixed(0)+" dB",n.style.color="red"):(maxdb=a,o.value=maxdb,n.innerHTML=a.toFixed(0)+" dB",n.style.color="white",t.style.color="white")}setmaxmindb(e,i,_)}function setmaxdb_wheel_cb(){setmaxdb(1,w3_slider_wheel("setmaxdb_wheel_cb","id-input-maxdb",maxdb,1,10))}function incr_mindb(e,t){wf.aper==kiwi.aper_e.man&&(t=+mindb+t,setmindb(e,Math.max(-190,Math.min(-30,t)).toFixed(0)))}function setmindb_cb(e,t,_,a){setmindb(_,t,!1)}function setmindb(e,t,_){var a=parseFloat(t),i=!1;if(wf.aper==kiwi.aper_e.auto)mindb=a+wf.auto_floor.val;else{var o=w3_el("id-input-mindb"),n=w3_el("id-field-maxdb"),t=w3_el("id-field-mindb");if(!o||!n||!t)return;i=!0,maxdb<=a?(mindb=maxdb-1,o.value=mindb,t.innerHTML=mindb.toFixed(0)+" dB",t.style.color="red"):(mindb=a,o.value=mindb,t.innerHTML=a.toFixed(0)+" dB",t.style.color="white",n.style.color="white")}mindb_un=mindb+zoomCorrection(),setmaxmindb(e,i,_)}function setmindb_wheel_cb(){setmindb(1,w3_slider_wheel("setmindb_wheel_cb","id-input-mindb",mindb,1,10))}function setmaxmindb(e,t,_){full_scale=(full_scale=maxdb-mindb)||1,spectrum_dB_bands(),wf_send("SET maxdb="+maxdb.toFixed(0)+" mindb="+mindb.toFixed(0)),need_clear_wf_sp_avg=!0,e&&(1!=_&&freqset_select(),t&&(writeCookie(wf.audioFFT_active?"last_AF_max_dB":"last_max_dB",maxdb.toFixed(0)),writeCookie(wf.audioFFT_active?"last_AF_min_dB":"last_min_dB",mindb_un.toFixed(0))))}function update_maxmindb_sliders(){var e,t,_,a,i,o=wf.aper==kiwi.aper_e.auto;o||(mindb=mindb_un-zoomCorrection()),full_scale=(full_scale=maxdb-mindb)||1,spectrum_dB_bands(),i=o?(e=wf.auto_ceil.val,i=wf.auto_floor.val,t=e.toFixed(0).positiveWithSign(),_=i.toFixed(0).positiveWithSign(),w3_el("id-input-ceildb").value=e,w3_el("id-input-floordb").value=i,a=w3_el("id-field-ceildb"),w3_el("id-field-floordb")):(i=mindb,t=(e=maxdb).toFixed(0),_=i.toFixed(0),w3_el("id-input-maxdb").value=e,w3_el("id-input-mindb").value=i,a=w3_el("id-field-maxdb"),w3_el("id-field-mindb")),a.innerHTML=t+" dB",i.innerHTML=_+" dB"}function setceildb_cb(e,t,_){var a=w3_el("id-input-ceildb"),i=w3_el("id-field-ceildb");a&&i&&(t=parseFloat(t),a.value=t,w3_innerHTML(i,t.toFixed(0).positiveWithSign()+" dB"),wf.auto_ceil.val=t,set_ceilfloordb(_))}function setceildb_wheel_cb(){setceildb_cb("",w3_slider_wheel("setceildb_wheel_cb","id-input-ceildb",wf.auto_ceil.val,1,5),1)}function setfloordb_cb(e,t,_){var a=w3_el("id-input-floordb"),i=w3_el("id-field-floordb");a&&i&&(t=parseFloat(t),a.value=t,w3_innerHTML(i,t.toFixed(0).positiveWithSign()+" dB"),wf.auto_floor.val=t,set_ceilfloordb(_))}function setfloordb_wheel_cb(){setfloordb_cb("",w3_slider_wheel("setfloordb_wheel_cb","id-input-floordb",wf.auto_floor.val,1,5),1)}function set_ceilfloordb(e){maxdb=wf.auto_maxdb+wf.auto_ceil.val,mindb=wf.auto_mindb+wf.auto_floor.val,mindb_un=mindb+zoomCorrection(),setmaxmindb(e,!1),w3_call("waterfall_maxmin_cb"),e&&(freqset_select(),writeCookie("last_ceil_dB",wf.auto_ceil.val.toFixed(0)),writeCookie("last_floor_dB",wf.auto_floor.val.toFixed(0)))}function wf_autoscale_cb(){wf.need_autoscale=1,colormap_update(),freqset_select()}var spectrum_slow_dev=0;function toggle_or_set_slow_dev(e,t){isNumber(e)?spectrum_slow_dev=kiwi_toggle(e,t,spectrum_slow_dev,"last_slow_dev"):spectrum_slow_dev^=1,w3_color("id-button-slow-dev",spectrum_slow_dev?"lime":"white"),freqset_select(),writeCookie("last_slow_dev",spectrum_slow_dev.toString()),spectrum_slow_dev&&wf_speed==WF_SPEED_FAST&&setwfspeed_cb("",WF_SPEED_MED,1)}function toggle_or_set_spec_peak(e,t,_,a){var i,o=a&&"hold"==a.type,a=a&&"click"==a.type&&a.shiftKey;if(o)return _=+t,console.log("toggle_or_set_spec_peak HOLD trace="+_),void(spec.peak_show[_]==spec.PEAK_ON&&(spec.peak_clear_btn[_]=!0));isNumber(e)?(_=+_,i=spec.peak_show[_],spec.peak_show[_]=kiwi_toggle(e,t,spec.peak_show[_],"last_spec_peak"+(_?"1":""))):(_=+t,i=spec.peak_show[_],a?(spec.peak_show[_]--,spec.peak_show[_]<0&&(spec.peak_show[_]=2)):spec.peak_show[_]=(spec.peak_show[_]+1)%3),i!=spec.PEAK_OFF&&spec.peak_show[_]==spec.PEAK_OFF&&(spec.peak_clear_btn[_]=!0),w3_color("id-button-spec-peak"+_,["white","lime","orange"][spec.peak_show[_]]),freqset_select(),writeCookie("last_spec_peak"+(_?"1":""),spec.peak_show[_]==spec.PEAK_ON?"1":"0")}var muted_until_freq_set=!0,recording=!1;function setvolume_cb(e,t,_,a,i){setvolume(_,t)}function setvolume(e,t){kiwi.volume=+t,isNumber(kiwi.volume)||(kiwi.volume=50),kiwi.volume=w3_clamp3(kiwi.volume,0,200,0,50,50),kiwi.volume_f=kiwi.muted||0==kiwi.volume?1e-6:kiwi.volume/100,e&&(w3_set_value("id-input-volume",kiwi.volume),writeCookie("last_volume",kiwi.volume),freqset_select())}function setvolume_wheel_cb(){setvolume(1,w3_slider_wheel("setvolume_wheel_cb","id-input-volume",kiwi.volume,5,15))}function toggle_or_set_mute(e){isNumber(e)?kiwi.muted=e:kiwi.muted^=1,owrx.squelched_overload||(w3_show_hide("id-mute-no",!kiwi.muted),w3_show_hide("id-mute-yes",kiwi.muted)),kiwi.volume_f=kiwi.muted||0==kiwi.volume?1e-6:kiwi.volume/100,freqset_select(),canvas_log_clear(),owrx.debug_drag&&(owrx.drag_count=0)}var de_emphasis=0,de_emphasis_nfm=0,de_emphasis_s=["off","75 uS","50 uS"],de_emphasis_nfm_s=["off","on","+LF"];function de_emp_cb(e,t,_,a){ext_mode(cur_mode);+a?(snd_send("SET de_emp="+(de_emphasis_nfm=+t)+" nfm=1"),writeCookie("last_de_emphasis_nfm",de_emphasis_nfm.toString())):(snd_send("SET de_emp="+(de_emphasis=+t)+" nfm=0"),writeCookie("last_de_emphasis",de_emphasis.toString()))}function setpan_cb(e,t,_,a,i){setpan(_,t)}function setpan(e,t,_){t=+t;-.1<t&&t<.1&&(t=0),w3_set_value("id-pan-value",t),w3_color("id-pan-value",null,t<0?"rgba(255,0,0,0.3)":t?"rgba(0,255,0,0.2)":""),w3_innerHTML("id-pan-field",t?(100*Math.abs(t)).toFixed(0)+" "+(t<0?"L":"R"):"L=R"),audio_set_pan(t),kiwi.pan=t,e&&(1!=_&&writeCookie("last_pan",t.toString()),freqset_select())}function setpan_wheel_cb(){setpan(1,w3_slider_wheel("setpan_wheel_cb","id-pan-value",kiwi.pan,.1,.1))}function audio_panner_ui_init(){audio_panner&&(w3_hide2("id-vol-comp"),w3_hide2("id-vol",!1),w3_hide2("id-pan",!1),setpan(1,kiwi.pan,!0))}function toggle_or_set_hide_bars(e){isNumber(e)?owrx.hide_bars=e:(owrx.hide_bars=owrx.hide_bars+1&owrx.HIDE_ALLBARS,owrx.hide_bars&owrx.HIDE_TOPBAR&&(extint.using_data_container||spec.source!=spec.NONE)&&(owrx.hide_bars=owrx.hide_bars+1&owrx.HIDE_ALLBARS)),w3_set_props("id-top-container","w3-panel-override-hide",owrx.hide_bars&owrx.HIDE_TOPBAR),w3_set_props("id-band-container","w3-panel-override-hide",owrx.hide_bars&owrx.HIDE_BANDBAR),openwebrx_resize()}var test_button,hide_panels=0;function toggle_or_set_hide_panels(e){isNumber(e)?hide_panels=e:hide_panels^=1,w3_iterate_children("id-panels-container",function(e){w3_contains(e,"class-panel")&&w3_set_props(e,"w3-panel-override-hide",hide_panels)})}function toggle_or_set_test(e){isNumber(e)?test_button=e:test_button^=1,console.log("toggle_or_set_test set="+e+" test_button="+test_button),w3_color("id-button-test",test_button?"lime":"white"),snd_send("SET test="+(test_button?1:0)),freqset_select()}function toggle_or_set_rec(e){var t,_,a;console.log("toggle_or_set_rec set="+e+" recording="+recording),recording=isBoolean(e)||isNumber(e)?e:!recording,w3_spin("id-rec1",recording),w3_spin("id-rec2",recording),w3_remove_then_add("id-rec1","w3-text-white","w3-text-pink"),w3_remove_then_add("id-rec2","w3-text-white","w3-text-pink"),recording?(window.recording_meta={buffers:[],data:null,offset:0,total_size:0,filename:kiwi_timestamp_filename("",".wav")},window.recording_meta.buffers.push(new ArrayBuffer(65536)),window.recording_meta.data=new DataView(window.recording_meta.buffers[0])):window.recording_meta&&(a=new ArrayBuffer(44),(_=new DataView(a)).setUint32(0,1380533830),_.setUint32(4,window.recording_meta.total_size+36,!0),_.setUint32(8,1463899717),_.setUint32(12,1718449184),_.setUint32(16,16,!0),_.setUint16(20,1,!0),t=ext_is_IQ_or_stereo_curmode()?2:1,_.setUint16(22,t,!0),e=Math.round(audio_input_rate||12e3),_.setUint32(24,e,!0),_.setUint32(28,e*t*2,!0),_.setUint16(32,2*t,!0),_.setUint16(34,16,!0),_.setUint32(36,1684108385),_.setUint32(40,window.recording_meta.total_size,!0),window.recording_meta.buffers.unshift(a),_=new Blob(window.recording_meta.buffers,{type:"octet/stream"}),(a=document.createElement("a")).style="display: none",a.href=window.URL.createObjectURL(_),a.download=window.recording_meta.filename,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(a.href),document.body.removeChild(a),delete window.recording_meta,audio_pre_record_buf_init())}var squelched=0,squelch=0,pre_record=0,pre_record_s=["0s","1s","2s","5s","10s"],pre_record_v=[0,1,2,5,10],squelch_tail=0,squelch_tail_s=["0s",".2s",".5s","1s","2s"],squelch_tail_v=[0,.2,.5,1,2];function squelch_action(e){var t=(squelched=e)?"white":kiwi.unmuted_color,e=t;owrx.squelched_overload=owrx.sMeter_dBm>=cfg.overload_mute,owrx.prev_squelched_overload!=owrx.squelched_overload&&(w3_show_hide("id-mute-exclaim",owrx.squelched_overload),w3_show_hide("id-mute-no",!owrx.squelched_overload&&!kiwi.muted),w3_show_hide("id-mute-yes",!owrx.squelched_overload&&kiwi.muted),owrx.prev_squelched_overload=owrx.squelched_overload),w3_color("id-squelch-label",e),w3_color("id-mute-no",t),recording&&(t=squelched||owrx.squelched_overload,w3_spin("id-rec1",!t),w3_spin("id-rec2",!t),w3_remove_then_add("id-rec1","w3-text-white w3-text-pink",t?"w3-text-white":"w3-text-pink"),w3_remove_then_add("id-rec2","w3-text-white w3-text-pink",t?"w3-text-white":"w3-text-pink"))}function squelch_setup(e){var t=ext_mode(cur_mode).NBFM;e&toggle_e.FROM_COOKIE&&(e=readCookie("last_squelch"+(t?"":"_efm")),squelch=e?+e:0,w3_el("id-squelch-value").max=t?99:40,w3_set_value("id-squelch-value",squelch),e=kiwi_storeGet("last_pre",0),pre_record=e?+e:0,w3_select_value("id-pre-rec",pre_record),e=kiwi_storeGet("last_tail",0),squelch_tail=e?+e:0,w3_select_value("id-squelch-tail",squelch_tail)),set_squelch_cb("",squelch,!0,!1,!0),pre_record_cb("",pre_record,!1,!0),squelch_tail_cb("",squelch_tail,!1,!0),t?squelch_action(squelched):w3_color("id-mute-no",kiwi.unmuted_color),w3_hide2("id-pre-rec",t),w3_hide2("id-squelch-tail",t),w3_hide2("id-squelch","drm"==cur_mode)}function send_squelch(){var e=ext_mode(cur_mode).NBFM;snd_send("SET squelch="+squelch.toFixed(0)+" param="+(e?squelch_threshold:squelch_tail_v[squelch_tail]).toFixed(2))}function set_squelch_cb(e,t,_,a,i){var o=ext_mode(cur_mode).NBFM;a||(t=(squelch=parseFloat(t)).toFixed(0),w3_el("id-squelch-field").innerHTML=squelch?t+(o?"":" dB"):"off",w3_set_value("id-squelch-value",squelch),w3_color("id-squelch-value",null,squelch?"":"rgba(255,0,0,0.3)"),send_squelch(),_&&(1!=i&&writeCookie("last_squelch"+(o?"":"_efm"),t),freqset_select()))}function set_squelch_wheel_cb(){set_squelch_cb("",w3_slider_wheel("set_squelch_wheel_cb","id-squelch-value",squelch,1,5),1)}var squelch_enable=1,squelch_save=null;function squelch_zero_cb(e,t,_){var a;squelch_enable^=1,w3_color(e,squelch_enable?"lime":"magenta"),squelch_enable?(a=null==squelch_save?squelch:squelch_save,freqset_select(),w3_disable("id-squelch-value",!1)):(squelch_save=squelch,a=0),set_squelch_cb("",a,!0,!1,!0),squelch_enable||w3_disable("id-squelch-value",!0)}function pre_record_cb(e,t,_,a){_||(pre_record=+t,audio_pre_record_buf_init(),1==a||ext_mode(cur_mode).NBFM||kiwi_storeSet("last_pre",pre_record))}function squelch_tail_cb(e,t,_,a){_||(squelch_tail=+t,send_squelch(),1==a||ext_mode(cur_mode).NBFM||kiwi_storeSet("last_tail",squelch_tail))}function sam_pll_reset_cb(e,t,_){snd_send("SET sam_pll=-1")}function sam_pll_cb(e,t,_){owrx.sam_pll=+t,snd_send("SET sam_pll="+owrx.sam_pll)}function chan_null_cb(e,t,_){_||(owrx.chan_null=+t,ext_set_mode(cur_mode))}function SAM_opts_cb(e,t,_){_||(owrx.SAM_opts=+t,ext_set_mode(cur_mode))}function ovld_mute_cb(e,t,_){_||(owrx.ovld_mute=+t,snd_send("SET ovld_mute="+(owrx.ovld_mute?1:0)))}var btn_less_buffering=0;function toggle_or_set_audio(e,t){isNumber(e)?btn_less_buffering=kiwi_toggle(e,t,btn_less_buffering,"last_audio"):btn_less_buffering^=1;t=w3_el("id-button-buffering");t&&(t.style.color=btn_less_buffering?"lime":"white",t.style.visibility="visible",freqset_select()),writeCookie("last_audio",btn_less_buffering.toString()),isNumber(e)||window.location.reload(!0)}var btn_compression=0;function toggle_or_set_compression(e,t){recording||(isNumber(e)?btn_compression=kiwi_toggle(e,t,btn_compression,"last_compression"):btn_compression^=1,w3_els("id-button-compression",function(e){e.style.color=btn_compression?"lime":"white",e.style.visibility="visible",freqset_select()}),writeCookie("last_compression",btn_compression.toString()),snd_send("SET compression="+btn_compression.toFixed(0)))}function set_agc(){var e=ext_mode(cur_mode).CW;w3_color("label-threshold",!e&&agc?"orange":"white"),w3_color("label-threshCW",e&&agc?"orange":"white"),snd_send("SET agc="+agc+" hang="+hang+" thresh="+(e?threshCW:thresh)+" slope="+slope+" decay="+decay+" manGain="+manGain)}var agc=0;function toggle_agc(e){return any_alternate_click_event(e)?setup_agc(toggle_e.SET):toggle_or_set_agc(),cancelEvent(e)}function agc_over(e){w3_el("id-button-agc").title=any_alternate_click_event(e)?"restore AGC params":""}var default_agc=1,default_hang=0,default_manGain=50,default_thresh=-100,default_threshCW=-130,default_slope=6,default_decay=1e3;function setup_agc(e){toggle_or_set_agc(agc=kiwi_toggle(e,default_agc,agc,"last_agc")),toggle_or_set_hang(hang=kiwi_toggle(e,default_hang,hang,"last_hang")),setManGain_cb("",manGain=kiwi_toggle(e,default_manGain,manGain,"last_manGain"),1),setThresh_cb("",thresh=kiwi_toggle(e,default_thresh,thresh,"last_thresh"),1),setThreshCW_cb("",threshCW=kiwi_toggle(e,default_threshCW,threshCW,"last_threshCW"),1),setSlope_cb("",slope=kiwi_toggle(e,default_slope,slope,"last_slope"),1),setDecay_cb("",decay=kiwi_toggle(e,default_decay,decay,"last_decay"),1)}function toggle_or_set_agc(e){null!=e?agc=e:agc^=1,w3_el("id-button-agc").style.color=agc?"lime":"white",agc?(w3_el("id-label-man-gain").style.color="white",w3_el("id-button-hang").style.borderColor=w3_el("label-slope").style.color=w3_el("label-decay").style.color="orange"):(w3_el("id-label-man-gain").style.color="orange",w3_el("id-button-hang").style.borderColor=w3_el("label-slope").style.color=w3_el("label-decay").style.color="white"),set_agc(),writeCookie("last_agc",agc.toString()),freqset_select()}var hang=0;function toggle_or_set_hang(e){null!=e?hang=e:hang^=1,w3_el("id-button-hang").style.color=hang?"lime":"white",set_agc(),writeCookie("last_hang",hang.toString()),freqset_select()}var manGain=0;function setManGain_cb(e,t,_,a){a||(manGain=parseFloat(t),w3_el("id-input-man-gain").value=manGain,w3_el("id-field-man-gain").innerHTML=t,set_agc(),writeCookie("last_manGain",manGain.toString()),_&&freqset_select())}function setManGain_wheel_cb(){setManGain_cb("",w3_slider_wheel("setManGain_wheel_cb","id-input-man-gain",manGain,1,10),1)}var thresh=0;function setThresh_cb(e,t,_,a){a||(thresh=parseFloat(t),w3_el("id-input-threshold").value=thresh,w3_el("id-field-threshold").innerHTML=t,set_agc(),writeCookie("last_thresh",thresh.toString()),_&&freqset_select())}function setThresh_wheel_cb(){setThresh_cb("",w3_slider_wheel("setThresh_wheel_cb","id-input-threshold",thresh,1,10),1)}var threshCW=0;function setThreshCW_cb(e,t,_,a){a||(threshCW=parseFloat(t),w3_el("id-input-threshCW").value=threshCW.toFixed(0),w3_el("id-field-threshCW").innerHTML=t,set_agc(),writeCookie("last_threshCW",threshCW.toString()),_&&freqset_select())}function setThreshCW_wheel_cb(){setThreshCW_cb("",w3_slider_wheel("setThreshCW_wheel_cb","id-input-threshCW",threshCW,1,10),1)}var slope=0;function setSlope_cb(e,t,_,a){a||(slope=parseFloat(t),w3_el("id-input-slope").value=slope,w3_el("id-field-slope").innerHTML=t,set_agc(),writeCookie("last_slope",slope.toString()),_&&freqset_select())}function setSlope_wheel_cb(){setSlope_cb("",w3_slider_wheel("setSlope_wheel_cb","id-input-slope",slope,1,1),1)}var decay=0;function setDecay_cb(e,t,_,a){a||(decay=parseFloat(t),w3_el("id-input-decay").value=decay,w3_el("id-field-decay").innerHTML=t,set_agc(),writeCookie("last_decay",decay.toString()),_&&freqset_select())}function setDecay_wheel_cb(){setDecay_cb("",w3_slider_wheel("setDecay_wheel_cb","id-input-decay",decay,100,500),1)}function users_setup(){for(var e="",t=0;t<rx_chans;t++)e+=w3_div("",w3_div("w3-show-inline-block w3-left w3-margin-R-5 "+(t==rx_chan?"w3-text-css-lime":"w3-text-css-orange"),"RX"+t),w3_div("id-optbar-user-"+t+" w3-show-inline-block"));var _=kiwi_isMobile()?" w3-font-16px":"";e+=w3_input("w3-margin-TB-4 w3-width-half/w3-label-not-bold/w3-custom-events"+_+'|padding:1px|size=20 onchange="ident_complete(\'el\', 2)" onkeyup="ident_keyup(this, event, 2)" ontouchstart="popup_keyboard_touchstart(event)"',"Your name or callsign:","ident-input2"),w3_innerHTML("id-optbar-users",w3_div("w3-nowrap",e))}function freq_vfo_cb(){owrx.vfo_ab^=1,w3_flip_colors("id-freq-vfo","w3-aqua w3-orange",owrx.vfo_ab),w3_innerHTML("id-freq-vfo","AB"[owrx.vfo_ab]);var e=parse_freq_pb_mode_zoom(readCookie("last_vfo_"+"AB"[owrx.vfo_ab])),t=void 0,_=0;e[3]&&(t=e[3].toLowerCase()),e[4]&&(_=+e[4]),ext_tune(e[1],t,ext_zoom.ABS,_)}function toggle_or_set_spec(e,t,_){var a=!1;isNumber(e)&&e&toggle_e.SET?(spec.source=+t,a=0!=(e&toggle_e.NO_CLOSE_EXT)):isUndefined(_)||1==_?spec.source=(spec.source+1)%spec.CHOICES:(spec.source--,spec.source<0&&(spec.source=spec.CHOICES-1));_=spec.source!=spec.NONE;!a&&extint.using_data_container&&_&&extint_panel_hide(!0);a=w3_el("id-button-spectrum");a.innerHTML=["Spec","Spec RF","Spec AF"][spec.source],a.style.color=_?"lime":"white",_?spec.switch_container=!0:(w3_show_hide("id-spectrum-container",!1),w3_show_hide("id-top-container",!0)),freqset_select(),snd_send("SET spc_="+spec.source)}function mode_over(e,t){var _;switch(t.innerHTML.toLowerCase()){case"sam":_="synchronous AM";break;case"sal":_="synchronous AM LSB";break;case"sau":_="synchronous AM USB";break;case"sas":_="synchronous AM stereo";break;case"qam":_="C-QUAM AM stereo";break;default:_=""}t.title=e.shiftKey?"restore passband":_}function any_alternate_click_event(e){return e&&(e.shiftKey||e.ctrlKey||e.altKey||e.button==mouse.middle||e.button==mouse.right)}function any_alternate_click_event_except_shift(e){return e&&(e.ctrlKey||e.altKey||e.button==mouse.middle||e.button==mouse.right)}function any_modifier_key(e){return e&&(e.shiftKey||e.ctrlKey||e.altKey)}function restore_passband(e){owrx.last_lo[e]=kiwi_passbands(e).lo,owrx.last_hi[e]=kiwi_passbands(e).hi}var step_9_10,divControl,mode_buttons=[{s:["AM","AMN"],dis:0},{s:["SAM","SAL","SAU","SAS","QAM"],dis:0},{s:["DRM"],dis:0},{s:["LSB","LSN"],dis:0},{s:["USB","USN"],dis:0},{s:["CW","CWN"],dis:0},{s:["NBFM","NNFM"],dis:0},{s:["IQ"],dis:0}];function mode_button(e,t,_){var a=t.innerHTML.toLowerCase();if(isUndefined(_)&&(_=1),any_alternate_click_event(e)){if(e.shiftKey||e.button==mouse.middle)return restore_passband(a),void ext_set_mode(a,null,{open_ext:!0});_=-1}var i=parseInt(t.id);if(isUndefined(owrx.last_mode_col)&&(owrx.last_mode_col=parseInt(owrx.last_mode_el.id)),owrx.last_mode_col!=i){if(recording)if((ext_is_IQ_or_stereo_curmode()?1:0)^(ext_is_IQ_or_stereo_mode(a)?1:0)||"drm"==a)return;owrx.last_mode_col=i}else{e=mode_buttons[i].s,i=a.toUpperCase(),_=e.indexOf(i)+_;if(_<=-1&&(_=e.length-1),_>=e.length&&(_=0),i=e[_],a=i.toLowerCase(),recording)if((ext_is_IQ_or_stereo_curmode()?1:0)^(ext_is_IQ_or_stereo_mode(a)?1:0)||"drm"==a)return;t.innerHTML=i}ext_set_mode(a,null,{open_ext:!0})}function button_9_10(e){null!=e?step_9_10=e:step_9_10^=1,writeCookie("last_9_10",step_9_10),freq_step_update_ui(!0),w3_el("id-button-9-10").innerHTML=step_9_10?"9":"10",freqset_select()}function pop_bottommost_panel(e){min_order=parseInt(e[0].getAttribute("data-panel-order"));for(var t=min_index=0;t<e.length;t++)actual_order=parseInt(e[t].getAttribute("data-panel-order")),actual_order<min_order&&(min_index=t,min_order=actual_order);return to_return=e[min_index],e.splice(min_index,1),to_return}function place_panels(){for(var e=[],t=[],_=html("id-panels-container").children,a=0;a<_.length;a++){var i,o,n=_[a];!n.classList.contains("class-panel")||(i=n.getAttribute("data-panel-pos"))&&(o=n.getAttribute("data-panel-size").split(","),"left"==i?e.push(n):"right"==i&&t.push(n),n.idName=n.id.replace("id-",""),n.style.width=o[0]+"px",n.style.height=o[1]+"px",n.style.margin=px(panel_margin),n.uiWidth=parseInt(o[0]),n.uiHeight=parseInt(o[1]),n.defaultWidth=parseInt(o[0]),n.defaultHeight=parseInt(o[1]),o=html_LR_border_pad(n),n.activeWidth=n.uiWidth-o,"center"==i&&(n.style.left=px(window.innerWidth/2-n.activeWidth/2),n.style.bottom=px(window.innerHeight/2-n.uiHeight/2),n.style.visibility="hidden"),"bottom-left"==i&&(n.style.left=0,n.style.bottom=0,n.style.visibility="hidden"))}for(y=0;0<e.length;)p=pop_bottommost_panel(e),p.style.left=0,p.style.bottom=px(y),p.style.visibility="visible",y+=p.uiHeight+3*panel_margin,w3_call("panel_setup_"+p.idName,p);for(y=0;0<t.length;)p=pop_bottommost_panel(t),p.style.right=kiwi_isMobile()?0:px(kiwi_scrollbar_width()),p.style.bottom=px(y),p.style.visibility="visible",y+=p.uiHeight+3*panel_margin,w3_call("panel_setup_"+p.idName,p)}var OPTBAR_CONTENT_HEIGHT=150;function panel_setup_control(e){(divControl=e).style.marginBottom="0",w3_el("id-control-inner").innerHTML=w3_div("id-control-top",w3_div("id-control-freq1"),w3_div("id-control-freq2"),w3_div("id-control-mode w3-margin-T-6"),w3_div("id-control-zoom w3-margin-T-6"),w3_div("id-optbar w3-margin-T-4"))+w3_div("id-optbar-content w3-margin-T-6 w3-scroll-y|height:"+px(OPTBAR_CONTENT_HEIGHT),w3_div("id-optbar-wf w3-hide"),w3_div("id-optbar-audio w3-hide"),w3_div("id-optbar-agc w3-hide"),w3_div("id-optbar-users w3-hide w3-scroll-x"),w3_div("id-optbar-status w3-hide"))+w3_div("id-control-smeter"),w3_el("id-control-freq1").style.width=px(e.activeWidth-visIcon-6),w3_show_hide("id-mute-no",!kiwi.muted),w3_show_hide("id-mute-yes",kiwi.muted)}function panel_set_vis_button(e){var t=w3_el(e),e=w3_el(e+"-vis"),t=t.activeWidth-visIcon;e.style.left=px(t+visBorder)}function panel_set_width_height(e,t,_){var a=w3_el(e);null==t&&(t=a.defaultWidth),a.style.width=px(t),a.uiWidth=t,null==_&&(_=a.defaultHeight),a.style.height=px(_),a.uiHeight=_;_=html_LR_border_pad(a);a.activeWidth=a.uiWidth-_,panel_set_vis_button(e)}function add_problem(e,t,_,a){if(el=w3_el(a||"id-status-problems"),el){if(isDefined(el.children)){for(var i=0;i<el.children.length;i++)if(el.children[i].innerHTML==e)return;if(0==t)for(;el.firstChild;)el.removeChild(el.firstChild)}t=w3_create_appendElement(el,"span",e);1!=_&&window.setTimeout(function(e,t){try{e.removeChild(t)}catch(e){}},1e3,el,t)}}function set_gen(e,t){snd_send("SET genattn="+t.toFixed(0)),snd_send("SET gen="+e+" mix=-1")}var bin_server=0,zoom_server=0;function owrx_msg_cb(e,t){switch(e[0]){case"wf_setup":wf_init();break;case"extint_list_json":extint_list_json(e[1]),override_ext&&extint_open(override_ext,3e3);break;case"bandwidth":bandwidth=parseInt(e[1]);break;case"center_freq":center_freq=parseInt(e[1]);break;case"wf_fft_size":wf_fft_size=parseInt(e[1]);break;case"wf_fps_max":wf_fps_max=parseInt(e[1]);break;case"wf_fps":wf_fps=parseInt(e[1]);break;case"wf_cal":break;case"start":bin_server=parseInt(e[1]);break;case"zoom":zoom_server=parseInt(e[1]);break;case"zoom_max":zoom_levels_max=parseInt(e[1]),zoom_nom=Math.min(ZOOM_NOMINAL,zoom_levels_max);break;case"audio_init":toggle_or_set_audio(toggle_e.FROM_COOKIE|toggle_e.SET,1),audio_init(+e[1],btn_less_buffering,kiwi_toggle(toggle_e.FROM_COOKIE|toggle_e.SET,1,1,"last_compression"));break;case"audio_camp":var _=e[1].split(",");audio_camp(+_[0],+_[1],!1,!1);break;case"audio_rate":audio_rate(parseFloat(e[1]));break;case"audio_adpcm_state":_=e[1].split(",");audio_adpcm_state(+_[0],+_[1]);break;case"audio_passband":_=e[1].split(",");audio_recompute_LPF(1,+_[0],+_[1]);break;case"audio_flags2":audio_recv_flags2(e[1]);break;case"kiwi_up":kiwi_up(parseInt(e[1]));break;case"gps":toggle_or_set_spec(toggle_e.SET,spec.RF);break;case"fft_mode":kiwi_fft_mode();break;case"maxdb":wf.auto_maxdb=+e[1],setmaxdb(1,wf.auto_maxdb,!0);break;case"mindb":wf.auto_mindb=+e[1],setmindb(1,wf.auto_mindb,!0),w3_call("waterfall_maxmin_cb"),update_maxmindb_sliders(!0);break;case"max_thr":owrx.overload_mute=Math.round(+e[1]);break;case"freq_offset":break;case"last_community_download":dx.last_community_download=decodeURIComponent(e[1]);break;default:return!1}return!0}function owrx_ws_open_snd(e,t){return ws_snd=open_websocket("SND",e,t,owrx_msg_cb,audio_recv,on_ws_error,owrx_close_cb)}function owrx_ws_open_wf(e,t){return ws_wf=open_websocket("W/F",e,t,owrx_msg_cb,waterfall_add_queue,on_ws_error)}function owrx_close_cb(){toggle_or_set_rec(0)}function on_ws_error(){console.log("WebSocket error")}function snd_send(t){try{return ws_snd.send(t),0}catch(e){return console.log("CATCH snd_send('"+t+"') ex="+e),kiwi_trace(),-1}}function wf_send(t){try{return ws_wf.send(t),0}catch(e){return console.log("CATCH wf_send('"+t+"') ex="+e),kiwi_trace(),-1}}function ws_any(){return ws_snd||ws_wf||null}var need_geo=!0,need_status=!0;function send_keepalive(){for(var e=0;e<1&&(ws_snd.up&&!(snd_send("SET keepalive")<0));e++){if(need_geo&&""!=kiwi_geo()){if(msg_send("SET geoloc="+kiwi_geo())<0)break;if(msg_send("SET geojson="+kiwi_geojson())<0)break;need_geo=!1}if(send_ident){if(ident_user=ident_user||"",snd_send("SET ident_user="+encodeURIComponent(ident_user))<0)break;send_ident=!1}if(need_status){if(snd_send("SET need_status=1")<0)break;need_status=!1}}ws_wf.up&&wf_send("SET keepalive")}




/* web/openwebrx/audio.min.js (web/openwebrx/audio.js = Fri May 19 21:09:45 2023) */
var audio={d:false,last_flags:0,trim_bufs:false,buffer_size:8192,lo_cut:0,hi_cut:0,SND_FLAG_LPF:0x0001,SND_FLAG_ADC_OVFL:0x0002,SND_FLAG_NEW_FREQ:0x0004,SND_FLAG_MODE_IQ:0x0008,SND_FLAG_COMPRESSED:0x0010,SND_FLAG_RESTART:0x0020,SND_FLAG_SQUELCH_UI:0x0040,SND_FLAG_LITTLE_ENDIAN:0x0080,SND_FLAG_SET_ACTIVE:0x0100,SND_FLAG_CLR_ACTIVE:0x0200,SND_FLAG_TUNE_ACK:0x0400,cur_flags2:0,last_msec:0,_last:0};var audio_periodic_interval_ms=1000;var audio_ext_sequence=0;var audio_meas_dly_ena=0;var audio_initial_connect=false;var audio_watchdog_restart=false;var audio_stat_input_size=0;var audio_stat_total_input_size=0;var audio_reconnect=0;var audio_silence_count=0;var audio_restart_count=0;var audio_stat_output_bufs;var audio_underrun_errors=0;var audio_overrun_errors=0;var audio_last_underruns=0;var audio_last_reconnect=0;var audio_last_restart_count=0;var audio_stat_last_time;var audio_running;var audio_started;var audio_last_output_offset;var audio_mode_iq;var audio_compression;var audio_use_first_sent_comp_value=false;var audio_stat_input_epoch;var audio_prepared_buffers;var audio_prepared_buffers2;var audio_prepared_seq;var audio_prepared_flags;var audio_prepared_smeter;var audio_buffering;var audio_convolver_running;var audio_meas_dly;var audio_meas_dly_start;var resample_new_default=false;var resample_new;var resample_old;var resample_init1;var resample_init2;var resample_input_buffer;var resample_input_available;var resample_input_processed;var resample_last_taps_delay;var resample_output_buffer;var resample_output_buffer2;var resample_output_size;var resample_taps;var resample_taps_length;var resample_last;var resample_last2;var audio_adpcm={index:0,previousValue:0};var audio_ext_adc_ovfl;var audio_need_stats_reset;var audio_change_LPF_latch;var audio_change_freq_latch;var audio_change_sq_UI_latch;var audio_last_sq;var audio_panner=null;var audio_gain;var audio_instance=0;var audio_camping=0;var audio_init_disconnect=0;var comp_lpf_freq;var comp_lpf_taps;var comp_lpf_taps_length;var audio_buffer_size;var audio_buffer_min_length_sec;var audio_buffer_max_length_sec;var audio_data,audio_data_unsquelched;var audio_last_output_buffer,audio_last_output_buffer2;var audio_silence_buffer;var audio_stats_interval;var audio_periodic_interval;var audio_context;var audio_output_rate;var audio_last_is_local,audio_last_compression;var audio_input_rate;var audio_interpolation;var audio_decimation;var audio_resample_ratio;var audio_transition_bw;var audio_min_nbuf;var audio_max_nbuf;var audio_stat_output_epoch;var audio_channels;var audio_source;var audio_watchdog;var audio_firefox_watchdog=0;var audio_change_LPF_delayed;var audio_disconnected;var audio_convolver;function audio_camp(disconnect,is_local,less_buffering,compression){audio_use_first_sent_comp_value=true;audio_camping=disconnect?0:1;audio_init_disconnect=disconnect;audio_init(is_local,less_buffering,compression);audio_ext_sequence=0;audio_meas_dly_ena=0;audio_initial_connect=false;audio_watchdog_restart=false;;}
function audio_reset(){audio.trim_bufs=true;}
function audio_init(is_local,less_buffering,compression){audio_running=false;kiwi_clearInterval(audio_periodic_interval);console.log('--------------------------');if(audio.d)console.log('AUDIO audio_init CALLED audio_init_disconnect='+audio_init_disconnect+' is_local='+is_local+' less_buffering='+less_buffering+' compression='+compression);less_buffering=false;if(audio.d)console.log('AUDIO audio_init LAST audio_last_is_local='+audio_last_is_local+' audio_last_compression='+audio_last_compression);if(is_local==null)is_local=audio_last_is_local;audio_last_is_local=is_local;if(compression==null)compression=audio_last_compression;audio_last_compression=compression;console.log('AUDIO audio_init FINAL is_local='+is_local+' less_buffering='+less_buffering+' compression='+compression);if(audio_init_disconnect||audio_source!=undefined){if(audio.d)console.log('AUDIO audio_init audio_disconnect');audio_disconnect();}
audio_started=false;audio_last_output_offset=0;audio_mode_iq=false;audio_compression=compression?true:false;audio_stat_input_epoch=-1;audio_prepared_buffers=[];audio_prepared_buffers2=[];audio_prepared_seq=[];audio_prepared_flags=[];audio_prepared_smeter=[];audio_buffering=false;audio_convolver_running=false;audio_meas_dly=0;audio_meas_dly_start=0;resample_new=kiwi_isMobile()?false:resample_new_default;resample_old=!resample_new;resample_init1=false;resample_init2=false;resample_input_buffer=[];resample_input_available=0;resample_input_processed=0;resample_last_taps_delay=0;resample_output_buffer=[];resample_output_buffer2=[];resample_taps=[];resample_last=0;resample_last2=0;comp_lpf_freq=0;comp_lpf_taps=[];comp_lpf_taps_length=255;audio_adpcm.index=0;audio_adpcm.previousValue=0;audio_ext_adc_ovfl=false;audio_need_stats_reset=true;audio_change_LPF_latch=false;audio_change_freq_latch=false;audio_change_sq_UI_latch=false;audio_last_sq=undefined;audio_firefox_watchdog=0;kiwi_clearInterval(audio_stats_interval);if(audio_init_disconnect){if(audio.d)console.log('AUDIO audio_init DISCONNECT');audio_init_disconnect=0;return false;}
var buffering_scheme=0;var scheme_s;var a=kiwi_url_param('abuf',null,null);var abuf=0;if(a!=null){var a2=a.split(',');abuf=parseFloat(a2[0]);if(!isNaN(abuf)&&abuf>=0.25&&abuf<=5.0){console.log('AUDIO override abuf='+a);var max=abuf*3;if(a2.length>=2){var m=parseFloat(a2[1]);if(!isNaN(m)&&m>=0.25&&m<=5.0&&m>abuf){max=m;}}else{max=abuf*3;}
audio_buffer_min_length_sec=abuf;audio_buffer_max_length_sec=max;audio_buffer_size=audio.buffer_size;buffering_scheme=9;scheme_s='abuf=';}else{abuf=0;}}
if(abuf==0){if(less_buffering){if(is_local)
buffering_scheme=2;else
buffering_scheme=1;}else{buffering_scheme=0;}
if(buffering_scheme==2){audio_buffer_size=audio.buffer_size;audio_buffer_min_length_sec=0.37;audio_buffer_max_length_sec=2.00;scheme_s='less buf, local';}else
if(buffering_scheme==1){audio_buffer_size=audio.buffer_size;audio_buffer_min_length_sec=0.74;audio_buffer_max_length_sec=3.00;scheme_s='less buf, remote';}else
if(buffering_scheme==0){audio_buffer_size=audio.buffer_size;audio_buffer_min_length_sec=0.85;audio_buffer_max_length_sec=3.40;scheme_s='more buf';}}
audio_data=new Int16Array(audio_buffer_size);audio_data_unsquelched=new Int16Array(audio_buffer_size);audio_last_output_buffer=new Float32Array(audio_buffer_size)
audio_last_output_buffer2=new Float32Array(audio_buffer_size)
audio_silence_buffer=new Float32Array(audio_buffer_size);console.log('AUDIO buffer_size='+audio_buffer_size+' buffering_scheme: '+scheme_s);audio_stats_interval=setInterval(audio_stats,1000);try{window.AudioContext=window.AudioContext||window.webkitAudioContext;audio_context=new AudioContext();audio_context.sampleRate=44100;audio_output_rate=audio_context.sampleRate;try{audio_panner=audio_context.createStereoPanner();audio_panner_ui_init();}catch(e){audio_panner=null;}
if(kiwi_isSmartTV()=='LG')audio_gain=audio_context.createGain();}catch(e){kiwi_serious_error("Your browser does not support Web Audio API, which is required for OpenWebRX to run. Please use an HTML5 compatible browser.");audio_context=null;audio_output_rate=0;return true;}
audio_instance++;setTimeout(function(inst){snd_send('SET little-endian');},10000,audio_instance);audio_running=true;return false;}
function audio_rate(input_rate){audio_input_rate=input_rate;if(audio_input_rate==0){kiwi_debug("user's browser gave zero audio_input_rate?");kiwi_serious_error("Audio initialization problem.");}else
if(audio_output_rate==0){kiwi_debug("user's browser doesn't support WebAudio");kiwi_debug(""+navigator.userAgent);kiwi_serious_error("Browser doesn\'t support WebAudio:<br>"+navigator.userAgent+"<br><br>"+"Please update to the latest version of your browser.");}else{if(resample_old){audio_interpolation=audio_output_rate / audio_input_rate;audio_decimation=1;}else{audio_interpolation=0;if(audio_interpolation==0){var interp,i_decim;for(interp=2;interp<=1024;interp++){var decim=(input_rate*interp)/ audio_output_rate;i_decim=Math.floor(decim);var frac=Math.abs(decim-i_decim);if(frac<0.00001)break;}
if(interp>1024){snd_send("SET UAR in="+input_rate+" out="+audio_output_rate);kiwi_serious_error("Your system uses an audio output rate of "+audio_output_rate+" sps which we do not support.");}else{audio_interpolation=interp;audio_decimation=i_decim;}}}}
if(audio_interpolation!=0){audio_transition_bw=0.001;audio_resample_ratio=audio_output_rate / audio_input_rate;snd_send("SET AR OK in="+input_rate+" out="+audio_output_rate);}else{audio_resample_ratio=1;}
audio_min_nbuf=Math.ceil((audio_buffer_min_length_sec*audio_output_rate)/ audio_buffer_size);audio_max_nbuf=Math.ceil((audio_buffer_max_length_sec*audio_output_rate)/ audio_buffer_size);console.log('AUDIO audio_input_rate='+audio_input_rate+' audio_output_rate='+audio_output_rate);console.log('AUDIO min_length_sec='+audio_buffer_min_length_sec+'('+audio_min_nbuf+' bufs) max_length_sec='+audio_buffer_max_length_sec+'('+audio_max_nbuf+' bufs)');}
function audio_start(){if(audio.d)console.log('AUDIO audio_start');if(audio_context==null)return;audio_started=true;audio_connect(0);audio_periodic_interval=setInterval(audio_periodic,audio_periodic_interval_ms);try{demodulator_analog_replace(init_mode);}catch(ex){kiwi_debug("audio_start.demodulator_analog_replace: catch: "+ex.toString());}}
function audio_disconnect(){if(audio.d)console.log('AUDIO audio_disconnect');if(audio_source){audio_disconnected=true;audio_source.disconnect();audio_source.onaudioprocess=null;audio_source=null;}
if(audio_convolver_running){audio_convolver.disconnect();audio_convolver_running=false;}
if(audio_watchdog){audio_watchdog.disconnect();audio_watchdog.onaudioprocess=null;audio_watchdog=null;}
if(audio_panner){audio_panner.disconnect();}}
function audio_connect_destination(src){if(kiwi_isSmartTV()=='LG'){audio_gain.gain.value=0.3;src.connect(audio_gain);src=audio_gain;}
if(audio_panner){src.connect(audio_panner);audio_panner.connect(audio_context.destination);}else{src.connect(audio_context.destination);}}
function audio_set_pan(pan){if(audio_panner){try{audio_panner.pan.value=pan;}catch(ex){}}}
function audio_connect(reconnect){if(audio_context==null)return;if(!audio_initial_connect&&reconnect){return;}
if(!reconnect)audio_initial_connect=true;if(reconnect){audio_disconnect();resample_init1=resample_init2=false;audio_reconnect++;kiwi_log('AUDIO reconnect BUFFERING true');audio_buffering=true;}
audio_stat_output_epoch=-1;audio_change_LPF_delayed=false;audio_source=audio_context.createScriptProcessor(audio_buffer_size,0,audio_channels);audio_source.onaudioprocess=audio_onprocess;audio_disconnected=false;if(audio_convolver_running){audio_source.connect(audio_convolver);audio_connect_destination(audio_convolver);}else{audio_connect_destination(audio_source);}
if(kiwi_isFirefox()){audio_watchdog=audio_context.createScriptProcessor(audio_buffer_size,audio_channels,0);audio_watchdog.onaudioprocess=audio_watchdog_process;if(audio_convolver_running)
audio_convolver.connect(audio_watchdog);else
audio_source.connect(audio_watchdog);}
audio_pre_record_buf_init();}
function audio_watchdog_process(ev){if(kiwi.muted||audio_buffering){audio_silence_count=0;return;}
var silence_buf=ev.inputBuffer.getChannelData(0);var silent=(silence_buf[0]==0);if(kiwi_gc_snd)silence_buf=null;audio_silence_count=silent?audio_silence_count+1:0;if(audio_silence_count>16){audio_connect(1);audio_silence_count=0;audio_restart_count++;add_problem("FF silence");kiwi_log('AUDIO FF SILENCE');}}
function audio_onprocess(ev){audio_firefox_watchdog++;if(audio_disconnected)return;if(audio_stat_output_epoch==-1){audio_stat_output_epoch=(new Date()).getTime();audio_stat_output_bufs=0;}
audio_stat_output_bufs++;if(audio_started&&audio_prepared_buffers.length==0){audio_underrun_errors++;audio_buffering=true;}
if(!audio_started||audio_buffering){audio_need_stats_reset=true;ev.outputBuffer.copyToChannel(audio_silence_buffer,0);if(audio_channels==2)ev.outputBuffer.copyToChannel(audio_silence_buffer,1);return;}
ev.outputBuffer.copyToChannel(audio_prepared_buffers.shift(),0);if(audio_channels==2)ev.outputBuffer.copyToChannel(audio_prepared_buffers2.shift(),1);audio_ext_sequence=audio_prepared_seq.shift();if(audio_change_LPF_delayed){audio_recompute_LPF(0);audio_change_LPF_delayed=false;}
owrx.sMeter_dBm_biased=audio_prepared_smeter.shift()/ 10;owrx.sMeter_dBm=owrx.sMeter_dBm_biased-SMETER_BIAS;var flags=audio_prepared_flags.shift();audio_ext_adc_ovfl=(flags&audio.SND_FLAG_ADC_OVFL)?true:false;if(flags&audio.SND_FLAG_LPF){audio_change_LPF_delayed=true;}
var sq=(flags&audio.SND_FLAG_SQUELCH_UI)?true:false;if(sq!=audio_last_sq&&isDefined(squelch_action)){setTimeout(function(_sq){squelch_action(_sq);},1,sq);audio_last_sq=sq;}
if(flags&audio.SND_FLAG_TUNE_ACK){setTimeout(function(tune_freq){w3_call('ale_2g_tune_ack',tune_freq);},10,audio.tune_freq);}
if(audio_meas_dly_ena&&audio_meas_dly_start&&(flags&audio.SND_FLAG_NEW_FREQ)){audio_meas_dly=(new Date()).getTime()-audio_meas_dly_start;kiwi_log('AUDIO dly='+audio_meas_dly);audio_meas_dly_start=0;}}
var audio_watchdog_restart_cnt=0;function audio_periodic(){if(audio_context.state!='running'){while(audio_prepared_buffers.length>0){audio_prepared_buffers.shift();if(audio_channels==2)audio_prepared_buffers2.shift();audio_prepared_seq.shift();audio_prepared_flags.shift();audio_prepared_smeter.shift();}
return;}
if(audio_started&&audio_prepared_buffers.length&&audio_firefox_watchdog==0&&kiwi_isFirefox()&&!cfg.disable_recent_changes){add_problem("FF watchdog");console.log('AUDIO FF WATCHDOG Q'+audio_prepared_buffers.length+' WD='+audio_firefox_watchdog+' ============================================');audio_init(null,false,null);audio_initial_connect=false;audio_watchdog_restart=true;snd_send("SET reinit");}
var overran=false;while(audio_prepared_buffers.length>audio_max_nbuf){overran=true;audio_prepared_buffers.shift();if(audio_channels==2)audio_prepared_buffers2.shift();audio_prepared_seq.shift();audio_prepared_flags.shift();audio_prepared_smeter.shift();}
if(overran){add_problem("audio overrun");audio_overrun_errors++;}
if(audio_last_underruns!=audio_underrun_errors){add_problem("audio underrun");snd_send("SET underrun="+audio_underrun_errors);audio_last_underruns=audio_underrun_errors;}}
function audio_adpcm_state(index,previousValue){audio_adpcm.index=index;audio_adpcm.previousValue=previousValue;audio_camping=2;}
function audio_pre_record_buf_init(){if(pre_record==0||isUndefined(cur_mode)){kiwi.pre_buf=null;return;}
var srate=Math.round(audio_input_rate||12000);var nch=ext_is_IQ_or_stereo_curmode()?2:1;var secs=pre_record_v[pre_record]+1;var pre_samps=Math.round(secs*nch*srate);if(pre_samps&1)pre_samps++;console.log('AUDIO pre_record init: samps='+pre_samps+' time='+pre_record_v[pre_record]);kiwi.pre_samps=pre_samps;kiwi.pre_size=pre_samps*2;kiwi.pre_last=kiwi.pre_size-2;kiwi.pre_buf=new ArrayBuffer(kiwi.pre_size);kiwi.pre_data=new DataView(kiwi.pre_buf);kiwi.pre_off=0;kiwi.pre_wrapped=false;kiwi.pre_captured=false;kiwi.pre_ping_pong=0;}
function audio_recv(data,ws,firstChars){if(!audio_running)return;if(firstChars!='SND'){var spec=new Uint8Array(data,5);spectrum_update(spec);return;}
var h8=new Uint8Array(data,0,8);var flags=h8[3];var squelched=flags&audio.SND_FLAG_SQUELCH_UI;var seq=(h8[7]<<24)|(h8[6]<<16)|(h8[5]<<8)|h8[4];if(audio_camping==1&&(flags&audio.SND_FLAG_COMPRESSED))return;if(audio_camping&&audio_use_first_sent_comp_value){audio_compression=(flags&audio.SND_FLAG_COMPRESSED)?true:false;audio_use_first_sent_comp_value=false;}
var sm8=new Uint8Array(data,8,2);var smeter=(sm8[0]<<8)|sm8[1];var isIQ=(flags&audio.SND_FLAG_MODE_IQ);var offset=isIQ?20:10;var data_view=new DataView(data,offset);var bytes=data_view.byteLength;var i,samps;if(audio_watchdog_restart){if(!(flags&audio.SND_FLAG_RESTART))return;audio_watchdog_restart=false;audio_prepared_buffers=[];audio_prepared_buffers2=[];audio_prepared_seq=[];audio_prepared_flags=[];audio_prepared_smeter=[];if(audio_mode_iq){resample_new=false;resample_old=!resample_new;}else{audio_adpcm.index=audio_adpcm.previousValue=0;resample_new=kiwi_isMobile()?false:resample_new_default;resample_old=!resample_new;}
audio_connect(1);}else
if(isIQ){if(!audio_mode_iq){audio_prepared_buffers=[];audio_prepared_buffers2=[];audio_prepared_seq=[];audio_prepared_flags=[];audio_prepared_smeter=[];resample_new=false;resample_old=!resample_new;audio_mode_iq=true;audio_channels=2;if(audio.d)console.log('AUDIO !IQ -> IQ transition');audio_connect(1);}
audio_last_compression=audio_compression=false;audio_mode_iq=true;}else{var compressed=(flags&audio.SND_FLAG_COMPRESSED)?true:false;if(audio_mode_iq||(audio_compression!=compressed)){audio_prepared_buffers=[];audio_prepared_buffers2=[];audio_prepared_seq=[];audio_prepared_flags=[];audio_prepared_smeter=[];audio_adpcm.index=audio_adpcm.previousValue=0;resample_new=kiwi_isMobile()?false:resample_new_default;resample_old=!resample_new;if(audio.d){if(audio_mode_iq)
console.log('AUDIO IQ -> !IQ transition, compressed='+compressed);else
console.log('AUDIO !IQ, compression change='+(audio_compression!=compressed)+' compressed='+compressed);}
audio_mode_iq=false;audio_channels=1;audio_last_compression=audio_compression=compressed;audio_connect(1);}
audio_last_compression=audio_compression=compressed;audio_mode_iq=false;}
audio_channels=audio_mode_iq?2:1;if(audio_compression){if(audio.d){var now=Date.now();var msec=now-audio.last_msec;audio.last_msec=now;console.log('AC Q'+audio_prepared_buffers.length+' '+audio_channels+'ch '+msec);}
decode_ima_adpcm_e8_i16(data_view,audio_data,audio_data_unsquelched,squelched,bytes,audio_adpcm);samps=bytes*2;}else{if(audio.d){var now=Date.now();var msec=now-audio.last_msec;audio.last_msec=now;if(isIQ)
console.log('ANC IQ Q'+audio_prepared_buffers.length+'/'+audio_prepared_buffers2.length+' '+audio_channels+'ch '+msec);else
console.log('ANC Q'+audio_prepared_buffers.length+' '+audio_channels+'ch '+msec);}
samps=bytes/2;for(i=0;i<samps;i++){audio_data_unsquelched[i]=data_view.getInt16(i*2,(flags&audio.SND_FLAG_LITTLE_ENDIAN)?true:false);audio_data[i]=squelched?1:audio_data_unsquelched[i];}}
audio_prepare(audio_data,samps,seq,flags,smeter);if(!audio_started){var enough_buffered=audio_prepared_buffers.length>audio_min_nbuf;if(enough_buffered)
audio_start();}
if(audio_need_stats_reset)
audio_stats_reset();audio_stat_input_size+=samps;audio_stat_total_input_size+=samps;extint_audio_data(audio_data,samps);if(wf.audioFFT_active){wf_audio_FFT(audio_data,samps);}
audio_record(audio_compression);}
function audio_record(compressed){var samples=audio_mode_iq?1024:(compressed?2048:512);var pre_record_buffer=function(){if(!kiwi.pre_buf)return;for(var i=0;i<samples;i++){var samp=audio_data_unsquelched[i];kiwi.pre_data.setInt16(kiwi.pre_off,samp,true);kiwi.pre_off+=2;if(kiwi.pre_off>=kiwi.pre_size){kiwi.pre_off=0;kiwi.pre_wrapped=true;kiwi.pre_ping_pong^=1;}}
kiwi.pre_captured=true;}
if(window.recording){var check_grow=function(){if(window.recording_meta.offset==65536){window.recording_meta.buffers.push(new ArrayBuffer(65536));window.recording_meta.data=new DataView(window.recording_meta.buffers[window.recording_meta.buffers.length-1]);window.recording_meta.offset=0;}};if(audio_last_sq==true){pre_record_buffer();}else{if(kiwi.pre_captured){if(kiwi.pre_wrapped){console.log('AUDIO pre_record WRAPPED insert pre_off='+kiwi.pre_off+' '+
(kiwi.pre_size-kiwi.pre_off)+'+'+kiwi.pre_off+'='+kiwi.pre_size+' ping_pong='+kiwi.pre_ping_pong);for(var i=kiwi.pre_off;i<kiwi.pre_size;i+=2){var samp=kiwi.pre_data.getInt16(i,true);window.recording_meta.data.setInt16(window.recording_meta.offset,samp,true);window.recording_meta.offset+=2;check_grow();}
window.recording_meta.total_size+=kiwi.pre_size-kiwi.pre_off;for(var i=0;i<kiwi.pre_off;i+=2){var samp=kiwi.pre_data.getInt16(i,true);window.recording_meta.data.setInt16(window.recording_meta.offset,samp,true);window.recording_meta.offset+=2;check_grow();}
window.recording_meta.total_size+=kiwi.pre_off;}else{console.log('AUDIO pre_record NOT-WRAPPED insert pre_off='+kiwi.pre_off+'/'+kiwi.pre_size+' ping_pong='+kiwi.pre_ping_pong);for(var i=0;i<kiwi.pre_off;i+=2){var samp=kiwi.pre_data.getInt16(i,true);window.recording_meta.data.setInt16(window.recording_meta.offset,samp,true);window.recording_meta.offset+=2;check_grow();}
window.recording_meta.total_size+=kiwi.pre_off;}
kiwi.pre_off=0;kiwi.pre_wrapped=false;kiwi.pre_captured=false;kiwi.pre_ping_pong=0;}
for(var i=0;i<samples;++i){window.recording_meta.data.setInt16(window.recording_meta.offset,audio_data[i],true);window.recording_meta.offset+=2;check_grow();}
window.recording_meta.total_size+=samples*2;}}else{pre_record_buffer();}}
function audio_recv_flags2(p){var ap=p.split(':');switch(ap[0]){case'active':var active=+ap[1];console.log('$ active='+active);audio.cur_flags2|=active?audio.SND_FLAG_SET_ACTIVE:SND_FLAG_CLR_ACTIVE;break;case'tune_ack':audio.tune_freq=+ap[1];console.log('$ tune_ack='+audio.tune_freq);audio.cur_flags2|=audio.SND_FLAG_TUNE_ACK;break;}}
var audio_push_ct=0;function audio_prepare(data,data_len,seq,flags,smeter){var resample_new_decomp=resample_new&&audio_compression&&comp_lpf_taps_length;var dopush=function(){audio_prepared_buffers.push(audio_last_output_buffer);if(audio_channels==2)audio_prepared_buffers2.push(audio_last_output_buffer2);audio_prepared_seq.push(seq);if(audio_change_LPF_latch){audio_change_LPF_latch=false;flags|=audio.SND_FLAG_LPF;}
if(audio_change_freq_latch){audio_change_freq_latch=false;flags|=audio.SND_FLAG_NEW_FREQ;}
if(audio_change_sq_UI_latch){audio_change_sq_UI_latch=false;flags|=audio.SND_FLAG_SQUELCH_UI;}
if(audio.cur_flags2){flags|=audio.cur_flags2;audio.cur_flags2=0;}
audio_prepared_flags.push(flags);audio_prepared_smeter.push(smeter);audio_last_output_offset=0;audio_last_output_buffer=new Float32Array(audio_buffer_size);if(audio_channels==2)audio_last_output_buffer2=new Float32Array(audio_buffer_size);};var copy=function(d,di,s,si,len){var i;for(i=0;i<len;i++)d[di+i]=s[si+i];};var idata,idata2,idata_length;if(data_len==0)return;if(audio_resample_ratio!=1){if(!resample_init1){resample_taps_length=Math.round(4.0/audio_transition_bw);if(resample_taps_length%2==0)resample_taps_length++;rational_resampler_get_lowpass_f(resample_taps,resample_taps_length,audio_interpolation,audio_decimation);resample_init1=true;}
if(!resample_init2&&resample_init1&&(resample_new_decomp||resample_old)&&(audio_source!=undefined)){var lpf_taps,lpf_taps_length;audio_recompute_LPF(1);lpf_taps=comp_lpf_taps;lpf_taps_length=comp_lpf_taps_length;audio_convolver=audio_context.createConvolver();audio_convolver.normalize=false;audio_reload_convolver_buffer(lpf_taps,lpf_taps_length);if(audio.d)console.log('AUDIO splice in convolver');audio_source.disconnect();audio_source.connect(audio_convolver);audio_connect_destination(audio_convolver);if(kiwi_isFirefox()){audio_convolver.connect(audio_watchdog);}
audio_convolver_running=true;resample_init2=true;}
if(resample_old){if(audio_channels==2){resample_output_size=Math.round(data_len/2*audio_resample_ratio);var incr=1.0 / audio_resample_ratio;var di=0;var frac=0;var xc,xc2,xl;for(i=0;i<resample_output_size;i++){xc=data[di*2];xl=resample_last;resample_output_buffer[i]=(xc-xl)*frac+xl;xc2=data[di*2+1];xl=resample_last2;resample_output_buffer2[i]=(xc2-xl)*frac+xl;frac+=incr;if(frac>=1){frac-=1;resample_last=xc;resample_last2=xc2;di++;}}
resample_last=xc;resample_last2=xc2;}else{resample_output_size=Math.round(data_len*audio_resample_ratio);var incr=1.0 / audio_resample_ratio;var di=0;var frac=0;var xc,xl;for(i=0;i<resample_output_size;i++){xc=data[di];xl=resample_last;resample_output_buffer[i]=(xc-xl)*frac+xl;frac+=incr;if(frac>=1){frac-=1;resample_last=xc;di++;}}
resample_last=xc;}}else{if(resample_input_processed!=0){var new_available=resample_input_available-resample_input_processed;copy(resample_input_buffer,0,resample_input_buffer,resample_input_processed,new_available);resample_input_available=new_available;resample_input_processed=0;}
copy(resample_input_buffer,resample_input_available,data,0,data_len);resample_input_available+=data_len;if(audio_channels==2){rational_resampler_cc(resample_input_buffer,resample_output_buffer,resample_output_buffer2,resample_input_available,audio_interpolation,audio_decimation,resample_taps,resample_taps_length,resample_last_taps_delay);}else{rational_resampler_ff(resample_input_buffer,resample_output_buffer,resample_input_available,audio_interpolation,audio_decimation,resample_taps,resample_taps_length,resample_last_taps_delay);}}
idata=resample_output_buffer;idata2=resample_output_buffer2;idata_length=resample_output_size;}else{idata=data;idata_length=data_len;}
if(flags&audio.SND_FLAG_LPF){audio_change_LPF_latch=true;}
if((flags&audio.SND_FLAG_NEW_FREQ)||audio.trim_bufs){audio_change_freq_latch=true;audio.trim_bufs=false;var len=audio_prepared_buffers.length;var min=audio_min_nbuf;var pop=(len>min)?(len-min):0;while(audio_prepared_buffers.length>min){audio_prepared_buffers.pop();if(audio_channels==2)audio_prepared_buffers2.pop();audio_prepared_seq.pop();audio_prepared_flags.pop();audio_prepared_smeter.pop();}}
if(flags&audio.SND_FLAG_SQUELCH_UI){audio_change_sq_UI_latch=true;}
if(audio_last_output_offset+idata_length<=audio_buffer_size){if(audio_channels==2){for(var i=0;i<idata_length;i++){audio_last_output_buffer[i+audio_last_output_offset]=idata[i]/ 32768*kiwi.volume_f;audio_last_output_buffer2[i+audio_last_output_offset]=idata2[i]/ 32768*kiwi.volume_f;}}else{for(var i=0;i<idata_length;i++)
audio_last_output_buffer[i+audio_last_output_offset]=idata[i]/ 32768*kiwi.volume_f;}
audio_last_output_offset+=idata_length;if(audio_last_output_offset==audio_buffer_size)dopush();}else{var copied=audio_buffer_size-audio_last_output_offset;var remain=idata_length-copied;if(audio_channels==2){for(var i=0;i<audio_buffer_size-audio_last_output_offset;i++){audio_last_output_buffer[i+audio_last_output_offset]=idata[i]/ 32768*kiwi.volume_f;audio_last_output_buffer2[i+audio_last_output_offset]=idata2[i]/ 32768*kiwi.volume_f;}}else{for(var i=0;i<audio_buffer_size-audio_last_output_offset;i++)
audio_last_output_buffer[i+audio_last_output_offset]=idata[i]/ 32768*kiwi.volume_f;}
dopush();do{var i;for(i=0;i<remain;i++){if(i==audio_buffer_size){dopush();break;}
audio_last_output_buffer[i]=idata[i+copied]/ 32768*kiwi.volume_f;if(audio_channels==2)audio_last_output_buffer2[i]=idata2[i+copied]/ 32768*kiwi.volume_f;}
remain-=i;copied+=i;}while(remain);audio_last_output_offset+=i;}
if(audio_buffering){var enough_buffered=audio_prepared_buffers.length>audio_min_nbuf;if(enough_buffered){audio_buffering=false;}}}
try{if(!AudioBuffer.prototype.copyToChannel){AudioBuffer.prototype.copyToChannel=function(input,channel){var cd=this.getChannelData(channel);for(var i=0;i<input.length;i++)cd[i]=input[i];}}}catch(ex){console.log("CATCH: AudioBuffer.prototype.copyToChannel");}
function audio_stats_reset(){audio_stat_input_epoch=(new Date()).getTime();audio_stat_last_time=audio_stat_input_epoch;audio_stat_input_size=audio_stat_total_input_size=0;audio_need_stats_reset=false;}
function audio_stats(){if(audio_stat_input_epoch==-1||audio_stat_output_epoch==-1)
return;var time_now=(new Date()).getTime();var secs_since_last_call=(time_now-audio_stat_last_time)/1000;var secs_since_reset=(time_now-audio_stat_input_epoch)/1000;var secs_since_first_output=(time_now-audio_stat_output_epoch)/1000;audio_stat_last_time=time_now;var net_sps=audio_stat_input_size / secs_since_last_call;var net_avg=audio_stat_total_input_size / secs_since_reset;var out_sps=(audio_stat_output_bufs*audio_buffer_size)/ secs_since_first_output;if(audio.d){var s="Audio: network "+
net_sps.toFixed(0)+" sps ("+
net_avg.toFixed(0)+" avg), output "+
out_sps.toFixed(0)+" sps";s+=', Qlen '+audio_prepared_buffers.length;if(audio_underrun_errors)s+=', underruns '+audio_underrun_errors.toString();if(audio_restart_count)s+=', restart '+audio_restart_count.toString();console.log(s);}
if(isNaN(out_sps))out_sps=0;w3_innerHTML('id-status-audio',w3_text('w3-text-css-orange','WF'),w3_text('',kiwi.wf_fps.toFixed(0)+' fps'),w3_text('w3-text-css-orange','Audio'),w3_text('',(out_sps/1000).toFixed(1)+'k, Qlen '+audio_prepared_buffers.length));audio_stat_input_size=0;}
function audio_recompute_LPF(force,lo_cut,hi_cut){if(isDefined(lo_cut)&&isDefined(hi_cut)){audio.lo_cut=Math.abs(lo_cut);audio.hi_cut=Math.abs(hi_cut);}
if(audio_camping){lo_cut=audio.lo_cut;hi_cut=audio.hi_cut;}else{if(isDefined(demodulators[0])){hi_cut=Math.abs(demodulators[0].high_cut);if(isNaN(hi_cut))console.log(demodulators[0]);lo_cut=Math.abs(demodulators[0].low_cut);}else{lo_cut=0,hi_cut=4000;}}
var lpf_freq=Math.max(hi_cut,lo_cut);if(force||lpf_freq!=comp_lpf_freq){var cutoff=lpf_freq / audio_output_rate;firdes_lowpass_f(comp_lpf_taps,comp_lpf_taps_length,cutoff);comp_lpf_freq=lpf_freq;if(audio_convolver_running){audio_reload_convolver_buffer(comp_lpf_taps,comp_lpf_taps_length);}}else{}}
function audio_reload_convolver_buffer(lpf_taps,lpf_taps_length){var audio_lpf_buffer=audio_context.createBuffer(2,lpf_taps_length,audio_output_rate);var audio_lpf=audio_lpf_buffer.getChannelData(0);audio_lpf.set(lpf_taps);audio_lpf=audio_lpf_buffer.getChannelData(1);audio_lpf.set(lpf_taps);audio_convolver.buffer=audio_lpf_buffer;}
function rational_resampler_ff(input,output,input_size,interpolation,decimation,taps,taps_length,last_taps_delay){var output_size=Math.round(input_size*interpolation/decimation);var i,oi;var startingi,delayi,last_delayi=-1;for(oi=0;oi<output_size;oi++){startingi=Math.floor((oi*decimation+interpolation-1-last_taps_delay)/ interpolation);delayi=Math.floor((last_taps_delay+startingi*interpolation-oi*decimation)%interpolation);if(startingi+taps_length/interpolation+1>input_size)
break;var end=Math.floor((taps_length-delayi)/ interpolation);var acc=0;for(i=0;i<end;i++){acc+=input[startingi+i]*taps[delayi+i*interpolation];}
output[oi]=acc*interpolation;}
resample_input_processed=startingi;resample_output_size=oi;resample_last_taps_delay=delayi;}
function rational_resampler_cc(input,outputI,outputQ,input_size,interpolation,decimation,taps,taps_length,last_taps_delay){console.log('WARNING rational_resampler_cc() not working yet!');return;}
function rational_resampler_get_lowpass_f(output,output_size,interpolation,decimation){var cutoff_for_interpolation=1.0/interpolation;var cutoff_for_decimation=1.0/decimation;var cutoff=(cutoff_for_interpolation<cutoff_for_decimation)?cutoff_for_interpolation:cutoff_for_decimation;firdes_lowpass_f(output,output_size,cutoff/2);}
function firdes_lowpass_f(output,length,cutoff_rate){var i;var middle=Math.floor(length/2);output[middle]=2*Math.PI*cutoff_rate*firdes_wkernel_hamming(0);for(i=1;i<=middle;i++){output[middle-i]=output[middle+i]=(Math.sin(2*Math.PI*cutoff_rate*i)/i)*firdes_wkernel_hamming(i/middle);}
var sum=0;for(i=0;i<length;i++){sum+=output[i];}
for(i=0;i<length;i++){output[i]/=sum;}}
function firdes_wkernel_hamming(rate){rate=0.5+rate/2;return 0.54-0.46*Math.cos(2*Math.PI*rate);}





/* web/openwebrx/ima_adpcm.min.js (web/openwebrx/ima_adpcm.js = Tue Sep 13 11:59:05 2022) */
var indexAdjustTable=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8];var stepSizeTable=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767];function ImaAdpcmDecode(deltaCode,state){var step=stepSizeTable[state.index];var difference=step>>3;if(deltaCode&1)difference+=step>>2;if(deltaCode&2)difference+=step>>1;if(deltaCode&4)difference+=step;if(deltaCode&8)difference=-difference;state.previousValue+=difference;if(state.previousValue>state.pos_clamp)state.previousValue=state.pos_clamp;else if(state.previousValue<state.neg_clamp)state.previousValue=state.neg_clamp;state.index+=indexAdjustTable[deltaCode];if(state.index<0)state.index=0;else if(state.index>88)state.index=88;return state.previousValue;}
function decode_ima_adpcm_e8_i16(input,output,output_unsquelched,squelched,input_length,state){state.pos_clamp=+32767;state.neg_clamp=-32768;var i,k=0;for(i=0;i<input_length;i++){var byte=input.getUint8(i);output_unsquelched[k]=ImaAdpcmDecode(byte&0xf,state);output[k]=squelched?1:output_unsquelched[k];k++;output_unsquelched[k]=ImaAdpcmDecode((byte>>4)&0xf,state);output[k]=squelched?1:output_unsquelched[k];k++;}}
function decode_ima_adpcm_e8_u8(input,output,input_length,state){state.pos_clamp=255;state.neg_clamp=0;var i,k=0;for(i=0;i<input_length;i++){output[k++]=ImaAdpcmDecode(input[i]&0xf,state);output[k++]=ImaAdpcmDecode((input[i]>>4)&0xf,state);}}





/* web/pkgs/w3color.min.js (web/pkgs/w3color.js = Tue Oct 12 08:26:57 2021) */
(function(){function w3color(color,elmnt){if(!(this instanceof w3color)){return new w3color(color,elmnt);}
if(typeof color=="object"){return color;}
this.attachValues(toColorObject(color));if(elmnt){elmnt.style.backgroundColor=this.toRgbString();}}
w3color.prototype={toRgbString:function(){return"rgb("+this.red+", "+this.green+", "+this.blue+")";},toRgbaString:function(){return"rgba("+this.red+", "+this.green+", "+this.blue+", "+this.opacity+")";},toHwbString:function(){return"hwb("+this.hue+", "+Math.round(this.whiteness*100)+"%, "+Math.round(this.blackness*100)+"%)";},toHwbStringDecimal:function(){return"hwb("+this.hue+", "+this.whiteness+", "+this.blackness+")";},toHwbaString:function(){return"hwba("+this.hue+", "+Math.round(this.whiteness*100)+"%, "+Math.round(this.blackness*100)+"%, "+this.opacity+")";},toHslString:function(){return"hsl("+this.hue+", "+Math.round(this.sat*100)+"%, "+Math.round(this.lightness*100)+"%)";},toHslStringDecimal:function(){return"hsl("+this.hue+", "+this.sat+", "+this.lightness+")";},toHslaString:function(){return"hsla("+this.hue+", "+Math.round(this.sat*100)+"%, "+Math.round(this.lightness*100)+"%, "+this.opacity+")";},toCmykString:function(){return"cmyk("+Math.round(this.cyan*100)+"%, "+Math.round(this.magenta*100)+"%, "+Math.round(this.yellow*100)+"%, "+Math.round(this.black*100)+"%)";},toCmykStringDecimal:function(){return"cmyk("+this.cyan+", "+this.magenta+", "+this.yellow+", "+this.black+")";},toNcolString:function(){return this.ncol+", "+Math.round(this.whiteness*100)+"%, "+Math.round(this.blackness*100)+"%";},toNcolStringDecimal:function(){return this.ncol+", "+this.whiteness+", "+this.blackness;},toNcolaString:function(){return this.ncol+", "+Math.round(this.whiteness*100)+"%, "+Math.round(this.blackness*100)+"%, "+this.opacity;},toName:function(){var r,g,b,colorhexs=getColorArr('hexs');for(i=0;i<colorhexs.length;i++){r=parseInt(colorhexs[i].substr(0,2),16);g=parseInt(colorhexs[i].substr(2,2),16);b=parseInt(colorhexs[i].substr(4,2),16);if(this.red==r&&this.green==g&&this.blue==b){return getColorArr('names')[i];}}
return"";},toHexString:function(){var r=toHex(this.red);var g=toHex(this.green);var b=toHex(this.blue);return"#"+r+g+b;},toRgb:function(){return{r:this.red,g:this.green,b:this.blue,a:this.opacity};},toHsl:function(){return{h:this.hue,s:this.sat,l:this.lightness,a:this.opacity};},toHwb:function(){return{h:this.hue,w:this.whiteness,b:this.blackness,a:this.opacity};},toCmyk:function(){return{c:this.cyan,m:this.magenta,y:this.yellow,k:this.black,a:this.opacity};},toNcol:function(){return{ncol:this.ncol,w:this.whiteness,b:this.blackness,a:this.opacity};},isDark:function(n){var m=(n||128);return(((this.red*299+this.green*587+this.blue*114)/ 1000)<m);},saturate:function(n){var x,rgb,color;x=(n / 100||0.1);this.sat+=x;if(this.sat>1){this.sat=1;}
rgb=hslToRgb(this.hue,this.sat,this.lightness);color=colorObject(rgb,this.opacity,this.hue,this.sat);this.attachValues(color);},desaturate:function(n){var x,rgb,color;x=(n / 100||0.1);this.sat-=x;if(this.sat<0){this.sat=0;}
rgb=hslToRgb(this.hue,this.sat,this.lightness);color=colorObject(rgb,this.opacity,this.hue,this.sat);this.attachValues(color);},lighter:function(n){var x,rgb,color;x=(n / 100||0.1);this.lightness+=x;if(this.lightness>1){this.lightness=1;}
rgb=hslToRgb(this.hue,this.sat,this.lightness);color=colorObject(rgb,this.opacity,this.hue,this.sat);this.attachValues(color);},darker:function(n){var x,rgb,color;x=(n / 100||0.1);this.lightness-=x;if(this.lightness<0){this.lightness=0;}
rgb=hslToRgb(this.hue,this.sat,this.lightness);color=colorObject(rgb,this.opacity,this.hue,this.sat);this.attachValues(color);},attachValues:function(color){this.red=color.red;this.green=color.green;this.blue=color.blue;this.hue=color.hue;this.sat=color.sat;this.lightness=color.lightness;this.whiteness=color.whiteness;this.blackness=color.blackness;this.cyan=color.cyan;this.magenta=color.magenta;this.yellow=color.yellow;this.black=color.black;this.ncol=color.ncol;this.opacity=color.opacity;this.valid=color.valid;}};function toColorObject(c){var x,y,typ,arr=[],arrlength,i,opacity,match,a,hue,sat,rgb,colornames=[],colorhexs=[];c=w3trim(c.toLowerCase());x=c.substr(0,1).toUpperCase();y=c.substr(1);a=1;if((x=="R"||x=="Y"||x=="G"||x=="C"||x=="B"||x=="M"||x=="W")&&!isNaN(y)){if(c.length==6&&c.indexOf(",")==-1){}else{c="ncol("+c+")";}}
if(c.length!=3&&c.length!=6&&!isNaN(c)){c="ncol("+c+")";}
if(c.indexOf(",")>0&&c.indexOf("(")==-1){c="ncol("+c+")";}
if(c.substr(0,3)=="rgb"||c.substr(0,3)=="hsl"||c.substr(0,3)=="hwb"||c.substr(0,4)=="ncol"||c.substr(0,4)=="cmyk"){if(c.substr(0,4)=="ncol"){if(c.split(",").length==4&&c.indexOf("ncola")==-1){c=c.replace("ncol","ncola");}
typ="ncol";c=c.substr(4);}else if(c.substr(0,4)=="cmyk"){typ="cmyk";c=c.substr(4);}else{typ=c.substr(0,3);c=c.substr(3);}
arrlength=3;opacity=false;if(c.substr(0,1).toLowerCase()=="a"){arrlength=4;opacity=true;c=c.substr(1);}else if(typ=="cmyk"){arrlength=4;if(c.split(",").length==5){arrlength=5;opacity=true;}}
c=c.replace("(","");c=c.replace(")","");arr=c.split(",");if(typ=="rgb"){if(arr.length!=arrlength){return emptyObject();}
for(i=0;i<arrlength;i++){if(arr[i]==""||arr[i]==" "){arr[i]="0";}
if(arr[i].indexOf("%")>-1){arr[i]=arr[i].replace("%","");arr[i]=Number(arr[i]/ 100);if(i<3){arr[i]=Math.round(arr[i]*255);}}
if(isNaN(arr[i])){return emptyObject();}
if(parseInt(arr[i])>255){arr[i]=255;}
if(i<3){arr[i]=parseInt(arr[i]);}
if(i==3&&Number(arr[i])>1){arr[i]=1;}}
rgb={r:arr[0],g:arr[1],b:arr[2]};if(opacity==true){a=Number(arr[3]);}}
if(typ=="hsl"||typ=="hwb"||typ=="ncol"){while(arr.length<arrlength){arr.push("0");}
if(typ=="hsl"||typ=="hwb"){if(parseInt(arr[0])>=360){arr[0]=0;}}
for(i=1;i<arrlength;i++){if(arr[i].indexOf("%")>-1){arr[i]=arr[i].replace("%","");arr[i]=Number(arr[i]);if(isNaN(arr[i])){return emptyObject();}
arr[i]=arr[i]/ 100;}else{arr[i]=Number(arr[i]);}
if(Number(arr[i])>1){arr[i]=1;}
if(Number(arr[i])<0){arr[i]=0;}}
if(typ=="hsl"){rgb=hslToRgb(arr[0],arr[1],arr[2]);hue=Number(arr[0]);sat=Number(arr[1]);}
if(typ=="hwb"){rgb=hwbToRgb(arr[0],arr[1],arr[2]);}
if(typ=="ncol"){rgb=ncolToRgb(arr[0],arr[1],arr[2]);}
if(opacity==true){a=Number(arr[3]);}}
if(typ=="cmyk"){while(arr.length<arrlength){arr.push("0");}
for(i=0;i<arrlength;i++){if(arr[i].indexOf("%")>-1){arr[i]=arr[i].replace("%","");arr[i]=Number(arr[i]);if(isNaN(arr[i])){return emptyObject();}
arr[i]=arr[i]/ 100;}else{arr[i]=Number(arr[i]);}
if(Number(arr[i])>1){arr[i]=1;}
if(Number(arr[i])<0){arr[i]=0;}}
rgb=cmykToRgb(arr[0],arr[1],arr[2],arr[3]);if(opacity==true){a=Number(arr[4]);}}}else if(c.substr(0,3)=="ncs"){rgb=ncsToRgb(c);}else{match=false;colornames=getColorArr('names');for(i=0;i<colornames.length;i++){if(c.toLowerCase()==colornames[i].toLowerCase()){colorhexs=getColorArr('hexs');match=true;rgb={r:parseInt(colorhexs[i].substr(0,2),16),g:parseInt(colorhexs[i].substr(2,2),16),b:parseInt(colorhexs[i].substr(4,2),16)};break;}}
if(match==false){c=c.replace("#","");if(c.length==3){c=c.substr(0,1)+c.substr(0,1)+c.substr(1,1)+c.substr(1,1)+c.substr(2,1)+c.substr(2,1);}
for(i=0;i<c.length;i++){if(!isHex(c.substr(i,1))){return emptyObject();}}
arr[0]=parseInt(c.substr(0,2),16);arr[1]=parseInt(c.substr(2,2),16);arr[2]=parseInt(c.substr(4,2),16);for(i=0;i<3;i++){if(isNaN(arr[i])){return emptyObject();}}
rgb={r:arr[0],g:arr[1],b:arr[2]};}}
return colorObject(rgb,a,hue,sat);}
function colorObject(rgb,a,h,s){var hsl,hwb,cmyk,ncol,color,hue,sat;if(!rgb){return emptyObject();}
if(a===null){a=1;}
hsl=rgbToHsl(rgb.r,rgb.g,rgb.b);hwb=rgbToHwb(rgb.r,rgb.g,rgb.b);cmyk=rgbToCmyk(rgb.r,rgb.g,rgb.b);hue=(h||hsl.h);sat=(s||hsl.s);ncol=hueToNcol(hue);color={red:rgb.r,green:rgb.g,blue:rgb.b,hue:hue,sat:sat,lightness:hsl.l,whiteness:hwb.w,blackness:hwb.b,cyan:cmyk.c,magenta:cmyk.m,yellow:cmyk.y,black:cmyk.k,ncol:ncol,opacity:a,valid:true};color=roundDecimals(color);return color;}
function emptyObject(){return{red:0,green:0,blue:0,hue:0,sat:0,lightness:0,whiteness:0,blackness:0,cyan:0,magenta:0,yellow:0,black:0,ncol:"R",opacity:1,valid:false};}
function getColorArr(x){if(x=="names"){return['AliceBlue','AntiqueWhite','Aqua','Aquamarine','Azure','Beige','Bisque','Black','BlanchedAlmond','Blue','BlueViolet','Brown','BurlyWood','CadetBlue','Chartreuse','Chocolate','Coral','CornflowerBlue','Cornsilk','Crimson','Cyan','DarkBlue','DarkCyan','DarkGoldenRod','DarkGray','DarkGrey','DarkGreen','DarkKhaki','DarkMagenta','DarkOliveGreen','DarkOrange','DarkOrchid','DarkRed','DarkSalmon','DarkSeaGreen','DarkSlateBlue','DarkSlateGray','DarkSlateGrey','DarkTurquoise','DarkViolet','DeepPink','DeepSkyBlue','DimGray','DimGrey','DodgerBlue','FireBrick','FloralWhite','ForestGreen','Fuchsia','Gainsboro','GhostWhite','Gold','GoldenRod','Gray','Grey','Green','GreenYellow','HoneyDew','HotPink','IndianRed','Indigo','Ivory','Khaki','Lavender','LavenderBlush','LawnGreen','LemonChiffon','LightBlue','LightCoral','LightCyan','LightGoldenRodYellow','LightGray','LightGrey','LightGreen','LightPink','LightSalmon','LightSeaGreen','LightSkyBlue','LightSlateGray','LightSlateGrey','LightSteelBlue','LightYellow','Lime','LimeGreen','Linen','Magenta','Maroon','MediumAquaMarine','MediumBlue','MediumOrchid','MediumPurple','MediumSeaGreen','MediumSlateBlue','MediumSpringGreen','MediumTurquoise','MediumVioletRed','MidnightBlue','MintCream','MistyRose','Moccasin','NavajoWhite','Navy','OldLace','Olive','OliveDrab','Orange','OrangeRed','Orchid','PaleGoldenRod','PaleGreen','PaleTurquoise','PaleVioletRed','PapayaWhip','PeachPuff','Peru','Pink','Plum','PowderBlue','Purple','RebeccaPurple','Red','RosyBrown','RoyalBlue','SaddleBrown','Salmon','SandyBrown','SeaGreen','SeaShell','Sienna','Silver','SkyBlue','SlateBlue','SlateGray','SlateGrey','Snow','SpringGreen','SteelBlue','Tan','Teal','Thistle','Tomato','Turquoise','Violet','Wheat','White','WhiteSmoke','Yellow','YellowGreen'];}
if(x=="hexs"){return['f0f8ff','faebd7','00ffff','7fffd4','f0ffff','f5f5dc','ffe4c4','000000','ffebcd','0000ff','8a2be2','a52a2a','deb887','5f9ea0','7fff00','d2691e','ff7f50','6495ed','fff8dc','dc143c','00ffff','00008b','008b8b','b8860b','a9a9a9','a9a9a9','006400','bdb76b','8b008b','556b2f','ff8c00','9932cc','8b0000','e9967a','8fbc8f','483d8b','2f4f4f','2f4f4f','00ced1','9400d3','ff1493','00bfff','696969','696969','1e90ff','b22222','fffaf0','228b22','ff00ff','dcdcdc','f8f8ff','ffd700','daa520','808080','808080','008000','adff2f','f0fff0','ff69b4','cd5c5c','4b0082','fffff0','f0e68c','e6e6fa','fff0f5','7cfc00','fffacd','add8e6','f08080','e0ffff','fafad2','d3d3d3','d3d3d3','90ee90','ffb6c1','ffa07a','20b2aa','87cefa','778899','778899','b0c4de','ffffe0','00ff00','32cd32','faf0e6','ff00ff','800000','66cdaa','0000cd','ba55d3','9370db','3cb371','7b68ee','00fa9a','48d1cc','c71585','191970','f5fffa','ffe4e1','ffe4b5','ffdead','000080','fdf5e6','808000','6b8e23','ffa500','ff4500','da70d6','eee8aa','98fb98','afeeee','db7093','ffefd5','ffdab9','cd853f','ffc0cb','dda0dd','b0e0e6','800080','663399','ff0000','bc8f8f','4169e1','8b4513','fa8072','f4a460','2e8b57','fff5ee','a0522d','c0c0c0','87ceeb','6a5acd','708090','708090','fffafa','00ff7f','4682b4','d2b48c','008080','d8bfd8','ff6347','40e0d0','ee82ee','f5deb3','ffffff','f5f5f5','ffff00','9acd32'];}}
function roundDecimals(c){c.red=Number(c.red.toFixed(0));c.green=Number(c.green.toFixed(0));c.blue=Number(c.blue.toFixed(0));c.hue=Number(c.hue.toFixed(0));c.sat=Number(c.sat.toFixed(2));c.lightness=Number(c.lightness.toFixed(2));c.whiteness=Number(c.whiteness.toFixed(2));c.blackness=Number(c.blackness.toFixed(2));c.cyan=Number(c.cyan.toFixed(2));c.magenta=Number(c.magenta.toFixed(2));c.yellow=Number(c.yellow.toFixed(2));c.black=Number(c.black.toFixed(2));c.ncol=c.ncol.substr(0,1)+Math.round(Number(c.ncol.substr(1)));c.opacity=Number(c.opacity.toFixed(2));return c;}
function hslToRgb(hue,sat,light){var t1,t2,r,g,b;hue=hue / 60;if(light<=0.5){t2=light*(sat+1);}else{t2=light+sat-(light*sat);}
t1=light*2-t2;r=hueToRgb(t1,t2,hue+2)*255;g=hueToRgb(t1,t2,hue)*255;b=hueToRgb(t1,t2,hue-2)*255;return{r:r,g:g,b:b};}
function hueToRgb(t1,t2,hue){if(hue<0)hue+=6;if(hue>=6)hue-=6;if(hue<1)return(t2-t1)*hue+t1;else if(hue<3)return t2;else if(hue<4)return(t2-t1)*(4-hue)+t1;else return t1;}
function hwbToRgb(hue,white,black){var i,rgb,rgbArr=[],tot;rgb=hslToRgb(hue,1,0.50);rgbArr[0]=rgb.r / 255;rgbArr[1]=rgb.g / 255;rgbArr[2]=rgb.b / 255;tot=white+black;if(tot>1){white=Number((white / tot).toFixed(2));black=Number((black / tot).toFixed(2));}
for(i=0;i<3;i++){rgbArr[i]*=(1-(white)-(black));rgbArr[i]+=(white);rgbArr[i]=Number(rgbArr[i]*255);}
return{r:rgbArr[0],g:rgbArr[1],b:rgbArr[2]};}
function cmykToRgb(c,m,y,k){var r,g,b;r=255-((Math.min(1,c*(1-k)+k))*255);g=255-((Math.min(1,m*(1-k)+k))*255);b=255-((Math.min(1,y*(1-k)+k))*255);return{r:r,g:g,b:b};}
function ncolToRgb(ncol,white,black){var letter,percent,h,w,b;h=ncol;if(isNaN(ncol.substr(0,1))){letter=ncol.substr(0,1).toUpperCase();percent=ncol.substr(1);if(percent==""){percent=0;}
percent=Number(percent);if(isNaN(percent)){return false;}
if(letter=="R"){h=0+(percent*0.6);}
if(letter=="Y"){h=60+(percent*0.6);}
if(letter=="G"){h=120+(percent*0.6);}
if(letter=="C"){h=180+(percent*0.6);}
if(letter=="B"){h=240+(percent*0.6);}
if(letter=="M"){h=300+(percent*0.6);}
if(letter=="W"){h=0;white=1-(percent / 100);black=(percent / 100);}}
return hwbToRgb(h,white,black);}
function hueToNcol(hue){while(hue>=360){hue=hue-360;}
if(hue<60){return"R"+(hue / 0.6);}
if(hue<120){return"Y"+((hue-60)/ 0.6);}
if(hue<180){return"G"+((hue-120)/ 0.6);}
if(hue<240){return"C"+((hue-180)/ 0.6);}
if(hue<300){return"B"+((hue-240)/ 0.6);}
if(hue<360){return"M"+((hue-300)/ 0.6);}}
function ncsToRgb(ncs){var black,chroma,bc,percent,black1,chroma1,red1,factor1,blue1,red1,red2,green2,blue2,max,factor2,grey,r,g,b;ncs=w3trim(ncs).toUpperCase();ncs=ncs.replace("(","");ncs=ncs.replace(")","");ncs=ncs.replace("NCS","NCS ");ncs=ncs.replace(/  /g," ");if(ncs.indexOf("NCS")==-1){ncs="NCS "+ncs;}
ncs=ncs.match(/^(?:NCS|NCS\sS)\s(\d{2})(\d{2})-(N|[A-Z])(\d{2})?([A-Z])?$/);if(ncs===null)return false;black=parseInt(ncs[1],10);chroma=parseInt(ncs[2],10);bc=ncs[3];if(bc!="N"&&bc!="Y"&&bc!="R"&&bc!="B"&&bc!="G"){return false;}
percent=parseInt(ncs[4],10)||0;if(bc!=='N'){black1=(1.05*black-5.25);chroma1=chroma;if(bc==='Y'&&percent<=60){red1=1;}else if((bc==='Y'&&percent>60)||(bc==='R'&&percent<=80)){if(bc==='Y'){factor1=percent-60;}else{factor1=percent+40;}
red1=((Math.sqrt(14884-Math.pow(factor1,2)))-22)/ 100;}else if((bc==='R'&&percent>80)||(bc==='B')){red1=0;}else if(bc==='G'){factor1=(percent-170);red1=((Math.sqrt(33800-Math.pow(factor1,2)))-70)/ 100;}
if(bc==='Y'&&percent<=80){blue1=0;}else if((bc==='Y'&&percent>80)||(bc==='R'&&percent<=60)){if(bc==='Y'){factor1=(percent-80)+20.5;}else{factor1=(percent+20)+20.5;}
blue1=(104-(Math.sqrt(11236-Math.pow(factor1,2))))/ 100;}else if((bc==='R'&&percent>60)||(bc==='B'&&percent<=80)){if(bc==='R'){factor1=(percent-60)-60;}else{factor1=(percent+40)-60;}
blue1=((Math.sqrt(10000-Math.pow(factor1,2)))-10)/ 100;}else if((bc==='B'&&percent>80)||(bc==='G'&&percent<=40)){if(bc==='B'){factor1=(percent-80)-131;}else{factor1=(percent+20)-131;}
blue1=(122-(Math.sqrt(19881-Math.pow(factor1,2))))/ 100;}else if(bc==='G'&&percent>40){blue1=0;}
if(bc==='Y'){green1=(85-17/20*percent)/ 100;}else if(bc==='R'&&percent<=60){green1=0;}else if(bc==='R'&&percent>60){factor1=(percent-60)+35;green1=(67.5-(Math.sqrt(5776-Math.pow(factor1,2))))/ 100;}else if(bc==='B'&&percent<=60){factor1=(1*percent-68.5);green1=(6.5+(Math.sqrt(7044.5-Math.pow(factor1,2))))/ 100;}else if((bc==='B'&&percent>60)||(bc==='G'&&percent<=60)){green1=0.9;}else if(bc==='G'&&percent>60){factor1=(percent-60);green1=(90-(1/8*factor1))/ 100;}
factor1=(red1+green1+blue1)/3;red2=((factor1-red1)*(100-chroma1)/ 100)+red1;green2=((factor1-green1)*(100-chroma1)/ 100)+green1;blue2=((factor1-blue1)*(100-chroma1)/ 100)+blue1;if(red2>green2&&red2>blue2){max=red2;}else if(green2>red2&&green2>blue2){max=green2;}else if(blue2>red2&&blue2>green2){max=blue2;}else{max=(red2+green2+blue2)/ 3;}
factor2=1 / max;r=parseInt((red2*factor2*(100-black1)/ 100)*255,10);g=parseInt((green2*factor2*(100-black1)/ 100)*255,10);b=parseInt((blue2*factor2*(100-black1)/ 100)*255,10);if(r>255){r=255;}
if(g>255){g=255;}
if(b>255){b=255;}
if(r<0){r=0;}
if(g<0){g=0;}
if(b<0){b=0;}}else{grey=parseInt((1-black / 100)*255,10);if(grey>255){grey=255;}
if(grey<0){grey=0;}
r=grey;g=grey;b=grey;}
return{r:r,g:g,b:b};}
function rgbToHsl(r,g,b){var min,max,i,l,s,maxcolor,h,rgb=[];rgb[0]=r / 255;rgb[1]=g / 255;rgb[2]=b / 255;min=rgb[0];max=rgb[0];maxcolor=0;for(i=0;i<rgb.length-1;i++){if(rgb[i+1]<=min){min=rgb[i+1];}
if(rgb[i+1]>=max){max=rgb[i+1];maxcolor=i+1;}}
if(maxcolor==0){h=(rgb[1]-rgb[2])/(max-min);}
if(maxcolor==1){h=2+(rgb[2]-rgb[0])/(max-min);}
if(maxcolor==2){h=4+(rgb[0]-rgb[1])/(max-min);}
if(isNaN(h)){h=0;}
h=h*60;if(h<0){h=h+360;}
l=(min+max)/ 2;if(min==max){s=0;}else{if(l<0.5){s=(max-min)/(max+min);}else{s=(max-min)/(2-max-min);}}
s=s;return{h:h,s:s,l:l};}
function rgbToHwb(r,g,b){var h,w,bl;r=r / 255;g=g / 255;b=b / 255;max=Math.max(r,g,b);min=Math.min(r,g,b);chroma=max-min;if(chroma==0){h=0;}else if(r==max){h=(((g-b)/ chroma)%6)*360;}else if(g==max){h=((((b-r)/ chroma)+2)%6)*360;}else{h=((((r-g)/ chroma)+4)%6)*360;}
w=min;bl=1-max;return{h:h,w:w,b:bl};}
function rgbToCmyk(r,g,b){var c,m,y,k;r=r / 255;g=g / 255;b=b / 255;max=Math.max(r,g,b);k=1-max;if(k==1){c=0;m=0;y=0;}else{c=(1-r-k)/(1-k);m=(1-g-k)/(1-k);y=(1-b-k)/(1-k);}
return{c:c,m:m,y:y,k:k};}
function toHex(n){var hex=n.toString(16);while(hex.length<2){hex="0"+hex;}
return hex;}
function cl(x){console.log(x);}
function w3trim(x){return x.replace(/^\s+|\s+$/g,'');}
function isHex(x){return('0123456789ABCDEFabcdef'.indexOf(x)>-1);}
window.w3color=w3color;})();function w3SetColorsByAttribute(){var z,i,att;z=document.getElementsByTagName("*");for(i=0;i<z.length;i++){att=z[i].getAttribute("data-w3-color");if(att){z[i].style.backgroundColor=w3color(att).toRgbString();}}}



