

/* web/extensions/ext.min.js */
var extint={ws:null,extname:null,srate:0,nom_srate:0,param:null,override_pb:!1,displayed:!1,help_displayed:!1,spectrum_used:!1,current_ext_name:null,using_data_container:!1,hide_func:null,default_w:525,default_h:300,prev_mode:null,seq:0,scanning:0,no_lockout:["noise_blank","noise_filter","ant_switch","iframe","colormap","devl","prefs"],excl_devl:["devl","s4285","prefs"],OPT_NOLOCAL:1},devl={p0:0,p1:0,p2:0,p3:0,p4:0,p5:0,p6:0,p7:0};function ext_switch_to_client(e,t,n){recv_websocket(extint.ws,n),ext_send("SET ext_switch_to_client="+e+" first_time="+(t?1:0)+" rx_chan="+rx_chan),w3_call(e+"_focus")}function ext_send(e,t){null==t&&(t=extint.ws);try{return t.send(e),0}catch(e){console.log("CATCH ext_send('"+s+"') ex="+e),kiwi_trace()}}function ext_panel_show(e,t,n,_){extint_panel_show(e,t,n,_)}function ext_set_data_height(e){var t=w3_el("id-ext-data-container");e?t&&(t.style.height=px(e)):t&&(t.style.height="")}function ext_set_controls_width_height(e,t){panel_set_width_height("ext-controls",e,t)}var EXT_SAVE=!0,EXT_NO_SAVE=!1;function ext_get_cfg_param(e,t,n){var _;e=w3_add_toplevel(e);try{_=getVarFromString(e)}catch(e){_=null}return null!=_&&null!=_||null==t||(_=t,setVarFromString(e,_),null!=n&&n!=EXT_SAVE||cfg_save_json("ext_get_cfg_param",e)),_}function ext_get_cfg_param_string(e,t,n){return kiwi_decodeURIComponent(ext_get_cfg_param_string+":"+e,ext_get_cfg_param(e,t,n))}function ext_set_cfg_param(e,t,n){e=w3_add_toplevel(e),setVarFromString(e,t),null!=n&&n==EXT_SAVE&&cfg_save_json("ext_set_cfg_param",e)}function ext_get_freq_range(){var e=kiwi.freq_offset_kHz;return{lo_kHz:cfg.sdr_hu_lo_kHz+e,hi_kHz:cfg.sdr_hu_hi_kHz+e,offset_kHz:e}}var extint_isAdmin_cb,extint_authkey_cb,ext_zoom={TO_BAND:0,IN:1,OUT:-1,ABS:2,WHEEL:3,CUR:4,NOM_IN:8,MAX_IN:9,MAX_OUT:-9},extint_ext_is_tuning=!1;function ext_tune(e,t,n,_,i,o,l){var a=null!=i&&null!=o;extint_ext_is_tuning=!0,freqmode_set_dsp_kHz(e,t,l),a&&ext_set_passband(i,o),null!=n?n==ext_zoom.CUR?zoom_step(ext_zoom.ABS,zoom_level):zoom_step(n,_):zoom_step(ext_zoom.TO_BAND),extint_ext_is_tuning=!1}function ext_get_freq_Hz(){return{displayed:freq_displayed_Hz,carrier:freq_car_Hz,passband_center:freq_passband_center()}}function ext_get_freq(){return freq_displayed_Hz}function ext_get_freq_kHz(){return(freq_displayed_Hz/1e3).toFixed(2)}function ext_get_carrier_freq(){return freq_car_Hz}function ext_get_passband_center_freq(){return freq_passband_center()}function ext_get_mode(){return cur_mode}function ext_is_IQ_or_stereo_mode(e){return"drm"==(e=e.toLowerCase(e))||"iq"==e||"sas"==e||"qam"==e}function ext_is_IQ_or_stereo_curmode(){return ext_is_IQ_or_stereo_mode(cur_mode)}function ext_get_prev_mode(){return extint.prev_mode}function ext_set_mode(e,t,n){var _="drm"==e;_&&(extint.prev_mode=cur_mode),demodulator_analog_replace(e,t);var i=w3_opt(n,"open_ext",!1),o=w3_opt(n,"no_drm_proc",!1),l="undefined"!=typeof drm&&drm.active;o||(_&&i?l?toggle_panel("ext-controls",1):extint_open("drm"):!_&&l&&(extint_panel_hide(),demodulator_analog_replace(e,t)))}function ext_get_passband(){var e=demodulators[0];return{low:e.low_cut,high:e.high_cut}}function ext_set_passband(e,t,n,_){var i=demodulators[0],o=i.filter;null==e&&(e=i.low_cut),null==t&&(t=i.high_cut);Math.abs(t-e);e=e<o.low_cut_limit?o.low_cut_limit:e,t=t>o.high_cut_limit?o.high_cut_limit:t;var l=!1;Math.abs(t-e)>=o.min_passband&&e<t&&(i.low_cut=e,i.high_cut=t,l=!0),isArg(n)&&n&&l&&(cfg.passbands[cur_mode].last_lo=e,cfg.passbands[cur_mode].last_hi=t),null!=_&&null!=_&&(_*=1e3,freq_car_Hz=freq_dsp_to_car(_)),extint_ext_is_tuning=!0,demodulator_set_offset_frequency(0,freq_car_Hz-center_freq),extint_ext_is_tuning=!1}function ext_get_tuning(){return{low:demod.low_cut,high:demod.high_cut,mode:cur_mode,freq_dial_kHz:freq_displayed_Hz/1e3}}function ext_get_zoom(){return zoom_level}function ext_set_scanning(e){extint.scanning=e?1:0}function ext_agc_delay(e){var t=w3_el("input-decay").value;return isDefined(e)&&setDecay(!0,e),t}function ext_get_optbar(){return readCookie("last_optbar")}function ext_set_optbar(e){extint.optbars[e]&&(writeCookie("last_optbar",e),w3_el("id-nav-"+e).click())}function ext_hasCredential(e,t,n,_){var i;"mfg"==e&&(e="admin"),"admin"==e?(deleteCookie("admin"),deleteCookie("admin-pwd"),i=""):i=(i=readCookie(e))?decodeURIComponent(i):"",extint_pwd_cb=t,extint_pwd_cb_param=n,ext_valpwd(e,i,_)}function ext_valpwd(e,t,n){t=encodeURIComponent(t),"admin"!=e&&writeCookie(e,t),extint_conn_type=e,t=""!=t?t:"#";var _=null,i=readCookie("iplimit"),o=kiwi_url_param(["pwd","password"],"","");""!=o?_=o:i&&""!=i&&(_=i),_=_?" ipl="+_:"",null!=kiwi_url_param(["p","prot","protected"],"true",null)&&"admin"!=e&&(e="prot");var l=0;kiwi_url_param("nolocal")&&(l|=extint.OPT_NOLOCAL),0!=l&&ext_send("SET options="+l),ext_send("SET auth t="+e+" p="+t+_,n)}function ext_isAdmin(e){extint_isAdmin_cb=e,ext_send("SET is_admin")}function ext_get_authkey(e){ext_send("SET get_authkey"),extint_authkey_cb=e}extint.optbars={"optbar-wf":0,"optbar-audio":1,"optbar-agc":2,"optbar-users":3,"optbar-status":4,"optbar-off":5};var extint_adc_clock_Hz=0;function ext_adc_clock_Hz(){return extint_adc_clock_Hz}var extint_adc_gps_clock_corr=0;function ext_adc_gps_clock_corr(){return extint_adc_gps_clock_corr}var extint_adc_clock_nom_Hz=0;function ext_adc_clock_nom_Hz(){return extint_adc_clock_nom_Hz}function ext_sample_rate(){return extint.srate}function ext_nom_sample_rate(){return extint.nom_srate}var extint_audio_data_cb=null;function ext_register_audio_data_cb(e){extint_audio_data_cb=e}function ext_unregister_audio_data_cb(){extint_audio_data_cb=null}function ext_param(){var e=extint.param;return extint.param=null,e}function ext_panel_set_name(e){extint.current_ext_name=e}function ext_mobile_info(e){var t,n=window.innerWidth,_=window.innerHeight,i={width:n,height:_};return t=owrx.popup_keyboard_active?e?e.isPortrait:1:n<_||mobile_laptop_test?1:0,i.orient_unchanged=e&&e.isPortrait==t?1:0,i.isPortrait=t?1:0,i.iPad=t&&n<=768?1:0,i.small=t&&n<768?1:0,i.narrow=t&&n<=600?1:0,i}function extint_news(e){var t;if(!extint.news_init){if((t=w3_el("id-news")).style.top="",t.style.bottom="",t.style.left="",t.style.right="",kiwi_isMobile()){var n=window.innerWidth,_=window.innerHeight;n<=768&&_>=600?(t.style.bottom="0",t.style.left="0",t.style.width="350px",t.style.height="400px"):(t.style.top="36px",t.style.right="0",t.style.width="150px",t.style.height="150px")}else t.style.bottom="0",t.style.left="0",t.style.width="350px",t.style.height="300px";t.style.visibility="visible",t.style.zIndex=9999,extint.news_init=!0}t=w3_el("id-news-inner"),w3_innerHTML(t,e),w3_scrollDown(t)}function ext_panel_init(){w3_el("id-panels-container").innerHTML+='<div id="id-ext-controls" class="class-panel" data-panel-name="ext-controls" data-panel-pos="bottom-left" data-panel-order="0" data-panel-size="'+extint.default_w+","+extint.default_h+'"></div>';w3_el("id-ext-data-container");w3_el("id-ext-controls").innerHTML=w3_div("id-ext-controls-container w3-relative|width:100%;height:100%;")+w3_div("id-ext-controls-vis class-vis")+w3_div("id-ext-controls-help cl-ext-help",w3_button('id-ext-controls-help-btn w3-green w3-small w3-padding-small w3-disabled||onclick="extint_help_click()"',"help")),w3_el("id-kiwi-body").addEventListener("keyup",function(e){"Escape"==e.key&&extint.displayed&&!confirmation.displayed&&1!=w3_call(extint.current_ext_name+"_escape_key_cb")&&(console.log("EXT ESC: no _escape_key_cb() routine, so doing id-ext-controls-close.click()"),w3_el("id-ext-controls-close").click())},!0)}function ext_show_spectrum(){w3_show_block("id-spectrum-container"),extint.spectrum_used=!0}function ext_hide_spectrum(){w3_hide("id-spectrum-container"),extint.spectrum_used=!1}function extint_panel_show(e,t,n,_,i){var o;extint.using_data_container=!!t,extint.using_data_container?(toggle_or_set_spec(toggle_e.SET,0),w3_hide("id-top-container"),w3_show_block(w3_innerHTML("id-ext-data-container",t))):(w3_hide("id-ext-data-container"),spec.source_wf||w3_show_block("id-top-container")),1==extint.help_displayed&&(confirmation_panel_close(),extint.help_displayed=!1),(o=w3_el("id-ext-controls-close")).onclick=function(){toggle_panel("ext-controls"),extint_panel_hide()},ext_set_data_height(),w3_el("id-ext-controls").style.zIndex=150,w3_create_attribute("id-ext-controls-close-img","src","icons/close.24.png"),(o=w3_el("id-ext-controls-container")).innerHTML=e,n&&n(),extint.hide_func=_,(o=w3_el("id-ext-controls")).style.zIndex=150,w3_visible(o,!0),o.panelShown=1,toggle_or_set_hide_panels(0),w3_el("id-confirmation-container").style.height="",i=isDefined(i)?i:w3_call(extint.current_ext_name+"_help",!1),w3_set_props("id-ext-controls-help-btn","w3-disabled",isUndefined(i)||0==i),w3_show_hide("id-ext-controls-help-btn","off"!=i),extint.displayed=!0}function ext_panel_displayed(e){return extint.displayed&&(!e||e==extint.current_ext_name)}function ext_panel_redisplay(e){w3_innerHTML("id-ext-controls-container",e)}function extint_panel_hide(){extint.using_data_container&&(w3_hide("id-ext-data-container"),ext_hide_spectrum(),w3_show_block("id-top-container"),extint.using_data_container=!1,1==extint.help_displayed&&(confirmation_panel_close(),extint.help_displayed=!1)),w3_visible("id-ext-controls",!1),extint_blur_prev(1),w3_call(extint.hide_func),w3_select_value("id-select-ext",-1),resize_waterfall_container(!0),extint.displayed=!1,freqset_select()}function extint_help_click_now(){extint.help_displayed=w3_call(extint.current_ext_name+"_help",!0)}function extint_help_click(e){w3_contains("id-ext-controls-help-btn","w3-disabled")||(console.log(extint.current_ext_name+"_help_click CLICKED"),e?setTimeout(function(){extint_help_click_now()},2e3):extint_help_click_now())}function extint_environment_changed(e){setTimeout(function(){extint.current_ext_name&&w3_call(extint.current_ext_name+"_environment_changed",e),(e.freq||e.mode||e.zoom||e.waterfall_pan||e.resize)&&mouse_freq_remove(),w3_call("injection_environment_changed",e)},100)}var extint_pwd_cb=null,extint_pwd_cb_param=null,extint_conn_type=null;function extint_valpwd_cb(e){extint_pwd_cb&&extint_pwd_cb(e,extint_pwd_cb_param)}function extint_open_ws_cb(){ext_hasCredential("kiwi",null,null),setTimeout(function(){setInterval(function(){ext_send("SET keepalive")},5e3)},5e3)}function extint_connect_server(){return extint.ws=open_websocket("EXT",extint_open_ws_cb,null,extint_msg_cb),extint.ws}function extint_msg_cb(e,t){switch(e[0]){case"keepalive":break;case"ext_client_init":console.log("ext_client_init is_locked="+ +e[1]),extint_focus(+e[1]);break;default:return!1}return!0}function extint_blur_prev(e){null!=extint.current_ext_name&&(w3_call(extint.current_ext_name+"_blur"),recv_websocket(extint.ws,null),e&&ext_set_controls_width_height(),extint.current_ext_name=null,time_display_setup("id-topbar-right-container")),extint.ws&&ext_send("SET ext_blur="+rx_chan)}function extint_focus(e){var t=extint.current_ext_name;if(console.log("extint_focus: loading "+t+".js"),e&&!extint.no_lockout.includes(t))return extint_panel_show(w3_text("w3-medium w3-text-css-yellow","Cannot use extensions while <br> another channel is in DRM mode."),null,null,null,"off"),void ext_set_controls_width_height(300,75);kiwi_load_js_dir("extensions/"+t+"/"+t,[".js",".css"],function(){console.log("extint_focus: calling "+t+"_main()"),ext_set_controls_width_height(),w3_call(t+"_main")},function(e){if(console.log("extint_focus: "+t+" loaded="+e),e){extint_panel_show("loading extension...",null,null,null,"off"),ext_set_controls_width_height(325,45),kiwi.is_locked&&console.log("==== IS_LOCKED =================================================")}})}var extint_names,extint_first_ext_load=!0;function extint_select(e){extint_blur_prev(0),w3_call(extint.hide_func),freqset_select(),e=+e;var t=w3_el("id-select-ext");if(t){w3_select_value(t,e);var n,_=t.childNodes[e+1].innerHTML.toLowerCase();console.log("extint_select val="+e+" name="+_),extint_names_enum(function(e,t,i,o){i.toLowerCase().includes(_)&&(console.log("extint_select HIT id="+i+" id_en="+o+" i="+e+" value="+t),n=e)}),extint.current_ext_name=extint_names[n],extint_first_ext_load?(extint.ws=extint_connect_server(),extint_first_ext_load=!1):ext_send("SET ext_is_locked_status")}else setTimeout(extint_select,1e3,e)}function extint_list_json(e){extint_names=kiwi_JSON_parse("extint_list_json",decodeURIComponent(e))}function extint_names_enum(e){var t,n;for(t=n=0;t<extint_names.length;t++){var _=extint_names[t];if((dbgUs||!extint.excl_devl.includes(_))&&("sig_gen"!=_||!(0!=rx_chan||rx_chans>=14))){"wspr"==_&&(_="WSPR");var i=_.toLowerCase();"cw_decoder"==i&&(i="cw"),"drm"==i&&(i="DRM"),"s_meter"==i&&(i="S_meter"),"wspr"==i&&(i="WSPR"),e(t,n,_,i),n++}}}function extint_select_build_menu(){var e="";return extint_names&&isArray(extint_names)&&extint_names_enum(function(t,n,_,i){var o=ext_get_cfg_param(i+".enable");(null==o||kiwi.is_local[rx_chan])&&(o=!0),"DRM"==_&&(kiwi.DRM_enable=o),e+="<option value="+dq(n)+" kiwi_idx="+dq(t)+" "+(o?"":"disabled")+">"+_+"</option>"}),e}function extint_open(e,t){e=e.toLowerCase();var n=0;extint_names_enum(function(_,i,o,l){var a=ext_get_cfg_param(l+".enable");(null==a||kiwi.is_local[rx_chan])&&(a=!0),!n&&a&&o.toLowerCase().includes(e)&&(t?setTimeout(function(){extint_select(i)},t):extint_select(i),n=1)})}function extint_audio_data(e,t){isFunction(extint_audio_data_cb)&&extint_audio_data_cb(e,t)}




/* web/kiwi/kiwi.min.js (web/kiwi/kiwi.js = Mon May  9 15:47:29 2022) */
var kiwi={isOffset:!1,is_local:[],loaded_files:{},WSPR_rgrid:"",GPS_fixes:0,wf_fps:0,is_multi_core:0,log2_seq:0,inactivity_panel:!1,no_admin_conns_pend:0,notify_seq:0,ident_min:16,volume:50,volume_f:1e-6,muted:1,unmuted_color:"lime",queued:0,modes_l:["am","amn","usb","lsb","cw","cwn","nbfm","iq","drm","usn","lsn","sam","sal","sau","sas","qam"],modes_u:[],modes_s:{},cfg_fields:["min","max","chan"],ITU_s:["any","R1: Europe, Africa","R2: North & South America","R3: Asia / Pacific","show on band scale only","show on band menu only"],ITU_ANY:0,BAND_SCALE_ONLY:4,BAND_MENU_ONLY:5,RX4_WF4:0,RX8_WF2:1,RX3_WF3:2,RX14_WF0:3,cmap_s:["Kiwi","CuteSDR","grey","linear","turbo","SdrDx","custom 1","custom 2","custom 3","custom 4"],cmap_e:{kiwi:0,CuteSDR:1,greyscale:2,linear:3,turbo:4,SdrDx:5,custom_1:6,custom_2:7,custom_3:8,custom_4:9},aper_s:["man","auto"],aper_e:{man:0,auto:1},xdLocalStorage_ready:!1,prefs_import_ch:-1};kiwi.modes_l.forEach(function(e,i){kiwi.modes_u.push(e.toUpperCase()),kiwi.modes_s[e]=i});var rx_chans,wf_chans,wf_chans_real,max_camp,conn_type,timestamp,gmap,WATERFALL_CALIBRATION_DEFAULT=-13,SMETER_CALIBRATION_DEFAULT=-13,rx_chan=null,try_again="",seriousError=!1,optbar_prefix_color="w3-text-css-orange",dbgUs=!1,dbgUsFirst=!0;function kiwi_bodyonload(e){if(""!=e)kiwi_serious_error(e);else if("LG"==kiwi_isSmartTV()&&kiwi_isChrome()<87){kiwi_serious_error("Browser: "+navigator.userAgent+"<br>Sorry, KiwiSDR requires SmartTV Chrome version >= 87")}else{initCookie("ident","").startsWith("ZL/KF6VO")&&(dbgUs=!0),"undefined"==(conn_type=html("id-kiwi-container").getAttribute("data-type"))&&(conn_type="kiwi"),console.log("conn_type="+conn_type),w3int_init();var i=new Date;timestamp=i.getTime(),extint.ws="kiwi"==conn_type?owrx_ws_open_snd(kiwi_open_ws_cb,{conn_type:conn_type}):kiwi_ws_open(conn_type,kiwi_open_ws_cb,{conn_type:conn_type})}}function kiwi_open_ws_cb(e){"kiwi"!=e.conn_type&&setTimeout(function(){setInterval(function(){ext_send("SET keepalive")},5e3)},5e3),seriousError||ext_hasCredential(e.conn_type,kiwi_valpwd1_cb,e)}function kiwi_load_js_polled(e,i){return e.started||(kiwi_load_js(i,function(){e.finished=!0}),e.started=!0,e.finished=!1),e.finished}function kiwi_load_js_dir(e,i,t,n){for(var r=0;r<i.length;r++)i[r]=e+i[r];kiwi_load_js(i,t,n)}function kiwi_load_js(e,i,t){console.log("DYNLOAD START"),e.push("kiwi/kiwi_js_load.js"),console.log(e);var n=!1;e.forEach(function(t){if(kiwi.loaded_files[t])console.log("already loaded: "+t);else{if(t.includes("kiwi_js_load.js")){if(!n)return}else kiwi.loaded_files[t]=1,n=!0;var r,o=!1;t.endsWith(".js")||t.includes("/js?key=")?((r=document.createElement("script")).src=t,r.type="text/javascript","kiwi/kiwi_js_load.js"==t&&(r.kiwi_js=e[0],r.kiwi_cb=i)):t.endsWith(".css")?((r=document.createElement("link")).rel="stylesheet",r.href=t,r.type="text/css"):o=!0,o?console.log("UNKNOWN FILETYPE "+t):(r.async=!1,document.head.appendChild(r),console.log("loading "+t))}}),console.log("DYNLOAD FINISH"),n?t&&w3_call(t,!0):(t&&w3_call(t,!1),i&&w3_call(i))}function kiwi_ask_pwd_cb(e,i,t){ext_valpwd(conn_type,i)}function kiwi_queue_or_camp_cb(e,i,t){var n=window.location.href;console.log(n),n+=kiwi_add_search_param(window.location,"camp"),console.log("--\x3e "+n),window.location.href=n}function kiwi_ask_pwd(e){console.log("kiwi_ask_pwd chan_no_pwd_true="+chan_no_pwd_true+" client_public_ip="+client_public_ip);var i="",t="";e&&chan_no_pwd_true&&(i="All channels busy that don't require a password ("+chan_no_pwd_true+"/"+rx_chans+")<br>",t="<br> <b>OR</b> <br><br> click to queue for an available channel, <br>or camp on an existing channel: <br>"+w3_button("w3-medium w3-padding-smaller w3-aqua w3-margin-T-8","Queue or Camp","kiwi_queue_or_camp_cb")),kiwi_url_param(["p","prot","protected"],!0,!1)&&e&&(i="You have requested a password protected channel<br>"),kiwi_show_msg("KiwiSDR: software-defined receiver <br>"+i+try_again+w3_input("w3-retain-input-focus w3-margin-TB-8/w3-label-inline w3-label-not-bold/kiwi-pw|padding:1px|size=40","Password:","id-pwd","","kiwi_ask_pwd_cb")+t),w3_field_select("id-pwd",{mobile:1})}var override_freq,override_mode,override_zoom,override_max_dB,override_min_dB,override_9_10,body_loaded=!1;function kiwi_valpwd1_cb(e,i){if(!seriousError)if(1==e)kiwi_ask_pwd("kiwi"==i.conn_type),try_again="Try again. ";else{if(2==e)return void kiwi_show_msg("Still determining local interface address.<br>Please try reloading page in a few moments.");if(3==e)return void kiwi_show_msg("Admin connections not allowed from this ip address.");if(4==e)return void kiwi_show_msg("No admin password set. Can only connect from same local network as Kiwi.<br>Client ip = "+client_public_ip);if(5==e)return void kiwi_show_msg("Multiple connections from the same ip address not allowed.<br>Client ip = "+client_public_ip);0==e&&("kiwi"==i.conn_type?extint.ws=owrx_ws_open_wf(kiwi_open_ws_cb2,i):kiwi_valpwd2_cb(0,i))}}function kiwi_open_ws_cb2(e){ext_hasCredential(e.conn_type,kiwi_valpwd2_cb,e)}function kiwi_valpwd2_cb(e,i){if(!seriousError)if(kiwi_show_msg(""),body_loaded)console.log("kiwi_valpwd2_cb: body_loaded previously!");else{body_loaded=!0,"kiwi"!=i.conn_type&&(w3_hide("id-kiwi-msg-container"),w3_show_block("id-kiwi-container"),w3_el("id-kiwi-body").style.overflow="hidden");try{kiwi_init(),w3_call(i.conn_type+"_main")}catch(e){console.log("EX: "+e),console.log("kiwi_valpwd2_cb: no interface routine for "+i.conn_type+"?")}}}function kiwi_init(){}function kiwi_xdLocalStorage_init(){for(var e=[],i=0;i<2;i++)e[i]="http://pub"+i+".kiwisdr.com/pkgs/xdLocalStorage/xdLocalStorage.php/?key=4e92a0c3194c62b2a067c494e2473e8dfe261138";xdLocalStorageHA.init({iframeUrls:e,initCallback:function(){kiwi.xdLocalStorage_ready=!0,console.log("xdLocalStorageHA READY")}})}function kiwi_get_init_settings(){var e=null==init_frequency?7020:init_frequency;e=ext_get_cfg_param("init.freq",e,EXT_NO_SAVE),init_frequency=override_freq||e;var i=null==init_mode?kiwi.modes_s.lsb:kiwi.modes_s[init_mode];i=ext_get_cfg_param("init.mode",i,EXT_NO_SAVE),init_mode=override_mode||kiwi.modes_l[i],"drm"===init_mode&&(init_mode="am");var t=null==init_zoom?0:init_zoom;t=ext_get_cfg_param("init.zoom",t,EXT_NO_SAVE),init_zoom=isNumber(override_zoom)?override_zoom:t;var n=null==init_max_dB?-10:init_max_dB;n=ext_get_cfg_param("init.max_dB",n,EXT_NO_SAVE),init_max_dB=override_max_dB||n;var r=null==init_min_dB?-110:init_min_dB;r=ext_get_cfg_param("init.min_dB",r,EXT_NO_SAVE),init_min_dB=override_min_dB||r,console.log("INIT f="+init_frequency+" m="+init_mode+" z="+init_zoom+" min="+init_min_dB+" max="+init_max_dB),w3_call("init_scale_dB");var o=ext_get_cfg_param("rx_antenna"),s=w3_el("rx-antenna");null!=s&&o&&(s.innerHTML="Antenna: "+kiwi_decodeURIComponent("rx_antenna",o)),kiwi.WSPR_rgrid=ext_get_cfg_param_string("WSPR.grid","",EXT_NO_SAVE)}var cfg={},adm={};function cfg_save_json(e,i){var t;i.startsWith("adm.")?(t=encodeURIComponent(JSON.stringify(adm,null,3)),extint.ws.send("SET save_adm="+t)):(t=encodeURIComponent(JSON.stringify(cfg,null,3)),extint.ws.send("SET save_cfg="+t)),console.log("cfg_save_json: from="+e+" path="+i+" DONE")}var server_time_utc,server_time_local,server_time_tzid,server_time_tzname,server_tz,geo={geo:"",json:"",retry:0};function kiwi_geolocate(e){var i=kiwi_isFirefox();if(!(i&&i<=28)){var t;switch(null==e&&(e=(new Date).getSeconds()),e%=3){case 0:t="https://ipapi.co/json";break;case 1:t="https://get.geojs.io/v1/ip/geo.json";break;case 2:t="http://ip-api.com/json?fields=49177"}kiwi_ajax(t,function(i){isUndefined(i.AJAX_error)?(console.log("GEOLOC "+t),console.log(i),geoloc_json(i)):geo.retry++<=3&&kiwi_geolocate(e+1)},null,5e3)}}function geoloc_json(e){if(!isDefined(e.AJAX_error)){window.JSON&&window.JSON.stringify?geo.json=JSON.stringify(e):geo.json=e.toString();var i=e.country_name||e.country,t=e.regionName||e.region;"United States"==i&&t&&(i=t+", USA"),geo.geo="",e.city&&(geo.geo+=e.city),i&&(geo.geo+=(e.city?", ":"")+i),console.log("GEOLOC "+geo.geo)}}function kiwi_geo(){return encodeURIComponent(geo.geo)}function kiwi_geojson(){return encodeURIComponent(geo.json)}var time_display_current=!0;function time_display_cb(e){isUndefined(e.tu)||(server_time_utc=e.tu,server_time_local=e.tl,server_time_tzid=decodeURIComponent(e.ti),server_time_tzname=decodeURIComponent(e.tn).replace(/\\/g,"").replace(/_/g," "),server_tz=server_time_tzname,server_time_tzid&&(server_tz+=" ("+server_time_tzid+")"),time_display_started?time_display(time_display_current):(time_display_periodic(),time_display_started=!0))}function time_display(e){if(w3_el("id-time-display-text-inner")){var i=""==server_time_local||"null"==server_time_tzname;w3_innerHTML("id-time-display-UTC",server_time_utc||"?"),w3_innerHTML("id-time-display-local",i?"?":server_time_local),w3_innerHTML("id-time-display-tzname",i?"Lat/lon needed for local time":server_tz),w3_el("id-time-display-logo-inner").style.opacity=e?0:1,w3_el("id-time-display-inner").style.opacity=e?1:0}}function time_display_periodic(){time_display(time_display_current),time_display_current^=1,setTimeout(function(){time_display_periodic()},time_display_current?5e4:1e4)}var time_display_prev,time_display_started=!1;function time_display_setup(e){var i;0==e.startsWith("id-")&&(e+="-time-display"),time_display_prev&&(i=w3_el(time_display_prev))&&(i.innerHTML=""),time_display_prev=e,(i=w3_el(e)).innerHTML=w3_div("id-time-display-inner",w3_div("id-time-display-text-inner",w3_inline("",w3_div("id-time-display-UTC"),w3_div("cl-time-display-text-suffix","UTC")),w3_inline("",w3_div("id-time-display-local"),w3_div("cl-time-display-text-suffix","Local")),w3_div("id-time-display-tzname")))+w3_div("id-time-display-logo-inner",w3_div("id-time-display-logo-text","Powered by"),'<a href="https://github.com/ha7ilm/openwebrx" target="_blank"><img id="id-time-display-logo" src="gfx/openwebrx-top-logo.png" /></a>'),time_display(time_display_current)}function time_display_height(){return 80}function time_display_width(){return 200}function time_display_html(e){return w3_div(e+"-time-display|top:50px; background-color:black; position:relative;")}var ansi={colors:[[0,0,0],[194,54,33],[37,188,36],[173,173,39],[73,46,225],[211,56,211],[51,187,200],[203,204,205],[129,131,131],[252,57,31],[49,231,34],[234,236,35],[88,51,255],[249,53,248],[20,240,240],[233,235,235]]};function kiwi_output_msg(e,i,t){var n=dbgUs,r=w3_el(e);if(r){var o;try{o=kiwi_decodeURIComponent("kiwi_output_msg",t.s)}catch(e){console.log("decodeURIComponent FAIL:"),console.log(t.s),o=t.s}t.init||(t.el=w3_create_appendElement(r,"pre",""),t.esc={s:"",state:0},t.sgr={span:0,bright:0,fg:null,bg:null},t.return_pending=!1,t.init=!0);var s="",_=w3_el(i),a=null;isUndefined(t.tstr)&&(t.tstr=""),isUndefined(t.col)&&(t.col=0),!t.process_return_alone||"\r"!=o.charAt(0)||1!=o.length&&"\n"==o.charAt(1)||(o=o.substring(1),t.tstr=s="",t.col=0),n&&console.log("kiwi_output_msg:"),n&&console.log(JSON.stringify(t)),n&&console.log(JSON.stringify(o)),t.remove_returns&&(o=o.replace(/\r/g,"")),t.inline_returns&&(o=(o=o.replace(/\r\n/g,"\n")).replace(/\r\n/g,"\n")),n&&console.log(JSON.stringify(o));for(var c=0;c<o.length;c++){var l=o.charAt(c);if(t.inline_returns&&t.return_pending&&"\r"!=l&&(t.tstr=s="",t.col=0,t.return_pending=!1),"\f"==l){for(;r.firstChild;)r.removeChild(r.firstChild);t.el=w3_create_appendElement(r,"pre",""),t.tstr=s="",t.col=0}else if(t.inline_returns&&"\r"==l)n&&console.log("\\r inline:"),t.return_pending=!0;else if("\t"==l)for(s+="&nbsp;",t.col++;0!=(7&t.col);)s+="&nbsp;",t.col++;else if(""==l)t.esc.s="",t.esc.state=1;else if(1==t.esc.state)if(l<"@"||"["==l)t.esc.s+=l;else{t.esc.s+=l;var d=t.esc.s.charAt(0),w=t.esc.s.charAt(1),p=0,m=0;if("["==d)if("m"==l){for(var u,f=0,g=0,k=t.esc.s.substr(1).split(";"),b=k.length,v=0;v<b&&0==m;v++)if(0==(u=""==k[v]||"m"==k[v]?0:parseInt(k[v])))t.sgr.fg=t.sgr.bg=null,f=1;else if(isNaN(u))m=2;else if(1==u)t.sgr.bright=8;else if(2==u)t.sgr.bright=0;else if(22==u)t.sgr.bright=0;else if(7==u){var h=t.sgr.fg;t.sgr.fg=t.sgr.bg,t.sgr.bg=h,null==t.sgr.fg&&(t.sgr.fg=[255,255,255]),null==t.sgr.bg&&(t.sgr.bg=[0,0,0]),g=1}else if(27==u)t.sgr.fg=t.sgr.bg=null,g=1;else if(u>=30&&u<=37)t.sgr.fg=ansi.colors[u-30+t.sgr.bright],g=1;else if(u>=90&&u<=97)t.sgr.fg=ansi.colors[u-90+8],g=1;else if(39==u)t.sgr.fg=null,g=1;else if(u>=40&&u<=47)t.sgr.bg=ansi.colors[u-40+t.sgr.bright],g=1;else if(u>=100&&u<=107)t.sgr.bg=ansi.colors[u-100+8],g=1;else if(49==u)t.sgr.bg=null,g=1;else if(38==u||48==u){var y,x,S,T,R,L;3!=b||5!=parseInt(k[1])||isNaN(y=parseInt(k[2]))?5!=b||2!=parseInt(k[1])||isNaN(x=parseInt(k[2]))||isNaN(S=parseInt(k[3]))||isNaN(T=parseInt(k[4]))?m=2:(R=[x=w3_clamp(x,0,255),S=w3_clamp(S,0,255),T=w3_clamp(T,0,255)],38==u?t.sgr.fg=R:t.sgr.bg=R,g=1):(v+=2,y<=15?(R=ansi.colors[y],38==u?t.sgr.fg=R:t.sgr.bg=R,g=1):y<=231?(y-=16,y-=36*(x=Math.floor(y/36)),T=y-=6*(S=Math.floor(y/6)),R=[x=Math.floor(255*x/5),S=Math.floor(255*S/5),T=Math.floor(255*T/5)],38==u?t.sgr.fg=R:t.sgr.bg=R,g=1):y<=255?(R=[L=8+10*(y-232),L,L],38==u?t.sgr.fg=R:t.sgr.bg=R,g=1):m=2)}else m=2;f?t.sgr.span&&(s+="</span>",t.sgr.span=0):g?(t.sgr.span&&(s+="</span>"),s+='<span style="'+(t.sgr.fg?"color:"+kiwi_rgb(t.sgr.fg)+";":"")+(t.sgr.bg?"background-color:"+kiwi_rgb(t.sgr.bg)+";":"")+'">',t.sgr.span=1):m=2}else"K"==l?(w.match(/[012]/)&&(p=w-"0"),m="erase in line "+["#0: cur to EOL","#1: cur to BOL","#2: full line"][p]):"P"==l?m="del #"+(p=w-"0")+" chars":"?"==w?m="set/reset mode":"r"==l||(m="l"==l?"reset mode":"J"==l?"0"==w||"J"==w?"erase cur to EOS":"2"==w||"3"==w?"erase full screen":"1"==w?"erase BOS to cur":2:"H"==l?"move row,col":"d"==l?"move row":"G"==l?"move col":2);else"("==d||(m=2);1===m?n&&console.log("ESC "+JSON.stringify(t.esc.s)+" IGNORED"):2===m?n&&console.log("ESC "+JSON.stringify(t.esc.s)+" UNKNOWN"):isString(m)&&n&&console.log("ESC "+JSON.stringify(t.esc.s)+" "+m),t.esc.state=0}else(l>=" "&&l<="~"||"\n"==l)&&("<"==l?(s+="&lt;",t.col++):">"==l?(s+="&gt;",t.col++):("\n"!=l&&(s+=l,t.col++),"\n"!=l&&t.col!=t.ncol||(a=w3_isScrolledDown(_),t.tstr+=s,""==t.tstr&&(t.tstr="&nbsp;"),t.el.innerHTML=t.tstr,t.tstr=s="",t.el=w3_create_appendElement(r,"pre",""),t.col=0,w3_contains(_,"w3-scroll-down")&&(!t.scroll_only_at_bottom||t.scroll_only_at_bottom&&a)&&w3_scrollDown(_))))}a=w3_isScrolledDown(_),t.tstr+=s,t.el.innerHTML=t.tstr,w3_contains(_,"w3-scroll-down")&&(!t.scroll_only_at_bottom||t.scroll_only_at_bottom&&a)&&w3_scrollDown(_)}else console.log("kiwi_output_msg NOT_FOUND id="+e)}function gps_stats_cb(e,i,t,n,r,o){var s=(e?"yes":"pause")+", track "+i+", good "+t+", fixes "+n.toUnits();if(w3_innerHTML("id-msg-gps","GPS: acquire "+s),w3_innerHTML("id-status-gps",w3_text(optbar_prefix_color,"GPS"),w3_text("","acq "+s)),extint_adc_clock_Hz=1e6*r,extint_adc_gps_clock_corr=o,o){s=r.toFixed(6)+" ("+o.toUnits()+" avgs)";var _=w3_el("id-msg-gps");_&&(_.innerHTML+=", ADC clock "+s),w3_innerHTML("id-status-adc",w3_text(optbar_prefix_color,"ADC clock "),w3_text("",s))}}function admin_stats_cb(e,i,t,n,r,o,s,_){if(null!=e){var a=w3_el("id-msg-errors");if(a&&(a.innerHTML="Stats: "+e.toUnits()+" dropped, "+i.toUnits()+" underruns, "+t.toUnits()+" sequence, "+n.toUnits()+" realtime"),a=w3_el("id-status-dp-hist")){for(var c="Datapump: ",l=0;l<r;l++)c+=(l?", ":"")+o[l].toUnits();a.innerHTML=c}if(a=w3_el("id-status-in-hist")){for(c="SoundInQ: ",l=0;l<s;l++)c+=(l?", ":"")+_[l].toUnits();a.innerHTML=c}}}function kiwi_too_busy(e){kiwi_show_msg("Sorry, the KiwiSDR server is too busy right now ("+e+' users max). <br>There is also a limit on the total number of channel queuers and campers. <br>Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.')}function kiwi_exclusive_use(){kiwi_show_msg('Sorry, this Kiwi has been locked for special use. <br>This happens when using an extension (e.g. DRM decoder) that requires all available resources. <br>Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide. <br><br>申し訳ありませんが、このキーウィは特別な使用のためにロックされています。 <br>これは、利用可能なすべてのリソースを必要とする拡張機能（DRM デコーダーなど）を使用している場合に発生します。 <br>世界中で利用できる KiwiSDR レシーバーについては、<a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> を確認してください。')}function kiwi_ip_limit_pwd_cb(e){console.log("kiwi_ip_limit_pwd_cb pwd="+e),writeCookie("iplimit",encodeURIComponent(e)),window.location.reload(!0)}function kiwi_show_error_ask_exemption_cb(e,i,t){kiwi_ip_limit_pwd_cb(i)}function kiwi_show_error_ask_exemption(e){kiwi_show_msg(e+="<br><br>If you have an exemption password from the KiwiSDR owner/admin <br> please enter it here: "+w3_input("w3-retain-input-focus w3-margin-TB-8/w3-label-inline w3-label-not-bold/kiwi-pw|padding:1px|size=40","Password:","id-epwd","","kiwi_show_error_ask_exemption_cb")),w3_field_select("id-epwd",{mobile:1})}function kiwi_inactivity_timeout(e){kiwi_show_msg("Sorry, this KiwiSDR has an inactivity timeout after "+e+" minutes.<br>Reload the page to continue.")}function kiwi_24hr_ip_limit(e,i){kiwi_show_error_ask_exemption("Sorry, this KiwiSDR can only be used for "+e+' minutes every 24 hours by each IP address.<br>Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.')}function kiwi_password_entry_timeout(){kiwi_show_msg("Timeout. Please reload page to continue.")}function kiwi_up(e){seriousError||(w3_hide("id-kiwi-msg-container"),w3_show_block("id-kiwi-container"),w3_el("id-kiwi-body").style.overflow="hidden")}function kiwi_down(e,i){var t;1==(e=+e)?t='Sorry, software update in progress. Please check back in a few minutes.<br>Or check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.':2==e?t="Backup in progress.":(null!=i&&""!=i||(i='Sorry, this KiwiSDR server is being used for development right now. <br>Please check <a href="http://rx.kiwisdr.com" target="_self">rx.kiwisdr.com</a> for more KiwiSDR receivers available world-wide.'),t=i),kiwi_show_msg(t)}var stats_interval=1e4,need_config=!0;function stats_init(){need_config&&(msg_send("SET GET_CONFIG"),need_config=!1),stats_update()}function stats_update(){msg_send("SET STATS_UPD ch="+rx_chan);var e=new Date,i=Math.ceil(e/stats_interval)*stats_interval-e;i<stats_interval/2&&(i+=stats_interval),setTimeout(stats_update,i)}function status_periodic(){w3_innerHTML("id-status-stats-cpu",kiwi_cpu_stats_str),w3_innerHTML("id-status-stats-xfer",kiwi_xfer_stats_str),w3_innerHTML("id-msg-stats-cpu",kiwi_cpu_stats_str_long),w3_innerHTML("id-msg-stats-xfer",kiwi_xfer_stats_str_long)}var kiwi_xfer_stats_str="",kiwi_xfer_stats_str_long="";function xfer_stats_cb(e,i,t,n,r){kiwi_xfer_stats_str=w3_text(optbar_prefix_color,"Net")+w3_text("","aud "+e.toFixed(0)+", wf "+i.toFixed(0)+", http "+n.toFixed(0)+", total "+r.toFixed(0)+" kB/s"),kiwi_xfer_stats_str_long="Network (all channels): audio "+e.toFixed(0)+" kB/s, waterfall "+i.toFixed(0)+" kB/s ("+t.toFixed(0)+" fps), http "+n.toFixed(0)+" kB/s, total "+r.toFixed(0)+" kB/s ("+(8*r).toFixed(0)+" kb/s)"}var kiwi_cpu_stats_str="",kiwi_cpu_stats_str_long="",kiwi_config_str="",kiwi_config_str_long="";function cpu_stats_cb(e,i,t,n){d%=100;var r=e.cc?e.cc:0,o=9*r/5+32,s=e.cc?e.cc>=60?"w3-text-css-red w3-bold":e.cc>=50?"w3-text-css-yellow":"w3-text-css-lime":"",_=r?r.toFixed(0)+"&deg;C "+o.toFixed(0)+"&deg;F ":"",a=e.cf>=1e3?(e.cf/1e3).toFixed(1)+" GHz":e.cf.toFixed(0)+" MHz";kiwi_cpu_stats_str=w3_text(optbar_prefix_color,"BB ")+w3_text("",e.cu[0]+","+e.cs[0]+","+e.ci[0]+" usi% ")+(r?w3_text(s,_):"")+w3_text("",a+" ")+w3_text(optbar_prefix_color,"FPGA")+w3_text("",t.toFixed(0)+"%"),kiwi.wf_fps=n;for(var c="",l="",d="",w=!0,p=0;p<e.cu.length;p++)c+=(w?"":" ")+e.cu[p]+"%",l+=(w?"":" ")+e.cs[p]+"%",d+=(w?"":" ")+e.ci[p]+"%",w=!1;var m="cpu";if(e.cu.length>1){m+="0";for(p=1;p<e.cu.length;p++)m+=" cpu"+p}kiwi_cpu_stats_str_long=w3_inline("",w3_text("w3-text-black","Beagle: "+m+" "+c+" usr | "+l+" sys | "+d+" idle,"+(r?"":" "))+(r?"&nbsp;"+w3_text(s+" w3-text-outline w3-large",_)+"&nbsp;":"")+w3_text("w3-text-black",a+", ")+w3_text("w3-text-black","FPGA eCPU: "+t.toFixed(0)+"%"));var u=i,f=Math.trunc(u%60);u=Math.trunc(u/60);var g=Math.trunc(u%60);u=Math.trunc(u/60);var k=Math.trunc(u%24),b=u=Math.trunc(u/24),v=" ";b&&(v+=b+"d:"),v+=k+":"+g.leadingZeros(2)+":"+f.leadingZeros(2),w3_innerHTML("id-status-config",w3_text(optbar_prefix_color,"Up"),w3_text("",v+", "+kiwi_config_str)),v=" | Uptime: ",b&&(v+=b+" "+(b>1?"days":"day")+" "),v+=k+":"+g.leadingZeros(2)+":"+f.leadingZeros(2);var h=""==server_time_local||"null"==server_time_tzname;server_time_utc&&(v+=" | UTC: "+server_time_utc),isDefined(server_time_tzname)&&(v+=" | Local: ",h||(v+=server_time_local+" "),v+=h?"Lat/lon needed for local time":server_tz),w3_innerHTML("id-msg-config",kiwi_config_str_long+v)}function config_str_update(e,i,t,n){kiwi_config_str="v"+t+"."+n+", "+e+" SDR ch, "+i+" GPS ch",w3_innerHTML("id-status-config",kiwi_config_str),kiwi_config_str_long="Config: v"+t+"."+n+", "+e+" SDR channels, "+i+" GPS channels",w3_innerHTML("id-msg-config",kiwi_config_str)}var config_net={};function config_cb(e,i,t,n,r,o,s,_,a,c,l){config_str_update(e,i,c,l);var d=w3_el("id-net-config");d&&(d.innerHTML=w3_div("",w3_col_percent("",w3_div("","Public IP address (outside your firewall/router): "+n+" [port "+r+"]"),50,w3_div("","Ethernet MAC address: "+a.toUpperCase()),30,w3_div("","KiwiSDR serial number: "+t),20),w3_col_percent("",w3_div("","Private IP address (inside your firewall/router): "+o+" [port "+s+"]"),50,w3_div("","Private netmask: /"+_),50)),config_net.pub_ip=n,config_net.pub_port=r,config_net.pvt_ip=n,config_net.pvt_port=s,config_net.mac=a,config_net.serno=t)}function update_cb(e,i,t,n,r,o,s,_,a,c,l){config_str_update(n,r,o,s);var d,w=w3_el("id-msg-update");w&&(d="Installed version: v"+o+"."+s+", built "+c+" "+l,d+=e?"<br>Cannot build, filesystem is FULL!":t?"<br>Update to version v"+ +_+"."+a+" in progress":i?"<br>Update check pending":-1==_?"<br>Error determining the latest version -- check log":o==_&&s==a?"<br>Running most current version":"<br>Available version: v"+_+"."+a,w.innerHTML=d)}var users_interval=2500,user_init=!1;function users_init(e){if(kiwi.called_from_admin=e.admin,kiwi.called_from_user=e.user,kiwi.called_from_monitor=e.monitor,kiwi.called_from_admin||kiwi.called_from_monitor)for(var i,t=kiwi.called_from_admin?"id-admin-user-":"id-monitor-user-",n=kiwi.called_from_monitor?" w3-padding-LR-2":"",r="",o=0;o<rx_chans;o++)kiwi.called_from_admin&&(r=w3_button("id-user-kick-"+o+" w3-hide w3-small w3-white w3-border w3-border-red w3-round-large w3-padding-0 w3-padding-LR-8","Kick","status_user_kick_cb",o)),i=w3_div("id-campers-"+o+" w3-css-orange w3-padding-LR-8"),w3_el("id-users-list").innerHTML+=w3_inline("/w3-hspace-8",w3_div("id-user-"+o+n,"RX"+o),w3_div(t+o),r,i);users_update(),w3_call("users_setup"),user_init=!0}function users_update(){msg_send("SET GET_USERS"),setTimeout(users_update,users_interval)}function user_cb(e){var i=kiwi.called_from_admin?"id-admin-user-":"id-monitor-user-",t=kiwi_url_origin();e.forEach(function(e){var n="",r="",o=e.i,s=e.n,_=e.f,a=e.g,c=isDefined(e.a)&&""!=e.a?e.a+", ":"",l=e.m,d=e.z,w=e.t,p="";if(e.rt){var m=1==e.rt?" act":" 24h";p=" "+w3_text("w3-text-css-orange|vertical-align:bottom",e.rs+m)}var u=e.e;if(isDefined(s)){var f,g=!1;do{try{f=decodeURIComponent(s),g=!0}catch(e){s=s.slice(0,-1)}}while(!g);var k=kiwi_strip_tags(f,"");kiwi.called_from_admin||""!=k||(k="(no identity)"),""!=k&&(k='"'+k+'"');var b="(null)"==a||""==a?kiwi.called_from_admin?"unknown location":"":decodeURIComponent(a);b=""!=(c=c.replace(/::ffff:/,""))||""!=b?"("+c+b+")":"";var v,h,y=(v=((v=_+kiwi.freq_offset_Hz)/1e3).toFixed(v>1e8?1:2))+" kHz ",x=(_/1e3).toFixed(2);kiwi.called_from_admin?(h=t+"/?f="+x+l+"z"+d,' target="_blank"'):(h="javascript:"+(kiwi.called_from_user?"tune("+x+","+sq(l)+","+d+")":"camp("+o+")"),""),""!=u&&(u=decodeURIComponent(u)+" "),n=w3_sb(k,b)+" ",r=w3_link("w3-link-darker-color",h,y+(e.wf?"WF":l)+" z"+d)+" "+u+w+p}if(user_init&&(kiwi.called_from_user?w3_innerHTML("id-optbar-user-"+o,""!=n?n+"<br>"+r:""):(w3_innerHTML(i+o,n+r+""),w3_hide2("id-user-kick-"+o,""==n),w3_hide2("id-user-bl32-"+o,""==n),w3_hide2("id-user-bl24-"+o,""==n))),o==rx_chan&&isDefined(e.c)){var S=w3_el("id-sam-carrier");S&&w3_innerHTML(S,"carrier "+e.c.toFixed(1)+" Hz")}if(w3_innerHTML("id-campers-"+o,e.ca?e.ca+plural(e.ca," camper"):""),o==rx_chan&&e.rn&&e.rn<=55&&!kiwi.inactivity_panel){var T=1==e.rt?"Inactivity timeout in one minute.<br>Close this panel to avoid disconnection.":"Per 24-hour connection timeout in one minute.";confirmation_show_content(T,360,55,function(){msg_send("SET inactivity_ack"),confirmation_panel_close(),kiwi.inactivity_panel=!1},"red"),kiwi.inactivity_panel=!0}if(o==rx_chan&&e.rn>55&&kiwi.inactivity_panel&&(confirmation_panel_close(),kiwi.inactivity_panel=!1),o==rx_chan&&isNumber(e.fo)&&e.fo!=kiwi.freq_offset_kHz&&!confirmation.displayed){T=w3_div("","Frequency scale offset changed. Page must be reloaded.",w3_inline("w3-halign-space-around/",w3_button("w3-margin-T-16 w3-aqua","OK","freq_offset_page_reload")));confirmation_show_content(T,425,100)}o==rx_chan&&isNumber(e.nc)&&e.nc!=rx_chan&&isNumber(e.ns)&&e.ns!=kiwi.notify_seq&&(console.log("$ NOTIFY sn="+e.ns),msg_send("SET notify_msg"),kiwi.notify_seq=e.ns)})}function freq_offset_page_reload(){window.location.reload(!0)}var toggle_e={SET:1,SET_URL:2,FROM_COOKIE:4,WRITE_COOKIE:8};function kiwi_toggle(e,i,t,n){var r=null;if(e&toggle_e.SET_URL&&(null!=i||null!=i))r=i;else if(e&toggle_e.FROM_COOKIE&&null!=(r=readCookie(n))){var o=parseFloat(r);isNaN(o)||(r=o)}return null==r&&e&toggle_e.SET&&(r=i),null==r&&(r=t),r}function kiwi_plot_max(e){var i=bi[e];return 1024/(i.samplerate/i.plot_samplerate)}function kiwi_fft_mode(){setmaxdb(-30)}function kiwi_mapPinSymbol(e,i){return{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z",fillColor:e=e||"red",fillOpacity:1,strokeColor:i=i||"white",strokeWeight:1,scale:1}}function isAdmin(){return 0!=Object.keys(adm).length}var chan_no_pwd,chan_no_pwd_true,client_public_ip,reason_disabled="",version_maj=-1,version_min=-1,debian_ver=-1,tflags={INACTIVITY:1,WF_SM_CAL:2,WF_SM_CAL2:4},kiwi_output_msg_p={scroll_only_at_bottom:!0,process_return_alone:!1};function kiwi_msg(e,i){var t=!0;switch(e[0]){case"version_maj":version_maj=parseInt(e[1]);break;case"version_min":version_min=parseInt(e[1]);break;case"debian_ver":debian_ver=parseInt(e[1]);break;case"client_public_ip":client_public_ip=e[1].replace(/::ffff:/,""),console.log("client public IP: "+client_public_ip);break;case"badp":extint_valpwd_cb(parseInt(e[1]));break;case"chan_no_pwd":chan_no_pwd=parseInt(e[1]);break;case"chan_no_pwd_true":chan_no_pwd_true=parseInt(e[1]);break;case"rx_chans":rx_chans=parseInt(e[1]);break;case"wf_chans":wf_chans=parseInt(e[1]);break;case"wf_chans_real":wf_chans_real=parseInt(e[1]);break;case"rx_chan":rx_chan=parseInt(e[1]);break;case"max_camp":max_camp=parseInt(e[1]);break;case"load_cfg":var n=decodeURIComponent(e[1]);console.log("### load_cfg "+i.stream+" "+n.length),cfg=kiwi_JSON_parse("load_cfg",n),kiwi.isOffset=0!=cfg.freq_offset,kiwi.freq_offset_kHz=cfg.freq_offset,kiwi.freq_offset_Hz=1e3*cfg.freq_offset,kiwi.offset_frac=cfg.freq_offset%1e3*1e3,owrx_cfg();break;case"load_adm":var r=decodeURIComponent(e[1]);console.log("### load_adm "+i.stream+" "+r.length),adm=kiwi_JSON_parse("load_adm",r);break;case"no_admin_conns":kiwi.no_admin_conns_pend++,1==kiwi.no_admin_conns_pend&&(confirmation_panel_close(),confirmation_show_content("Must close all admin connections before attempting this operation.",500,55,function(){confirmation_panel_close(),kiwi.no_admin_conns_pend=0},"red"));break;case"request_dx_update":isAdmin()?dx.ignore_dx_update?dx.ignore_dx_update=!1:dx_update_admin():dx_update_request();break;case"mkr":var o=e[1];(s=kiwi_JSON_parse("mkr",o))&&dx_label_cb(s);break;case"user_cb":var s;(s=kiwi_JSON_parse("user_cb",e[1]))&&user_cb(s);break;case"config_cb":(_=kiwi_JSON_parse("config_cb",e[1]))&&config_cb(_.r,_.g,_.s,_.pu,_.pe,_.pv,_.pi,_.n,_.m,_.v1,_.v2,_.ai);break;case"update_cb":(_=kiwi_JSON_parse("update_cb",e[1]))&&update_cb(_.f,_.p,_.i,_.r,_.g,_.v1,_.v2,_.p1,_.p2,decodeURIComponent(_.d),decodeURIComponent(_.t));break;case"stats_cb":var _;(_=kiwi_JSON_parse("stats_cb",e[1]))&&(null!=_.ce&&cpu_stats_cb(_,_.ct,_.ce,_.fc),xfer_stats_cb(_.ac,_.wc,_.fc,_.ah,_.as),extint.srate=_.sr,extint.nom_srate=_.nsr,gps_stats_cb(_.ga,_.gt,_.gg,_.gf,_.gc,_.go),_.gr&&(kiwi.WSPR_rgrid=decodeURIComponent(_.gr),kiwi.GPS_fixes=_.gf),-1==_.sh?(w3_innerHTML("id-rx-snr",", SNR ",_.sa," dB"),w3_innerHTML("id-msg-snr","SNR: All ",_.sa," dB")):(w3_innerHTML("id-rx-snr",", SNR ",_.sa,":",_.sh," dB"),w3_innerHTML("id-msg-snr","SNR: All ",_.sa," dB, HF ",_.sh," dB")),admin_stats_cb(_.ad,_.au,_.ae,_.ar,_.an,_.ap,_.an2,_.ai),time_display_cb(_));break;case"status_msg_text":kiwi_output_msg_p.s=e[1],kiwi_output_msg("id-output-msg","id-output-msg",kiwi_output_msg_p);break;case"status_msg_html":var a=kiwi_decodeURIComponent("status_msg_html",e[1]);w3_innerHTML("id-status-msg",a),w3_innerHTML("id-msg-status",a);break;case"is_admin":extint_isAdmin_cb(e[1]);break;case"is_local":var c=e[1].split(",");console.log("kiwi_msg rx_chan="+c[0]+" is_local="+c[1]),kiwi.is_local[+c[0]]=+c[1];break;case"is_multi_core":kiwi.is_multi_core=1;break;case"authkey_cb":extint_authkey_cb(e[1]);break;case"down":kiwi_down(e[1],reason_disabled);break;case"too_busy":kiwi_too_busy(parseInt(e[1]));break;case"monitor":kiwi_monitor();break;case"exclusive_use":kiwi_exclusive_use();break;case"inactivity_timeout":kiwi_inactivity_timeout(e[1]);break;case"ip_limit":c=decodeURIComponent(e[1]).split(",");kiwi_24hr_ip_limit(parseInt(c[0]),c[1]);break;case"password_timeout":kiwi_password_entry_timeout();break;case"reason_disabled":reason_disabled=kiwi_decodeURIComponent("reason_disabled",e[1]);break;case"sample_rate":extint.srate=parseFloat(e[1]);break;case"pref_import_ch":kiwi.prefs_import_ch=+e[1];break;case"pref_import":prefs_import_cb(e[1],kiwi.prefs_import_ch);break;case"adc_clk_nom":extint_adc_clock_nom_Hz=+e[1];break;case"notify_msg":a=kiwi_decodeURIComponent("notify_msg",e[1]);if(console.log("notify_msg: "+a),confirmation.displayed)break;a=w3_div("",a),confirmation_show_content(a,425,50),setTimeout(confirmation_panel_close,3e3);break;default:t=!1}return t}function kiwi_debug(e){console.log(e),msg_send("SET dbug_msg="+encodeURIComponent(e))}function kiwi_show_msg(e){html("id-kiwi-msg").innerHTML=e,""==e?(w3_hide("id-kiwi-msg-container"),w3_el("id-kiwi-body").style.overflow="hidden"):(w3_hide("id-kiwi-container"),w3_show_block("id-kiwi-msg-container"),w3_el("id-kiwi-body").style.overflow="scroll")}function kiwi_server_error(e){kiwi_show_msg('Hmm, there seems to be a problem. <br>The server reported the error: <span style="color:red">'+e+"</span>"),seriousError=!0}function kiwi_serious_error(e){kiwi_show_msg(e),seriousError=!0,console.log(e)}function kiwi_trace(e){e&&console.log("kiwi_trace: "+e);try{console.trace()}catch(e){}}function kiwi_trace_mobile(e){alert(e+" "+Error().stack)}




/* web/kiwi/kiwi_ui.min.js */
function dx_get_value(d){return w3_get_value("dx.o."+d+"_"+dx.o.gid)}function dx_update_check(d,o,x){if(d!=dx.IDX_USER){d=+d,dx.o.gid=d,console.log("### dx_update_check gid(idx)="+d+" "+(o==dx.UPD_ADD?"ADD":"MODIFY")),dx.o.fr=+dx_get_value("fr"),dx.o.fm=+dx_get_value("fm"),dx.o.ft=+dx_get_value("ft"),dx.o.fd=dx.o.last_fd[d],dx.o.b=+dx_get_value("b"),dx.o.e=+dx_get_value("e"),dx.o.o=+dx_get_value("o"),dx.o.i=dx_get_value("i"),dx.o.n=dx_get_value("n"),dx.o.p=dx_get_value("p"),x||(d>=0&&dx.o.last_pb[d]?(dx.o.lo=dx.o.last_pb[d][0],dx.o.hi=dx.o.last_pb[d][1]):dx.o.lo=dx.o.hi=0);var _=dx.o.fd<<dx.DX_DOW_SFT|dx.o.ft<<dx.DX_TYPE_SFT|dx.o.fm;if(dx.o.fr>32e3||kiwi.freq_offset_kHz){var e=dx.o.fr-kiwi.freq_offset_kHz;console.log("removing freq_offset from old_freq="+dx.o.fr+" freq_offset_kHz="+kiwi.freq_offset_kHz+" new_freq="+e),dx.o.fr=e}dx.o.fr<0&&(dx.o.fr=0),o==dx.UPD_ADD?dx.o.gid=-1:dx.ignore_dx_update=!0,console.log("dx.o:"),console.log(dx.o);var i=+dx.o.b,t=+dx.o.e;0==i&&0==t&&(t=2400),console.log("SET DX_UPD g="+dx.o.gid+" f="+dx.o.fr+" lo="+dx.o.lo+" hi="+dx.o.hi+" o="+dx.o.o.toFixed(0)+" fl="+_+"(dow="+dx.o.fd+"|ty="+dx.o.ft+"|mo="+dx.o.fm+") b="+i+" e="+t+" i="+dx.o.i+" n="+dx.o.n+" p="+dx.o.p),ext_send("SET DX_UPD g="+dx.o.gid+" f="+dx.o.fr+" lo="+dx.o.lo.toFixed(0)+" hi="+dx.o.hi.toFixed(0)+" o="+dx.o.o.toFixed(0)+" fl="+_+" b="+i+" e="+t+" i="+encodeURIComponent(dx.o.i+"x")+" n="+encodeURIComponent(dx.o.n+"x")+" p="+encodeURIComponent(dx.o.p+"x")),w3_call("dx_sched_save","id-dx-list-saved",1e3)}}function dx_num_cb(d,o,x){if(!x){var _=w3_remove_trailing_index(d,"_");console.log("dx_num_cb path="+d+" val="+o+" o.idx="+_.idx),w3_num_cb(_.el,o),dx_update_check(_.idx,dx.UPD_MOD)}}function dx_sel_cb(d,o,x){if(!x){var _=w3_remove_trailing_index(d,"_");console.log("dx_sel_cb path="+d+" val="+o+" o.idx="+_.idx),w3_string_cb(_.el,o),dx_update_check(_.idx,dx.UPD_MOD)}}function dx_string_cb(d,o,x){if(!x){var _=w3_remove_trailing_index(d,"_");console.log("dx_string_cb path="+d+" val="+o+" o.idx="+_.idx),w3_string_cb(_.el,o),dx_update_check(_.idx,dx.UPD_MOD)}}function dx_dow_button(d,o){var x=w3_remove_trailing_index(d,"_");console.log("dx_dow_button path="+d+" o.idx="+x.idx);var _=x.idx==dx.IDX_USER,e=1<<6-+o,i=_?dx.o.fd:dx.o.last_fd[x.idx],t=i;i^=e,_?dx.o.fd=i:dx.o.last_fd[x.idx]=i;var l=i&e;console.log("dx_dow_button day_i="+o+" dow_b="+e.toHex(2)+" sel="+l.toHex(2)+" before="+t.toHex(2)+" after="+i.toHex(2)+" o.idx="+x.idx),w3_color(d,l?"black":"white",l?dx.dow_colors[o]:"darkGrey"),dx_update_check(x.idx,dx.UPD_MOD)}function dx_sched_time_cb(d,o,x){dx_string_cb(d,o=(+o).toFixed(0).leadingZeros(4),x),w3_set_value(d,o)}function dx_passband_cb(d,o,x){if(!x){var _=o.split(/[,\s]/),e=_.length;if(console.log("dx_passband_cb path="+d+" val="+o+" a.len="+e),console.log(_),1==e&&""!=_[0]){var i=Math.round(_[0].parseFloatWithUnits("kM")/2);dx.o.lo=-i,dx.o.hi=i}else e>=1&&""!=_[0]&&""!=_[e-1]?(dx.o.lo=Math.round(_[0].parseFloatWithUnits("kM")),dx.o.hi=Math.round(_[e-1].parseFloatWithUnits("kM"))):dx.o.lo=dx.o.hi=0;var t=w3_remove_trailing_index(d,"_");console.log("dx_passband_cb lo="+dx.o.lo+" hi="+dx.o.hi+" o.idx="+t.idx),dx_update_check(t.idx,dx.UPD_MOD,!0)}}




/* web/kiwi/kiwi_util.min.js */
function isUndefined(e){return void 0===e}function isDefined(e){return void 0!==e}function isNull(e){return null===e}function isNumber(e){return"number"==typeof e&&!isNaN(e)}function isBoolean(e){return"boolean"==typeof e}function isString(e){return"string"==typeof e}function isArray(e){return Array.isArray(e)}function isFunction(e){return"function"==typeof e}function isObject(e){return"object"==typeof e}function isArg(e){return!isUndefined(e)&&!isNull(e)}function kiwi_typeof(e){return isNull(e)?"null":isArray(e)?"array":typeof e}try{String.prototype.includes||(String.prototype.includes=function(e){return this.indexOf(e)>=0})}catch(e){console.log("kiwi_util: String.prototype.includes")}try{String.prototype.startsWith||(String.prototype.startsWith=function(e){return 0==this.indexOf(e)})}catch(e){console.log("kiwi_util: String.prototype.startsWith")}try{String.prototype.endsWith||(String.prototype.endsWith=function(e,i){return(void 0===i||i>this.length)&&(i=this.length),this.substring(i-e.length,i)===e})}catch(e){console.log("kiwi_util: String.prototype.endsWith")}var kiwi_iOS,kiwi_MacOS,kiwi_linux,kiwi_Windows,kiwi_android,kiwi_safari,kiwi_firefox,kiwi_chrome,kiwi_opera,kiwi_smartTV,kiwi_util={};function kiwi_is_iOS(){return kiwi_iOS}function kiwi_isMacOS(){return kiwi_MacOS}function kiwi_isWindows(){return kiwi_Windows}function kiwi_isLinux(){return kiwi_linux}function kiwi_isAndroid(){return kiwi_android}function kiwi_isSmartTV(){return kiwi_smartTV}function kiwi_isMobile(){return force_mobile||kiwi_is_iOS()||kiwi_isAndroid()||"Samsung"==kiwi_isSmartTV()||mobile_laptop_test}function kiwi_isSafari(){return kiwi_safari?kiwi_safari[1]:NaN}function kiwi_isFirefox(){return kiwi_firefox?kiwi_firefox[1]:NaN}function kiwi_isChrome(){return kiwi_chrome?kiwi_chrome[1]:NaN}function kiwi_isOpera(){return kiwi_opera?kiwi_opera[1]:NaN}document.onreadystatechange=function(){if("complete"==document.readyState){var e=navigator.userAgent;console.log(e),kiwi_iOS=e.includes("iPhone")||e.includes("iPad"),kiwi_MacOS=e.includes("OS X"),kiwi_linux=e.includes("Linux"),kiwi_Windows=e.includes("Win"),kiwi_android=e.includes("Android"),kiwi_safari=/safari\/([0-9]+)/i.exec(e),kiwi_browserVersion=/version\/([0-9]+)/i.exec(e),kiwi_firefox=/firefox\/([0-9]+)/i.exec(e),kiwi_chrome=/chrome\/([0-9]+)/i.exec(e),(kiwi_opera=/opera\/([0-9]+)/i.exec(e))||(kiwi_opera=/OPR\/([0-9]+)/i.exec(e)),(kiwi_smartTV=e.includes("SmartTV"))||(kiwi_smartTV=e.includes("SMART-TV")),kiwi_smartTV&&(e.includes("Samsung")?kiwi_smartTV="Samsung":e.includes("LG")&&(kiwi_smartTV="LG")),console.log("MacOS="+kiwi_MacOS+" Linux="+kiwi_linux+" Windows="+kiwi_Windows+" iOS="+kiwi_iOS+" Android="+kiwi_android+" SmartTV="+kiwi_smartTV),kiwi_opera?kiwi_chrome=kiwi_safari=null:kiwi_chrome?kiwi_safari=null:kiwi_safari&&kiwi_browserVersion&&(kiwi_safari[1]=kiwi_browserVersion[1]),console.log("Safari="+kiwi_isSafari()+" Firefox="+kiwi_isFirefox()+" Chrome="+kiwi_isChrome()+" Opera="+kiwi_isOpera()),"undefined"!=typeof kiwi_check_js_version?kiwi_ajax("/VER","kiwi_version_cb"):"undefined"!=typeof kiwi_bodyonload&&kiwi_bodyonload("")}};var kiwi_version_fail=!1;function kiwi_version_cb(e){version_maj=e.maj,version_min=e.min;var i="";kiwi_check_js_version.forEach(function(e){e.VERSION_MAJ==version_maj&&e.VERSION_MIN==version_min||(0==kiwi_version_fail&&(i="Your browser is trying to use incorrect versions of the KiwiSDR Javascript files.<br>Please clear your browser cache and try again.<br>Or click the button below to continue anyway.<br><br>v"+version_maj+"."+version_min+": KiwiSDR server<br>",kiwi_version_fail=!0),i+="v"+e.VERSION_MAJ+"."+e.VERSION_MIN+": "+e.file+"<br>")}),kiwi_version_fail&&(i+="<br>"+w3_button("w3-css-yellow","Continue anyway","kiwi_version_continue_cb")),kiwi_bodyonload(i)}function kiwi_version_continue_cb(){seriousError=!1,kiwi_bodyonload("")}function ord(e,i){return isString(i)?e.charCodeAt(0)-i.charCodeAt(0):e.charCodeAt(0)}function chr(e){return String.fromCharCode(e)}function sq(e){return"'"+e+"'"}function dq(e){return'"'+e+'"'}function dqc(e){return'"'+e+'":'}function plural(e,i){return 1==e?i:i+"s"}function arrayBufferToString(e){var i;try{var t=new Uint8Array(e);i="";for(var r=0;r<t.length;r++)i+=String.fromCharCode(t[r])}catch(t){console.log(e),console.log(t),kiwi_trace("arrayBufferToString"),i=null}return i}function arrayBufferToStringLen(e,i){var t=new Uint8Array(e),r=String();i=Math.min(i,t.length);for(var n=0;n<i;n++)r+=String.fromCharCode(t[n]);return r}function kiwi_dup_array(e){return e.slice()}function kiwi_dedup_array(e,i){var t=[];return e.forEach(function(e,r){i&&i(e)||t.includes(e)||t.push(e)}),t}function kiwi_shallow_copy(e){return Object.assign({},e)}function kiwi_deep_copy(e){return JSON.parse(JSON.stringify(e))}function getFirstChars(e,i){arrayBufferToStringLen(e,i)}function kiwi_inet4_d2h(e,i){var t=e.split(".");if(4!=t.length)return null;var r,n,o,a,s=function(e){var i=parseInt(e);return!isNumber(i)||i<0||i>255?null:i};if(null==(r=s(t[0])))return null;if(null==(n=s(t[1])))return null;if(null==(o=s(t[2])))return null;if(null==(a=s(t[3])))return null;var l=r<<24|n<<16|o<<8|a;return i&&(l>=kiwi_ip_10_lo&&l<=kiwi_ip_10_hi||l>=kiwi_ip_172_16_lo&&l<=kiwi_ip_172_16_hi||l>=kiwi_ip_192_168_lo&&l<=kiwi_ip_192_168_hi||l==kiwi_ip_loopback)?null:l}var kiwi_ip_10_lo=kiwi_inet4_d2h("10.0.0.0"),kiwi_ip_10_hi=kiwi_inet4_d2h("10.255.255.255"),kiwi_ip_172_16_lo=kiwi_inet4_d2h("172.16.0.0"),kiwi_ip_172_16_hi=kiwi_inet4_d2h("172.31.255.255"),kiwi_ip_192_168_lo=kiwi_inet4_d2h("192.168.0.0"),kiwi_ip_192_168_hi=kiwi_inet4_d2h("192.168.255.255"),kiwi_ip_loopback=kiwi_inet4_d2h("127.0.0.1");function kiwi_h2n_32(e,i){var t;switch(i){case 0:t=e>>24;break;case 1:t=e>>16;break;case 2:t=e>>8;break;case 3:t=e;break;default:t=0}return 255&t}function kiwi_ip_str(e){var i="";return isNumber(e)?i=kiwi_h2n_32(e,0)+"."+kiwi_h2n_32(e,1)+"."+kiwi_h2n_32(e,2)+"."+kiwi_h2n_32(e,3):isArray(e)?i=e[3]+"."+e[2]+"."+e[1]+"."+e[0]:isObject(e)&&(i=e.a+"."+e.b+"."+e.c+"."+e.d),i}function isHexDigit(e){return"0123456789ABCDEFabcdef".indexOf(e)>-1}Number.prototype.leadingZeros=function(e){var i=String(this);for(isNumber(e)||(e=2);i.length<e;)i="0"+i;return i},String.prototype.leadingZeros=function(e){var i=String(this);for(isNumber(e)||(e=2);i.length<e;)i="0"+i;return i},Number.prototype.fieldWidth=function(e){var i=String(this);if(!isNumber(e))return i;for(;i.length<e;)i=" "+i;return i},String.prototype.fieldWidth=function(e){var i=String(this);if(!isNumber(e))return i;for(;i.length<e;)i=" "+i;return i},String.prototype.filterInt=function(){var e=String(this);return/^(\-|\+)?([0-9]+|Infinity)$/.test(e)?Number(e):NaN},String.prototype.withSign=function(){var e=this;return Number(e)<0?e:"+"+e},String.prototype.positiveWithSign=function(){var e=this;return Number(e)<=0?e:"+"+e},Number.prototype.toHex=function(e){isNumber(e)||(e=0);var i=e<0?0:1;e=Math.abs(e);for(var t=Number(this),r=(t>>>=0).toString(16);r.length<e;)r="0"+r;return i&&(r="0x"+r),r},Number.prototype.toFixedNZ=function(e){for(var i=Number(this).toFixed(e);i.endsWith("0");)i=i.slice(0,-1);return i.endsWith(".")&&(i=i.slice(0,-1)),i},Number.prototype.toUnits=function(){var e=Number(this);return e<1e3?e.toString():e<1e6?(e/1e3).toFixed(1)+"k":e<1e9?(e/1e6).toFixed(1)+"M":(e/1e9).toFixed(1)+"G"},String.prototype.parseFloatWithUnits=function(e,i){var t=String(this),r=parseFloat(t);return isNaN(r)?NaN:(e&&!e.includes("k")||new RegExp("([-0-9.]*k)").test(t)&&(r*=1e3,i&&(r*=i)),e&&!e.includes("M")||new RegExp("([-0-9.]*M)").test(t)&&(r*=1e6,i&&(r*=i)),r)},Number.prototype.withSign=function(){var e=Number(this),i=e.toString();return e<0?i:"+"+i};var kHz=function(e){return(e/1e3).toFixed(3)+"k"};function kiwi_setTimeout(e,i,t){return e(t),setTimeout(e,i,t)}function kiwi_clearTimeout(e){try{clearTimeout(e)}catch(e){}}function kiwi_setInterval(e,i,t){return e(t),setInterval(e,i,t)}function kiwi_clearInterval(e){try{clearInterval(e)}catch(e){}}var littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}();function _nochange(e){if(0!=arguments.length)return void 0===e}function _default(e){return 0==arguments.length?NaN:isNaN(e)}function _change(e){return!_nochange(e)&&!_default(e)}function console_log(){for(var e,i=0;i<arguments.length;i++){var t=arguments[i];0==i?e=t+": ":e+="arg"+(i-1)+"="+t+" "}console.log("CONSOLE_LOG "+e)}function console_log_fqn(){for(var e,i=0;i<arguments.length;i++){var t=arguments[i];if(0==i)e=t+": ";else{var r;try{r=getVarFromString(t)}catch(e){r="[not defined]"}var n=t.lastIndexOf(".");e+=(-1==n?t:t.substr(n+1))+"="+r+" "}}console.log("FQN "+e)}function console_log_dbgUs(){if(dbgUs){s="";for(var e=0;e<arguments.length;e++)s+=arguments[e].toString();console.log(s)}}function kiwi_log(e){setTimeout(function(e){console.log(e)},1,e)}function kiwi_trace_log(e){setTimeout(function(e){kiwi_trace(e)},1,e)}function canvas_log(e){isUndefined(owrx.news_acc_s)&&(owrx.news_acc_s="<br>"),"\f"==e?owrx.news_acc_s="<br>":"$"==e.charAt(0)?owrx.news_acc_s+="<br>"+e:owrx.news_acc_s+=("<br>"!=owrx.news_acc_s?" | ":"")+e,extint_news(owrx.news_acc_s)}function canvas_log2(e){kiwi_isMobile()&&toggle_or_set_hide_bars(owrx.HIDE_BANDBAR),w3_innerHTML("id-rx-title",kiwi.log2_seq+": "+e),kiwi.log2_seq++}function kiwi_pathToSelector(e){if(!e||!e.outerHTML)return null;for(var i;e.parentElement;){var t=e.localName;if(!t)break;t=t.toLowerCase();var r=e.parentElement,n=[];if(r.children&&r.children.length>0)for(var o=0;o<r.children.length;o++){var a=r.children[o];a.localName&&a.localName.toLowerCase&&a.localName.toLowerCase()===t&&n.push(a)}n.length>1&&(t+=":eq("+n.indexOf(e)+")"),i=t+(i?">"+i:""),e=r}return i}function kiwi_serializeEvent(e){if(e){var i={eventName:e.toString(),altKey:e.altKey,bubbles:e.bubbles,button:e.button,buttons:e.buttons,cancelBubble:e.cancelBubble,cancelable:e.cancelable,clientX:e.clientX,clientY:e.clientY,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:e.currentTarget?e.currentTarget.outerHTML:null,defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,fromElement:e.fromElement?e.fromElement.outerHTML:null,isTrusted:e.isTrusted,layerX:e.layerX,layerY:e.layerY,metaKey:e.metaKey,movementX:e.movementX,movementY:e.movementY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,path:kiwi_pathToSelector(e.path&&e.path.length?e.path[0]:null),relatedTarget:e.relatedTarget?e.relatedTarget.outerHTML:null,returnValue:e.returnValue,screenX:e.screenX,screenY:e.screenY,shiftKey:e.shiftKey,sourceCapabilities:e.sourceCapabilities?e.sourceCapabilities.toString():null,target:e.target?e.target.outerHTML:null,timeStamp:e.timeStamp,toElement:e.toElement?e.toElement.outerHTML:null,type:e.type,view:e.view?e.view.toString():null,which:e.which,x:e.x,y:e.y};return JSON.stringify(i,null,2)}return"(null)"}function event_dump(e,i,t){if(t){var r=isDefined(e.relatedTarget)&&e.relatedTarget?" Trel="+e.relatedTarget.id:"",n="";e.shiftKey&&(n+="shift-"),e.ctrlKey&&(n+="ctrl-"),e.altKey&&(n+="alt-"),e.metaKey&&(n+="meta-"),n+=""+e.key,console.log("event_dump "+i+" "+e.type+" k="+n+" T="+e.target.id+" Tcur="+e.currentTarget.id+r)}else{if(console.log("================================"),!isArg(e))return console.log("EVENT_DUMP: "+i+" bad evt"),void kiwi_trace();console.log("EVENT_DUMP: "+i+" type="+e.type),console.log((e.shiftKey?"SFT ":"")+(e.ctrlKey?"CTL ":"")+(e.altKey?"ALT ":"")+(e.metaKey?"META ":"")+"key="+e.key);var o=e.currentTarget?e.currentTarget.id:"(null)";console.log("this.id="+this.id+" tgt.name="+e.target.nodeName+" tgt.id="+e.target.id+" ctgt.id="+o);var a="";1&e.buttons&&(a+="L"),4&e.buttons&&(a+="M"),2&e.buttons&&(a+="R"),console.log("button="+"LMR"[e.button]+" buttons="+a+" detail="+e.detail),e.type.startsWith("touch")?(console.log("pageX="+e.pageX+" clientX="+e.clientX+" screenX="+e.screenX),console.log("pageY="+e.pageY+" clientY="+e.clientY+" screenY="+e.screenY)):(console.log("pageX="+e.pageX+" clientX="+e.clientX+" screenX="+e.screenX+" offX(EXP)="+e.offsetX+" layerX(DEPR)="+e.layerX),console.log("pageY="+e.pageY+" clientY="+e.clientY+" screenY="+e.screenY+" offY(EXP)="+e.offsetY+" layerY(DEPR)="+e.layerY)),console.log("evt, evt.target, evt.currentTarget, evt.relatedTarget, elementFromPoint:"),console.log(e),console.log(e.target),console.log(e.currentTarget),console.log(e.relatedTarget),isNumber(e.pageX)&&isNumber(e.pageY)?console.log(document.elementFromPoint(e.pageX,e.pageY)):console.log("(no x,y)"),console.log("----")}}function kiwi_rateLimit(e,i){var t=!1;return function(){if(!t){t=!0;var r=arguments;setTimeout(function(){t=!1,e.apply(this,r)},i)}}}function kiwi_UTC_minutes(){var e=new Date;return 60*e.getUTCHours()+e.getUTCMinutes()}function kiwi_hh_mm(e){if(isNumber(e))return e;if(isString(e)){var i=e.split(":"),t=+i[0];if(i.length>1){var r=+i[1]/60;t=t<0?t-r:t+r}return"-0"!=i[0]&&"-00"!=i[0]||(t=-t),t}return null}function kiwi_UTCdoyToDate(e,i,t,r,n){return new Date(Date.UTC(i,0,e,t,r,n))}function kiwi_decodeURIComponent(e,i){var t=null,r=!1;if(dbgUs&&2!=arguments.length)return alert("kiwi_decodeURIComponent: requires exactly two args"),kiwi_trace(),null;for(;null==t;)try{t=decodeURIComponent(i)}catch(l){if(console.log("$kiwi_decodeURIComponent("+e+"): decode fail"),console.log(i),r)return console.log("kiwi_decodeURIComponent("+e+"): DOUBLE DECODE FAIL"),console.log(i),console.log(l),null;for(var n=0;n<i.length-2;n++){var o=i.charAt(n+1),a=i.charAt(n+2);if("%"==i.charAt(n)&&isHexDigit(o)&&isHexDigit(a)&&o>="8"){var s=i.charAt(n-1);s=s.charCodeAt(0),i=i.substr(0,n)+i.substr(n+3),n=0,r=!0}}t=null}return t}kiwi_util.str_recode_lookup=[];var e1=function(e){kiwi_util.str_recode_lookup[ord(e)]=1},e2=function(e){kiwi_util.str_recode_lookup[ord(e)]=2},er=function(e,i,t){for(var r=e;r<=i;r++)kiwi_util.str_recode_lookup[r]=t};function kiwi_str_decode_selective_inplace(e,i){var t,r="",n=e.length,o=(e.length,/[0-9a-fA-F]/);for(t=0;t<n;t++)if("%"==e[t]&&t+2<n&&e[t+1].match(o)&&e[t+2].match(o)){var a=parseInt(e[t+1],16)<<4|parseInt(e[t+2],16);a<128&&(0==kiwi_util.str_recode_lookup[a]||i&&1==kiwi_util.str_recode_lookup[a])?(r+=chr(a),t+=2):r+="%"}else r+=e[t];return r}function kiwi_JSON_parse(e,i){var t;try{t=JSON.parse(i)}catch(r){console.log("kiwi_JSON_parse("+e+"): JSON parse fail"),console.log(i),console.log(r),t=null}return t}function kiwi_remove_ANSI_escape_sequences(e){for(var i=e.split(""),t=[],r=!1,n=0;n<i.length;n++)r?"m"==i[n]&&(r=!1):""==i[n]&&n+1<i.length&&"["==i[n+1]?(n++,r=!0):t.push(i[n]);return t.join("")}function kiwi_clean_html(e){return e.replace(/\&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}function kiwi_clean_newline(e){return e.replace(/[\r\n\f\v]/g,"").replace(/\t/g," ")}function kiwi_SSL(){return window.location.protocol+"//"}function kiwi_url_origin(){return window.location.origin}function kiwi_host_port(){return window.location.host}function kiwi_host(){return window.location.hostname}function kiwi_url_param(e,i,t){var r=isArray(e);isUndefined(i)&&(i=!0),isUndefined(t)&&(t=null);var n=window.location&&window.location.search&&window.location.search.substr(1);if(!n)return t;var o=t;return n.split("&").forEach(function(t){var n=t.split("=");r?e.forEach(function(e){e==n[0]&&(o=n.length>=2?n[1]:i)}):e==n[0]&&(o=n.length>=2?n[1]:i)}),o}function kiwi_add_search_param(e,i){var t=e.search;return console.log("qs=<"+t+">"),(""==t?"/?":t.includes("?")?"&":"/?")+i}function kiwi_remove_search_param(e,i){return e=e.replace("?"+i+"&","?").replace("&"+i+"&","&").replace("?"+i,"").replace("&"+i,"")}er(0,127,0),e1("&"),e1("'"),e1("+"),e1(";"),e1("<"),e1(">"),e1("`"),e2('"'),e2("%"),e2("\\"),er(0,31,2),er(127,127,2);var kiwiint_dummy_elem={};function html(e){var i=w3_el(e);try{i.value}catch(t){console.log("html('"+e+"')="+i+" FAILED"),dbgUs&&dbgUsFirst&&(dbgUsFirst=!1)}return null==i&&(i=kiwiint_dummy_elem),i}function px(e){if(!isArg(e)||""==e)return"0";var i=parseFloat(e);return isNaN(i)?(console.log("px num="+e),kiwi_trace(),"0"):i.toFixed(0)+"px"}function unpx(e){return parseFloat(e)}function css_style(e,i){return(e=w3_el(e))?getComputedStyle(e,null).getPropertyValue(i):null}function css_style_num(e,i){if(!(e=w3_el(e)))return null;var t=parseInt(css_style(e,i));return isNaN(t)&&(t=0),t}function html_LR_border_pad(e){return css_style_num(e,"border-left-width")+css_style_num(e,"border-right-width")+css_style_num(e,"padding-left")+css_style_num(e,"padding-right")}function cancelEvent(e){return(e=e||window.event).stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1,!1}function ignore(e){return cancelEvent(e)}function kiwi_rgb(e,i,t){return null==e?"":(isArray(e)&&(i=e[1],t=e[2],e=e[0]),"rgb("+Math.floor(e)+","+Math.floor(i)+","+Math.floor(t)+")")}function hsl(e,i,t){return(i=Math.floor(i))<0&&(i=0),i>100&&(i=100),(t=Math.floor(t))<0&&(t=0),t>100&&(t=100),"hsl("+Math.round(e)+","+i+"%,"+t+"%)"}function createCookie(e,i,t){var r="";if(t){var n=new Date;n.setTime(n.getTime()+24*t*60*60*1e3),r="; expires="+n.toGMTString()}document.cookie=e+"="+i+r+"; path=/; SameSite=Lax;"}function readCookie(e,i){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var o=r[n];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return isDefined(i)?i:null}function writeCookie(e,i){createCookie(e,i,15330)}function initCookie(e,i){var t=readCookie(e);return null==t?(writeCookie(e,i),i):t}function updateCookie(e,i){var t=readCookie(e);return(null==t||t!=i)&&(writeCookie(e,i),!0)}function deleteCookie(e){null!=readCookie(e)&&createCookie(e,0,-1)}function kiwi_storeGet(e,i){var t;if(!isArg(e))return null;try{if(null==localStorage)return null;null==(t=localStorage.getItem(e))&&(null!=(t=readCookie(e))?(console.log("$moving to storage api: "+e+"="+t),kiwi_storeSet(e,t),deleteCookie(e)):isDefined(i)?(kiwi_storeSet(e,i),t=i):t=null)}catch(i){console.log("$kiwi_storeGet CATCH: "+e),console.log("$kiwi_storeGet CATCH: "+i),t=null}return null==t&&console.log("$ kiwi_storeGet warning: "+e+"=null"),t}function kiwi_storeSet(e,i){if(!isArg(i))return null;try{if(null==localStorage)return null;localStorage.setItem(e,i)}catch(e){return null}return!0}function getVarFromString(e){var t=window,r=e.split(".");for(i=0;i<r.length-1;i++){var n=r[i];if(isUndefined(t=t[n]))throw console.log("getVarFromString: NO SCOPE "+e+" scope_name="+n),"no scope"}return t[r[r.length-1]]}function setVarFromString(e,t){var r=window,n=e.split(".");for(i=0;i<n.length-1;i++)null==r[n[i]]&&(r[n[i]]={}),r=r[n[i]];r[n[n.length-1]]=t}function getType(e){return e&&e.constructor&&e.constructor.name}function kiwi_parseQuery(e){var i=new Object;if(!e)return i;for(var t=e.split(/[;&]/),r=0;r<t.length;r++){var n=t[r].split("=");if(n&&2==n.length){var o=unescape(n[0]),a=unescape(n[1]);a=a.replace(/\+/g," "),i[o]=a}}return i}function getTextWidth(e,i){var t=(getTextWidth.canvas||(getTextWidth.canvas=document.createElement("canvas"))).getContext("2d");return t.font=i,t.measureText(e).width}function kiwi_GETrequest(e,i,t){var r=w3_opt(t,"debug",0),n=document.createElement("iframe"),o=e+"_"+(new Date).toUTCString().substr(17,8);document.body.appendChild(n),n.style.display="none",n.contentWindow.name=o,w3_add(n,"id-kiwi_GETrequest");var a=document.createElement("form");return a.target=o,a.action=i,a.method="GET",w3_add(a,"id-kiwi_GETrequest"),r&&console.log("kiwi_GETrequest: "+o),{iframe:n,form:a,debug:r}}function kiwi_GETrequest_submit(e,i){var t=w3_opt(i,"no_submit",0),r=w3_opt(i,"gc",0);t?console.log("kiwi_GETrequest_submit: NO SUBMIT"):(document.body.appendChild(e.form),e.form.submit(),e.debug&&console.log("kiwi_GETrequest_submit: SUBMITTED")),r&&setTimeout(function(){document.body.removeChild(e.form),document.body.removeChild(e.iframe)},6e4)}function kiwi_GETrequest_param(e,i,t){var r=document.createElement("input");r.type="hidden",r.name=i,r.value=t,e.form.appendChild(r),e.debug&&console.log("kiwi_GETrequest_param: "+i+"="+t)}var ajax_state={DONE:4};function kiwi_ajax(e,i,t,r,n){kiwi_ajax_prim("GET",null,e,i,t,r,void 0,void 0,n)}function kiwi_ajax_progress(e,i,t,r,n,o,a){kiwi_ajax_prim("GET",null,e,i,t,r,n,o,a)}function kiwi_ajax_send(e,i,t,r,n,o){kiwi_ajax_prim("PUT",e,i,t,r,n,void 0,void 0,o)}var ajax_id=0,ajax_requests={};function kiwi_ajax_prim(e,i,t,r,n,o,a,s,l){var c;ajax_id++;var u=function(e){l&&console.log(e)};try{c=new XMLHttpRequest}catch(e){try{c=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{c=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}}}return c.kiwi_id=ajax_id,ajax_requests[ajax_id]={},ajax_requests[ajax_id].didTimeout=!1,ajax_requests[ajax_id].timer=-1,(o=o||0)&&(ajax_requests[ajax_id].timer=setTimeout(function(){var e=c.kiwi_id;ajax_requests[e].didTimeout=!0,ajax_requests[e].timer=-1,console.log("$AJAX TIMEOUT url="+t);w3_call(r,{AJAX_error:"timeout"},n),c.abort(),delete ajax_requests[e]},Math.abs(o))),a&&(u("AJAX with progress_cb="+a),c.onprogress=function(){var e=c.responseText.toString()||"";u("XHR.onprogress="+e),w3_call(a,e,s)}),c.onerror=function(e){u("XHR.onerror="+e),l&&console.log(e)},c.onabort=function(e){u("XHR.onabort="+e),l&&console.log(e)},c.onload=function(e){u("XHR.onload="+e),l&&console.log(e)},c.onloadstart=function(e){u("XHR.onloadstart="+e),l&&console.log(e)},c.onreadystatechange=function(){if(u("XHR.onreadystatechange readyState="+c.readyState),c.readyState!=ajax_state.DONE)return!1;var e=c.kiwi_id,i=ajax_requests[e].timer;if(u("AJAX ORSC ENTER recovered id="+e+" timer="+i+" cb="+r),-1!=i&&(u("AJAX ORSC CLEAR_TIMER recovered id="+e+" timer="+i),kiwi_clearTimeout(i),ajax_requests[e].timer=-1),ajax_requests[e].didTimeout)u("AJAX ORSC TIMED_OUT recovered id="+e);else{var o;if(u("XHR.status="+c.status),u("XHR.statusText="+c.statusText),u("XHR.responseType="+c.responseType),u("XHR.response="+c.response),u("XHR.responseText="+c.responseText),u("XHR.responseURL="+c.responseURL),l&&console.log(c),200!=c.status)console.log("$AJAX BAD STATUS="+c.status+" url="+t),o={AJAX_error:"status",status:c.status};else{var a=c.responseText.toString();if(null==a&&(a=""),a.startsWith("<?xml"))o={XML:!0,text:a};else{var s=a.charAt(0);if("{"==s||"["==s||s>="0"&&s<="9")try{a=kiwi_remove_cjson_comments(a),o=JSON.parse(a),u("AJAX JSON response:"),u(a),u(o)}catch(e){u("AJAX response JSON.parse failed: <"+a+">"),u(e),o={AJAX_error:"JSON parse",JSON_ex:e.toString(),response:a}}else u("AJAX: response didn't begin with JSON '{', '[' or digit? "+a),o={AJAX_error:"JSON prefix",response:a}}}u("AJAX ORSC CALLBACK recovered id="+e+" callback="+typeof r),w3_call(r,o,n)}u("AJAX ORSC ABORT/DELETE"),c.abort(),delete ajax_requests[e]},o>=0&&(c.open(e,t,!0),u("AJAX SEND id="+ajax_id+" url="+t),c.send(i)),!0}function kiwi_remove_cjson_comments(e){for(var i,t;-1!=(i=e.indexOf("\n//"));)t=e.indexOf("\n",i+3),e=e.slice(0,i)+e.slice(t),!0;return e}function kiwi_scrollbar_width(){return kiwi_isMacOS()?10:15}function kiwi_strip_tags(e,i){i=(((i||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(e,t){return i.indexOf("<"+t.toLowerCase()+">")>-1?e:""})}function kiwi_pie(e,i,t,r){var n=2*i;return'<svg width="'+n+'" height="'+n+'" viewbox="0 0 '+n+" "+n+'"><circle cx="'+i+'" cy="'+i+'" r="'+i+'" fill="'+t+'" /><path class="'+e+'" style="fill:'+r+'" transform="translate('+i+", "+i+')" /></svg>'}function kiwi_draw_pie(e,i,t){var r=360*t,n=r*Math.PI/180,o=Math.sin(n)*i,a=Math.cos(n)*-i,s=r>=180?1:0;360==r&&(s=1,o=-.1,a=-i);var l="M 0 0 v "+-i+" A "+i+" "+i+" 1 "+s+" 1 "+o+" "+a+" z";w3_iterate_classname(e,function(e){e.setAttribute("d",l)})}function enc(e){return e.replace(/./gi,function(e){return String.fromCharCode(3^e.charCodeAt(0))})}var sendmail=function(e,i){var t="mailto:"+enc(decodeURIComponent(e))+(isDefined(i)?"?subject="+i:"");window.location.href=t};function line_stroke(e,i,t,r,n,o,a,s){var l=Math.floor(t/2),c=i?t:a-n+1,u=i?s-o+1:t,_=n-(i?l:0),f=o-(i?0:l);e.fillStyle=r,e.fillRect(_,f,c,u)}var wsockets=[];function msg_send(e){for(var i=0;i<wsockets.length;i++){var t=wsockets[i].ws;if(t.up)try{return t.send(e),0}catch(i){return console.log("CATCH msg_send('"+e+"') ex="+i),kiwi_trace(),-1}}return-1}function open_websocket(e,i,t,r,n,o,a){if(!("WebSocket"in window&&"CLOSING"in WebSocket))return console.log("WEBSOCKET TEST"),kiwi_serious_error("Your browser does not support WebSocket, which is required for OpenWebRX to run. <br> Please use an HTML5 compatible browser."),null;var s=kiwi_url_origin().split("://")[1],l="ws://";"https:"===window.location.protocol&&(l="wss://");var c=window.location.href.includes("?no_wf")||window.location.href.includes("&no_wf");s=l+s+"/"+(c?"no_wf/":"kiwi/")+timestamp+"/"+e,c&&(wf.no_wf=!0);var u=new WebSocket(s);return wsockets.push({ws:u,name:e}),u.up=!1,u.stream=e,u.open_cb=i,u.open_cb_param=t,u.msg_cb=r,u.recv_cb=n,u.error_cb=o,u.close_cb=a,u.onopen=function(){if(u.up=!0,u.open_cb)try{u.open_cb(u.open_cb_param)}catch(e){console.log(e)}},u.onmessage=function(e){on_ws_recv(e,u)},u.onclose=function(e){if(u.up=!1,console.log("WS-CLOSE: "+u.stream),u.close_cb)try{u.close_cb(u)}catch(e){console.log(e)}},u.binaryType="arraybuffer",u.onerror=function(e){if(u.error_cb)try{u.error_cb(e,u)}catch(e){console.log(e)}},u}var kiwi_flush_recv_input=!0;function recv_websocket(e,i){"SND"!=e.stream&&"W/F"!=e.stream&&(e.recv_cb=i,null==i&&(kiwi_flush_recv_input=!0))}function on_ws_recv(e,i){var t=e.data;if(t instanceof ArrayBuffer){if(!seriousError){var r=arrayBufferToStringLen(t,3);if("CLI"!=r){var n=!1;if("MSG"==r){var o=arrayBufferToString(t);params=o.substring(4).split(" ");for(var a=0;a<params.length;a++){var s=params[a].split("=");"EXT"==i.stream&&"EXT-STOP-FLUSH-INPUT"==s[0]&&(kiwi_flush_recv_input=!1),0==(n=kiwi_msg(s,i))&&i.msg_cb&&(n=i.msg_cb(s,i)),0==n&&console.log(">>> "+i.stream+": message not claimed: "+params[a])}}else!i.recv_cb||"EXT"==i.stream&&0!=kiwi_flush_recv_input||(i.recv_cb(t,i,r),isDefined(kiwi_gc_recv)&&kiwi_gc_recv&&(t=null))}}}else console.log("on_ws_recv: not an ArrayBuffer?")}window.onbeforeunload=function(){var e;for(e=0;e<wsockets.length;e++){var i=wsockets[e].ws;i&&(i.onclose=function(){},i.close())}};




/* web/kiwi/w3_util.min.js */
var w3int={menu_cur_id:null,menu_active:!1,menu_debug:!1,menu_close_func:null,prev_menu_hover_el:null,_last_:0};function visible_block(){}var w3_console={};function w3int_console_replacer(e,n){return isUndefined(n)?"<undefined>":isNull(n)?"<null>":isFunction(n)?"<function>":"<"+n.toString()+">"}function w3_strip_quotes(e){return!isString(e)||-1==e.indexOf("'")&&-1==e.indexOf('"')?e:e.replace(/'/g,"").replace(/"/g,"")+" [quotes stripped]"}function w3_esc_dq(e){return isString(e)&&-1!=e.indexOf('"')?e.replace(/"/g,"&quot;"):e}function w3_call(e,n,t,i,l,r){var o=void 0;if(!isArg(e))return o;try{if(isString(e)){var _=getVarFromString(e);isFunction(_)&&(o=_(n,t,i,l,r))}else isFunction(e)?o=e(n,t,i,l,r):console.log("w3_call: func not a string or function")}catch(e){console.log("w3_call: while in func this exception occured:"),console.log(e)}return o}function w3_first_value(e){if(null==e)return"null";var n=typeof e;return"number"===n||"boolean"===n||"string"===n?e:isArray(e)?e[0]:"object"===n?w3_obj_seq_el(e,0):n}function w3_second_value(e){var n=null;return isArray(e)&&e.length>1&&e.length>1&&(n=e[1]),n}function w3_opt(e,n,t){return isDefined(e)&&isDefined(e[n])?e[n]:t}function w3_obj_num(e){return isUndefined(e)||isNull(e)||isObject(e)?e:isNumber(e)?{num:e}:isBoolean(e)?{num:e?1:0}:isString(e)?{num:parseFloat(e)}:e}function w3_obj_seq_el(e,n){var t=Object.keys(e);return!isNumber(n)||n<0||n>=t.length?null:e[t[n]]}function w3_obj_key_seq(e,n){var t=null;return Object.keys(e).forEach(function(e,i){e==n&&(t=i)}),t}function w3_array_el_seq(e,n){var t=null;return e.forEach(function(e,i){e==n&&(t=i)}),t}function w3_obj_enum(e,n,t){var i=w3_opt(t,"key_match",void 0),l=w3_opt(t,"value_match",void 0);Object.keys(e).forEach(function(t,r){var o=e[t];isDefined(i)?t==i&&n(t,r,o):isDefined(l)?o==l&&n(t,r,o):n(t,r,o)})}function w3_ext_param_array_match_str(e,n,t){var i=!1;return e.forEach(function(e,l){var r=e.toString().toLowerCase();!i&&r.startsWith(n)&&(t&&t(l,e.toString()),i=!0)}),i}function w3_ext_param_array_match_num(e,n,t){var i=!1;return e.forEach(function(e,l){var r=parseFloat(e);i||r!=n||(t&&t(l,n),i=!0)}),i}function w3_ext_param(e,n){var t=n.split(":"),i=n.toLowerCase().split(":");return e.startsWith(i[0])?(rv={match:!0},i.length>1?(rv.has_value=!0,rv.num=parseFloat(i[1]),rv.string=i[1],rv.string_case=t[1]):(rv.has_value=!1,rv.num=0,rv.string=""),rv):{match:!1}}function w3_clamp(e,n,t,i){if(isNaN(e))return isDefined(i)?i:Math.NaN;if(isObject(n)){var l=n;try{void 0===l.clamp?e=Math.max(l.min,Math.min(l.max,e)):(e<l.min||e>l.max)&&(e=l.clamp)}catch(e){return console.log("w3_clamp: bad obj:"),void console.log(l)}}else null==i?e=Math.max(n,Math.min(t,e)):(e<n||e>t)&&(e=i);return e}function w3_clamp3(e,n,t,i,l,r){return isNaN(e)?r:e<n?i:e>t?l:e}function w3_add_id(e,n){return""==(e=e||"")?"":(e=e.startsWith("id-")?e:"id-"+e)+(n=n||"")}function w3int_w3_el(e){if(!e||""==e)return null;var n=document.getElementById(e);return null==n&&null!=(n=document.getElementsByName(e))&&(n=n[0]),null==n&&null!=(n=document.getElementsByClassName(e))&&(n=n[0]),n}function w3int_w3_els(e){if(!e||""==e)return null;var n,t=document.getElementById(e);return null!=t?n=[t]:(null!=(t=document.getElementsByName(e))&&0!=t.length||(t=document.getElementsByClassName(e)),n=t),0==n.length&&(n=null),n}function w3_el(e){if(isString(e)){if(""==e)return null;if("body"==e)return document.body;var n=w3int_w3_el(e);return null==n&&null==(n=w3int_w3_el("id-"+e))&&null==(n=w3int_w3_el(e=w3_add_toplevel(e)))&&(n=w3int_w3_el("id-"+e)),n}return e}function w3_els(e,n){if(isString(e)){if(""==e)return null;if("body"==e)return document.body;var t=w3int_w3_els(e);if(null==t&&null==(t=w3int_w3_els("id-"+e))&&null==(t=w3int_w3_els(e=w3_add_toplevel(e)))&&(t=w3int_w3_els("id-"+e)),t&&n)for(var i=0;i<t.length;i++)n(t[i],i);return t}return w3_el(e)}function w3_id(e){var n=w3_el(e);if(!n)return null;if(n.id&&n.id.startsWith("id-"))return n.id;var t=!1,i=null;return w3_iterate_classList(n,function(e,n){e.startsWith("id-")&&!t&&(i=e,t=!0)}),i}function w3_innerHTML(e){var n=w3_el(e);if(!n)return null;for(var t="",i=arguments.length,l=1;l<i;l++)t+=arguments[l];return n.innerHTML=t,n}function w3_clearInnerHTML(e){w3_innerHTML(e,"")}function w3_append_innerHTML(e){var n=w3_el(e);if(!n)return null;for(var t="",i=arguments.length,l=1;l<i;l++)t+=arguments[l];return n.innerHTML+=t,n}function w3_get_innerHTML(e){var n=w3_el(e);return n?n.innerHTML:null}function w3_iterate_classname(e,n){var t=document.getElementsByClassName(e);if(null!=t)for(var i=0;i<t.length;i++)n(t[i],i)}function w3_iterate_classList(e,n){var t=w3_el(e);if(t&&t.classList)for(var i=0;i<t.classList.length;i++)n(t.classList.item(i),i);return t}function w3_create_appendElement(e,n,t){var i=document.createElement(n);return w3_innerHTML(i,t),w3_el(e).appendChild(i),i}function w3_iterate_parent(e,n){var t=w3_el(e),i=0;do{if(null!=n(t,i))break;t=t.parentNode,i++}while(t)}function w3_iterate_children(e,n){for(var t=w3_el(e),i=0;i<t.children.length;i++){n(t.children[i],i)}}function w3_iterateDeep_children(e,n){for(var t=w3_el(e),i=0;i<t.children.length;i++){var l=t.children[i];n(l),l.hasChildNodes&&w3_iterateDeep_children(l,n)}}function w3_iterate_childNodes(e,n){for(var t=w3_el(e),i=0;i<t.childNodes.length;i++){n(t.childNodes[i],i)}}function w3_boundingBox_children(e,n){var t={x1:1e99,x2:0,y1:1e99,y2:0,w:0,h:0};return w3_iterateDeep_children(e,function(e){if("DIV"==e.nodeName||"IMG"==e.nodeName){var i=css_style(e,"position");if("static"!=i&&0!=e.offsetHeight){n&&console.log(e),n&&console.log(e.nodeName+" el.oL="+e.offsetLeft+" el.oW="+e.offsetWidth+" el.oT="+e.offsetTop+" el.oH="+e.offsetHeight+" "+i),t.x1=Math.min(t.x1,e.offsetLeft);var l=e.offsetLeft+e.offsetWidth;t.x2=Math.max(t.x2,l),t.y1=Math.min(t.y1,e.offsetTop);var r=e.offsetTop+e.offsetHeight;t.y2=Math.max(t.y2,r)}}}),t.w=t.x2-t.x1,t.h=t.y2-t.y1,-1e99==t.w&&(t.w=t.h=0),n&&w3_console.log(t,"w3_boundingBox_children"),t}function w3_center_in_window(e,n){var t=w3_el(e);return window.innerHeight/2-t.clientHeight/2}function w3_field_select(e,n){var t=w3_el(e);if(t=t&&isFunction(t.select)?t:null){var i=0,l=0,r=0;n.mobile&&kiwi_isMobile()?r=1:i=l=1,n.blur&&(r=1),n.focus_select&&(i=l=1),n.focus_only&&(i=1,l=0),n.select_only&&(l=1),i&&t.focus(),l&&t.select(),r&&t.blur()}}function w3_add(e,n){if(!e)return null;var t=null,i=w3_el(e);return i?t?void 0:i&&n?((n=n.replace(/\s+/g," ").split(" ")).forEach(function(e){i.classList.add(e)}),t||(t=i),t):null:null}function w3_remove(e,n){if(!e)return null;var t=null,i=w3_el(e);return i?(t||(t=i),i&&n?((n=n.replace(/\s+/g," ").split(" ")).forEach(function(e){i.classList.remove(e)}),t):null):null}function w3_match_wildcard(e,n){var t=w3_el(e);if(!t)return null;for(var i=0;i<t.classList.length;i++){var l=t.classList.item(i);if(l.startsWith(n))return l}return!1}function w3_remove_wildcard(e,n){var t=w3_el(e);if(!t)return null;for(var i=0;i<t.classList.length;i++){var l=t.classList.item(i);l.startsWith(n)&&t.classList.remove(l)}return t}function w3_set_props(e,n,t){var i=w3_el(e);return i?((t=!isArg(t)||t)?w3_add(i,n):w3_remove(i,n),i):i}function w3_remove_then_add(e,n,t){w3_remove(e,n),w3_add(e,t)}function w3_contains(e,n){var t=w3_el(e);if(!t)return 0;var i=t.classList;return i&&i.contains(n)?1:0}function w3_parent_with(e,n){var t=w3_el(e);if(t){var i=null;return w3_iterate_parent(t,function(e){!i&&w3_contains(e,n)&&(i=e)}),i}}function w3_toggle(e,n){var t=w3_el(e);if(t)return w3_contains(t,n)?w3_remove(t,n):w3_add(t,n),t}function w3_appendAllClass(e,n){w3_iterate_classname(e,function(e){e.classList.add(n)})}function w3_setAllHref(e,n){w3_iterate_classname(e,function(e){e.href=n})}function w3_show(e,n){var t=w3_el(e);return t?(w3_remove(t,"w3-hide"),w3_add(t,n||"w3-show-inline-block"),t):t}function w3_create_attribute(e,n,t){var i=w3_el(e);if(null!=i){var l=document.createAttribute(n);l.value=t,i.setAttributeNode(l)}}function w3_attribute(e,n,t,i){var l=w3_el(e);if(null==l)return null;isUndefined(i)||1==i?l.setAttribute(n,t):l.removeAttribute(n)}function w3_show_block(e){return w3_show(e,"w3-show-block")}function w3_show_inline_block(e){return w3_show(e,"w3-show-inline-block")}function w3_show_inline(e){return w3_show(e,"w3-show-inline-new")}function w3_show_table_cell(e){return w3_show(e,"w3-show-table-cell")}function w3_hide(e){var n;return(n=w3_el(e))?(w3_add(n=w3_iterate_classList(n,function(e,t){e.startsWith("w3-show-")&&w3_remove(n,e)}),"w3-hide"),n):n}function w3_hide2(e,n){var t=w3_el(e);return t?(w3_set_props(t,"w3-hide",n=!isArg(n)||n),t):t}function w3_show_hide(e,n,t){return n?w3_show(e,t||"w3-show-block"):w3_hide(e)}function w3_show_hide_inline(e,n){w3_show_hide(e,n,"w3-show-inline-new")}function w3_disable(e,n){w3_set_props(e,"w3-disabled",n)}function w3_visible(e,n){var t=w3_el(e);return t.style.visibility=n?"visible":"hidden",t}function w3_isVisible(e){var n=w3_el(e);return n?"visible"==n.style.visibility:null}w3_console.log=function(e,n){var t=n?n+": ":"";if(isString(e))t+='"'+e.toString()+'"';else if(isObject(e)){console.log(e);var i="JSON "+JSON.stringify(e,w3int_console_replacer);i.includes("\n")&&(i=JSON.stringify(e,w3int_console_replacer,1)),t+=i}else t+=e.toString();console.log(t)};var w3_highlight_time=250,w3_highlight_color="w3-selection-green",w3_selection_green="#4CAF50";function w3_highlight(e){var n=w3_el(e);w3_add(n,n.w3int_highlight_color||w3_highlight_color)}function w3_unhighlight(e){var n=w3_el(e);w3_remove(n,n.w3int_highlight_color||w3_highlight_color)}function w3_isHighlighted(e){var n=w3_el(e);return w3_contains(n,n.w3int_highlight_color||w3_highlight_color)}function w3_schedule_highlight(e){var n=w3_el(e);w3_highlight(n),setTimeout(function(){w3_unhighlight(n)},w3_highlight_time)}function w3_set_highlight_color(e,n){var t=w3_el(e);return t?(w3_isHighlighted(t)?(w3_unhighlight(t),t.w3int_highlight_color=n,w3_highlight(t)):t.w3int_highlight_color=n,t):null}var w3_flag_color="w3-override-yellow";function w3_flag(e){w3_add(w3_el(e),w3_flag_color)}function w3_unflag(e){w3_remove(w3_el(e),w3_flag_color)}function w3_color(e,n,t,i){var l=w3_el(e);if(!l)return null;var r=l.style.color,o=l.style.backgroundColor;return i=isUndefined(i)||i,isArg(n)&&(l.style.color=i?n:""),isArg(t)&&(l.style.backgroundColor=i?t:""),{color:r,backgroundColor:o}}function w3_background_color(e,n){var t=w3_el(e),i=t.style.backgroundColor;return null!=n&&null!=n&&(t.style.backgroundColor=n),i}function w3_colors(e,n){var t=w3_el(e);if(!t)return null;var i=n?n.split(","):null,l=null,r=null;i&&i.length>0&&(l=i[0]),i&&i.length>1&&(r=i[1]),l&&l.startsWith("w3-")?w3_add(t,l):t.style.backgroundColor=l,r&&r.startsWith("w3-")?w3_add(t,r):t.style.color=r}function w3_flip_colors(e,n,t){var i=w3_el(e);if(!i)return null;var l=n?n.split(" "):null;if(!l||2!=l.length)return null;w3_remove(i,l[0]),w3_remove(i,l[1]),w3_add(i,l[t?1:0])}function w3_fg_color_with_opacity_against_bk_color(e,n,t){var i=w3color(e);if(!i.valid)return null;var l=w3color(t);if(!l.valid)return null;var r=1-n,o=Math.round(n*i.red+r*l.red),_=Math.round(n*i.green+r*l.green),a=Math.round(n*i.blue+r*l.blue);return w3color(kiwi_rgb(o,_,a))}function w3_flash_fade(e,n,t,i,l){var r=w3_el(e);return r?(r.style.transition="background 0s",r.style.background=n,setTimeout(function(){r.style.transition="background "+(i?i/1e3:.3)+"s linear",r.style.background=isString(l)?l:"black"},t||50),r):r}function w3_fillText_shadow(e,n,t,i,l,r,o,_){_=_||Math.floor(r/3);var a=e.getContext("2d");a.font=px(r)+" "+l,a.miterLimit=2,a.lineJoin="circle",a.strokeStyle="black",a.lineWidth=_,a.strokeText(n,t,i),a.fillStyle=o,a.lineWidth=1,a.fillText(n,t,i)}function w3_fillText(e,n,t,i,l,r,o,_,a){l&&(e.fillStyle=l),r&&(e.font=r),o&&(e.lineWidth=o),_&&(e.textAlign=_),a&&(e.textBaseline=a);var c=e.measureText(i).width;e.fillText(i,n-c/2,t)}function w3_check_restart_reboot(e){var n=w3_el(e);n&&w3_iterate_parent(n,function(e){return w3_contains(e,"w3-restart")?(w3_restart_cb(),e):w3_contains(e,"w3-reboot")?(w3_reboot_cb(),e):null})}function w3_set_value(e,n){var t=w3_el(e);t&&(t.value=n)}function w3_set_decoded_value(e,n){w3_set_value(e,kiwi_decodeURIComponent("w3_set_decoded_value:"+e,n))}function w3_get_value(e){var n=w3_el(e);return n?n.value:null}function w3_add_toplevel(e){return e.startsWith("cfg.")||e.startsWith("adm.")?e:"cfg."+e}function w3_not_toplevel(e){return e.startsWith("cfg.")||e.startsWith("adm.")?e.substr(e.indexOf(".")+1):e}function w3_basename(e){var n=e.lastIndexOf(".");return n>=0?e.substr(n+1):e}function w3_psa3(e){e=e||"",a=e.split("/");var n=(a[0]||"").replace("&slash;","/"),t=(a[1]||"").replace("&slash;","/"),i=(a[2]||"").replace("&slash;","/");return 1==a.length?{left:"",middle:"",right:n}:2==a.length?{left:"",middle:n,right:t}:3==a.length?{left:n,middle:t,right:i}:{left:"",middle:"",right:""}}function w3_sb(){for(var e=[],n=0;n<arguments.length;n++){var t=arguments[n];""!=(t=isString(t)?t.trim():"")&&e.push(t)}return e.length?e.join(" "):""}function w3_sbc(e){for(var n=[],t=1;t<arguments.length;t++){var i=arguments[t];""!=(i=isString(i)?i.trim():"")&&n.push(i)}return n.length?n.join(e):""}function w3_sbew(e){for(var n=[],t=1;t<arguments.length;t++){var i=arguments[t];""!=(i=isString(i)?i.trim():"")&&(i[i.length-1]!=e&&(i+=e),n.push(i))}return n.length?n.join(" "):""}function w3_psa(e,n,t,i){if(e&&e.startsWith("class="))return e;var l=e?e.split("|"):[];e="";var r=l[0]||"";n&&(r=w3_sb(r,n)),""!=r&&(e="class="+dq(r));var o=l[1]||"";t&&(o=w3_sbew(";",o,t)),""!=o&&(e=w3_sb(e,"style="+dq(o)));var _=(l[2]||"").replace("&vbar;","|");return i&&(_=w3_sb(_,i)),""!=_&&(e=w3_sb(e,_)),e}function w3_psa_mix(e,n,t,i){var l=e.includes("w3-dump");l&&console.log("--- w3_psa_mix psa="+e);var r=e?e.split("|"):[],o=r[0]||"";l&&console.log("prop=["+o+"]"),l&&console.log("extra_prop=["+n+"]"),n&&(o=w3_sb(o,n)),l&&console.log("mixed prop=["+o+"]");var _=r[1]||"";l&&console.log("style=["+_+"]"),l&&console.log("extra_style=["+t+"]"),t&&(_=w3_sbew(";",_,t)),l&&console.log("mixed style=["+_+"]");var a=r[2]||"";return l&&console.log("attr=["+a+"]"),l&&console.log("extra_attr=["+i+"]"),i&&(a=w3_sb(a,i)),l&&console.log("mixed attr=["+a+"]"),e=o+"|"+_+"|"+a,l&&console.log("mix_out=["+e+"]"),e}function w3int_init(){}function w3int_post_action(){w3_call("freqset_select")}function w3_copy_to_clipboard(e){var n=document.createElement("input");n.setAttribute("type","text"),n.setAttribute("value",e),document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}function w3_isScrolling(e){var n=w3_el(e);return n?n.scrollHeight>n.clientHeight:null}function w3_isScrolledDown(e){var n=w3_el(e);return n?Math.abs(n.scrollHeight-n.clientHeight-n.scrollTop)<1:null}function w3_scrolledPosition(e){var n=w3_el(e);if(!n)return null;if(0==n.clientHeight)return-1;var t=n.scrollHeight-n.clientHeight;return t<=0?0:n.scrollTop/t}function w3_scrollTo(e,n,t){var i=w3_el(e);if(!i)return null;var l=i.scrollHeight-i.clientHeight;l<0&&(l=0);var r=l*n,o=r==i.scrollTop;return i.scrollTop=r,1==t&&(i.scrollTop=r+1,i.scrollTop=r),o}function w3_scrollDown(e,n){var t=w3_el(e);return isArg(n)&&!n||(t.scrollTop=t.scrollHeight),t}function w3_scrollTop(e,n){var t=w3_el(e);return isArg(n)&&!n||(t.scrollTop=0),t}function w3_do_when_rendered(e,n,t,i){var l=w3_el(e);i=isNumber(i)?i:500,isArg(l)?n(l,t):setTimeout(function(){w3_do_when_rendered(e,n,t,i)},i)}function w3_do_when_cond(e,n,t,i){i=isNumber(i)?i:500,e()?n(t):setTimeout(function(){w3_do_when_cond(e,n,t,i)},i)}function w3_hr(e){for(var n="<hr "+w3_psa(e)+">",t=arguments.length,i=1;i<t;i++)n+=arguments[i];return n}function w3_click_nav(e,n,t){var i="id-nav-"+e,l=null,r=null,o=null;w3_iterate_children(w3_el(i).parentNode,function(e,n){"A"==e.nodeName&&(w3_contains(e,"w3int-cur-sel")&&(l=e.id.substring(7),w3_remove(e,"w3int-cur-sel"),w3_iterate_classList(e,function(e,n){e.startsWith("id-nav-cb-")&&(o=e.substring(10))})),e.id==i&&(r=e))}),l&&w3_toggle(l,"w3-show-block"),l&&o&&w3_call(o+"_blur",l),r&&(w3_add(r,"w3int-cur-sel"),w3_check_restart_reboot(r)),w3_toggle(e,"w3-show-block"),"null"!=n&&w3_call(n+"_focus",e,t)}function w3int_anchor(e,n,t,i,l){return void 0===i&&(i=t),"<a "+w3_psa(e,(i?"id-nav-cb-"+i:"")+(l?" w3int-cur-sel":""),"",'id="id-nav-'+t+'" onclick="w3_click_nav('+sq(t)+", "+sq(i)+')"')+' href="javascript:void(0)">'+n+"</a>"}function w3_navbar(e){for(var n="<nav "+w3_psa(e,"w3-navbar")+">",t=arguments.length,i=1;i<t;i++)n+=arguments[i];return n+="</nav>"}function w3_sidenav(e){for(var n="<nav "+w3_psa(e,"w3-sidenav w3-static w3-left w3-sidenav-full-height w3-light-grey")+">",t=arguments.length,i=1;i<t;i++)n+=arguments[i];return n+="</nav>"}function w3_nav(e,n,t,i,l){return w3int_anchor(e,n,t,i,l)}function w3_navdef(e,n,t,i){return setTimeout(function(){w3_toggle(t,"w3-show-block")},w3_highlight_time),w3int_anchor(e,n,t,i,!0)}function w3_label(e,n,t,i){return arguments.length>=4&&console.log("### w3_label ext="+i),n=n||"",i=i||"",""==(e=e||"")&&""==n&&""==i?"":n.startsWith("<label ")?n:"<label "+w3_psa(e,w3_add_id(t,"-label"))+">"+n+i+"</label>"}function w3_get_label(e,n){return w3_get_innerHTML(w3_add_id(n,"-label"))}function w3_set_label(e,n){w3_innerHTML(w3_add_id(n,"-label"),e)}function w3_title(e,n){var t=w3_el(e);return t?(w3_attribute(t,"title",n),t):null}function w3int_link_click(e,n,t){console.log("w3int_link_click cb="+n+" cb_param="+t),console.log(e);var i=e.currentTarget;console.log(i),w3_check_restart_reboot(i),n&&w3_call(n,i,t,!1),w3int_post_action()}function w3_link(e,n,t,i,l,r){var o,_=n;n.startsWith("javascript:")?o="":(""==n||n.startsWith("http://")||n.startsWith("https://")||(_="http://"+n),o=' target="_blank"'),t=t||"",""!=(i=i||"")&&(i=" title="+dq(i));var a=l&&""!=l?"w3-pointer":"";r=r||0;var c=l?' onclick="w3int_link_click(event, '+sq(l)+", "+sq(r)+')"':"";return"<a "+w3_psa(e,a,"","href="+dq(_)+o+i+c)+">"+t+"</a>"}function w3_link_set(e,n){var t=w3_el(e);t&&""!=n&&(n.startsWith("http://")||n.startsWith("https://")||(n="http://"+n),w3_attribute(t,"href",n))}var w3_SELECTED=!0,w3_NOT_SELECTED=!1;function w3_radio_unhighlight(e){w3_iterate_classname("id-"+e,function(e){w3_unhighlight(e)})}function w3int_radio_click(e,n,t,i){w3_radio_unhighlight(n),w3_highlight(e.currentTarget);var l=-1;w3_iterate_classname("id-"+n,function(e,n){w3_isHighlighted(e)&&(l=n)}),w3_check_restart_reboot(e.currentTarget),t&&w3_call(t,n,l,!1,i),w3int_post_action()}function w3_radio_btn(e,n,t,i,l){l=arguments.length>4?arguments[4]:null;return'<button class="w3-btn w3-ext-btn'+(" id-"+n+(t?" "+w3_highlight_color:"")+(l?" "+l:""))+'" '+('onclick="w3int_radio_click(event, '+sq(n)+", "+sq(i)+')"')+">"+e+"</button>"}function w3_radio_button(e,n,t,i,l,r){r=r||0;var o=l?'onclick="w3int_radio_click(event, '+sq(t)+", "+sq(l)+", "+sq(r)+')"':"";return"<button "+w3_psa(e,"id-"+t+(i?" "+w3_highlight_color:"")+" w3-btn w3-ext-btn","",o)+">"+n+"</button>"}function w3_radio_button_get_param(e,n,t,i,l,r,o){return w3_radio_button(e,n,t,ext_get_cfg_param(t,null==l?null:l)==i?w3_SELECTED:w3_NOT_SELECTED,r,o)}var w3_SWITCH_YES_IDX=0,w3_SWITCH_NO_IDX=1;function w3_switch(e,n,t,i,l,r,o){return w3_radio_button(w3_psa_mix(e,"w3int-switch-0"),n,i,l?1:0,r,o)+w3_radio_button(w3_psa_mix(e,"w3int-switch-1"),t,i,l?0:1,r,o)}function w3_switch_get_param(e,n,t,i,l,r,o,_){var a=ext_get_cfg_param(i,null==r?null:r)==l?w3_SELECTED:w3_NOT_SELECTED;return w3_radio_button(w3_psa_mix(e,"w3int-switch-0"),n,i,a?1:0,o,_)+w3_radio_button(w3_psa_mix(e,"w3int-switch-1"),t,i,a?0:1,o,_)}function w3_switch_set_value(e,n){var t="w3int-switch-"+n;w3_iterate_classname("id-"+e,function(e,n){w3_contains(e,t)&&e.click()})}function w3int_button_click(e,n,t,i){w3_contains(n,"w3-disabled")||(w3_check_restart_reboot(e.currentTarget),t&&w3_call(t,n,i,!1)),w3int_post_action()}var w3int_btn_grp_uniq=0;function w3_btn(e,n){return console.log("### DEPRECATED: w3_btn"),w3_button("",e,n)}function w3_cb_param_encode(e){return isArg(e)?isObject(e)?encodeURIComponent(JSON.stringify(e)):e:0}function w3_cb_param_decode(e){if(!isArg(e))return 0;var n;if(isString(e)&&"{"==(e=decodeURIComponent(e))[0]){try{n=JSON.parse(e)}catch(n){return e}return n}return e}function w3int_button(e,n,t,i,l){l=w3_cb_param_encode(l);var r=i?'onclick="w3int_button_click(event, '+sq(n)+", "+sq(i)+", "+sq(l)+')"':"";i&&e.includes("w3-momentary")&&(r+=' onmousedown="w3int_button_click(event, '+sq(n)+", "+sq(i)+', 0)"',r+=' ontouchstart="w3int_button_click(event, '+sq(n)+", "+sq(i)+', 0)"');var o=e.includes("w3-round")||e.includes("w3-circle")?"":" w3-round-large",_=w3_psa3(e),a=w3_psa(_.left),c=w3_psa(_.right,n+" w3-btn w3-ext-btn"+o,"",r);e.includes("w3-dump")&&(console.log("w3_button"),console.log(_),console.log("psa_outer="+a),console.log("psa_inner="+c));var s="<button "+c+">"+t+"</button>";return""!=a&&(s="<div "+a+">"+s+"</div>"),a.includes("w3-dump")&&console.log(s),s}function w3_button(e,n,t,i){var l="id-btn-grp-"+w3int_btn_grp_uniq.toString();return w3int_btn_grp_uniq++,w3int_button(e,l,n,t,i)}function w3_button_path(e,n,t,i,l){return w3int_button(e,n,t,i,l)}function w3_button_text(e,n,t,i){var l=w3_el(e);return l?(l.innerHTML=n,t&&(t.startsWith("w3-")?(w3_remove(l,i),w3_add(l,t)):l.style.color=t),l):null}function w3_icon(e,n,t,i,l,r){var o=l&&""!=l?" w3-pointer":"",_="id-btn-grp-"+w3int_btn_grp_uniq.toString();w3int_btn_grp_uniq++,r=r||0;var a=null;isNumber(t)&&t>=0?a=px(t):isString(t)&&(a=t),a=a?" font-size:"+a+";":"";var c=(i=i||"").split("|");i="",""!=c[0]&&(i=" color:"+c[0]+";"),c.length>=2&&""!=c[1]&&(i+=" background-color:"+c[1]+";");var s=l?'onclick="w3int_button_click(event, '+sq(_)+", "+sq(l)+", "+sq(r)+')"':"";return l&&e.includes("w3-momentary")&&(s+=' onmousedown="w3int_button_click(event, '+sq(_)+", "+sq(l)+', 0)"',s+=' ontouchstart="w3int_button_click(event, '+sq(_)+", "+sq(l)+', 0)"'),"<i "+w3_psa(e,_+o+" fa "+n,a+i,s)+"></i>"}function w3int_input_keydown(e,n,t){var i,l,r=e.key.toUpperCase(),o=e.ctrlKey,_=w3_el(n);if(_){var a=w3_contains(_,"w3-trace");a&&console.log("w3int_input_keydown k="+r+(o?" CTL ":"")+" val=<"+_.value+"> cb="+t);var c=t.split("|");o&&"CD\\".includes(r)&&c[1]&&w3_call(c[1],r);var s=w3_contains(_,"w3-input-any-change");if("Enter"==e.key)if(s){for(l=_.value,i=_.selectionStart;i<_.textLength&&"\n"==l.charAt(i);i++);if(i==_.textLength){for(;l.endsWith("\n");)l=l.slice(0,-1);w3_set_value(_,l)}a&&console.log("ss="+_.selectionStart+" se="+_.selectionEnd+" tl="+_.textLength),(_.selectionStart==_.selectionEnd&&_.selectionStart==_.textLength||0==_.selectionStart&&_.selectionEnd==_.textLength)&&(a&&console.log("w3_input_change..."),w3_input_change(n,t,"kd"))}else""==_.value&&w3_input_change(n,t,"kd");"Backspace"==e.key&&s&&0==_.selectionStart&&_.selectionEnd==_.value.length&&(_.value="",w3_input_change(n,t,"kd"))}}function w3int_input_keyup(e,n,t){}function w3_input_change(e,n,t){var i=w3_el(e);if(i&&(w3_contains(i,"w3-trace")&&console.log("w3_input_change path="+e),w3_check_restart_reboot(i),w3_schedule_highlight(i),n)){var l=n.split("|");isArg(t)&&l.push(t),w3_call(l[0],e,i.value,!1,l)}w3_contains(i,"w3-retain-input-focus")||w3_contains(i,"w3-ext-retain-input-focus")?w3_field_select(e,{mobile:1}):w3int_post_action()}function w3_input(e,n,t,i,l,r){var o=e.includes("w3-dump"),_=w3_add_id(t);l=l||"";var a=r?'placeholder="'+r+'"':"",c=e.includes("w3-custom-events"),s=' onchange="w3_input_change('+sq(t)+", "+sq(l)+", "+sq("ev")+')"',w=' onkeydown="w3int_input_keydown(event, '+sq(t)+", "+sq(l)+')"',u=' onkeyup="w3int_input_keyup(event, '+sq(t)+", "+sq(l)+')"',d=t&&!c?s+w+u:"";i=" value="+dq(w3_esc_dq(i)||"");var v=e.includes("w3-label-inline"),f=!e.includes("w3-label-not-bold"),h=""!=(n=n||"")&&v?"w3int-margin-input":"",g=w3_psa3(e);o&&console.log(g);var p=w3_psa(g.left,v?"w3-show-inline-new":""),m=w3_psa_mix(g.middle,""!=n&&f?"w3-bold":""),b=e.includes("w3-no-styling")?"":"w3-input w3-border w3-hover-shadow",x=g.right.includes("type=")?"":'type="text"',y=w3_psa(g.right,w3_sb(_,b,h),"",w3_sb(x,a));return o&&console.log("O:["+p+"] L:["+m+"] I:["+y+"]"),"<div "+p+">"+w3_label(m,n,t)+"<input id="+dq(_)+" "+y+i+d+"></div>"}function w3_input_get(e,n,t,i,l,r){var o=ext_get_cfg_param(t,null==l?null:l);return w3_input(e,n,t,o=kiwi_decodeURIComponent("w3_input_get:"+t,o),i,r)}function w3_input_get_param(e,n,t,i,l){var r=ext_get_cfg_param(n,null==i?null:i);return w3_input("",e,n,r=kiwi_decodeURIComponent("w3_input_get_param:"+n,r),t,l)}function w3_textarea(e,n,t,i,l,r,o){var _=w3_add_id(t),a=""!=n?" w3-margin-T-8":"",c=e.includes("w3-input-any-change")?"":' onchange="w3_input_change('+sq(t)+", "+sq(o)+')"',s=' onkeydown="w3int_input_keydown(event, '+sq(t)+", "+sq(o)+')"',w=' onkeyup="w3int_input_keyup(event, '+sq(t)+", "+sq(o)+')"',u=(i=i||"",!e.includes("w3-label-not-bold")),d=w3_psa3(e),v=w3_psa_mix(d.middle,""!=n&&u?"w3-bold":""),f=w3_psa(d.right,"w3-input w3-border w3-hover-shadow "+_+a,"","rows="+dq(l)+" cols="+dq(r));return w3_div(d.left,w3_label(v,n,t)+"<textarea "+f+c+s+w+">"+i+"</textarea>")}function w3_textarea_get_param(e,n,t,i,l,r,o){var _=ext_get_cfg_param(t,null==o?null:o);return w3_textarea(e,n,t,_=kiwi_decodeURIComponent("w3_textarea_get_param:"+t,_),i,l,r)}function w3int_checkbox_change(e,n,t){var i=w3_el(e);w3_check_restart_reboot(i),n&&(w3_schedule_highlight(i),w3_call(n,e,i.checked,!1,t)),w3_contains(i,"w3-retain-input-focus")||w3_contains(i,"w3-ext-retain-input-focus")?w3_field_select(e,{mobile:1}):w3int_post_action()}function w3_checkbox(e,n,t,i,l,r){var o=w3_add_id(t),_=' onchange="w3int_checkbox_change('+sq(t)+", "+sq(l)+", "+sq(r)+')"',a=i?" checked":"",c=e.includes("w3-label-inline"),s=e.includes("w3-label-left"),w=!e.includes("w3-label-not-bold"),u=""!=n&&c?s?" w3-margin-L-8":" w3-margin-R-8":"",d=w3_psa3(e),v=w3_psa(d.left,c?"w3-show-inline-new":""),f=w3_psa_mix(d.middle,""!=n&&w?"w3-bold":""),h=w3_psa(d.right,"w3-input w3-width-auto w3-border w3-pointer w3-hover-shadow "+o+u,"",'type="checkbox"'),g=w3_label(f,n,t),p="<input "+h+a+_+">",m="<div "+v+">"+(s?g+p:p+g)+"</div>";return l&&setTimeout(function(){w3_call(l,t,i,!0,r)},500),m}function w3_checkbox_get_param(e,n,t,i,l){return w3_checkbox(e,n,t,ext_get_cfg_param(t,null==l?null:l),i)}function w3_checkbox_get(e){var n=w3_el(e);if(n)return!!n.checked}function w3_checkbox_set(e,n){var t=w3_el(e);t&&(t.checked=!!n)}var W3_SELECT_SHOW_TITLE=-1;function w3int_select_change(e,n,t,i){var l=e.currentTarget;w3_check_restart_reboot(l),t&&w3_call(t,n,l.value,!1,i),w3int_post_action()}function w3int_select(e,n,t,i,l,r,o,_){var a=w3_add_id(i),c="";""!=t?t.split("<br>").forEach(function(e,n){c+='<option value="-1" '+(l==W3_SELECT_SHOW_TITLE&&0==n?"selected":"")+" disabled>"+e+"</option>"}):l==W3_SELECT_SHOW_TITLE&&(l=0);var s=e.includes("w3-label-inline"),w=!e.includes("w3-label-not-bold"),u=""==n||s?"":" w3-margin-T-8";s&&(u+=" w3-margin-left"),null==o&&(o="");var d='onchange="w3int_select_change(event, '+sq(i)+", "+sq(o)+", "+sq(_)+')"',v=w3_psa3(e),f=w3_psa(v.left,s?"w3-show-inline-new":""),h=w3_psa_mix(v.middle,""!=n&&w?"w3-bold":""),g=w3_psa(v.right,a+" w3-select-menu"+u,"",d),p="<div "+f+">"+w3_label(h,n,i)+(s||""==n?"":"<br>")+"<select "+g+">"+c+r+"</select></div>";return o&&l!=W3_SELECT_SHOW_TITLE&&setTimeout(function(){w3_call(o,i,l,!0,_)},500),p}function w3int_select_options(e,n,t){var i="";if(isString(n)){var l=n.split(":");if(2==l.length)for(var r=+l[0],o=+l[1],_=0,a=r;a<=o;a++)i+="<option value="+dq(_)+" "+(_==e?"selected":"")+">"+a+"</option>",_++}else isArray(n)?n.forEach(function(n,l){if(null!=n){if(isObject(n)){var r=isDefined(n.name);if(r&&!t&&""==n.name)return;n=r?n.name:w3_obj_seq_el(n,0)}i+="<option value="+dq(l)+" "+(l==e?"selected":"")+">"+n+"</option>"}}):isObject(n)&&w3_obj_enum(n,function(n,l,r){var o,_,a=!1;if(isObject(r)){o=isDefined(r.value)?r.value:l;var c=isDefined(r.name);if(c&&!t&&""==r.name)return;_=c?r.name:n,isDefined(r.disabled)&&r.disabled&&(a=!0)}else o=l,_=r;i+="<option value="+dq(o)+(l==e?" selected":"")+(a?" disabled":"")+">"+_+"</option>\n"});return null==e&&(i+="<option value=-1 selected disabled>(unknown)</option>\n"),i}function w3_select(e,n,t,i,l,r,o,_){var a=w3int_select_options(l,r,e.includes("w3-show-empty"));return e.includes("w3-dump")&&console.log(a),w3int_select(e,n,t,i,l,a,o,_)}function w3int_select_hier(e,n,t,i,l,r,o,_,a){var c="",s=0;if(isObject(o))return w3_obj_enum(o,function(e,n,t){isNumber(+e)||(as=e.split("_"),as.forEach(function(e){e&&""==e||(c+="<option value="+dq(s++)+" disabled>"+e+"</option> ")})),isArray(t)&&t.forEach(function(e,t){if(!(r&&t>=r)){var i=w3_first_value(e);if("null"!=i){var l=w3_second_value(e),o=l?" class="+dq(l):"";c+="<option value="+dq(s++)+' id="id-'+n+"-"+t+'"'+o+">"+i.toString()+"</option> "}}})}),w3int_select(e,n,t,i,l,c,_,a)}function w3_select_hier(e,n,t,i,l,r,o,_){return w3int_select_hier(e,n,t,i,l,0,r,o,_)}function w3_select_hier_collapse(e,n,t,i,l,r,o,_,a){return w3int_select_hier(e,n,t,i,l,r,o,_,a)}function w3_select_conditional(e,n,t,i,l,r,o,_){var a="",c=0;if(isArray(r))return r.forEach(function(e){isArray(e)&&(a+="<option value="+dq(c++)+" "+(e[1]?"":"disabled")+">"+e[0]+"</option> ")}),w3int_select(e,n,t,i,l,a,o,_)}function w3_select_set_disabled(e,n,t){w3_iterate_children("id-"+e,function(e,i){e.value==n&&(e.disabled=!!t)})}function w3_select_get_param(e,n,t,i,l,r,o){return w3_select(e,n,t,i,ext_get_cfg_param(i,null==o?0:o),l,r)}function w3_select_enum(e,n){(e=w3_el(e))&&w3_iterate_children(e,n)}function w3_select_value(e,n,t){if(w3_opt(t,"all"))w3_els(e,function(e){e.value=n});else{var i=w3_el(e);if(!i)return;i.value=n}}function w3_select_set_if_includes(e,n){var t=!1,i=RegExp(n);return w3_select_enum(e,function(n){i.test(n.innerHTML)&&(t||(w3_select_value(e,n.value),t=!0))}),t}function w3int_slider_change(e,n,t,i,l){var r=e.currentTarget;w3_check_restart_reboot(r),i&&w3_call(i,t,r.value,n,!1,l),n&&w3int_post_action()}function w3_slider_old(e,n,t,i,l,r,o){t=null==t?"":w3_strip_quotes(t);var _='oninput="w3int_slider_change(event, 0, '+sq(n)+", "+sq(o)+')" ',a='onchange="w3int_slider_change(event, 1, '+sq(n)+", "+sq(o)+')" ',c=w3_label("w3-bold",e,n)+'<br><input id="id-'+n+'" class="" value=\''+t+'\' type="range" min="'+i+'" max="'+l+'" step="'+r+'" '+_+a+">";return o&&setTimeout(function(){w3_call(o,n,t,!0,!0)},500),c}function w3_slider(e,n,t,i,l,r,o,_,a){var c=w3_add_id(t),s=e.includes("w3-label-inline"),w=!e.includes("w3-label-not-bold"),u=""!=n&&s?" w3-margin-L-8":"";s&&(u+=" w3-margin-left"),value=null==i?"":w3_strip_quotes(i),value="value="+dq(value),a=a||0;var d=' oninput="w3int_slider_change(event, 0, '+sq(t)+", "+sq(_)+", "+sq(a)+')"',v=' onchange="w3int_slider_change(event, 1, '+sq(t)+", "+sq(_)+", "+sq(a)+')"',f=w3_psa3(e),h=w3_psa(f.left,s?"w3-show-inline-new":""),g=w3_psa_mix(f.middle,""!=n&&w?"w3-bold":""),p=w3_psa(f.right,c+u,"",value+' type="range" min='+dq(l)+" max="+dq(r)+" step="+dq(o)+d+v),m="<div "+h+">"+w3_label(g,n,t)+(s||""==n?"":"<br>")+"<input "+p+"></div>";return _&&setTimeout(function(){w3_call(_,t,i,!0,!0,a)},500),m}function w3_slider_set(e,n,t){w3_set_value(e,n),w3_call(t,e,n,!0,!1)}function w3_slider_setup(e,n,t,i,l){var r=w3_el(e);return r?(r.min=n,r.max=t,r.step=i,r.value=l,r):r}function w3_menu(e,n){var t=e.replace(/\s+/g," ").split(" |")[0];n=n||"";var i="<div "+w3_psa(e,"w3-menu w3-menu-container w3-round-large","",'onclick="w3int_menu_onclick(event, '+sq(t)+", "+sq(n)+')" oncontextmenu="w3int_menu_onclick(event, '+sq(t)+", "+sq(n)+')"')+"></div>";w3_el("id-w3-main-container").innerHTML+=i}function w3_menu_items(e,n,t){w3int.menu_debug&&canvas_log("w3_menu_items cur="+w3int.menu_cur_id),w3_menu_close(),w3int.menu_cur_id=e;var i,l,r,o="",_=0;if(isArray(n))r=n;else{r=[];for(var a=1;a<arguments.length;a++)r.push(arguments[a])}w3int.menu_debug&&canvas_log("#="+r.length);for(a=0;a<r.length;a++){if(w3int.menu_debug&&canvas_log("i="+a+" "+r[a]),null!=r[a])i="w3-menu ",l="id="+dq(_),"<hr>"==r[a]?(i+="w3-menu-item-hr",_++):"!"==r[a].charAt(0)?(i+="w3-menu-item-disabled",r[a]=r[a].substr(1),_++):(i+="w3-menu-item",_++,kiwi_isMobile()||(i+=" w3-menu-item-hover")),o+=w3_div(w3_psa_mix("",i,"",l),r[a])}w3int.menu_debug&&canvas_log("s#="+o.length);var c=w3_el(e);c.innerHTML=o,w3int.menu_debug&&canvas_log("BUILD"),t=t||r.length,r.length>t?(c.style.height=px(27.5*t+16),w3_add(c,"w3-scroll-always-y")):(c.style.height="",w3_remove(c,"w3-scroll-always-y")),kiwi_isMobile()&&(mobile_laptop_test&&console.log("w3_menu_items MOBILE "+e),w3_iterate_children(e,function(e,n){e.addEventListener("touchmove",w3int_menu_touch_move,!1),mobile_laptop_test&&e.addEventListener("mousemove",w3int_menu_mouse_move,!1)}))}function w3int_menu_mouse_move(e){w3int_menu_move("MMM",Math.round(e.pageX),Math.round(e.pageY))}function w3int_menu_touch_move(e){w3int_menu_move("MTM",Math.round(e.touches[0].pageX),Math.round(e.touches[0].pageY))}function w3int_menu_move(e,n,t){var i=document.elementFromPoint(n,t);if(i&&!w3_isScrolling(w3int.menu_cur_id)){var l=!i||!w3_contains(i,"w3-menu-item");w3int.prev_menu_hover_el&&(l||i!=w3int.prev_menu_hover_el)&&(w3int.prev_menu_hover_el.style.background="",w3int.prev_menu_hover_el.style.color="",l)||(i.style.background="rgb(79, 157, 251)",i.style.color="white",w3int.prev_menu_hover_el=i)}}function w3_menu_popup(e,n,t,i){var l=w3_el(e);t=t||window.innerWidth/2,i=i||window.innerHeight/2;l.w3_realigned=!1,t+l.clientWidth+16>window.innerWidth&&(t=window.innerWidth-l.clientWidth-16,l.w3_realigned_time=Date.now(),l.w3_realigned=!0),l.style.left=px(t),i+l.clientHeight+16>window.innerHeight&&(i=window.innerHeight-l.clientHeight-16,l.w3_realigned_time=Date.now(),l.w3_realigned=!0),l.style.top=px(i),w3_visible(l,!0),w3int.menu_debug&&canvas_log("VIS"),w3int.menu_active=!0,l.w3_menu_x=t,w3int.menu_close_func=n,w3int.menu_first=!0,window.addEventListener("keyup",w3int_menu_event,!1),window.addEventListener("click",w3int_menu_event,!1)}function w3_menu_active(){return w3int.menu_active}function w3int_menu_onclick(e,n,t,i){w3int.menu_debug&&canvas_log("OC "+n+" "+i);var l=w3_el(n);if(l.w3_realigned){l.w3_realigned=!1;var r=Date.now()-l.w3_realigned_time;if(r<50)return w3int.menu_debug&&canvas_log("XRe"+r),cancelEvent(e);w3int.menu_debug&&canvas_log("XOK"+r)}if(w3_visible(l,!1),w3int.menu_debug&&canvas_log("NOT_VIS"),w3int.menu_active=!1,window.removeEventListener("keyup",w3int_menu_event,!1),window.removeEventListener("click",w3int_menu_event,!1),null!=e&&null!=t){var o=e.target.id,_=+o;(""==o||isNaN(_))&&(o=e.target.parentNode.id),_=+o,(""==o||isNaN(_))&&(_=-1),w3int.menu_debug&&canvas_log("CALL:"+_),w3_call(t,_,l.w3_menu_x,i)}if(null!=e)return w3int.menu_debug&&canvas_log("Enull"),cancelEvent(e)}function w3int_menu_event(e){if(w3int.menu_debug&&canvas_log("ME "+e.type),w3_el(w3int.menu_cur_id)&&w3int.menu_close_func){var n=w3int.menu_close_func(e,w3int.menu_first);w3int.menu_first=!1,w3int.menu_debug&&canvas_log("CLOSE="+n),n&&w3_menu_close()}}function w3_menu_close(){if(w3int.menu_cur_id){var e=w3_el(w3int.menu_cur_id);e&&(e.w3_realigned=!1,w3int_menu_onclick(null,w3int.menu_cur_id,null,1138),w3int.menu_cur_id=null)}}function w3_num_cb(e,n){var t=parseFloat(n);""==n&&(t=0),isNaN(t)&&(w3_set_value(e,0),t=0),setVarFromString(e,t)}function w3_bool_cb(e,n){v=+n,setVarFromString(e,v)}function w3_string_cb(e,n){setVarFromString(e,n.toString())}function w3_num_set_cfg_cb(e,n,t){var i=parseFloat(n);isNaN(i)&&(i=0),ext_set_cfg_param(e,i,null==t||!t)}function w3_int_set_cfg_cb(e,n,t){var i=parseInt(n);isNaN(i)&&(i=0),w3_set_value(e,i),ext_set_cfg_param(e,i,null==t||!t)}function w3_float_set_cfg_cb(e,n,t,i){var l=-1;if(i&&i.length>=2&&(l=+i[1],isNaN(l)&&(l=-1)),n=parseFloat(n),isNaN(n))n=ext_get_cfg_param(e);else{if(-1!=l){var r=n.toFixed(l);n=+r}ext_set_cfg_param(e,n,!0)}w3_set_value(e,n)}function w3_bool_set_cfg_cb(e,n,t){var i;i=1==n||1==n,ext_set_cfg_param(e,i,null==t||!t)}function w3_string_set_cfg_cb(e,n,t){var i=null==t||!t;ext_set_cfg_param(e,encodeURIComponent(n.toString()),i)}function w3_json_set_cfg_cb(e,n,t){ext_set_cfg_param(e,n,null==t||!t)}function w3_remove_trailing_index(e,n){n=n||"-";var t,i=new RegExp("(.*)"+n+"([-]?[0-9]+)").exec(e);return i?(t=i[2],i=i[1]):(t=null,i=e),{el:i,idx:t}}var w3_MENU_NEXT=1,w3_MENU_PREV=-1;function w3_select_next_prev_cb(e,n,t){dbgUs&&console.log("w3_select_next_prev_cb cb_param="+decodeURIComponent(n));var i=w3_cb_param_decode(n);if(isObject(i)){dbgUs&&console.log("w3_select_next_prev_cb dir="+i.dir+" id="+i.id);for(var l,r,o=0,_=0,a=0,c=0,s=0;null!=(r=w3_el(l=i.id+s));s++){var w=r.value;if(dbgUs&&console.log("menu_s="+l+" value="+w),-1!=w){w3_select_enum(l,function(e){var n=isUndefined(i.isNumeric)||1==i.isNumeric&&isNumber(parseInt(e.innerText));!e.disabled&&n&&(dbgUs&&console.log("consider val="+e.value+' "'+e.innerText+'" content_check='+n),_&&(a=e.value,_=0),e.value===w&&(c=o,_=1),o=e.value)});break}}dbgUs&&console.log("i="+s+" captured_prev="+c+" captured_next="+a),w=0,i.dir==w3_MENU_NEXT&&a&&(w=a),i.dir==w3_MENU_PREV&&c&&(w=c),dbgUs&&console.log("w3_select_next_prev_cb val="+w),w3_call(i.func,l,w,t)}else console.log("w3_select_next_prev_cb cb_param is not an object")}function w3_table(e){for(var n="<table "+w3_psa(e,"w3-table w3-table-default")+">",t=1;t<arguments.length;t++)n+=arguments[t];return n+="</table>"}function w3_table_heads(e){for(var n=w3_psa(e,"w3-table-head"),t="",i=1;i<arguments.length;i++)null!=arguments[i]&&(t+="<th "+n+">",t+=arguments[i],t+="</th>");return t}function w3_table_row(e){for(var n="<tr "+w3_psa(e,"w3-table-row")+">",t=1;t<arguments.length;t++)null!=arguments[t]&&(n+=arguments[t]);return n+="</tr>"}function w3_table_cells(e){for(var n=w3_psa(e,"w3-table-cell"),t="",i=1;i<arguments.length;i++)null!=arguments[i]&&(t+="<td "+n+">",t+=arguments[i],t+="</td>");return t}function w3_inline(e,n){var t=arguments.length;if(""==e&&""==n&&t>2){console.log("### w3_inline OLD API DEPRECATED");var i=Array.prototype.splice.call(arguments,0);return i.splice(0,1),w3_inline.apply(null,i)}for(var l=w3_psa3(e),r=w3_psa(l.middle,"w3-show-inline-new"),o=w3_psa(l.right),_="<div w3d-inlo "+r+">",a=1;a<t;a++){var c=arguments[a];if(c){var s=!1;c.startsWith("w3-")||c.startsWith("id-")?(e=w3_psa(l.right,c),c=arguments[++a],s=!0):e=o,""==l.right&&!s&&c.startsWith("<div ")?_+=c:_+="<div w3d-inli-"+(a-1)+" "+e+">"+c+"</div>"}}return _+="</div>"}function w3_inline_percent(e){for(var n=w3_psa3(e),t=w3_psa(n.middle,"w3-show-inline-new"),i=arguments.length,l=0,r=e.includes("w3-debug")?"w3_debug ":"",o=e.includes("w3-last-halign-end"),_="<div w3d-inlpo "+t+">",a=1;a<i;a+=2){var c;a+1<i?(c="flex-basis:"+arguments[a+1]+"%",l+=arguments[a+1]):c="flex-basis:"+(100-l)+"%",a==i-1&&o&&(r+="w3-flex w3-halign-end"),_+="<div w3d-inlpi-"+(a-1)/2+" "+w3_psa(n.right,r,c)+">"+arguments[a]+"</div>"}return _+="</div>"}function w3_div(e){for(var n="<div w3d-div "+w3_psa(e)+">",t=arguments.length,i=1;i<t;i++)n+=arguments[i];return n+="</div>"}function w3_span(e){for(var n="<div w3d-span "+w3_psa(e,"w3-show-span")+">",t=arguments.length,i=1;i<t;i++)n+=arguments[i];return n+="</div>"}function w3_divs(e,n){var t,i,l=arguments.length;if(""==e&&""==n)return console.log("### w3_divs OLD API 1 DEPRECATED"),t=w3_div.apply(null,Array.prototype.splice.call(arguments,1));if(""!=e&&""==n&&l>2)return console.log("### w3_divs OLD API 2 DEPRECATED"),(i=Array.prototype.splice.call(arguments,0)).splice(1,1),t=w3_div.apply(null,i);if(""==e&&n&&n.startsWith("w3-")&&l>2)return console.log("### w3_divs OLD API 3 DEPRECATED"),(i=Array.prototype.splice.call(arguments,0)).splice(0,1),t=w3_divs.apply(null,i);if(""!=e&&n&&n.startsWith("w3-")&&l>2)return console.log("### w3_divs OLD API 4 DEPRECATED"),(i=Array.prototype.splice.call(arguments,2)).splice(0,0,arguments[0]+"/"+arguments[1]),t=w3_divs.apply(null,i);var r=w3_psa3(e),o=w3_psa(r.middle),_=w3_psa(r.right);t="<div w3d-divso "+o+">";for(var a=1;a<l;a++)t+="<div w3d-divsi-"+(a-1)+" "+_+">"+arguments[a]+"</div>";return t+="</div>"}function w3_col_percent(e){for(var n=w3_psa3(e),t=w3_psa(n.middle,"w3-row"),i=arguments.length,l="<div w3d-colpo "+t+">",r=1;r<i;r+=2){var o,_;r+1<i?(o="w3-col",_="width:"+arguments[r+1]+"%"):(o="w3-rest",_=""),l+="<div w3d-colpi-"+(r-1)/2+" "+w3_psa(n.right,o,_)+">"+arguments[r]+"</div>"}return l+="</div>"}function w3_text(e,n){var t=e.includes("w3-padding")||e.includes("w3-nopad")?"":"padding:0 4px 0 0; ";return w3_div(w3_psa_mix(e,"w3-text",t+"background-color:inherit"),n||" ")}function w3_code(e,n){for(var t=arguments.length,i='<pre class="'+e+'"><code>',l=2;l<t;l++)i+='<div class="'+n+'">'+arguments[l]+"</div>";return i+="</code></pre>"}function w3_half(e,n,t,i,l,r){return null==l&&(l=""),null==r&&(r=""),'<div class="w3-row '+e+'"><div class="w3-col w3-half '+n+l+'">'+t+'</div><div class="w3-col w3-half '+n+r+'">'+(i||"")+"</div></div>"}function w3_third(e,n,t,i,l){return'<div class="w3-row '+e+'"><div class="w3-col w3-third '+n+'">'+t+'</div><div class="w3-col w3-third '+n+'">'+(i||"")+'</div><div class="w3-col w3-third '+n+'">'+(l||"")+"</div></div>"}function w3_quarter(e,n,t,i,l,r){return'<div class="w3-row '+e+'"><div class="w3-col w3-quarter '+n+'">'+t+'</div><div class="w3-col w3-quarter '+n+'">'+(i||"")+'</div><div class="w3-col w3-quarter '+n+'">'+(l||"")+'</div><div class="w3-col w3-quarter '+n+'">'+(r||"")+"</div></div>"}function w3_canvas(e,n,t,i){var l="",r=w3_opt(i,"pad",null),o=w3_opt(i,"pad_top",0),_=w3_opt(i,"pad_bottom",0);isNull(r)||(o=_=r),(r=o+_)&&(l+=sprintf(" padding-top:%dpx; padding-bottom:%dpx;",o,_));var a=w3_opt(i,"left","");""!=a&&(l+=sprintf(" left:%dpx;",a));var c=w3_opt(i,"right","");""!=c&&(l+=sprintf(" right:%dpx;",c));var s=w3_opt(i,"top","");return""!=s&&(l+=sprintf(" top:%dpx;",s)),l="<canvas "+w3_psa(e,null,"position:absolute;"+l,sprintf('width="%d" height="%d"',n,t))+"></canvas>"}




/* web/kiwi/monitor.min.js */
var monitor={init:!1};function kiwi_queue_cb(){kiwi.queued^=1,w3_innerHTML("id-queue-button",kiwi.queued?"Exit queue":"Enter queue"),kiwi.queued||w3_innerHTML("id-queue-pos",""),msg_send("SET MON_QSET="+(kiwi.queued?1:0))}function kiwi_monitor(){console.log("n_camp="+cfg.n_camp);var e=cfg.n_camp?"To camp (listen) to the audio of an existing connection <br>click on one of the channel links below.":"No audio camping allowed on this Kiwi.",i=w3_div("",w3_text("w3-text-black","All Kiwi channels busy. Click button to wait in queue for an available channel."),w3_inline("w3-margin-L-8 w3-margin-T-4/w3-margin-right w3-valign",w3_button("id-queue-button w3-medium w3-padding-smaller w3-green","Enter queue","kiwi_queue_cb"),w3_text("id-queue-pos w3-text-black"),w3_button("id-queue-button w3-medium w3-padding-smaller w3-yellow","Reload page","kiwi_queue_reload_cb")),w3_text("id-queue-status w3-margin-T-4 w3-text-black",""),w3_div("id-camp-container",w3_hr("w3-margin-16"),w3_text("w3-margin-T-4 w3-text-black w3-show-block",e),w3_text("id-camp-status w3-margin-T-4 w3-text-black","")),w3_hr("w3-margin-16"),w3_div("id-users-list w3-margin-T-10"));kiwi_show_msg(i),kiwi.unmuted_color="mediumSeaGreen",users_init({monitor:1}),pwd_prot=chan_no_pwd_true?rx_chans-chan_no_pwd_true:0,console.log("rx_chans="+rx_chans+" chan_no_pwd_true="+chan_no_pwd_true+" pwd_prot="+pwd_prot);var n=plural(pwd_prot," channel"),t=1==pwd_prot?"is":"are";pwd_prot?(i="<br>Note that "+pwd_prot+n+" on this Kiwi "+t+" password protected. <br>This is why you may see empty channels you cannot access.",w3_innerHTML("id-queue-status",i)):w3_innerHTML("id-queue-status",""),setInterval(function(){msg_send("SET keepalive"),kiwi.queued&&msg_send("SET MON_QPOS")},2500),ws_any().msg_cb=function(e){var i=e[1]?e[1].split(","):null;switch(e[0]){case"qpos":var n=i[0],t=i[1];+i[2]&&kiwi_queue_reload_cb();var a="";kiwi.queued&&(a+="You are "+n+" of "+t+" in queue."),w3_innerHTML("id-queue-pos",a);break;case"camp":var o=+i[0],_=+i[1];o?(monitor.init||(check_suspended_audio_state(),monitor.init=!0),a=w3_div("",w3_inline("w3-margin-T-4/w3-margin-right w3-valign",w3_text("id-queue-pos w3-text-black","Camping on RX"+_),w3_button("w3-medium w3-padding-smaller w3-red","Stop","kiwi_camp_stop_cb"),w3_slider("w3-margin-L-16/w3-label-inline w3-label-not-bold/","Volume","kiwi.volume",kiwi.volume,0,200,1,"setvolume"),w3_div('|background-color: #e0e0e0; padding:2px; border-radius:8px|title="mute"',w3_div("id-mute-no fa-stack|width:28px; color:"+kiwi.unmuted_color,w3_icon("","fa-volume-up fa-stack-2x fa-nudge-up",24,"inherit","toggle_or_set_mute")),w3_div("id-mute-yes fa-stack w3-hide|width:28px;color:magenta;",w3_icon("","fa-volume-off fa-stack-2x fa-nudge-left fa-nudge-up",24,"","toggle_or_set_mute"),w3_icon("","fa-times fa-right",12,"","toggle_or_set_mute"))))+w3_div("id-control-smeter w3-margin-T-4"))):(a="Too many campers on channel RX"+_,_=-1),kiwi_camp_update(_,a),-1!=_&&smeter_init(!0),toggle_or_set_mute(0);break;case"camp_stop":kiwi_camp_stop_cb();break;default:owrx_msg_cb(e)}}}function kiwi_queue_reload_cb(){var e=kiwi_remove_search_param(window.location.href,"camp");window.location.href=e}function kiwi_camp_update(e,i){w3_innerHTML("id-camp-status",i);for(var n=0;n<rx_chans;n++){var t=w3_el("id-user-"+n);w3_remove(t,"w3-green"),n==e&&w3_add(t,"w3-green")}}function camp(e,i,n,t){console.log("camp ch"+e),cfg.n_camp&&msg_send("SET MON_CAMP="+e)}function kiwi_camp_stop_cb(){console.log("camp STOP"),kiwi_camp_update(-1,""),msg_send("SET MON_CAMP=-1")}




/* web/openwebrx/openwebrx.min.js (web/openwebrx/openwebrx.js = Tue May 10 06:59:19 2022) */
var owrx={debug_drag:!1,height_top_bar_parts:67,hide_bars:0,HIDE_TOPBAR:1,HIDE_BANDBAR:2,HIDE_ALLBARS:3,cfg_loaded:!1,mobile:null,wf_snap:0,wf_cursor:"crosshair",last_pageX:0,last_pageY:0,mouse_freq:{},freq_memory_menu_shown:0,vfo_ab:0,vfo_first:!0,last_freq:-1,last_mode:"",last_locut:-1,last_hicut:-1,last_selected_band:0,last_mode_el:null,dseq:0,sMeter_dBm_biased:0,sMeter_dBm:0,smeter_interval:null,force_no_agc_thresh_smeter:!1,overload_mute:90,squelched_overload:!1,prev_squelched_overload:!1,touch_hold_pressed:!1,tuning_locked:0,dx_click_gid_last:void 0,sam_pll:1,sam_pll_s:["DX","med","fast"],chan_null:0,chan_null_s:["normal","null LSB","null USB"],ovld_mute:0,ovld_mute_s:["off","on"],scale_canvas:{mouse_out:!1,target:null,restore_visibility:[],restore_visibility_delay:500},canvas:{target:null,restore_visibility:[],restore_visibility_delay:500},__last:0},bandwidth,center_freq,wf_fft_size,cur_mode,wf_fps,wf_fps_max,ws_snd,ws_wf,spectrum_show=0,spectrum_param=-1,gen_freq=0,gen_attn=0,squelch_threshold=0,wf_rate="",wf_mm="",wf_compression=1,wf_interp=13,wf_winf=2,debug_v=0,sb_trace=0,kiwi_gc=1,kiwi_gc_snd=0,kiwi_gc_wf=-1,kiwi_gc_recv=-1,kiwi_gc_wspr=-1,override_ext=null,muted_initially=0,peak_initially=null,param_nocache=!1,nocache=!1,param_ctrace=!1,ctrace=!1,no_clk_corr=!1,override_pbw="",override_pbc="",nb_click=!1,no_geoloc=!1,force_mobile=!1,mobile_laptop_test=!1,user_url=null,freq_memory=[],wf_rates={0:0,off:0,1:1,"1hz":1,s:2,slow:2,m:3,med:3,f:4,fast:4},okay_wf_init=!1;function kiwi_main(){w3_do_when_cond(function(){return owrx.cfg_loaded},function(){kiwi_main_ready()},0,200)}function kiwi_main_ready(){override_freq=parseFloat(readCookie("last_freq")),override_mode=readCookie("last_mode"),override_zoom=parseFloat(readCookie("last_zoom")),override_9_10=parseFloat(readCookie("last_9_10")),override_max_dB=parseFloat(readCookie("last_max_dB")),override_min_dB=parseFloat(readCookie("last_min_dB")),setvolume(!0,readCookie("last_volume",50)),freq_memory_init(),console.log("LAST f="+override_freq+" m="+override_mode+" z="+override_zoom+" 9_10="+override_9_10+" min="+override_min_dB+" max="+override_max_dB);console.log("URL: "+window.location.href);var e=window.location.search&&window.location.search.substr(1),t=[],a=[];for(w=1;w<=16;w++){var _="&win"+(w+1)+"&";t[w]=e&&e.split(_)[0],e=e&&e.split(_)[1],a[w]=function(e){var t={};return e&&e.split("&").forEach(function(e){e=e.split("=");t[e[0]]=e[1]||1}),t}(t[w]),a[w].WID=w}var i=window.location.href.split("?")[0];for(g_qs_idx=2,w=2;w<=16;w++)t[w]&&setTimeout(function(){var e=i+"?"+t[g_qs_idx];g_qs_idx++,null==window.open(e,"_blank")&&alert("Do you have popups blocked for this site? "+e)},2e3*(w-1));var o,n="f";(e=a[1])[n]&&((o=parse_freq_pb_mode_zoom(e[n]))[1]&&(override_freq=o[1].replace(",",".").parseFloatWithUnits("M",.001)),o[1]&&console.log("p="+o[1]+" override_freq="+override_freq),o[2]&&console.log("override_pbw/pbc="+o[2]),o[2]&&"/"==o[2].charAt(0)&&(override_pbw=o[2].substr(1)),o[2]&&":"==o[2].charAt(0)&&(override_pbc=o[2].substr(1)),o[3]&&(override_mode=o[3].toLowerCase()),o[4]&&(override_zoom=+o[4])),e[n="ext"]&&isString(e[n])&&(o=e[n].split(","),override_ext=o[0],extint.param=o.slice(1).join(","),console.log("URL: ext="+override_ext+" ext_p="+extint.param)),e[n="pbw"]&&(override_pbw=e[n]),e[n="pb"]&&(override_pbw=e[n]),e[n="pbc"]&&(override_pbc=e[n]),e[n="sp"]&&(spectrum_show=e[n]),e[n="spec"]&&(spectrum_show=e[n]),e[n="spp"]&&(spectrum_param=parseFloat(e[n])),e[n="vol"]&&setvolume(!0,parseInt(e[n])),e[n="mute"]&&(muted_initially=parseInt(e[n])),e[n="wf"]&&(wf_rate=e[n]),e[n="wfm"]&&(wf_mm=e[n]),e[n="cmap"]&&(wf.cmap_override=w3_clamp(parseInt(e[n]),0,kiwi.cmap_s.length-1,0)),e[n="sqrt"]&&(wf.sqrt=w3_clamp(parseInt(e[n]),0,4,0)),e[n="wfts"]&&(wf.url_tstamp=w3_clamp(parseInt(e[n]),2,3600,2)),e[n="peak"]&&(peak_initially=parseInt(e[n])),e[n="no_geo"]&&(no_geoloc=!0),e[n="keys"]&&(shortcut.keys=e[n]),e[n="user"]&&(user_url=e[n]),e[n="u"]&&(user_url=e[n]),e[n="m"]&&(force_mobile=!0),e[n="mobile"]&&(force_mobile=!0),e[n="sqth"]&&(squelch_threshold=parseFloat(e[n])),e[n="click"]&&(nb_click=!0),e[n="nocache"]&&(param_nocache=!0,nocache=parseInt(e[n])),e[n="ncc"]&&(no_clk_corr=parseInt(e[n])),e[n="wfdly"]&&(waterfall_delay=parseFloat(e[n])),e[n="wf_comp"]&&(wf_compression=parseInt(e[n])),e[n="wfi"]&&(wf_interp=parseInt(e[n])),e[n="wfw"]&&(wf_winf=parseInt(e[n])),e[n="gen"]&&(gen_freq=e[n].parseFloatWithUnits("kM",.001)),e[n="attn"]&&(gen_attn=Math.abs(parseInt(e[n]))),e[n="blen"]&&(audio_buffer_min_length_sec=parseFloat(e[n])/1e3),e[n="audio"]&&(audio_meas_dly_ena=parseFloat(e[n])),e[n="gc"]&&(kiwi_gc=parseInt(e[n])),e[n="gc_snd"]&&(kiwi_gc_snd=parseInt(e[n])),e[n="gc_wf"]&&(kiwi_gc_wf=parseInt(e[n])),e[n="gc_recv"]&&(kiwi_gc_recv=parseInt(e[n])),e[n="gc_wspr"]&&(kiwi_gc_wspr=parseInt(e[n])),e[n="ctrace"]&&(param_ctrace=!0,ctrace=parseInt(e[n])),e[n="tmobile"]&&(mobile_laptop_test=!0),e[n="v"]&&console.log("URL: debug_v = "+(debug_v=e[n])),-1==kiwi_gc_snd&&(kiwi_gc_snd=kiwi_gc),-1==kiwi_gc_wf&&(kiwi_gc_wf=kiwi_gc),-1==kiwi_gc_recv&&(kiwi_gc_recv=kiwi_gc),-1==kiwi_gc_wspr&&(kiwi_gc_wspr=kiwi_gc),console.log("GC: snd="+kiwi_gc_snd+" wf="+kiwi_gc_wf+" recv="+kiwi_gc_recv+" wspr="+kiwi_gc_wspr),""!=wf_mm&&(wf_mm=wf_mm.split(","),s=parseInt(wf_mm[0]),!isNaN(s)&&-190<=s&&s<=-30&&(override_min_dB=s),2<=wf_mm.length&&(s=parseInt(wf_mm[1]),!isNaN(s)&&-100<=s&&s<=20&&(override_max_dB=s))),kiwi_xdLocalStorage_init(),kiwi_get_init_settings(),no_geoloc||kiwi_geolocate(),init_top_bar(),init_rx_photo(),right_click_menu_init(),freq_memory_menu_init(),keyboard_shortcut_init(),confirmation_panel_init(),ext_panel_init(),place_panels(),init_panels(),okay_wf_init=!0,confirmation_panel_init2(),smeter_init(),time_display_setup("id-topbar-right-container"),window.setInterval(send_keepalive,5e3),window.addEventListener("resize",openwebrx_resize),param_nocache&&console.log("### nocache="+(nocache?1:0)),param_ctrace&&console.log("### ctrace="+(ctrace?1:0)),snd_send("SERVER DE CLIENT openwebrx.js SND"),snd_send("SET dbug_v="+debug_v),w3_do_when_cond(function(){return isArg(rx_chan)&&owrx.cfg_loaded},function(){var e;0==rx_chan&&(0!=gen_attn&&(e=gen_attn+cfg.waterfall_cal,e=Math.pow(10,-e/20),gen_attn=131071*e),set_gen(gen_freq,gen_attn))},0,500);n=cfg.passbands[init_mode].lo;isNumber(n)||(n=-4e3);var s=cfg.passbands[init_mode].hi;isNumber(s)||(s=4e3),snd_send("SET mod="+init_mode+" low_cut="+n+" high_cut="+s+" freq="+init_frequency),set_agc(),snd_send("SET browser="+navigator.userAgent),wf_send("SERVER DE CLIENT openwebrx.js W/F"),wf_send("SET send_dB=1"),wf_send("SET zoom=0 start=0"),wf_send("SET maxdb=0 mindb=-100"),0==wf_compression&&wf_send("SET wf_comp=0"),0!=wf_interp&&wf_send("SET interp="+wf_interp),0!=wf_winf&&wf_send("SET window_func="+wf_winf),null==(wf_speed=wf_rates[wf_rate])&&(wf_speed=WF_SPEED_FAST),wf_send("SET wf_speed="+wf_speed)}var ptype={HIDE:0,POPUP:1,TOGGLE:2},popt={CLOSE:-1,PERSIST:0},visBorder=10,visIcon=24,readme_color="blueViolet",show_news=!1,news_color="#ff00bf";function init_panels(){init_panel_toggle(ptype.TOGGLE,"id-control",!1,popt.PERSIST);var e=updateCookie("readme","seen2");kiwi_isMobile()&&(e=!1),init_panel_toggle(ptype.TOGGLE,"id-readme",!1,e?popt.PERSIST:popt.CLOSE,readme_color);e=null==readCookie("news","seen");init_panel_toggle(ptype.POPUP,"id-news",!1,show_news&&e?popt.PERSIST:popt.CLOSE),init_panel_toggle(ptype.POPUP,"id-ext-controls",!1,popt.CLOSE),init_panel_toggle(ptype.POPUP,"id-confirmation",!1,popt.CLOSE)}function init_panel_toggle(e,t,a,_,i){var o=w3_el(t);o.ptype=e;var n=w3_el(t+"-vis");o.scrollable=1==a;var s=o.scrollable?-kiwi_scrollbar_width():visBorder,r="right"==o.getAttribute("data-panel-pos");o.panelShown=1,e==ptype.TOGGLE?(a=r?"right":"left",l=r?"left":"right",n.innerHTML='<a id="'+t+'-hide" onclick="toggle_panel('+sq(t)+');"><img src="icons/hide'+a+'.24.png" width="24" height="24" /></a><a id="'+t+'-show" class="class-vis-show" onclick="toggle_panel('+sq(t)+');"><img src="icons/hide'+l+'.24.png" width="24" height="24" /></a>'):n.innerHTML='<a id="'+t+'-close" onclick="toggle_panel('+sq(t)+');"><img id='+dq(t+"-close-img")+' src="icons/close.24.png" width="24" height="24" /></a>';var l=o.activeWidth-visIcon;r?n.style.right=px(0):n.style.left=px(l+s),n.style.top=px(visBorder),null!=_&&(0<_?setTimeout(function(){toggle_panel(t)},_):_==popt.CLOSE?toggle_panel(t):e==ptype.POPUP&&(o.style.visibility="visible")),null==i||null!=(e=w3_el(t+"-show"))&&(e.style.backgroundColor=e.style.borderColor=i),o.init=!0}function toggle_panel(e,t){var a=w3_el(e),_=w3_el(e+"-vis");if(isDefined(t)&&(a.panelShown=1^t),a.ptype==ptype.POPUP)return a.style.visibility=a.panelShown?"hidden":"visible",a.panelShown^=1,updateCookie(e,"seen"),void freqset_select();var i=a.activeWidth+30,t="right"==a.getAttribute("data-panel-pos"),i=-i,i=a.panelShown?(o=0,i):(o=i,kiwi_isMobile()?0:kiwi_scrollbar_width());"id-control"==e&&1==a.panel_isScaled&&a.panelShown&&mobile_scale_control_panel(null,!1),animate(a,t?"right":"left","px",o,i,.93,kiwi_isMobile()?1:1e3,60,0),w3_hide(e+"-"+(a.panelShown?"hide":"show")),w3_show_block(e+"-"+(a.panelShown?"show":"hide")),a.panelShown^=1;var o=a.activeWidth-visIcon,i=a.scrollable?-kiwi_scrollbar_width():visBorder;console.log("toggle_panel "+e+" right="+t+" shown="+a.panelShown),t?_.style.right=px(a.panelShown?0:o+visIcon+2*visBorder):_.style.left=px(o+(a.panelShown?i:visIcon+2*visBorder)),"id-control"==e&&1==a.panel_isScaled&&a.panelShown&&mobile_scale_control_panel(null,!0),freqset_select()}function openwebrx_resize(e){e=isString(e)&&e.startsWith("orient")?e:"event",resize_wf_canvases(),resize_waterfall_container(!0),extint_environment_changed({resize:1}),resize_scale(e),check_top_bar_congestion()}var offsetDiff_init=!1,p_left,p_owner,p_mid,p_right;function offsetDiff(e,t,a,_){var i=w3_el("id-tbar-"+e.toLowerCase()+"-bbox");i.style.left=px(a.x1),i.style.width=px(a.w),i.style.height=px(a.h),i.style.backgroundColor=t,console.log(e+" L/R/W="+a.x1+"/"+a.x2+"/"+a.w+" ("+(_.x1-a.x1)+"/"+(_.x2-a.x2)+"/"+(_.w-a.w)+")")}function check_top_bar_congestion(){var e=w3_boundingBox_children("id-left-info-container"),t=w3_boundingBox_children("id-mid-owner-container"),a=w3_boundingBox_children("id-mid-info-container"),_=w3_boundingBox_children("id-topbar-right-container"),i=e.x2+(a.x1-e.x2)/2-t.w/2;w3_el("id-owner-info").style.left=px(i),t=w3_boundingBox_children("id-mid-owner-container"),w3_visible("id-mid-owner-container",t.x1>=e.x2),w3_visible("id-mid-info-container",a.x1>=e.x2),w3_visible("id-topbar-right-container",_.x1>=e.x2),w3_el("id-rx-details-arrow").style.left=px(e.x2)}function init_top_bar(){w3_append_innerHTML("id-rx-desc",w3_link("id-rx-gmap","","[map]","","dont_toggle_rx_photo")+w3_div("id-rx-snr w3-show-inline"))}var rx_photo_spacer_height=owrx.height_top_bar_parts;function init_rx_photo(){w3_el("id-top-photo-img").style.paddingLeft=RX_PHOTO_LEFT_MARGIN?"50px":0,RX_PHOTO_HEIGHT+=rx_photo_spacer_height,w3_el("id-top-photo-clip").style.maxHeight=px(RX_PHOTO_HEIGHT),dbgUs||kiwi_isMobile()?close_rx_photo():window.setTimeout(function(){close_rx_photo()},3e3)}var rx_photo_state=1,scale_ctx,band_ctx,dx_ctx,pb_adj_cf,pb_adj_cf_ttip,pb_adj_lo,pb_adj_lo_ttip,pb_adj_hi,pb_adj_hi_ttip,pb_adj_car,pb_adj_car_ttip,scale_canvas,band_canvas,dx_div,dx_canvas;function open_rx_photo(){rx_photo_state=1,html("id-rx-photo-desc").style.opacity=1,html("id-rx-photo-title").style.opacity=1,animate_to(html("id-top-photo-clip"),"maxHeight","px",RX_PHOTO_HEIGHT,.93,kiwi_isMobile()?1:1e3,60,function(){resize_waterfall_container(!0)}),w3_hide("id-rx-details-arrow-down"),w3_show_block("id-rx-details-arrow-up")}function close_rx_photo(){rx_photo_state=0,animate_to(html("id-top-photo-clip"),"maxHeight","px",rx_photo_spacer_height,.93,kiwi_isMobile()?1:1e3,60,function(){resize_waterfall_container(!0)}),w3_show_block("id-rx-details-arrow-down"),w3_hide("id-rx-details-arrow-up")}function dont_toggle_rx_photo(){dont_toggle_rx_photo_flag=1}function toggle_rx_photo(){dont_toggle_rx_photo_flag?dont_toggle_rx_photo_flag=0:((rx_photo_state?close_rx_photo:open_rx_photo)(),freqset_select())}function animate(e,t,a,_,i,o,n,s,r){isUndefined(r)&&(r=0),e.style[t]=_.toString()+a,e.anim_i=0,n_of_iters=n/(1e3/s),n_of_iters<1&&(n_of_iters=1),change=(i-_)/n_of_iters,isDefined(e.anim_timer)&&window.clearInterval(e.anim_timer),e.anim_timer=window.setInterval(function(){e.anim_i++<n_of_iters?1==o?e.style[t]=(parseFloat(e.style[t])+change).toString()+a:(remain=parseFloat(e.style[t])-i,new_val=9<Math.abs(remain)||"px"!=a?i+o*remain:Math.abs(remain)<2?i:i+remain-remain/Math.abs(remain),e.style[t]=new_val.toString()+a):(e.style[t]=i.toString()+a,window.clearInterval(e.anim_timer),delete e.anim_timer),0!=r&&r()},1e3/s)}function animate_to(e,t,a,_,i,o,n,s){from=parseFloat(style_value(e,t)),animate(e,t,a,from,_,i,o,n,s)}function style_value(e,t){return(e.currentStyle||(window.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.style))[t]}function demodulators_get_next_color(){return demodulator_color_index>=demodulator_colors.length&&(demodulator_color_index=0),demodulator_colors[demodulator_color_index++]}function demod_envelope_draw(e,t,a,_,i){isUndefined(_)&&(_="lime");var o=scale_px_from_freq(t,e),t=scale_px_from_freq(a,e);t<o&&(a=t,t=o,o=a),pb_adj_cf.style.left=px(o),pb_adj_cf.style.width=px(t-o),pb_adj_lo.style.left=px(o-5-10),pb_adj_lo.style.width=px(20),pb_adj_hi.style.left=px(t-5),pb_adj_hi.style.width=px(20),o-=10,t+=10,scale_ctx.lineWidth=3,scale_ctx.strokeStyle=_,scale_ctx.fillStyle=_;_={envelope_on_screen:!1,line_on_screen:!1,allow_pb_adj:!1};return t<0||o>window.innerWidth||(_.beginning={x1:o,x2:o+5+5+5},_.ending={x1:t-5-5-5,x2:t},_.whole_envelope={x1:o,x2:t},_.envelope_on_screen=!0,_.allow_pb_adj=t-o>=(dbgUs?100:30),_.allow_pb_adj||(scale_ctx.strokeStyle=scale_ctx.fillStyle="yellow"),scale_ctx.beginPath(),scale_ctx.moveTo(o,17),scale_ctx.lineTo(o+5,17),scale_ctx.lineTo(o+5+5,5),scale_ctx.lineTo(t-5-5,5),scale_ctx.lineTo(t-5,17),scale_ctx.lineTo(t,17),scale_ctx.globalAlpha=.3,scale_ctx.fill(),scale_ctx.globalAlpha=1,scale_ctx.stroke()),isDefined(i)&&(line_px=scale_px_from_freq(i,e),line_px<0||line_px>window.innerWidth||(_.line={x1:line_px-4,x2:line_px+4},_.line_on_screen=!0,scale_ctx.moveTo(line_px,18),scale_ctx.lineTo(line_px,4),scale_ctx.stroke(),pb_adj_car.style.left=px(_.line.x1),pb_adj_car.style.width=px(8))),_}function demod_envelope_where_clicked(e,a,t,_){if(in_range=function(e,t){return t.x1<=e&&t.x2>=e&&a<scale_canvas_h/2},dr=demodulator.draggable_ranges,_.shiftKey){if(t.line_on_screen&&in_range(e,t.line))return dr.bfo;if(t.envelope_on_screen&&in_range(e,t.whole_envelope))return dr.pbs}if(_.altKey){if(t.envelope_on_screen&&in_range(e,t.beginning))return dr.bwlo;if(t.envelope_on_screen&&in_range(e,t.ending))return dr.bwhi}if(t.envelope_on_screen){if(t.allow_pb_adj){if(in_range(e,t.beginning))return dr.beginning;if(in_range(e,t.ending))return dr.ending}if(in_range(e,t.whole_envelope))return dr.anything_else}return dr.none}function demodulator_default_analog(e,t,a,_){null==cfg.passbands[t]&&(t="am"),demodulator.call(this,e),this.subtype=t,this.envelope.dragged_range=demodulator.draggable_ranges.none;e=audio_input_rate?audio_input_rate/2:5e3;this.filter={min_passband:4,high_cut_limit:e,low_cut_limit:-e},this.server_mode=t;var i,o,n,s,r,e=isNaN(a)?cfg.passbands[t].last_lo:a,a=isNaN(_)?cfg.passbands[t].last_hi:_;switch("undefined"!=e&&null!=e||(e=cfg.passbands[t].last_lo=cfg.passbands[t].lo),"undefined"!=a&&null!=a||(a=cfg.passbands[t].last_hi=cfg.passbands[t].hi),""!=override_pbw&&(s=e+(a-e)/2,o=this.filter.min_passband,n=(override_pbw=decodeURIComponent(override_pbw)).split(","),console.log("p.len="+n.length),i=n[0].parseFloatWithUnits("k"),console.log('nlo="'+n[0]+'" '+i),r=NaN,1<n.length&&(r=n[1].parseFloatWithUnits("k"),console.log('nhi="'+n[1]+'" '+i)),1==n.length&&!isNaN(i)&&o<=i?(e=s-i/2,a=s+i/2):2==n.length&&!isNaN(i)&&!isNaN(r)&&i<r&&o<=r-i&&(e=i,a=r),override_pbw="",extint.override_pb=!0),""!=override_pbc&&(_=(a-e)/2,o=this.filter.min_passband,s=(n=(override_pbc=decodeURIComponent(override_pbc)).split(","))[0].parseFloatWithUnits("k"),console.log('pbc="'+n[0]+'" '+i),r=NaN,1<n.length&&(r=n[1].parseFloatWithUnits("k"),console.log('pbw="'+n[1]+'" '+i)),1!=n.length||isNaN(s)?2==n.length&&!isNaN(s)&&!isNaN(r)&&o<=r&&(e=s-r/2,a=s+r/2):(e=s-_,a=s+_),override_pbc="",extint.override_pb=!0),this.low_cut=Math.max(e,this.filter.low_cut_limit),this.high_cut=Math.min(a,this.filter.high_cut_limit),this.usePBCenter=!1,this.isCW=!1,t){case"am":case"amn":case"sam":case"sal":case"sau":case"sas":case"qam":case"drm":case"nbfm":case"iq":break;case"lsb":case"lsn":case"usb":case"usn":this.usePBCenter=!0;break;case"cw":case"cwn":this.usePBCenter=!0,this.isCW=!0;break;default:console.log("DEMOD-new: unknown subtype="+t)}this.wait_for_timer=!1,this.set_after=!1,this.set=function(){this.wait_for_timer?this.set_after=!0:(this.doset(),this.set_after=!1,this.wait_for_timer=!0,timeout_this=this,window.setTimeout(function(){timeout_this.wait_for_timer=!1,timeout_this.set_after&&timeout_this.set()},demodulator_response_time))},this.doset=function(){var e=(freq_car_Hz/1e3).toFixed(3),t=this.server_mode,a=this.low_cut.toString(),_=this.high_cut.toString();snd_send("SET mod="+t+" low_cut="+a+" high_cut="+_+" freq="+e+("sam"==t?" param="+owrx.chan_null:""));var i=null;e!=owrx.last_freq&&((i=i||{}).freq=1,owrx.last_freq=e),t!=owrx.last_mode&&((i=i||{}).mode=1,owrx.last_mode=t),a==owrx.last_locut&&_==owrx.last_hicut||((i=i||{}).passband=1,owrx.last_locut=a,owrx.last_hicut=_),null!=i&&(i.passband_screen_location=1,extint_environment_changed(i)),muted_until_freq_set&&(toggle_or_set_mute(muted_initially),muted_until_freq_set=!1),audio_meas_dly_ena&&(audio_meas_dly_start=(new Date).getTime())},(this.envelope.parent=this).envelope.draw=function(e){this.visible_range=e,this.drag_ranges=demod_envelope_draw(g_range,center_freq+this.parent.offset_frequency+this.parent.low_cut,center_freq+this.parent.offset_frequency+this.parent.high_cut,this.color,center_freq+this.parent.offset_frequency);e=Math.abs(this.parent.high_cut-this.parent.low_cut);pb_adj_lo_ttip.innerHTML="lo "+this.parent.low_cut.toString()+", bw "+e.toString(),pb_adj_hi_ttip.innerHTML="hi "+this.parent.high_cut.toString()+", bw "+e.toString(),pb_adj_cf_ttip.innerHTML="cf "+(this.parent.low_cut+Math.abs(this.parent.high_cut-this.parent.low_cut)/2).toString();e=(center_freq+this.parent.offset_frequency)/1e3+kiwi.freq_offset_kHz;pb_adj_car_ttip.innerHTML=e.toFixed(freq_field_prec(e))+" kHz"},this.envelope.env_drag_start=function(e,t,a){return this.key_modifiers=a,this.dragged_range=demod_envelope_where_clicked(e,t,this.drag_ranges,a),this.drag_origin={x:e,low_cut:this.parent.low_cut,high_cut:this.parent.high_cut,offset_frequency:this.parent.offset_frequency},this.dragged_range!=demodulator.draggable_ranges.none},this.envelope.drag_move=function(e){var t=demodulator.draggable_ranges;if(this.dragged_range==t.none)return!1;freq_change=Math.round(this.visible_range.hpp*(e-this.drag_origin.x));var a=this.dragged_range==t.bfo,_=this.dragged_range==t.beginning,i=this.dragged_range==t.ending,o=this.dragged_range==t.bwlo,n=this.dragged_range==t.bwhi,s=a||this.dragged_range==t.pbs||o||n,e=a||n?-1:1,n=a||o?-1:1,o=this.drag_origin.low_cut,_=_||s;_&&(o+=e*freq_change);e=this.drag_origin.high_cut,s=i||s;if(s&&(e+=n*freq_change),_){if(o<this.parent.filter.low_cut_limit)return!0;if(e-o<this.parent.filter.min_passband)return!0;if(e<=o)return!0}if(s){if(e>this.parent.filter.high_cut_limit)return!0;if(e-o<this.parent.filter.min_passband)return!0;if(e<=o)return!0}if(_&&(cfg.passbands[this.parent.server_mode].last_lo=this.parent.low_cut=o),s&&(cfg.passbands[this.parent.server_mode].last_hi=this.parent.high_cut=e),this.dragged_range==t.anything_else||a){if(new_value=this.drag_origin.offset_frequency+freq_change,new_value>bandwidth/2||new_value<-bandwidth/2)return!0;this.parent.offset_frequency=new_value}return mkenvelopes(this.visible_range),freqset_car_Hz(this.parent.offset_frequency+center_freq),this.parent.set(),freqset_update_ui(),!0},this.envelope.drag_end=function(e){return to_return=this.dragged_range!=demodulator.draggable_ranges.none,this.dragged_range=demodulator.draggable_ranges.none,to_return}}function mkenvelopes(e){scale_ctx.clearRect(0,0,scale_ctx.canvas.width,22);for(var t=0;t<demodulators.length;t++)demodulators[t].envelope.draw(e)}function demodulator_remove(e){demodulators[e].stop(),demodulators.splice(e,1)}function demodulator_add(e){demodulators.push(e),waterfall_setup_done&&mkenvelopes(get_visible_freq_range())}function demodulator_analog_replace(e,t){null==cfg.passbands[e]&&(e="am");var a,_=0,i=0,o=!1,n=!1,s=!1;demodulators.length?(o=demodulators[0].isCW,_=demodulators[0].offset_frequency,i=passband_offset(),demodulator_remove(0)):(_=(a=Math.round(1e3*(init_frequency-kiwi.freq_offset_kHz)))<=0||bandwidth<a?0:a-center_freq,e=init_mode),isArg(t)&&(_=t-center_freq),demodulator_add(new demodulator_default_analog(_,e,NaN,NaN)),!o&&demodulators[0].isCW&&(n=!0),o&&!demodulators[0].isCW&&(s=!0),isArg(t)?(_=(freq_car_Hz=freq_dsp_to_car(t))-center_freq,wf.audioFFT_clear_wf=!0):(t=0,n&&(t=-passband_offset()),s&&(t=i),_+=t,(n||s)&&(wf.audioFFT_clear_wf=!0)),"drm"!=cur_mode&&(extint.prev_mode=cur_mode),cur_mode=e,(n||s)&&set_agc(),demodulator_set_offset_frequency(0,_),try_modeset_update_ui(e)}function demodulator_set_offset_frequency(e,t){var a;bandwidth/2<t||t<-bandwidth/2||(freqset_car_Hz((t=Math.round(t))+center_freq),(a=demodulators[0]).offset_frequency=t,a.set(),try_freqset_update_ui())}function owrx_cfg(){w3_do_when_rendered("id-rx-gmap",function(){w3_link_set("id-rx-gmap","https://www.google.com/maps/place/"+cfg.index_html_params.RX_GMAP)}),owrx.cfg_loaded=!0}function scale_setup(){w3_el("id-scale-container").addEventListener("mouseout",scale_container_mouseout,!1),scale_canvas=html("id-scale-canvas"),scale_ctx=scale_canvas.getContext("2d"),add_scale_listner(scale_canvas),(pb_adj_car=html("id-pb-adj-car")).innerHTML='<span id="id-pb-adj-car-ttip" class="class-passband-adjust-car-tooltip class-tooltip-text"></span>',pb_adj_car_ttip=html("id-pb-adj-car-ttip"),add_scale_listner(pb_adj_car),(pb_adj_lo=html("id-pb-adj-lo")).innerHTML='<span id="id-pb-adj-lo-ttip" class="class-passband-adjust-cut-tooltip class-tooltip-text"></span>',pb_adj_lo_ttip=html("id-pb-adj-lo-ttip"),add_scale_listner(pb_adj_lo),(pb_adj_hi=html("id-pb-adj-hi")).innerHTML='<span id="id-pb-adj-hi-ttip" class="class-passband-adjust-cut-tooltip class-tooltip-text"></span>',pb_adj_hi_ttip=html("id-pb-adj-hi-ttip"),add_scale_listner(pb_adj_hi),(pb_adj_cf=html("id-pb-adj-cf")).innerHTML='<span id="id-pb-adj-cf-ttip" class="class-passband-adjust-cf-tooltip class-tooltip-text"></span>',pb_adj_cf_ttip=html("id-pb-adj-cf-ttip"),add_scale_listner(pb_adj_cf),band_canvas=html("id-band-canvas"),band_ctx=band_canvas.getContext("2d"),add_canvas_listner(band_canvas),add_canvas_listner(dx_div=html("id-dx-container")),dx_canvas=html("id-dx-canvas"),dx_ctx=dx_canvas.getContext("2d"),add_canvas_listner(dx_canvas),resize_scale("setup")}function add_scale_listner(e){e.addEventListener("mousedown",scale_canvas_mousedown,!1),e.addEventListener("mousemove",scale_canvas_mousemove,!1),e.addEventListener("mouseup",scale_canvas_mouseup,!1),e.addEventListener("contextmenu",scale_canvas_contextmenu,!1),kiwi_isMobile()&&(e.addEventListener("touchstart",scale_canvas_touchStart,!1),e.addEventListener("touchmove",scale_canvas_touchMove,!1),e.addEventListener("touchend",scale_canvas_touchEnd,!1))}function scale_canvas_contextmenu(e){return cancelEvent(e)}dont_toggle_rx_photo_flag=0,demodulators=[],demodulator_color_index=0,demodulator_colors=["#ffff00","#00ff00","#00ffff","#058cff","#ff9600","#a1ff39","#ff4e39","#ff5dbd"],demodulator=function(e){this.offset_frequency=e,this.has_audio_output=!0,this.has_text_output=!1,this.envelope={},this.color=demodulators_get_next_color(),this.stop=function(){}},demodulator.draggable_ranges={none:0,beginning:1,ending:2,anything_else:3,bfo:4,pbs:5,bwlo:6,bwhi:7},demodulator_response_time=100,demodulator_default_analog.prototype=new demodulator;var scale_canvas_drag_params={mouse_down:!1,drag:!1,start_x:0,last_x:0,start_y:0,last_y:0,key_modifiers:{shiftKey:!1,altKey:!1,ctrlKey:!1}};function scale_canvas_mousedown(evt){with(scale_canvas_drag_params)drag=!1,start_x=evt.pageX,start_y=evt.pageY,key_modifiers.shiftKey=evt.shiftKey,key_modifiers.altKey=evt.altKey,key_modifiers.ctrlKey=evt.ctrlKey;scale_canvas_start_drag(evt,1),evt.preventDefault()}function scale_canvas_touchStart(evt){with(scale_canvas_drag_params)drag=!1,last_x=start_x=evt.targetTouches[0].pageX,last_y=start_y=evt.targetTouches[0].pageY,key_modifiers.shiftKey=!1,key_modifiers.altKey=!1,key_modifiers.ctrlKey=!1;scale_canvas_start_drag(evt,0),touch_restore_tooltip_visibility(owrx.scale_canvas),evt.preventDefault()}var scale_canvas_ignore_mouse_event=!1;function scale_canvas_start_drag(e,t){if(e.button==mouse.right&&!e.ctrlKey)return right_click_menu(scale_canvas_drag_params.start_x,scale_canvas_drag_params.start_y,1),scale_canvas_drag_params.mouse_down=owrx.scale_canvas.mouse_out=!1,void(scale_canvas_ignore_mouse_event=!0);scale_canvas_drag_params.mouse_down=!0,owrx.scale_canvas.target=e.target,t&&scale_canvas_mousemove(e)}function scale_offset_carfreq_from_px(e,t){isUndefined(t)&&(t=get_visible_freq_range());var a=passband_offset();return t.start+t.bw*(e/wf_container.clientWidth)-center_freq-a}function scale_canvas_drag(e,t,a){if(!scale_canvas_ignore_mouse_event){var _=0;Math.abs(t-scale_canvas_drag_params.start_x);if(scale_canvas_drag_params.mouse_down&&!scale_canvas_drag_params.drag){scale_canvas_drag_params.drag=!0;for(var i=0;i<demodulators.length;i++)_|=demodulators[i].envelope.env_drag_start(t,a,scale_canvas_drag_params.key_modifiers);e.target.style.cursor="move"}if(scale_canvas_drag_params.drag){for(i=0;i<demodulators.length;i++)_|=demodulators[i].envelope.drag_move(t);_||demodulator_set_offset_frequency(0,scale_offset_carfreq_from_px(t)),scale_canvas_drag_params.last_x=t}}}function scale_canvas_mousemove(e){scale_canvas_drag(e,e.pageX,e.offsetY)}function scale_canvas_touchMove(e){for(var t=0;t<e.touches.length;t++){var a=e.touches[t].pageY-owrx.scale_offsetY;scale_canvas_drag(e,e.touches[t].pageX,a)}e.preventDefault()}function scale_canvas_end_drag(e,t,a){if(scale_canvas_ignore_mouse_event)scale_canvas_ignore_mouse_event=!1;else if(1!=scale_canvas_drag_params.mouse_down||"mouseout"!=e.type){var _=scale_canvas_drag_params.drag=!1;if(1==scale_canvas_drag_params.mouse_down){for(var i=0;i<demodulators.length;i++)_|=demodulators[i].envelope.drag_end(t);_||demodulator_set_offset_frequency(0,scale_offset_carfreq_from_px(t))}scale_canvas_drag_params.mouse_down=!1;e=owrx.scale_canvas.target;e&&e.style&&(e.style.cursor=null)}else owrx.scale_canvas.mouse_out=!0}function scale_canvas_mouseup(e){scale_canvas_end_drag(e,e.pageX)}function touch_hide_tooltip(e,t){var a,_=t.target;w3_contains(_,"class-tooltip")&&(a=_.childNodes[0],w3_contains(a,"class-tooltip-text")&&(t.restore_visibility_timeout=setTimeout(function(){a.style.visibility="hidden",t.restore_visibility.push(a)},t.restore_visibility_delay)))}function touch_restore_tooltip_visibility(e){kiwi_clearTimeout(e.restore_visibility_timeout),e.restore_visibility.forEach(function(e){e.style.visibility=""}),e.restore_visibility=[]}function scale_canvas_touchEnd(e){scale_canvas_end_drag(e,scale_canvas_drag_params.last_x),touch_hide_tooltip(e,owrx.scale_canvas),e.preventDefault()}function scale_container_mouseout(e){var t=e.relatedTarget;(t=isObject(t)&&null!=t&&isDefined(t.id)?t.id:null)&&(t.startsWith("id-pb-adj")||t.startsWith("id-scale"))||scale_canvas_mouseup(e)}function scale_px_from_freq(e,t){return Math.round((e-t.start)/t.bw*wf_container.clientWidth)}function scale_px_from_freq_offset(e,t){return Math.round((e-t.start_offset)/t.bw*wf_container.clientWidth)}function get_visible_freq_range(){var e,t;return out={},wf.audioFFT_active&&cur_mode?(t=Math.round(audio_input_rate||12e3),t=ext_is_IQ_or_stereo_curmode()?(e=0,t):(e=!cur_mode||"ls"!=cur_mode.substr(0,2)&&"sal"!=cur_mode?t/4:0,t/2),out.center=center_freq+demodulators[0].offset_frequency+e,out.start=out.center-t,out.end=out.center+t,x_bin=freq_to_bin(out.start)):(t=bins_at_cur_zoom(),out.start=bin_to_freq(x_bin),out.center=bin_to_freq(x_bin+t/2),out.end=bin_to_freq(x_bin+t)),out.bw=out.end-out.start,out.hpp=out.bw/scale_canvas.clientWidth,out.start_offset=out.start+kiwi.offset_frac,out}var scale_markers_levels=[{hz_per_large_marker:1e7,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:0},{hz_per_large_marker:5e6,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:0},{hz_per_large_marker:1e6,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:0},{hz_per_large_marker:5e5,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:1},{hz_per_large_marker:1e5,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:1},{hz_per_large_marker:5e4,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:2},{hz_per_large_marker:1e4,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:2},{hz_per_large_marker:5e3,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:3},{hz_per_large_marker:1e3,estimated_text_width:70,format:"{x} ",pre_divide:1e6,decimals:3}],scale_min_space_btwn_texts=50,scale_min_space_btwn_small_markers=7,g_range;function get_scale_mark_spacing(t){out={},fcalc=function(e){return out.numlarge=t.bw/e,out.pxlarge=wf_container.clientWidth/out.numlarge,out.ratio=5,out.pxsmall=out.pxlarge/out.ratio,!(out.pxsmall<scale_min_space_btwn_small_markers)&&(out.pxsmall/2>=scale_min_space_btwn_small_markers&&"5"!=e.toString()[0]&&(out.pxsmall/=2,out.ratio*=2),out.smallbw=e/out.ratio,!0)};for(var e=scale_markers_levels.length-1;0<=e&&(mp=scale_markers_levels[e],!(fcalc(mp.hz_per_large_marker)&&out.pxlarge-mp.estimated_text_width>scale_min_space_btwn_texts));e--);return out.params=mp,out}function mk_freq_scale(){mkenvelopes(g_range=get_visible_freq_range()),scale_ctx.clearRect(0,22,scale_ctx.canvas.width,scale_ctx.canvas.height-22),scale_ctx.strokeStyle="#fff",scale_ctx.font="bold 12px sans-serif",scale_ctx.textBaseline="top",scale_ctx.fillStyle="#fff";var _,i=get_scale_mark_spacing(g_range),e=Math.ceil(g_range.start_offset/i.smallbw)*i.smallbw,t=e+kiwi.freq_offset_Hz-kiwi.offset_frac;text_y_pos=32+(kiwi_isFirefox()?3:0);function a(e){var t=e,a=i.params.pre_divide,e=i.params.decimals;(t+=kiwi.freq_offset_Hz-kiwi.offset_frac)<1e6&&(a/=1e3,e=0),_=format_frequency(i.params.format+(t<1e6?"kHz":"MHz"),t,a,e)}for(var o,n,s,r,l,d=0;!(1e3<++d);){if((l=scale_px_from_freq_offset(e,g_range))>window.innerWidth)break;scale_ctx.beginPath(),scale_ctx.moveTo(l,22),t%i.params.hz_per_large_marker==0?(isUndefined(n)&&(n=e),o=e,scale_ctx.lineWidth=3.5,scale_ctx.lineTo(l,33),a(e),s=scale_ctx.measureText(_),scale_ctx.textAlign="center",0==zoom_level&&g_range.start+i.smallbw*i.ratio>e?l<=s.width/2?scale_px_from_freq_offset(e+i.smallbw*i.ratio,g_range)-s.width>=scale_min_space_btwn_texts&&(scale_ctx.textAlign="left",scale_ctx.fillText(_,0,text_y_pos)):scale_ctx.fillText(_,l,text_y_pos):0==zoom_level&&g_range.end-i.smallbw*i.ratio<e&&l>window.innerWidth-s.width/2?window.innerWidth-s.width-scale_px_from_freq_offset(e-i.smallbw*i.ratio,g_range)>=scale_min_space_btwn_texts&&(scale_ctx.textAlign="right",scale_ctx.fillText(_,window.innerWidth,text_y_pos)):scale_ctx.fillText(_,l,text_y_pos)):(scale_ctx.lineWidth=2,scale_ctx.lineTo(l,30)),e+=i.smallbw,t+=i.smallbw,scale_ctx.stroke()}1e3<d&&(console.log("CONV_CT > 1000!!!"),kiwi_trace()),0!=zoom_level&&(scale_ctx.textAlign="center",l=scale_px_from_freq_offset(r=n-i.smallbw*i.ratio,g_range),a(r),0<l+scale_ctx.measureText(_).width/2&&scale_ctx.fillText(_,l,32),l=scale_px_from_freq_offset(r=o+i.smallbw*i.ratio,g_range),a(r),l-scale_ctx.measureText(_).width/2<window.innerWidth&&scale_ctx.fillText(_,l,32))}var dx_car_size=8,dx_car_border=3,dx_car_w=dx_car_h=2*dx_car_border+dx_car_size,window_width,waterfall_width,main_container,wf_container,canvas_annotation,canvas_phantom,annotation_div;function resize_scale(e){band_ctx.canvas.width=window.innerWidth,band_ctx.canvas.height=band_canvas_h,dx_div.style.width=px(window.innerWidth),dx_ctx.canvas.width=dx_car_w,dx_ctx.canvas.height=dx_car_h,dx_canvas.style.top=px(scale_canvas_top-dx_car_h+2),dx_canvas.style.left=0,dx_canvas.style.zIndex=99,dx_ctx.miterLimit=2,dx_ctx.lineJoin="round",dx_ctx.beginPath(),dx_ctx.lineWidth=dx_car_border-1,dx_ctx.strokeStyle="black";var t=dx_car_border,a=dx_car_size;dx_ctx.moveTo(t-1,t),dx_ctx.lineTo(t+a,t),dx_ctx.lineTo(t+a/2,t+a),dx_ctx.lineTo(t,t),dx_ctx.stroke(),dx_ctx.fillStyle="yellow",dx_ctx.fill(),scale_ctx.canvas.width=window.innerWidth,scale_ctx.canvas.height=scale_canvas_h,mkscale(),dx_schedule_update()}function format_frequency(e,t,a,_){return out=e.replace("{x}",(t/a).toFixed(_)),out}function mkscale(){mk_freq_scale(),mk_bands_scale()}function bins_at_zoom(e){return wf_fft_size<<zoom_levels_max-e}function bins_at_cur_zoom(){return bins_at_zoom(zoom_level)}function norm_to_bins(e){return Math.round(e*bins_at_cur_zoom())}function bin_to_freq(e){var t=wf_fft_size<<zoom_levels_max;return Math.round(e/t*bandwidth)}function freq_to_bin(e){var t=wf_fft_size<<zoom_levels_max;return Math.round(e/bandwidth*t)}function bins_to_pixels_frac(e,t,a){var _=t/bins_at_zoom(a);return sb_trace&&console.log("bins_to_pixels_frac bins="+t+" z="+a+" ratio="+_),1<_&&(_=1),_<-1&&(_=-1),wf_fft_size*_}function bins_to_pixels(e,t,a){a=bins_to_pixels_frac(e,t,a);return Math.round(a)}function freq_to_pixel(e){e=freq_to_bin(e)-x_bin;return 0<=e&&e<bins_at_cur_zoom()||(console.log("freq_to_pixel: bins="+e+" bins_at_cur_zoom="+bins_at_cur_zoom()),console.assert("assert fail")),bins_to_pixels(0,e,zoom_level)}function clamp_xbin(e){e<0&&(e=0);var t=(wf_fft_size<<zoom_levels_max)-bins_at_cur_zoom();return t<e&&(e=t),e}function passband_visible(){if(isUndefined(demodulators[0]))return x_bin;var e=freq_to_bin(freq_passband_center());return e=x_bin<=e&&e<x_bin+bins_at_cur_zoom()?e:-e-1}function create_canvas(e,t,a,_,i){var o=document.createElement("canvas");return o.id=e,o.width=t,o.height=a,_&&(o.style.width=px(_)),i&&(o.style.height=px(i)),o.ctx=o.getContext("2d"),o}function init_wf_container(){window_width=window.innerWidth,wf_container=w3_el("id-waterfall-container"),waterfall_width=wf_container.clientWidth,(canvas_annotation=create_canvas("id-annotation-canvas",wf_fft_size,wf_canvas_default_height,waterfall_width,wf_canvas_default_height)).style.zIndex=1,wf_container.appendChild(canvas_annotation),add_canvas_listner(canvas_annotation),w3_el("id-kiwi-body").addEventListener("keyup",mouse_freq_remove),add_canvas_listner(annotation_div=w3_el("id-annotation-div")),annotation_div.style.pointerEvents="none",add_canvas_listner(canvas_phantom=html("id-phantom-canvas")),canvas_phantom.style.width=px(wf_container.clientWidth),add_wf_canvas(),spec.canvas=create_canvas("id-spectrum-canvas",wf_fft_size,spec.height_spectrum_canvas,waterfall_width,spec.height_spectrum_canvas),html("id-spectrum-container").appendChild(spec.canvas),spec.ctx=spec.canvas.ctx,add_canvas_listner(spec.canvas),spec.ctx.font="10px sans-serif",spec.ctx.textBaseline="middle",spec.ctx.textAlign="left",spec.dB=html("id-spectrum-dB"),spec.dB.style.height=px(spec.height_spectrum_canvas),spec.dB.style.width=px(waterfall_width),spec.dB.innerHTML='<span id="id-spectrum-dB-ttip" class="class-spectrum-dB-tooltip class-tooltip-text"></span>',add_canvas_listner(spec.dB),w3_do_when_rendered("id-spectrum-dB-ttip",function(e){spec.dB_ttip=e}),document.addEventListener("mousemove",mouse_freq_add,!1)}function add_canvas_listner(e){e.addEventListener("mouseover",canvas_mouseover,!1),e.addEventListener("mouseout",canvas_mouseout,!1),e.addEventListener("mousedown",canvas_mousedown,!1),e.addEventListener("mousemove",canvas_mousemove,!1),e.addEventListener("mouseup",canvas_mouseup,!1),e.addEventListener("contextmenu",canvas_contextmenu,!1),e.addEventListener("wheel",canvas_mousewheel,!1),kiwi_isMobile()&&(e.addEventListener("touchstart",canvas_touchStart,!1),e.addEventListener("touchmove",canvas_touchMove,!1),e.addEventListener("touchend",canvas_touchEnd,!1))}function remove_canvas_listner(e){e.removeEventListener("mouseover",canvas_mouseover,!1),e.removeEventListener("mouseout",canvas_mouseout,!1),e.removeEventListener("mousedown",canvas_mousedown,!1),e.removeEventListener("mousemove",canvas_mousemove,!1),e.removeEventListener("mouseup",canvas_mouseup,!1),e.removeEventListener("contextmenu",canvas_contextmenu,!1),e.removeEventListener("wheel",canvas_mousewheel,!1),kiwi_isMobile()&&(e.removeEventListener("touchstart",canvas_touchStart,!1),e.removeEventListener("touchmove",canvas_touchMove,!1),e.removeEventListener("touchend",canvas_touchEnd,!1))}function canvas_contextmenu(e){return e.target.id,e&&e.currentTarget&&"id-dx-container"==e.currentTarget.id&&(dx.ctrl_click=!0,w3_el(e.target.id).click()),cancelEvent(e)}function canvas_mouseover(e){}function canvas_mouseout(e){waterfall_setup_done&&(canvas_dragging&&(e=e.target.id.startsWith("id-spectrum-dB"),owrx.debug_drag&&canvas_log("C-MOUT"+(e?" SPEC-IGNORE":"")),e||canvas_end_drag2()),mouse_freq_remove())}function canvas_get_carfreq_offset(e,t){var a=e/waterfall_width;a=wf.audioFFT_active?center_freq+demodulators[0].offset_frequency+(a-=(e=ext_is_IQ_or_stereo_curmode())?.5:.25)*audio_input_rate*(e?2:1):bin_to_freq(x_bin+a*bins_at_cur_zoom());t=t?passband_offset():0;return Math.round(a-t)-bandwidth/2}function canvas_get_dspfreq(e){return canvas_get_carfreq_offset(e,!1)+center_freq}canvas_dragging=!1,canvas_drag_min_delta=1,canvas_mouse_down_or_touch=!1,canvas_ignore_mouse_event=!1;var mouse={left:0,middle:1,right:2};function canvas_start_drag(e,t,a){return owrx.debug_drag&&canvas_log("CSD"),e.button!=mouse.right||e.ctrlKey?owrx.scale_canvas.mouse_out?(event_dump(e,"CSD-scale"),void console.log("SHOULD NOT OCCUR")):(e.shiftKey&&"id-dx-container"==e.target.id?(canvas_ignore_mouse_event=!0,owrx.debug_drag&&console.log("CSD-DX IME=set-true"),dx_show_edit_panel(e,-1)):e.shiftKey&&!e.ctrlKey&&!e.altKey||owrx.wf_snap?(canvas_ignore_mouse_event=!0,owrx.debug_drag&&console.log("CSD-Wboundary IME=set-true"),i=(i=canvas_get_dspfreq(t))/(_=freq_step_amount(find_band(i)).step_Hz),freqmode_set_dsp_kHz(Math.round(i)*_/1e3,null)):e.shiftKey&&(e.ctrlKey||e.altKey)?(canvas_ignore_mouse_event=!0,owrx.debug_drag&&console.log("CSD-lookup IME=set-true"),freq_database_lookup(canvas_get_dspfreq(t),e.altKey)):e.ctrlKey?(canvas_ignore_mouse_event=!0,owrx.debug_drag&&console.log("CSD-pageScroll1 IME=set-true"),page_scroll(-page_scroll_amount)):e.altKey&&(canvas_ignore_mouse_event=!0,owrx.debug_drag&&console.log("CSD-pageScroll2 IME=set-true"),page_scroll(page_scroll_amount)),owrx.drag_count=0,canvas_mouse_down_or_touch=!0,canvas_dragging=!1,owrx.canvas.drag_last_x=owrx.canvas.drag_start_x=t,owrx.canvas.drag_last_y=owrx.canvas.drag_start_y=a,void(owrx.canvas.target=e.target)):(canvas_ignore_mouse_event=!0,owrx.debug_drag&&console.log("CSD-Rclick IME=set-true"),owrx.debug_drag&&canvas_log("ordinary-RCM"),right_click_menu(t,a,2),canvas_ignore_mouse_event=!1,void(owrx.debug_drag&&console.log("CSD-Rclick IME=set-false")));var _,i}function canvas_mousedown(e){owrx.debug_drag&&canvas_log("$C-MD"),canvas_start_drag(e,e.pageX,e.pageY),e.preventDefault()}function canvas_touchStart(e){var t=e.targetTouches.length,a=Math.round(e.targetTouches[0].pageX),_=Math.round(e.targetTouches[0].pageY);owrx.debug_drag&&canvas_log("$C-TS"+t+"-x"+a+"-y"+_),owrx.double_touch_start=!1,1==t?e.target.id.startsWith("id-spectrum")?(owrx.canvas.drag_last_x=owrx.canvas.drag_start_x=a,owrx.canvas.drag_last_y=owrx.canvas.drag_start_y=_,owrx.debug_drag&&canvas_log("*SPEC*")):canvas_start_drag(e,a,_):2<=t&&(canvas_start_drag(e,a,_),canvas_ignore_mouse_event=!0,owrx.debug_drag&&console.log("CTS-doubleTouch IME=set-true"),owrx.touches_first_startx=a,_=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY,owrx.pinch_distance_first=Math.round(Math.hypot(_,a)),owrx.pinch_distance_last=owrx.pinch_distance_first,owrx.double_touch_swipe=Math.abs(a)<50,owrx.double_touch_start=!0),touch_restore_tooltip_visibility(owrx.canvas),e.preventDefault()}function canvas_drag(e,t,a,_,i,o){var n;waterfall_setup_done&&(spectrum_tooltip_update(e,i,o),owrx.drag_count=isNumber(owrx.drag_count)?owrx.drag_count+1:0,owrx.scale_canvas.mouse_out?scale_canvas_drag(e,a,_):(n=canvas_mouse_down_or_touch?owrx.canvas.drag_start_x:a,owrx.debug_drag&&canvas_log("CD#"+owrx.drag_count+" x"+a+" y"+_+" dx"+Math.abs(a-n)+" CMDT"+(canvas_mouse_down_or_touch?1:0)+" IME"+(canvas_ignore_mouse_event?1:0)+" DG"+(canvas_dragging?1:0)),!canvas_mouse_down_or_touch||canvas_ignore_mouse_event&&!owrx.double_touch_start||(i=kiwi_isMobile()?10:1,o=owrx.drag_count>i,n=Math.abs(a-owrx.canvas.drag_start_x)>canvas_drag_min_delta,!canvas_dragging&&o&&n&&(owrx.debug_drag&&canvas_log("### dc="+owrx.drag_count+" >? "+i+" && "+Math.abs(a-owrx.canvas.drag_start_x)+" >? "+canvas_drag_min_delta+" "+(o?"T":"F")+(n?"T":"F")),canvas_dragging=!0,wf_container.style.cursor="move"),canvas_dragging&&(o=owrx.canvas.drag_last_x-a,n=owrx.canvas.drag_last_y-_,owrx.double_touch_start?owrx.double_touch_swipe?0==t&&2<=e.touches.length&&demodulator_set_offset_frequency(0,canvas_get_carfreq_offset(Math.round(Math.abs((e.touches[0].pageX+e.touches[1].pageX)/2)),!0)):(e=Math.round(Math.hypot(o,n)),n=Math.abs(e-owrx.pinch_distance_last),owrx.debug_drag&&canvas_log(e.toFixed(0)+" "+n.toFixed(0)),25<n&&(owrx.debug_drag&&canvas_log("*"),zoom_step((n=e<=owrx.pinch_distance_last)?ext_zoom.OUT:ext_zoom.IN),owrx.debug_drag&&canvas_log(n?"IN":"OUT"),owrx.pinch_distance_last=e)):waterfall_pan_canvases(norm_to_bins(o/waterfall_width)),owrx.canvas.drag_last_x=a,owrx.canvas.drag_last_y=_))))}function mouse_freq_add(e){var t,a,_;isNumber(e.pageX)&&(owrx.last_pageX=e.pageX),isNumber(e.pageY)&&(owrx.last_pageY=e.pageY),kiwi_isMobile()||wf.audioFFT_active||(t=canvas_annotation.ctx,e.target==canvas_annotation&&any_modifier_key(e)?(a=e.offsetX,_=e.offsetY+16,t.font=px(12)+" monospace",owrx.mouse_freq.vis&&t.clearRect(owrx.mouse_freq.tx,owrx.mouse_freq.cy,owrx.mouse_freq.tw,12),e=(canvas_get_dspfreq(a)+kiwi.freq_offset_Hz)/1e3,owrx.mouse_freq.text=format_frequency("{x}",e,1,freq_field_prec(e)),1&(e=Math.ceil(t.measureText(owrx.mouse_freq.text).width))&&e++,owrx.mouse_freq.tw=e,owrx.mouse_freq.th=12,owrx.mouse_freq.tx=a-e/2,t.fillStyle="black",t.fillRect(a-e/2,_,e,12),t.fillStyle="white",t.fillText(owrx.mouse_freq.text,owrx.mouse_freq.tx,_+12-2),owrx.mouse_freq.cx=a,owrx.mouse_freq.cy=_,owrx.mouse_freq.vis=!0):mouse_freq_remove())}function mouse_freq_remove(){owrx.mouse_freq.vis&&(canvas_annotation.ctx.clearRect(owrx.mouse_freq.tx,owrx.mouse_freq.cy,owrx.mouse_freq.tw,owrx.mouse_freq.th),owrx.mouse_freq.vis=!1)}function canvas_mousemove(e){canvas_drag(e,0,e.pageX,e.pageY,e.clientX,e.clientY)}function canvas_touchMove(e){1<=e.touches.length&&(owrx.touches_first_lastx=e.touches[0].pageX);for(var t=0;t<e.touches.length;t++){var a=Math.round(e.touches[t].pageX),_=Math.round(e.touches[t].pageY);canvas_drag(e,t,a,_,a,_)}e.preventDefault()}function canvas_end_drag2(){owrx.debug_drag&&canvas_log("C-ED2"),wf_container.style.cursor=owrx.wf_cursor,canvas_mouse_down_or_touch=!1,canvas_ignore_mouse_event=!1,owrx.debug_drag&&console.log("C-ED2 IME=set-false")}function canvas_end_drag(e,t){var a;owrx.scale_canvas.mouse_out&&scale_canvas_end_drag(e,t,!(owrx.scale_canvas.mouse_out=!1)),owrx.debug_drag&&canvas_log("C-ED IME"+(canvas_ignore_mouse_event?1:0)+" CD"+(canvas_dragging?1:0)),waterfall_setup_done&&(e=t,canvas_ignore_mouse_event||(canvas_dragging?canvas_end_drag2():(owrx.debug_drag&&canvas_log("CMDT"+(canvas_mouse_down_or_touch?1:0)+" TL"+owrx.tuning_locked),canvas_mouse_down_or_touch&&(w3_menu_active()?(owrx.debug_drag&&canvas_log("*MA*"),w3_menu_close()):owrx.tuning_locked?((a=w3_el("id-tuning-lock-container")).style.opacity=.8,w3_show(a),(t=w3_el("id-tuning-lock")).style.marginTop=px(w3_center_in_window(t,"TL")),setTimeout(function(){a.style.opacity=0,setTimeout(function(){w3_hide(a)},500)},300)):(owrx.debug_drag&&canvas_log("*click*"),demodulator_set_offset_frequency(0,canvas_get_carfreq_offset(e,!0)))))),canvas_mouse_down_or_touch=!1,canvas_ignore_mouse_event=!1,owrx.debug_drag&&console.log("C-ED IME=set-false"))}function canvas_mouseup(e){owrx.debug_drag&&console.log("C-MU"),owrx.debug_drag&&canvas_log("C-MU"),canvas_end_drag(e,e.pageX)}function canvas_touchEnd(e){var t=owrx.canvas.drag_last_x,a=owrx.canvas.drag_last_y;owrx.debug_drag&&canvas_log("C-TE-x"+t+"-DTS"+(owrx.double_touch_start?1:0)+"-DTSw"+(owrx.double_touch_swipe?1:0)+"-DRAG"+(canvas_dragging?1:0)),canvas_end_drag(e,t),spectrum_tooltip_update(e,t,a),owrx.double_touch_start&&(owrx.debug_drag&&canvas_log("DTS-D="+(canvas_dragging?"T":"F")),canvas_dragging||(kiwi_isMobile()&&owrx.mobile&&owrx.mobile.small&&(t=10),owrx.debug_drag&&canvas_log("*-RCM"),right_click_menu(t,a,3)),canvas_ignore_mouse_event=!1,owrx.debug_drag&&console.log("CTE-doubleTouch IME=set-false"),owrx.double_touch_start=!1),touch_hide_tooltip(e,owrx.canvas),e.preventDefault()}var canvas_mousewheel_rlimit=kiwi_rateLimit(canvas_mousewheel_cb,170);function canvas_mousewheel(e){canvas_mousewheel_rlimit(e),e.preventDefault()}function canvas_mousewheel_cb(e){var t,a,_;waterfall_setup_done&&(t=e.deltaX,a=e.deltaY,_=e.ctrlKey||0!=t,zoom_step(t<0||0==t&&a<0?ext_zoom.IN:ext_zoom.OUT,_?void 0:e.pageX))}function right_click_menu_init(){var e=[];e.push("DX database"),owrx.rcm_db=0,e.push("edit last selected DX label"),owrx.rcm_edit=1,e.push("DX label filter"),owrx.rcm_filter=2,e.push("<hr>"),e.push("database lookup"),owrx.rcm_lookup=4,e.push("DX Cluster lookup"),owrx.rcm_cluster=5,e.push("<hr>"),e.push("snap to nearest"),owrx.rcm_snap=7,e.push("🔒 lock tuning"),owrx.rcm_lock=8,e.push("restore passband"),owrx.rcm_pb=9,e.push("save waterfall as JPG"),owrx.rcm_save=10,e.push("<hr>"),e.push('<i style="pointer-events:none">cal ADC clock (admin)</i>'),owrx.rcm_cal=12,e.push('<i style="pointer-events:none">set freq offset (admin)</i>'),owrx.rcm_foff=13,e.push('<i style="pointer-events:none">save noise defaults (admin)</i>'),owrx.rcm_noise=14,owrx.right_click_menu_content=e,w3_menu("id-right-click-menu","right_click_menu_cb");e=w3_div("id-tuning-lock-container class-overlay-container w3-hide",w3_div("id-tuning-lock",w3_icon("","fa-lock",192)+"<br>Tuning locked"));w3_create_appendElement("id-main-container","div",e)}function right_click_menu(e,t,a){owrx.debug_drag&&canvas_log("RCM"+a),owrx.right_click_menu_content[owrx.rcm_db]="DX "+dx.db_flip_s[dx.db]+" database";var _=freq_displayed_Hz/1e3,a=band_info(),a=_>=a.NDB_lo&&_<a.NDB_hi?"NDB":_<a.LW_lo?"VLF/LF":_<a.MW_hi?"LW/MW":"SWBC";owrx.right_click_menu_content[owrx.rcm_lookup]=a+" database lookup",owrx.right_click_menu_content[owrx.rcm_snap]=owrx.wf_snap?"no snap":"snap to nearest";a=dx.db==dx.DB_STORED&&isDefined(owrx.dx_click_gid_last);owrx.right_click_menu_content[owrx.rcm_edit]=a?"edit last selected DX label":"open DX label edit panel",w3_menu_items("id-right-click-menu",owrx.right_click_menu_content),w3_menu_popup("id-right-click-menu",function(e,t){return"keyup"==e.type&&"Escape"==e.key||"click"==e.type&&e.button!=mouse.right||"touchend"==e.type&&!t&&!w3_contains(e.target,"w3-menu")},e,t)}function right_click_menu_cb(e,t,a){switch(e){case owrx.rcm_db:dx_database_cb("",dx.db==dx.DB_EiBi?dx.DB_STORED:dx.DB_EiBi);break;case owrx.rcm_lookup:case owrx.rcm_cluster:freq_database_lookup(canvas_get_dspfreq(t),e);break;case owrx.rcm_snap:wf_snap();break;case owrx.rcm_lock:owrx.tuning_locked^=1,owrx.right_click_menu_content[owrx.rcm_lock]=(owrx.tuning_locked?"🔓 unlock":"🔒 lock")+" tuning";break;case owrx.rcm_pb:restore_passband(cur_mode),demodulator_analog_replace(cur_mode);break;case owrx.rcm_save:export_waterfall();break;case owrx.rcm_edit:var _=-1;dx.db==dx.DB_STORED&&isDefined(owrx.dx_click_gid_last)&&(_=owrx.dx_click_gid_last),console.log("RCM rcm_edit: gid="+_+" db="+dx.db),dx_show_edit_panel(null,_),dx_schedule_update();break;case owrx.rcm_filter:dx_filter();break;case owrx.rcm_cal:admin_pwd_query(function(){var e=Math.round(freq_displayed_Hz/1e3),t=1e3*e,a=t-freq_displayed_Hz,_=Math.round(a*ext_adc_clock_Hz()/t);console.log("cal ADC clock: dsp="+freq_displayed_Hz+" car="+freq_car_Hz+" r1k_kHz="+e+" clk_diff="+a+" clk_adj="+_);t=cfg.clk_adj+_,_=1e6*t/ext_adc_clock_Hz();console.log("cal ADC clock: prev_adj="+cfg.clk_adj+" new_adj="+t+" ppm="+_.toFixed(1)),cal_adc_dialog(t,a,e,_)});break;case owrx.rcm_foff:admin_pwd_query(function(){set_freq_offset_dialog()});break;case owrx.rcm_noise:admin_pwd_query(function(){w3_call("noise_blank_save_defaults"),w3_call("noise_filter_save_defaults")})}}function freq_database_lookup(e,t){var a,_=e/1e3,i=(Math.round(e/10),Math.round(e/1e3)),o="https://",n=band_info();t==owrx.rcm_lookup&&(_>=n.NDB_lo&&_<n.NDB_hi?o+="rxx.classaxe.com/en/rww/signals?types=DGPS,NAVTEX,NDB&khz="+(a=i.toFixed(0))+"&limit=-1":_<n.LW_lo?(a=Math.round(e/100)/10,console.log("kHz="+_+" f="+a),o+="www.mwlist.org/vlf.php?kHz="+a.toFixed(1)):_<n.MW_hi?(a=Math.round(i/n._9_10)*n._9_10,console.log("MW kHz="+_+" f="+a),o+="www.mwlist.org/mwlist_quick_and_easy.php?area="+[0,1,3,2][n.ITU_region]+"&kHz="+a.toFixed(0)):o+="www.short-wave.info/index.php?freq="+(a=5*Math.round(i/5)).toFixed(0)+"&timbus=NOW&ip="+client_public_ip+"&porm=4"),t==owrx.rcm_cluster&&(o="http://ve3sun.com/KiwiSDR/DX.php?Search="+(a=Math.floor(e)/1e3).toFixed(1)),console.log("LOOKUP "+_+" -> "+a+" "+o);o=window.open(o,"_blank");o&&o.focus()}function export_waterfall(){var e=w3_el("id-scale-canvas"),t=waterfall_width,a=Math.round(e.height),o=50,_=w3_el("id-spectrum-canvas"),n=_&&spec.source_wf?_.height:0,s=document.createElement("canvas"),r=s.getContext("2d"),l=s.width=wf_fft_size,d=s.height=50+a+n+(old_canvases.length+wf_canvases.length)*wf_canvas_default_height;if(r.fillStyle="black",r.fillRect(0,0,l,d),n&&(r.drawImage(_,0,o),o+=n),r.fillStyle="gray",r.fillRect(0,o,l,a),r.drawImage(e,0,0,t,a,0,o,l,a),o+=a,wf_canvases.forEach(function(e,t){var a=e.height,_=0;0==t&&(a+=t=unpx(e.style.top),_=-t),r.drawImage(e,0,_,l,a,0,o,l,a),o+=a}),1<old_canvases.length)for(i=1;i<old_canvases.length;i++)r.drawImage(old_canvases[i],0,o),o+=old_canvases[i].height;r.font="18px Arial",r.fillStyle="lime";t=kiwi_host()+"     "+(new Date).toUTCString()+"     "+freq_displayed_kHz_str+" kHz  "+cur_mode,a=l/2-r.measureText(t).width/2;r.fillText(t,a,35);t=kiwi_host()+"_"+(new Date).toISOString().replace(/:/g,"_").replace(/\.[0-9]+Z$/,"Z")+"_"+w3_el("id-freq-input").value+"_"+cur_mode+".jpg",a=s.toDataURL("image/jpeg",.85),s=document.createElement("a");s.download=t,s.href=a,s.target="_blank",s.dataset.downloadurl=["image/jpeg",s.download,s.href].join(":"),document.body.appendChild(s),s.click(),document.body.removeChild(s)}function zoom_finally(){w3_innerHTML("id-nav-optbar-wf","WF"+zoom_level.toFixed(0)),wf_gnd_value=wf_gnd_value_base-zoomCorrection(),extint_environment_changed({zoom:1}),freqset_select()}var ZOOM_NOMINAL=10,ZOOM_BAND=6,zoom_nom=0,zoom_old_nom=0,zoom_levels_max=0,zoom_level=0,zoom_level_f=0,zoom_freq=0,zoom_maxin_s=["id-maxin","id-maxin-nom","id-maxin-max"],x_bin=0;function zoom_step(e,t){if(wf.audioFFT_active)audioFFT_update();else{var a,_,o,n=e==ext_zoom.OUT,s=e==ext_zoom.IN,r=e!=ext_zoom.TO_BAND&&e!=ext_zoom.ABS,l=zoom_level,d=x_bin,c=!0;if(e==ext_zoom.WHEEL){if(null==t)return;var f,c=!1;if((f=Math.round(zoom_level_f))==l)return;e=l<f?ext_zoom.IN:ext_zoom.OUT}if(e==ext_zoom.MAX_OUT)n=!0,x_bin=zoom_level=0;else{if(r&&(n&&0==zoom_level||s&&zoom_levels_max<=zoom_level))return void zoom_finally();if(e==ext_zoom.TO_BAND){var u,w=center_freq+demodulators[0].offset_frequency;if(null!=t)a=t.b1,_=t.b2,zoom_level=_.zoom_level,u=_.cfHz,sb_trace&&console.log("ZTB-user f="+w+" cf="+u+" b="+a.name+" z="+_.zoom_level);else{var p=cfg.init.ITU_region+1;for(i=0;i<cfg.bands.length&&(a=cfg.bands[i],_=kiwi.bands[i],!((a.itu==kiwi.BAND_SCALE_ONLY||a.itu==kiwi.ITU_ANY||a.itu==p)&&w>=_.minHz&&w<=_.maxHz));i++);u=i!=cfg.bands.length?(zoom_level=_.zoom_level,_.cfHz):(zoom_level=ZOOM_BAND,w)}n=zoom_level<l,x_bin=freq_to_bin(u),x_bin-=norm_to_bins(.5)}else if(e==ext_zoom.ABS){if(null==t)return void zoom_finally();if((f=t)<0||zoom_levels_max<f||f==zoom_level)return void zoom_finally();n=f<zoom_level,zoom_level=f,x_bin=freq_to_bin(freq_passband_center()),x_bin-=norm_to_bins(.5)}else e==ext_zoom.NOM_IN||e==ext_zoom.MAX_IN?(n=(zoom_level=e==ext_zoom.NOM_IN&&null!=t&&1==t&&zoom_nom<=zoom_level?zoom_level==zoom_levels_max?zoom_nom:zoom_levels_max:e==ext_zoom.NOM_IN?zoom_nom:zoom_levels_max)<l,x_bin=freq_to_bin(freq_passband_center()),x_bin-=norm_to_bins(.5)):(dbgUs&&(sb_trace&&console.log("ZOOM IN/OUT"),sb_trace=0),o=null!=t?t/waterfall_width:0<=(o=passband_visible())?(o-x_bin)/bins_at_cur_zoom():.5,x_bin+=norm_to_bins(o),zoom_level+=e,x_bin-=norm_to_bins(o))}c&&(zoom_level_f=zoom_level);c=zoom_level==zoom_levels_max?2:zoom_nom<=zoom_level?1:0;c!=zoom_old_nom&&(w3_hide(zoom_maxin_s[zoom_old_nom]),w3_show(zoom_maxin_s[c],"w3-show-table-cell"),zoom_old_nom=c),0!=zoom_level&&0!=l||(w3_show_hide("id-maxout",0!=zoom_level,"w3-show-table-cell"),w3_show_hide("id-maxout-max",0==zoom_level,"w3-show-table-cell")),x_bin=clamp_xbin(x_bin);c=n?d-x_bin:x_bin-d,n=bins_to_pixels(1,c,n?zoom_level:l);sb_trace&&console.log("Zs z"+l+">"+zoom_level+" b="+x_bin+"/"+d+"/"+c+" bz="+bins_at_zoom(l)+" r="+c/bins_at_zoom(l)+" px="+n);c=zoom_level-l;sb_trace&&console.log("zoom_step oz="+l+" zl="+zoom_level+" dz="+c+" pdx="+n),waterfall_zoom_canvases(c,n),mkscale(),dx_schedule_update(),sb_trace&&console.log("SET Z"+zoom_level+" xb="+x_bin),wf_send("SET zoom="+zoom_level+" start="+x_bin),need_maxmindb_update=!0,writeCookie("last_zoom",zoom_level),freq_link_update(),vfo_update(),zoom_finally(),dbgUs&&(w=get_visible_freq_range(),console.log("^ZOOM z"+zoom_level+" "+(w.start/1e3).toFixed(0)+"|"+(w.center/1e3).toFixed(0)+"|"+(w.end/1e3).toFixed(0)+" ("+(w.bw/1e3).toFixed(0)+" kHz)"))}}function passband_increment(e){var t=ext_get_passband(),a=Math.abs(t.high-t.low),_=e?(1.25*a-a)/2:(a-.8*a)/2,a=10<_?10:1;_=Math.round(_/a)*a,t.low+=e?-_:_,t.low=Math.round(t.low/a)*a,t.high+=e?_:-_,t.high=Math.round(t.high/a)*a,ext_set_passband(t.low,t.high,!0)}function zoom_click(e,t,a){if(any_alternate_click_event(e)){var _=e.currentTarget,e=w3_contains(_,"id-zoom-in"),_=w3_contains(_,"id-zoom-out");return e||_?void passband_increment(e):void 0}t==ext_zoom.NOM_IN?zoom_step(t,1):zoom_step(t)}function zoom_over(e){var t,a;"IMG"==e.target.nodeName&&(t=e.target,a=e.currentTarget,a=w3_contains(a,"id-zoom-in"),any_alternate_click_event(e)?t.title=a?"passband widen":"passband narrow":t.removeAttribute("title"))}function mobile_init(){var t=owrx.mobile=ext_mobile_info();t.small&&(toggle_or_set_hide_bars(owrx.HIDE_TOPBAR),optbar_focus("optbar-off","init")),t.narrow&&(w3_hide("id-readme"),t.width<600&&toggle_or_set_hide_bars(owrx.HIDE_ALLBARS)),owrx.last_mobile={},owrx.rescale_cnt=owrx.rescale_cnt2=0,setInterval(function(){t=owrx.mobile=ext_mobile_info(owrx.last_mobile),owrx.last_mobile=t;var e;w3_el("id-control");t.orient_unchanged||(owrx.rescale_cnt++,0!=owrx.rescale_cnt2&&toggle_panel("id-control",1),e=t.narrow&&!mobile_laptop_test,mobile_scale_control_panel(t,e))},500)}function mobile_scale_control_panel(e,t){e=e||owrx.mobile;var a=w3_el("id-control");(a.panel_isScaled=t)?(a.style.right="0px",e=e.width/a.uiWidth*.95,a.style.transform="scale("+e.toFixed(2)+")",a.style.transformOrigin="bottom right",owrx.rescale_cnt2++):a.style.transform="none"}var spec={height_spectrum_canvas:200,tooltip_offset:100,source_wf:0,source_audio:0,canvas:null,ctx:null,spectrum_image:null,colormap:null,colormap_transparent:null,dB:null,dB_ttip:null,update:0,last_update:0,need_update:0,need_clear_avg:0,clear_avg:0,avg:[],peak_show:0,peak_clear:0,peak:[],dB_bands:[],redraw_dB_scale:!1};function spectrum_init(){spec.colormap=spec.ctx.createImageData(1,spec.canvas.height),spec.colormap_transparent=spec.ctx.createImageData(1,spec.canvas.height),update_maxmindb_sliders(),spectrum_dB_bands();var e,t,a,_;kiwi_isMobile();setInterval(function(){spec.update++},100),spec.spectrum_image=spec.ctx.createImageData(spec.canvas.width,spec.canvas.height),!wf.audioFFT_active&&rx_chan>=wf_chans&&(e=spec.canvas.width,t=spec.canvas.height,spec.ctx.fillStyle="black",spec.ctx.fillRect(0,0,e,t),spec.ctx.font="18px sans-serif",spec.ctx.fillStyle="white",a=wf_chans?"Spectrum not available for rx"+rx_chan:"Spectrum not allowed on this Kiwi",_=spec.ctx.measureText(a).width,spec.ctx.fillText(a,e/2-_/2,t/2)),kiwi_load_js_dir("extensions/",["waterfall/waterfall.js","colormap/colormap.js"],function(){waterfall_init(),colormap_init()})}function spectrum_dB_bands(){spec.dB_bands=[];var e=0,t=maxdb,a=mindb;t<=a&&(t=-10,a=-110);for(var _=t-a,i=a+-12,o=(o=t-i)||1,n=0,s=0,r=10*Math.floor(t/10);a-r<10;r-=10){var l=1-(r-a)/_;1<l&&(l=1);function d(e){return Math.round(e*spec.canvas.height)}var c=Math.round((r-i)/o*255),f=color_map[c],u=color_map_transparent[c],w="#"+(f>>>8).toString(16).leadingZeros(6),c=d(n),p=d(l);if(0!=c||0!=p){spec.dB_bands[e]={dB:r,y1:c,y2:p,norm:l.toFixed(2),color:w};for(var m=c;m<p;m++){for(var h=0;h<4;h++)spec.colormap.data[4*m+h]=f>>>0>>8*(3-h)&255,spec.colormap_transparent.data[4*m+h]=u>>>0>>8*(3-h)&255;if(8192<s++)break}if(n=l,e++,8192<s++)break}}spec.redraw_dB_scale=!0,w3_call("colormap_aper")}function spectrum_tooltip_update(e,t,a){e.target==spec.dB||e.currentTarget==spec.dB||e.target==spec.dB_ttip||e.currentTarget==spec.dB_ttip?(owrx.debug_drag&&canvas_log("*STTU*"),e=spec.height_spectrum_canvas,0<=a&&a<e&&(t=t-(kiwi_isMobile()?spec.tooltip_offset:0),spec.dB_ttip.style.left=px(t),spec.dB_ttip.style.bottom=px(e+10-a),owrx.debug_drag&&canvas_log("["+t+","+a+"]"),t=format_frequency("{x}",t=(canvas_get_dspfreq(t)+kiwi.freq_offset_Hz)/1e3,1,freq_field_prec(t)),e=(e-a)/e*full_scale+mindb,spec.dB_ttip.innerHTML=t+" kHz<br>"+e.toFixed(0)+" dBm")):owrx.debug_drag&&canvas_log("STTU-ck")}function spectrum_update(e){var t,a;spec.last_update=spec.update;var _=spec.ctx,i=spec.canvas.width-25,o=spec.canvas.height;for(_.fillStyle="black",_.fillRect(0,0,i,o),_.fillStyle="lightGray",c=0;c<spec.dB_bands.length;c++){var n=spec.dB_bands[c],s=Math.round(n.norm*o);_.fillRect(0,s,i,1)}if(spec.clear_avg){for(t=0;t<i;t++)spec.avg[t]=color_index(e[t]);spec.clear_avg=!1,spec.peak_clear=!0}if(spec.peak_clear){for(t=0;t<i;t++)spec.peak[t]=0;spec.peak_clear=!1}if(spec.redraw_dB_scale){for(t=i;t<spec.canvas.width;t++)_.putImageData(spec.colormap_transparent,t,0,0,0,1,o);for(_.fillStyle="white",c=0;c<spec.dB_bands.length;c++){n=spec.dB_bands[c];s=Math.round(n.norm*o),_.fillText(n.dB,3+i,s-4)}spec.redraw_dB_scale=!1}for(_.fillStyle="hsl(180, 100%, 70%)",t=0;t<i;t++){switch(a=color_index(wf_gnd?wf_gnd_value:e[t]),spec_filter){case wf_sp_menu_e.IIR:var r=1-Math.exp(-sp_param*a/255);r<=.01&&(r=.01);var l=spec.avg[t];255<(l+=r*(a-l))&&(l=255),l<0&&(l=0),a=spec.avg[t]=l;break;case wf_sp_menu_e.MMA:255<a&&(a=255),a<0&&(a=0),spec.avg[t]=(spec.avg[t]*(sp_param-1)+a)/sp_param,a=spec.avg[t];break;case wf_sp_menu_e.EMA:255<a&&(a=255),a<0&&(a=0),spec.avg[t]+=(a-spec.avg[t])/sp_param,a=spec.avg[t];break;case wf_sp_menu_e.OFF:default:255<a&&(a=255),a<0&&(a=0)}if(a>spec.peak[t]&&(spec.peak[t]=a),s=Math.round((1-a/255)*o),spectrum_slow_dev)_.fillRect(t,s,1,o-s);else for(var d=!0,c=0;c<spec.dB_bands.length;c++){var f,u=spec.dB_bands[c];d&&s>u.y2||(d=!1,_.fillStyle=u.color,f=u.y2-s,_.fillRect(t,s,1,f),s=u.y2)}}if(spec.peak_show){for(_.lineWidth=1,_.strokeStyle="yellow",_.beginPath(),s=Math.round((1-spec.peak[0]/255)*o)-1,_.moveTo(0,s),t=1;t<i;t++)s=Math.round((1-spec.peak[t]/255)*o)-1,_.lineTo(t,s);_.globalAlpha=.55,_.stroke(),_.globalAlpha=1}}var waterfall_setup_done=0,waterfall_timer,waterfall_ms,waterfall_scrollable_height,wf_canvases=[],old_canvases=[],wf_cur_canvas=null,wf_canvas_default_height=200,wf_canvas_actual_line,wf_canvas_id_seq=1,wf_canvas_maxshift=0;function wf_init(){w3_do_when_cond(function(){return okay_wf_init},function(){wf_init_ready()},0,200)}function wf_init_ready(){init_wf_container(),wf.audioFFT_active=rx_chan>=wf_chans,resize_waterfall_container(!1),resize_wf_canvases(),bands_init(),panels_setup(),scale_setup(),mkcolormap(),mkscale(),spectrum_init(),dx_schedule_update(),users_init({user:1}),ident_init(),stats_init(),check_top_bar_congestion(),spectrum_show&&setTimeout(spec_show,2e3),audioFFT_setup(),waterfall_ms=900/wf_fps_max,waterfall_timer=window.setInterval(waterfall_dequeue,waterfall_ms),""!=shortcut.keys&&setTimeout(keyboard_shortcut_url_keys,3e3),wf_snap(kiwi_storeGet("wf_snap")),kiwi_isMobile()&&mobile_init(),dx_init(),waterfall_setup_done=1}function add_wf_canvas(){var e=create_canvas("id-wf-canvas",wf_fft_size,wf_canvas_default_height,waterfall_width,wf_canvas_default_height);e.id_seq=wf_canvas_id_seq++,wf_canvas_actual_line=wf_canvas_default_height-1,e.style.left=0,e.openwebrx_height=wf_canvas_default_height,e.openwebrx_top=1-wf_canvas_default_height,e.style.top=px(e.openwebrx_top),e.oneline_image=e.ctx.createImageData(wf_fft_size,1),wf_container.appendChild(e),add_canvas_listner(e),wf_canvases.unshift(e),wf_cur_canvas=e,kiwi_gc_wf&&(e=null)}function wf_shift_canvases(){for(wf_canvases.forEach(function(e){e.style.top=px(e.openwebrx_top++)});wf_canvases.length;){var e=wf_canvases[wf_canvases.length-1];if(null==e||e.openwebrx_top<waterfall_scrollable_height){kiwi_gc_wf&&(e=null);break}var t=wf_canvases[wf_canvases.length-2];t&&old_canvases.unshift(t),15<old_canvases.length&&old_canvases.pop(),kiwi_gc_wf&&remove_canvas_listner(e),wf_container.removeChild(e),kiwi_gc_wf&&(e=wf_canvases[wf_canvases.length-1]=null),wf_canvases.pop()}++wf_canvas_maxshift<wf_container.clientHeight?(canvas_phantom.style.top=px(wf_canvas_maxshift),canvas_phantom.style.height=px(wf_container.clientHeight-wf_canvas_maxshift),w3_show_block(canvas_phantom)):canvas_phantom.hidden||(w3_hide(canvas_phantom),canvas_phantom.hidden=!0)}function resize_wf_canvases(){window_width=wf_container.innerWidth,waterfall_width=wf_container.clientWidth,new_width=px(waterfall_width);wf_canvases.forEach(function(e){e.style.width=new_width,e.style.left=0}),canvas_annotation.width=waterfall_width,canvas_annotation.style.width=new_width,canvas_phantom.style.width=new_width,canvas_phantom.style.left=0,spec.canvas.style.width=new_width,wf.audioFFT_active&&w3_innerHTML("id-annotation-div",w3_div("w3-section w3-container",w3_text("w3-large|color:cyan","Audio FFT<br>"),w3_text("w3-small|color:cyan","Zoom waterfall not available<br>"+(wf.no_wf?'when "no_wf" URL option used.<br>':"on channels "+wf_chans_real+"-"+(rx_chans-1)+" of Kiwis<br>configured for "+rx_chans+" channels.<br>")),w3_text("w3-small|color:cyan","For details see the Kiwi forum.")))}function waterfall_timestamp(){var e,t=0==wf.ts_tz?(new Date).toUTCString().substr(17,8):(new Date).toString().substr(16,8),a=wf_canvas_actual_line,_=wf_cur_canvas;w3_fillText_shadow(_,t,12,a+12,"Arial",14,"lime"),a+10>_.height&&((e=wf_canvases[1])&&w3_fillText_shadow(e,t,12,a-_.height+12,"Arial",14,"lime"))}function wf_snap(e){owrx.wf_snap=isUndefined(e)?1^owrx.wf_snap:isNull(e)?0:+e,w3_el("id-waterfall-container").style.cursor=owrx.wf_cursor=owrx.wf_snap?"col-resize":"crosshair",kiwi_storeSet("wf_snap",owrx.wf_snap)}var page_scroll_amount=.8;function page_scroll(e){wf.audioFFT_active||waterfall_pan_canvases(norm_to_bins(e)),freqset_select()}function page_scroll_icon_click(e,t){any_alternate_click_event(e)?dx_label_step(t<0?-1:1):(page_scroll(t),owrx.debug_drag&&(canvas_log("\f"),owrx.drag_count=0))}var waterfall_dont_scale=0,need_maxmindb_update=!1,need_clear_wf_sp_avg=!1,need_clear_wfavg=!1,clear_wfavg=!0,wfavg=[],wf_swallow_samples=[2,4,8,18],x_bin_server_last,wf_swallow=0;function waterfall_add(e,t){var a;if(null!=e){var _=wf_cur_canvas;if(null!=_){var i,o=wf_fft_size;if(0==t){var n=new Uint32Array(e,4,3),s=n[0],r=n[1];kiwi_gc_wf&&(n=null);var l,d=65535&r,c=r>>16&65535,f=1,u=2,r=(n=new Uint8Array(e,16)).length;if(need_maxmindb_update&&zoom_level==d&&(update_maxmindb_sliders(),need_maxmindb_update=!1),x_bin==s&&zoom_level==d&&((need_clear_wf_sp_avg||spec.need_clear_avg)&&(spec.clear_avg=!0),(need_clear_wf_sp_avg||need_clear_wfavg)&&(clear_wfavg=!0),need_clear_wf_sp_avg=need_clear_wfavg=spec.need_clear_avg=!1),l=c&f?(i=new Uint8Array(2*r),decode_ima_adpcm_e8_u8(n,i,r,{index:0,previousValue:0}),i.subarray(10)):n,wf.no_sync=c&u,wf_swallow)return void wf_swallow--;s!=x_bin_server_last&&(x_bin_server_last=s,11<=zoom_level&&(wf_swallow=wf_swallow_samples[zoom_level-11],wf_fps!=wf_fps_max&&(wf_swallow=Math.round(wf_swallow*wf_fps/wf_fps_max))))}else l=e,spec.source_wf&&spec.need_clear_avg&&(spec.clear_avg=!0,spec.need_clear_avg=!1);spec.source_wf&&spec.update!=spec.last_update&&spectrum_update(l);for(var w=_.oneline_image,p=0;p<o;p++){switch(a=color_index(wf_gnd?wf_gnd_value:l[p],wf.sqrt),wf_filter){case wf_sp_menu_e.IIR:clear_wfavg&&(wfavg[p]=a);var m=1-Math.exp(-wf_param*a/255);m<=.01&&(m=.01);var h=wfavg[p];255<(h+=m*(a-h))&&(h=255),h<0&&(h=0),wfavg[p]=h,a=Math.round(wfavg[p]);break;case wf_sp_menu_e.MMA:clear_wfavg&&(wfavg[p]=a),wfavg[p]=(wfavg[p]*(wf_param-1)+a)/wf_param,a=Math.round(wfavg[p]);break;case wf_sp_menu_e.EMA:clear_wfavg&&(wfavg[p]=a),wfavg[p]+=(a-wfavg[p])/wf_param,a=Math.round(wfavg[p]);break;case wf_sp_menu_e.OFF:}w.data[4*p]=color_map_r[a],w.data[4*p+1]=color_map_g[a],w.data[4*p+2]=color_map_b[a],w.data[4*p+3]=255}clear_wfavg=clear_wfavg&&!1,_.ctx.putImageData(w,0,wf_canvas_actual_line),0==t&&w3_call("IBP_scan_plot",w),"undefined"!=typeof wfext&&wfext.tstamp&&(x=(60*(g=new Date).getUTCMinutes()+g.getUTCSeconds())%wfext.tstamp==0,0==wf.prev_sec_mark&&1==x&&waterfall_timestamp(),wf.prev_sec_mark=x);var g,x,b,u=!1;if(0!=t||wf.no_sync||(sb_trace&&console.log("WF fixup bin="+x_bin+"/"+s+" z="+zoom_level+"/"+d),zoom_level!=d&&(b=bins_to_pixels(2,t=(x=(g=zoom_level-d)<0)?s-x_bin:x_bin-s,x?zoom_level:d),sb_trace&&console.log("WF Z fix z"+d+">"+zoom_level+" out="+x+" b="+x_bin+"/"+s+"/"+t+" px="+b),waterfall_zoom(_,g,wf_canvas_actual_line,b),s+=x?-t:t,sb_trace&&console.log("WF z fixed"),u=!0),x_bin!=s&&(b=bins_to_pixels(3,x_bin-s,zoom_level),sb_trace&&console.log("WF bin fix L="+wf_canvas_actual_line+" xb="+x_bin+" xbs="+s+" pdx="+b),waterfall_pan(_,wf_canvas_actual_line,b),sb_trace&&console.log("WF bin fixed"),u=!0),sb_trace&&x_bin==s&&zoom_level==d&&(console.log("--WF FIXUP ALL DONE--"),sb_trace=0)),1<wf.need_autoscale&&wf.need_autoscale--,1==wf.need_autoscale&&!u){for(var v=[],k=wf.audioFFT_active?l.slice(256,768):l,y=k.length,q=0,T=0;T<y;T++){var M=dB_wire_to_dBm(k[T]);M<=-190||(v[q]=M,q++)}var z,S,s=v.length;s?(v.sort(function(e,t){return e-t}),z=v[Math.floor(.5*s)],S=v[Math.floor(.95*s)],console_log_dbgUs("# autoscale len="+s+" min="+v[0]+" noise="+z+" signal="+S+" max="+v[s-1]),d=v[Math.floor(.1*s)],u=v[Math.floor(.2*s)],console_log_dbgUs("# autoscale min="+v[0]+" 10%="+d+" 20%="+u+" 50%(noise)="+z+" 95%(signal)="+S+" max="+v[s-1])):(S=-110,z=-120),(S+=30)<-80&&(S=-80),z-=10,wf.audioFFT_active&&(z=dbgUs&&devl.p4?Math.round(devl.p4):-110,console_log_dbgUs("audioFFT_active: force noise = "+z.toFixed(0)+" dBm")),setmaxdb(1,S),setmindb(1,z),update_maxmindb_sliders(),wf.need_autoscale=0}wf_canvas_actual_line--,wf_shift_canvases(),wf_canvas_actual_line<0&&add_wf_canvas(),kiwi_gc_wf&&(_=e=n=i=l=null)}}}function waterfall_pan(e,t,a){function _(e,t,a){return e<t?t:a<e?a:e}var i,o,n=e.ctx,s=e.width,r=-1==t?(i=0,e.height):(i=t,1);try{sb_trace&&console.log("waterfall_pan h="+r+" dx="+a),a<0?(o=s-(a=-a),sb_trace&&console.log("PAN-L w="+o+" dx="+a),0<o&&n.drawImage(e,0,i,o,r,a,i,o,r),n.fillStyle="Black",sb_trace&&(n.fillStyle=-1==t?"Lime":"Red"),fx=_(a,0,s),n.fillRect(0,i,fx,r)):(o=s-a,sb_trace&&console.log("PAN-R w="+o+" dx="+a),0<o&&n.drawImage(e,a,i,o,r,0,i,o,r),n.fillStyle="Black",sb_trace&&(n.fillStyle=-1==t?"Lime":"Red"),fx=_(o,0,s),n.fillRect(fx,i,s,r))}catch(e){console.log("EX WFPAN "+e.toString()+" dx="+a+" y="+i+" w="+o+" h="+r)}}var last_pixels_frac=0;function waterfall_pan_canvases(e){var t,a;e&&(wf.audioFFT_active||(t=x_bin,e=bins_to_pixels_frac(4,(x_bin=clamp_xbin(x_bin+=e))-t,zoom_level)+last_pixels_frac,a=Math.round(e),last_pixels_frac=e-a,sb_trace&&console.log("PAN-CAN z="+zoom_level+" xb="+x_bin+" db="+(x_bin-t)+" f_dx="+e+" i_dx="+a+" lpf="+last_pixels_frac),a&&(wf_canvases.forEach(function(e){waterfall_pan(e,-1,a)}),wf_send("SET zoom="+zoom_level+" start="+x_bin),mkscale(),need_clear_wf_sp_avg=!0,dx_schedule_update(),extint_environment_changed({waterfall_pan:1}),passband_visible()<0&&check_band(!0))))}function waterfall_zoom(e,t,a,_){function i(e,t,a){return e<t?t:a<e?a:e}var o,n,s,r,l=e.ctx,d=e.width,c=1<<Math.abs(t),f=d/c,u=-1==a?(n=0,e.height):(n=a,1);try{sb_trace&&console.log("waterfall_zoom w="+d+" h="+u+" pw="+f+" zf="+c),t<0?(sb_trace&&console.log("WFZ-out srcX=0/"+d+" dstX="+_+"/"+(_+f)+" (pw="+f+")"),l.drawImage(e,0,n,d,u,_,n,f,u),l.fillStyle="Black",sb_trace&&(console.log("chocolate 0:"+_),l.fillStyle="chocolate"),o=i(_,0,d),l.fillRect(0,n,o,n+u),sb_trace&&(console.log("brown "+(_+f)+":"+d),l.fillStyle="brown"),o=i(_+f,0,d),l.fillRect(o,n,d,n+u)):0!=d&&(sb_trace&&console.log("WFZ-in srcX="+_+"/"+(_+f)+"(pw="+f+") dstX=0/"+d),r=s=!1,d<_+f&&(o=Math.round((d-_)*c),sb_trace&&console.log("CLAMP HI fx="+o),s=!0),_<0&&(o=Math.round(-_*c),sb_trace&&console.log("CLAMP LO fx="+o),r=!0),l.drawImage(e,_,n,f,u,0,n,d,u),l.fillStyle="Black",sb_trace&&(l.fillStyle="deepPink"),s&&l.fillRect(o,n,d,n+u),r&&l.fillRect(0,n,o,n+u))}catch(e){console.log("EX WFZ "+e.toString()+" dz="+t+" x="+_+" y="+n+" w="+d+" h="+u)}}function waterfall_zoom_canvases(t,a){sb_trace&&console.log("ZOOM-CAN z"+zoom_level+" xb="+x_bin+" x="+a),wf_canvases.forEach(function(e){waterfall_zoom(e,t,-1,a)}),need_clear_wf_sp_avg=!0}function waterfall_height(){var e=html("id-top-container").clientHeight,t=html("id-non-waterfall-container").clientHeight,a=html("id-scale-container").clientHeight;return owrx.scale_offsetY=e+t-a,window.innerHeight-e-t}function resize_waterfall_container(e){e&&!waterfall_setup_done||(e=waterfall_height(),waterfall_scrollable_height=0<=e?(canvas_annotation.style.height=wf_container.style.height=px(e),(canvas_annotation.height=e)*wf.scroll_multiple):0)}var waterfall_delay=0,waterfall_queue=[],waterfall_last_add=0;function waterfall_add_queue(e,t,a){if("DAT"!=a){var _=new Uint32Array(e,4,3)[2];kiwi_gc_wf&&0;var i=Date.now(),a=waterfall_last_add?i-waterfall_last_add:0;waterfall_last_add=i,waterfall_queue.push({data:e,audioFFT:0,seq:_,spacing:a}),kiwi_gc_wf&&(e=null)}else{var o=new Uint8Array(e,4),e=o[0];if(0==e){for(var n=0;n<768;n++)downloaded_colormap[n]=o[n+1];mkcolormap(),console.log("W/F DAT downloaded_colormap")}else console.log("W/F DAT unknown cmd="+e)}}var init_zoom_set=!1,waterfall_last_out=0,wf_dq_onesec=0;function waterfall_dequeue(){if(!init_zoom_set&&demodulators[0]&&(init_zoom=parseInt(init_zoom),(init_zoom<0||init_zoom>zoom_levels_max)&&(init_zoom=0),zoom_step(ext_zoom.ABS,init_zoom),init_zoom_set=!0),waterfall_setup_done&&0!=waterfall_queue.length)for(;0!=waterfall_queue.length;){var e=Date.now();if(!wf.no_sync){var t=waterfall_queue[0].seq;if(audio_ext_sequence+waterfall_delay<t)return;if(t==audio_ext_sequence&&e<waterfall_last_out+waterfall_queue[0].spacing)return}waterfall_last_out=e;t=waterfall_queue[0].data;kiwi_gc_wf&&(waterfall_queue[0].data=null);e=waterfall_queue[0].audioFFT;waterfall_queue.shift(),waterfall_add(t,e),kiwi_gc_wf&&0}}var downloaded_colormap=new Uint8Array(768);turbo_colormap_data=[.18995,.07176,.23217,.19483,.08339,.26149,.19956,.09498,.29024,.20415,.10652,.31844,.2086,.11802,.34607,.21291,.12947,.37314,.21708,.14087,.39964,.22111,.15223,.42558,.225,.16354,.45096,.22875,.17481,.47578,.23236,.18603,.50004,.23582,.1972,.52373,.23915,.20833,.54686,.24234,.21941,.56942,.24539,.23044,.59142,.2483,.24143,.61286,.25107,.25237,.63374,.25369,.26327,.65406,.25618,.27412,.67381,.25853,.28492,.693,.26074,.29568,.71162,.2628,.30639,.72968,.26473,.31706,.74718,.26652,.32768,.76412,.26816,.33825,.7805,.26967,.34878,.79631,.27103,.35926,.81156,.27226,.3697,.82624,.27334,.38008,.84037,.27429,.39043,.85393,.27509,.40072,.86692,.27576,.41097,.87936,.27628,.42118,.89123,.27667,.43134,.90254,.27691,.44145,.91328,.27701,.45152,.92347,.27698,.46153,.93309,.2768,.47151,.94214,.27648,.48144,.95064,.27603,.49132,.95857,.27543,.50115,.96594,.27469,.51094,.97275,.27381,.52069,.97899,.27273,.5304,.98461,.27106,.54015,.9893,.26878,.54995,.99303,.26592,.55979,.99583,.26252,.56967,.99773,.25862,.57958,.99876,.25425,.5895,.99896,.24946,.59943,.99835,.24427,.60937,.99697,.23874,.61931,.99485,.23288,.62923,.99202,.22676,.63913,.98851,.22039,.64901,.98436,.21382,.65886,.97959,.20708,.66866,.97423,.20021,.67842,.96833,.19326,.68812,.9619,.18625,.69775,.95498,.17923,.70732,.94761,.17223,.7168,.93981,.16529,.7262,.93161,.15844,.73551,.92305,.15173,.74472,.91416,.14519,.75381,.90496,.13886,.76279,.8955,.13278,.77165,.8858,.12698,.78037,.8759,.12151,.78896,.86581,.11639,.7974,.85559,.11167,.80569,.84525,.10738,.81381,.83484,.10357,.82177,.82437,.10026,.82955,.81389,.0975,.83714,.80342,.09532,.84455,.79299,.09377,.85175,.78264,.09287,.85875,.7724,.09267,.86554,.7623,.0932,.87211,.75237,.09451,.87844,.74265,.09662,.88454,.73316,.09958,.8904,.72393,.10342,.896,.715,.10815,.90142,.70599,.11374,.90673,.69651,.12014,.91193,.6866,.12733,.91701,.67627,.13526,.92197,.66556,.14391,.9268,.65448,.15323,.93151,.64308,.16319,.93609,.63137,.17377,.94053,.61938,.18491,.94484,.60713,.19659,.94901,.59466,.20877,.95304,.58199,.22142,.95692,.56914,.23449,.96065,.55614,.24797,.96423,.54303,.2618,.96765,.52981,.27597,.97092,.51653,.29042,.97403,.50321,.30513,.97697,.48987,.32006,.97974,.47654,.33517,.98234,.46325,.35043,.98477,.45002,.36581,.98702,.43688,.38127,.98909,.42386,.39678,.99098,.41098,.41229,.99268,.39826,.42778,.99419,.38575,.44321,.99551,.37345,.45854,.99663,.3614,.47375,.99755,.34963,.48879,.99828,.33816,.50362,.99879,.32701,.51822,.9991,.31622,.53255,.99919,.30581,.54658,.99907,.29581,.56026,.99873,.28623,.57357,.99817,.27712,.58646,.99739,.26849,.59891,.99638,.26038,.61088,.99514,.2528,.62233,.99366,.24579,.63323,.99195,.23937,.64362,.98999,.23356,.65394,.98775,.22835,.66428,.98524,.2237,.67462,.98246,.2196,.68494,.97941,.21602,.69525,.9761,.21294,.70553,.97255,.21032,.71577,.96875,.20815,.72596,.9647,.2064,.7361,.96043,.20504,.74617,.95593,.20406,.75617,.95121,.20343,.76608,.94627,.20311,.77591,.94113,.2031,.78563,.93579,.20336,.79524,.93025,.20386,.80473,.92452,.20459,.8141,.91861,.20552,.82333,.91253,.20663,.83241,.90627,.20788,.84133,.89986,.20926,.8501,.89328,.21074,.85868,.88655,.2123,.86709,.87968,.21391,.8753,.87267,.21555,.88331,.86553,.21719,.89112,.85826,.2188,.8987,.85087,.22038,.90605,.84337,.22188,.91317,.83576,.22328,.92004,.82806,.22456,.92666,.82025,.2257,.93301,.81236,.22667,.93909,.80439,.22744,.94489,.79634,.228,.95039,.78823,.22831,.9556,.78005,.22836,.96049,.77181,.22811,.96507,.76352,.22754,.96931,.75519,.22663,.97323,.74682,.22536,.97679,.73842,.22369,.98,.73,.22161,.98289,.7214,.21918,.98549,.7125,.2165,.98781,.7033,.21358,.98986,.69382,.21043,.99163,.68408,.20706,.99314,.67408,.20348,.99438,.66386,.19971,.99535,.65341,.19577,.99607,.64277,.19165,.99654,.63193,.18738,.99675,.62093,.18297,.99672,.60977,.17842,.99644,.59846,.17376,.99593,.58703,.16899,.99517,.57549,.16412,.99419,.56386,.15918,.99297,.55214,.15417,.99153,.54036,.1491,.98987,.52854,.14398,.98799,.51667,.13883,.9859,.50479,.13367,.9836,.49291,.12849,.98108,.48104,.12332,.97837,.4692,.11817,.97545,.4574,.11305,.97234,.44565,.10797,.96904,.43399,.10294,.96555,.42241,.09798,.96187,.41093,.0931,.95801,.39958,.08831,.95398,.38836,.08362,.94977,.37729,.07905,.94538,.36638,.07461,.94084,.35566,.07031,.93612,.34513,.06616,.93125,.33482,.06218,.92623,.32473,.05837,.92105,.31489,.05475,.91572,.3053,.05134,.91024,.29599,.04814,.90463,.28696,.04516,.89888,.27824,.04243,.89298,.26981,.03993,.88691,.26152,.03753,.88066,.25334,.03521,.87422,.24526,.03297,.8676,.2373,.03082,.86079,.22945,.02875,.8538,.2217,.02677,.84662,.21407,.02487,.83926,.20654,.02305,.83172,.19912,.02131,.82399,.19182,.01966,.81608,.18462,.01809,.80799,.17753,.0166,.79971,.17055,.0152,.79125,.16368,.01387,.7826,.15693,.01264,.77377,.15028,.01148,.76476,.14374,.01041,.75556,.13731,.00942,.74617,.13098,.00851,.73661,.12477,.00769,.72686,.11867,.00695,.71692,.11268,.00629,.7068,.1068,.00571,.6965,.10102,.00522,.68602,.09536,.00481,.67535,.0898,.00449,.66449,.08436,.00424,.65345,.07902,.00408,.64223,.0738,.00401,.63082,.06868,.00401,.61923,.06367,.0041,.60746,.05878,.00427,.5955,.05399,.00453,.58336,.04931,.00486,.57103,.04474,.00529,.55852,.04028,.00579,.54583,.03593,.00638,.53295,.03169,.00705,.51989,.02756,.0078,.50664,.02354,.00863,.49321,.01963,.00955,.4796,.01583,.01055];var spectrum_scale_color_map_transparency=200,color_map=new Uint32Array(256),color_map_transparent=new Uint32Array(256),color_map_r=new Uint8Array(256),color_map_g=new Uint8Array(256),color_map_b=new Uint8Array(256);function mkcolormap(){var e;wf.cmap>=kiwi.cmap_e.custom_1&&(e=wf.custom_colormaps[wf.cmap-kiwi.cmap_e.custom_1]);for(var t,a,_,i,o,n,s=0;s<256;s++){switch(wf.cmap){case kiwi.cmap_e.kiwi:n=s<32?(o=r=0,255*s/31):s<72?(r=0,o=255*(s-32)/39,255):s<96?(r=0,(o=255)-255*(s-72)/23):s<116?(r=255*(s-96)/19,o=255,0):s<184?(o=(r=255)-255*(s-116)/67,0):(r=255,o=0,128*(s-184)/70);break;case kiwi.cmap_e.CuteSDR:n=s<43?(o=r=0,255*s/43):s<87?(r=0,o=255*(s-43)/43,255):s<120?(r=0,(o=255)-255*(s-87)/32):s<154?(r=255*(s-120)/33,o=255,0):s<217?(o=(r=255)-255*(s-154)/62,0):(r=255,o=0,128*(s-217)/38);break;case kiwi.cmap_e.greyscale:black_level=0,white_level=48;var r=o=n=black_level+(255-black_level+white_level)*s/255;break;case kiwi.cmap_e.linear:r=255*(s/255)+0*((255-s)/255),r*=1+s/255*0,o=0*(s/255)+255*((255-s)/255),o*=1+s/255*0,n=255*(s/255)+0*((255-s)/255),n*=1+s/255*0;break;case kiwi.cmap_e.turbo:r=255*turbo_colormap_data[3*s+0],o=255*turbo_colormap_data[3*s+1],n=255*turbo_colormap_data[3*s+2];break;case kiwi.cmap_e.SdrDx:l=s<=20?(n=.5,i=o=r=_=a=t=0,20):s<=60?(_=.5,o=r=a=t=0,n=1,i=21,60):s<=150?(o=r=_=1,n=a=t=0,i=61,150):s<=180?(r=a=t=1,n=o=_=0,i=151,180):s<=210?(_=a=0,n=o=r=t=1,i=181,210):(n=o=r=_=a=t=1,i=211,255);var l=(s-i)/(l-i);r=255*(t+(r-t)*l),o=255*(a+(o-a)*l),n=255*(_+(n-_)*l);break;default:r=e[3*s+0],o=e[3*s+1],n=e[3*s+2]}r=Math.round(r),r=w3_clamp(r,0,255),o=Math.round(o),o=w3_clamp(o,0,255),n=Math.round(n),n=w3_clamp(n,0,255),color_map[s]=r<<24|o<<16|n<<8|255,color_map_transparent[s]=r<<24|o<<16|n<<8|spectrum_scale_color_map_transparency,color_map_r[s]=r,color_map_g[s]=o,color_map_b[s]=n}}function dB_wire_to_dBm(e){return e<0&&(e=0),255<e&&(e=255),-(255-e)+cfg.waterfall_cal}function color_index(e,t){e=dB_wire_to_dBm(e);e<mindb&&(e=mindb),maxdb<e&&(e=maxdb);var a=(e-mindb)/full_scale,_=a;if(isDefined(t))try{switch(+t){case 0:default:break;case 1:_=Math.sqrt(a);break;case 2:.21<a&&a<.5&&(_=.2+.09*(4+Math.log10(a-.2)));break;case 3:.31<a&&a<.6&&(_=.3+.07*(5+Math.log10(a-.3)));break;case 4:.41<a&&a<.7&&(_=.4+.055*(6+Math.log10(a-.4)))}}catch(e){_=a}e=255*_;return(e=Math.round(e))<0&&(e=0),255<e&&(e=255),e}function waterfall_color_index_max_min(e,t,a){(e=-(255-e))<a&&(e=a),t<e&&(e=t);t-=a,t=255*((e-a)/(t=t||1));return(t=Math.round(t))<0&&(t=0),255<t&&(t=255),t}function color_index_max_min(e,t,a){e<a&&(e=a),t<e&&(e=t);t-=a,t=255*((e-a)/(t=t||1));return(t=Math.round(t))<0&&(t=0),255<t&&(t=255),t}var afft={init:!1,comp_1x:!1,prev_lsb:!1,audioFFT_dynload:{},offt:0,i_re:0,i_im:0,o_re:0,o_im:0,window_512:[],window_1k:[],window_2k:[],pwr_dB:[],dBi:[],CUTESDR_MAX_VAL:32767},freq_displayed_Hz,freq_displayed_kHz_str,freq_displayed_kHz_str_with_freq_offset,freq_car_Hz,freqset_tout,freq_dsp_set_last;function audioFFT_setup(){if(wf.audioFFT_active){var e,t;zoom_level=0,wf.aper!=kiwi.aper_e.auto&&(e=readCookie("last_AF_max_dB",maxdb),t=readCookie("last_AF_min_dB",mindb_un),setmaxdb(1,e),setmindb(1,t),update_maxmindb_sliders());function a(e,t){return.5-.5*Math.cos(2*Math.PI*e/(t-1))}for(i=0;i<512;i++)afft.window_512[i]=a(i,512);for(i=0;i<1024;i++)afft.window_1k[i]=a(i,1024);for(i=0;i<2048;i++)afft.window_2k[i]=a(i,2048)}}function audioFFT_update(){mkscale(),dx_schedule_update(),freq_link_update(),w3_innerHTML("id-nav-optbar-wf","WF"),freqset_select(),wf.audioFFT_clear_wf&&(wf_canvases.forEach(function(e){e.ctx.fillStyle="Black",e.ctx.fillRect(0,0,e.width,e.height)}),spec.need_clear_avg=!0,wf.audioFFT_clear_wf=!1,wf.aper==kiwi.aper_e.auto&&wf.audioFFT_active&&(wf.need_autoscale=16))}function wf_audio_FFT(e,t){if(wf.audioFFT_active&&isDefined(cur_mode)&&kiwi_load_js_polled(afft.audioFFT_dynload,["pkgs/js/Ooura_FFT32.js"])){var a,_,i,o,n=ext_is_IQ_or_stereo_curmode(),s="ls"==cur_mode.substr(0,2)||"sal"==cur_mode,r=!afft.init||n!=afft.iq||audio_compression!=afft.comp;if(r&&(console.log("audio_FFT: SWITCHING iq="+n+" comp="+audio_compression),n?(afft.size=1024,afft.offt=ooura32.FFT(afft.size,{type:"complex",radix:4}),afft.i_re=ooura32.vectorArrayFactory(afft.offt),afft.i_im=ooura32.vectorArrayFactory(afft.offt)):(afft.size=audio_compression?afft.comp_1x?2048:1024:512,afft.offt=ooura32.FFT(afft.size,{type:"real",radix:4}),afft.i_re=ooura32.scalarArrayFactory(afft.offt)),afft.o_re=ooura32.vectorArrayFactory(afft.offt),afft.o_im=ooura32.vectorArrayFactory(afft.offt),afft.scale=20/(afft.size*afft.size*afft.size*afft.CUTESDR_MAX_VAL*afft.CUTESDR_MAX_VAL),afft.init||wf.aper==kiwi.aper_e.auto||(wf.need_autoscale=16),afft.iq=n,afft.comp=audio_compression,afft.init=!0),r||s!=afft.prev_lsb){for(a=0;a<1024;a++)afft.pwr_dB[a]=0;afft.prev_lsb=s}if(afft.iq){for(_=a=0;a<1024;a+=2,_++)afft.i_re[_]=e[a]*afft.window_512[_],afft.i_im[_]=e[a+1]*afft.window_512[_];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.i_im.buffer,afft.o_re.buffer,afft.o_im.buffer),_=0,i=512;_<256;_++,i++){var l=(c=afft.o_re[_])*c+(f=afft.o_im[_])*f,d=10*Math.log10(l*afft.scale+1e-30);d=Math.round(255+d),afft.pwr_dB[i]=d}for(i=_=256;_<512;_++,i++){l=(c=afft.o_re[_])*c+(f=afft.o_im[_])*f,d=10*Math.log10(l*afft.scale+1e-30);d=Math.round(255+d),afft.pwr_dB[i]=d}waterfall_queue.push({data:afft.pwr_dB,audioFFT:1,seq:0,spacing:0})}else if(audio_compression){if(afft.comp_1x){for(a=0;a<2048;a++)afft.i_re[a]=e[a]*afft.window_2k[a];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.o_re.buffer,afft.o_im.buffer),o=s?(i=512,-1):(i=256,1),_=0;_<1024;_++){l=(c=afft.o_re[_])*c+(f=afft.o_im[_])*f;afft.dBi[1&_]=Math.round(255+10*Math.log10(l*afft.scale+1e-30)),1&_&&(afft.pwr_dB[i]=Math.max(afft.dBi[0],afft.dBi[1]),i+=o)}}else{for(a=0;a<1024;a++)afft.i_re[a]=e[a]*afft.window_1k[a];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.o_re.buffer,afft.o_im.buffer),o=s?(i=512,-1):(i=256,1),_=0;_<512;_++,i+=o){l=(c=afft.o_re[_])*c+(f=afft.o_im[_])*f;afft.pwr_dB[i]=Math.round(255+10*Math.log10(l*afft.scale+1e-30))}for(waterfall_queue.push({data:afft.pwr_dB,audioFFT:1,seq:0,spacing:0}),a=1024;a<2048;a++)afft.i_re[a]=e[a]*afft.window_2k[a-1024];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.o_re.buffer,afft.o_im.buffer),o=s?(i=512,-1):(i=256,1),_=0;_<512;_++,i+=o){l=(c=afft.o_re[_])*c+(f=afft.o_im[_])*f;afft.pwr_dB[i]=Math.round(255+10*Math.log10(l*afft.scale+1e-30))}}waterfall_queue.push({data:afft.pwr_dB,audioFFT:1,seq:0,spacing:0})}else{for(a=0;a<512;a++)afft.i_re[a]=e[a]*afft.window_512[a];for(afft.offt.fft(afft.offt,afft.i_re.buffer,afft.o_re.buffer,afft.o_im.buffer),o=s?(i=512,-2):(i=256,2),_=0;_<256;_++,i+=o){var c,f,l=(c=afft.o_re[_])*c+(f=afft.o_im[_])*f;afft.pwr_dB[i]=afft.pwr_dB[i+1]=Math.round(255+10*Math.log10(l*afft.scale+1e-30))}waterfall_queue.push({data:afft.pwr_dB,audioFFT:1,seq:0,spacing:0})}}}function freq_dsp_to_car(e){var t=demodulators[0];if(isUndefined(t))return console.log("freq_dsp_to_car no demod?"),e;var a=t.low_cut+(t.high_cut-t.low_cut)/2;return fcar=t.isCW?e-a:e,fcar<0&&(fcar=0),fcar>bandwidth&&(fcar=bandwidth),fcar}function freq_car_to_dsp(e){var t=demodulators[0];if(isUndefined(t))return e;var a=t.low_cut+(t.high_cut-t.low_cut)/2;return fdsp=t.isCW?e+a:e,fdsp}function passband_offset(){var e=0,t=demodulators[0];return isDefined(t)&&(e=t.usePBCenter?t.low_cut+(t.high_cut-t.low_cut)/2:0),e}function freq_passband_center(){var e=0,t=demodulators[0];return isDefined(t)&&(e=center_freq+t.offset_frequency,e+=t.low_cut+(t.high_cut-t.low_cut)/2),e}function passband_offset_dxlabel(e){var t=cfg.passbands[e],e=e.substr(0,2);return"us"==e||"ls"==e?t.lo+(t.hi-t.lo)/2:0}function freqmode_set_dsp_kHz(e,t,a){var _=w3_opt(a,"dont_clear_wf",!1),i=w3_opt(a,"open_ext",!1),o=w3_opt(a,"no_set_freq",0);e*=1e3,0==_&&(wf.audioFFT_clear_wf=!0),!isArg(t)||t==cur_mode&&1!=i?(freq_car_Hz=freq_dsp_to_car(e),o||demodulator_set_offset_frequency(0,freq_car_Hz-center_freq)):ext_set_mode(t,e,a)}function freqset_car_Hz(e){freq_car_Hz=e}function freq_field_prec(e){var t=1e5-(cfg.max_freq?32e3:3e4);return!(kiwi.freq_offset_kHz>=t)&&cfg.show_1Hz?3:2}function freq_field_width(){var e=1e5-(cfg.max_freq?32e3:3e4);return(kiwi.freq_offset_kHz>=e||cfg.show_1Hz?6.25:5.75)+"em"}function freqset_update_ui(){var e,t=(freq_displayed_Hz=freq_car_to_dsp(freq_car_Hz))/1e3;freq_displayed_kHz_str=t.toFixed(freq_field_prec(t)),waterfall_setup_done&&(e=w3_el("id-freq-input"),isUndefined(e)||null==e||(t=(freq_displayed_Hz+kiwi.freq_offset_Hz)/1e3,freq_displayed_kHz_str_with_freq_offset=t.toFixed(freq_field_prec(t)),e.value=freq_displayed_kHz_str_with_freq_offset,freqset_select(),0<=(e=-passband_visible()-1)&&waterfall_pan_canvases(e-(x_bin+bins_at_cur_zoom()/2)),check_band(),writeCookie("last_freq",freq_displayed_kHz_str_with_freq_offset),freq_dsp_set_last=freq_displayed_kHz_str_with_freq_offset,freq_step_update_ui(),freq_link_update(),vfo_update(),freq_memory_update(freq_displayed_kHz_str_with_freq_offset),kiwi_clearTimeout(owrx.popup_keyboard_active_timeout),owrx.popup_keyboard_active_timeout=setTimeout(function(){owrx.popup_keyboard_active=!1},2e3)))}function vfo_update(){var e;owrx.vfo_first&&(t=freq_displayed_kHz_str_with_freq_offset+cur_mode+"z"+zoom_level,e=parseInt(initCookie("last_vfo_A",t)),t=parseInt(initCookie("last_vfo_B",t)),freq_displayed_kHz_str_with_freq_offset!=e&&freq_displayed_kHz_str_with_freq_offset==t&&(owrx.vfo_ab=1,w3_flip_colors("id-freq-vfo","w3-aqua w3-orange",owrx.vfo_ab),w3_innerHTML("id-freq-vfo","AB"[owrx.vfo_ab])),owrx.vfo_first=!1);var t=freq_displayed_kHz_str_with_freq_offset+cur_mode+"z"+zoom_level;writeCookie("last_vfo_"+"AB"[owrx.vfo_ab],t)}function popup_keyboard_touchstart(e){owrx.popup_keyboard_active=!0}function freqset_select(){var e=document.activeElement,t=e&&w3_contains(e,"w3-ext-retain-input-focus")&&!extint.displayed,a=e&&(w3_contains(e,"w3-retain-input-focus")||w3_contains(e,"w3-ext-retain-input-focus"));extint.scanning||e&&a&&!t||w3_field_select("id-freq-input",{mobile:1,log:1})}function modeset_update_ui(e){null!=owrx.last_mode_el&&(owrx.last_mode_el.style.color="white");var t=e.substr(0,2);"qa"==t&&(t="sa");var a=w3_el("id-mode-"+t);a.innerHTML=e.toUpperCase(),a&&a.style&&(a.style.color="lime"),owrx.last_mode_el=a,squelch_setup(toggle_e.FROM_COOKIE),writeCookie("last_mode",e),freq_link_update(),vfo_update();var _=ext_is_IQ_or_stereo_mode(e);w3_els("id-button-compression",function(e){w3_set_props(e,"w3-disabled",_)}),w3_hide2("id-sam-carrier-container","sa"!=t),w3_hide2("id-chan-null","sam"!=e)}function try_freqset_update_ui(){waterfall_setup_done?(freqset_update_ui(),wf.audioFFT_active?(cur_mode!=wf.audioFFT_prev_mode&&(wf.audioFFT_clear_wf=!0),audioFFT_update(),wf.audioFFT_prev_mode=cur_mode):mkenvelopes(get_visible_freq_range())):setTimeout(try_freqset_update_ui,1e3)}function try_modeset_update_ui(e){waterfall_setup_done?modeset_update_ui(e):setTimeout(function(){try_modeset_update_ui(e)},1e3)}function freq_link_update(){var e=kiwi_url_origin()+"/?f="+freq_displayed_kHz_str_with_freq_offset+cur_mode+"z"+zoom_level;w3_innerHTML("id-freq-link",w3_icon("w3-text-css-lime||title="+dq("copy to clipboard:\n"+e),"fa-external-link-square",15,"","freq_link_update_cb",e))}function freq_link_update_cb(e,t,a){a||w3_copy_to_clipboard(t)}function freqset_complete(e){var t=w3_el("id-freq-input");if(kiwi_clearTimeout(freqset_tout),!isUndefined(t)&&null!=t){var a,_=t.value.split(/[\/\+\:\;]/),i=t.value.includes("/")||t.value.includes("+"),o=_[0].replace(",",".").parseFloatWithUnits("M",.001),n=!0;if("/"==t.value||"+"==t.value)return restore_passband(cur_mode),demodulator_analog_replace(cur_mode),void freqset_update_ui();0<o&&!isNaN(o)&&0<(o-=kiwi.freq_offset_kHz)&&!isNaN(o)&&(freqmode_set_dsp_kHz(o,null),w3_field_select(t,{mobile:1,log:2}),n=!1),n&&freqset_update_ui(),_[1]&&(p2=_[1].split(","),o=p2[0].parseFloatWithUnits("k"),t=NaN,1<p2.length&&(t=p2[1].parseFloatWithUnits("k")),_=((n=ext_get_passband()).high-n.low)/2,n=n.low+_,i?1==p2.length&&(o=n-(a=o/2),t=n+a):(n=o,t=1==p2.length?(o=n-_,n+_):(o=n-(a=Math.abs(t/2)),n+a)),ext_set_passband(o,t,!0))}}var ignore_next_keyup_event=!1;function freqset_keyup(e,t){if(kiwi_clearTimeout(freqset_tout),null!=t&&null!=t.key){var a=t.key.length;if(any_alternate_click_event_except_shift(t)||1!=a&&"Backspace"!=t.key)return"Escape"==t.key&&freqset_update_ui(),void(ignore_next_keyup_event=!1)}ignore_next_keyup_event?ignore_next_keyup_event=!1:kiwi_isMobile()||(freqset_tout=setTimeout(function(){freqset_complete("t/o")},3e3))}var num_step_buttons=6,up_down={am:[0,-1,-.1,.1,1,0],amn:[0,-1,-.1,.1,1,0],sam:[0,-1,-.1,.1,1,0],sal:[0,-1,-.1,.1,1,0],sau:[0,-1,-.1,.1,1,0],sas:[0,-1,-.1,.1,1,0],qam:[0,-1,-.1,.1,1,0],drm:[0,-1,-.1,.1,1,0],usb:[0,-.1,-.01,.01,.1,0],usn:[0,-.1,-.01,.01,.1,0],lsb:[0,-.1,-.01,.01,.1,0],lsn:[0,-.1,-.01,.01,.1,0],cw:[0,-.1,-.01,.01,.1,0],cwn:[0,-.1,-.01,.01,.1,0],nbfm:[-5,-1,-.1,.1,1,5],iq:[0,-1,-.1,.1,1,0]},NDB_400_1000_mode=1,freq_step_last_mode,freq_step_last_band;function freq_step_amount(e){var t=cur_mode.substr(0,2),a="ls"==t||"us"==t||"cw"==t,_=a?1e3:5e3,i=a?" 1k default":" 5k default",o="am"==t||"sa"==t||"qa"==t||"ls"==t||"us"==t||"iq"==t||"dr"==t,a=2==cfg.init.ITU_region+1&&e&&"75m"==e.name;return e&&"NDB"==e.name?("cw"==t&&(_=NDB_400_1000_mode),i=" NDB"):!e||"LW"!=e.name&&"MW"!=e.name?(t=e?band_svc_lookup(e.svc):null)&&t.o.name.includes("Broadcast")&&!a?o&&(_=5e3,i=" SWBC 5k"):e&&0!=e.chan&&(_=1e3*e.chan,i=" band="+e.name+" chan_kHz="+e.chan):(o&&(_=step_9_10?9e3:1e4),i=" LW/MW"),{step_Hz:_,s:i}}function special_step(e,t,a){a=freq_step_amount(e),e=a.step_Hz;return a.s,t<num_step_buttons/2&&(e=-e),e}function freqstep(e){var t=1e3*up_down[cur_mode][e];0==t&&(t=special_step(find_band(freq_displayed_Hz),e,"freqstep"));var a=freq_displayed_Hz,_=Math.abs(t),i=0<=t?1:0,e=a/_;e=(i?Math.ceil(e):Math.floor(e))*_,_==NDB_400_1000_mode?(_=a%1e3,_=i?_<400?400:_<600?600:1e3:0==_?-400:_<=400?0:_<=600?400:600,a=(e=1e3*Math.floor(a/1e3))+_):freq_displayed_Hz!=e?a=e:a+=t,freqmode_set_dsp_kHz(a/1e3,null,{dont_clear_wf:!0})}function freq_step_update_ui(e){if(!isUndefined(cur_mode)&&null!=cfg.passbands[cur_mode]){var t=find_band(freq_displayed_Hz);if(e||freq_step_last_mode!=cur_mode||freq_step_last_band!=t){e=cur_mode.substr(0,2),e="am"==e||"sa"==e||"qa"==e||"iq"==e||"dr"==e,e=!(!t||"LW"!=t.name&&"MW"!=t.name||!e);kiwi_isMobile()?w3_hide2("id-9-10-cell",!e):(w3_hide2("id-9-10-cell",!1),w3_disable("id-9-10-cell",!e));for(var a=0;a<num_step_buttons;a++){var _=1e3*up_down[cur_mode][a];0==_&&(_=special_step(t,a,"freq_step_update_ui"));var i=Math.abs(_),o=0<=_?1:0,o=1e3<=i?(o?"+":"")+(_/1e3).toString()+"k":i!=NDB_400_1000_mode?(o?"+":"")+_.toString():(o?"+":"-")+"400/"+(o?"+":"-")+"1000";html("id-step-"+a).title=o}freq_step_last_mode=cur_mode,freq_step_last_band=t}}}function freq_memory_init(){var e=readCookie("freq_memory");!e||(e=kiwi_JSON_parse("freq_memory_init",e))&&(freq_memory=kiwi_dedup_array(e,function(e){return null==e||!isNumber(+e)||+e<=0}))}function freq_memory_menu_init(){w3_menu("id-freq-memory-menu","freq_memory_menu_cb")}function freq_memory_menu_show(e){var t,a;w3_isVisible("id-freq-memory-menu")?owrx.freq_memory_menu_shown=0:(owrx.freq_memory_menu_shown=1,t=owrx.last_pageX,a=owrx.last_pageY,1!=e&&(t+=0<=t-128?-128:16),(e=kiwi_dup_array(freq_memory)).push("clear all"),w3_menu_items("id-freq-memory-menu",e,Math.min(e.length,10)),w3_menu_popup("id-freq-memory-menu",function(e,t){return!(("keyup"!=e.type||"m"==e.key&&owrx.freq_memory_menu_shown)&&("click"!=e.type&&"touchend"!=e.type||t||w3_contains(e.target,"w3-menu")&&owrx.freq_memory_menu_shown))},t,a))}function freq_memory_update(e){isNumber(+e)&&(e<=1&&(e=1),e!=freq_memory[0]&&(freq_memory.unshift(e),freq_memory=kiwi_dedup_array(freq_memory)),25<freq_memory.length&&freq_memory.pop(),writeCookie("freq_memory",JSON.stringify(freq_memory)))}function freq_memory_menu_cb(e,t){var a;e>=freq_memory.length?(a=freq_memory[0],freq_memory=[a]):(a=freq_memory[e],freq_memory.unshift(a),25<(freq_memory=kiwi_dedup_array(freq_memory)).length&&freq_memory.pop()),freqmode_set_dsp_kHz(a-kiwi.freq_offset_kHz)}function band_info(){var e,t,a=+cfg.init.AM_BCB_chan?10:9,_=cfg.init.ITU_region+1,i=1==_?(e=283.5,t=526.5,1606.5):2==_?(e=190.5,t=540-a/2,1700+a/2):(e=190.5,t=540-a/2,1602+a/2);return{ITU_region:_,_9_10:a,LW_lo:148.5,NDB_lo:e,NDB_hi:t,MW_hi:i}}function band_svc_lookup(a){var _=null;return cfg.band_svc.forEach(function(e,t){e.key==a&&(_=t)}),null==_?(console.log("$$$ band_svc_lookup NO KEY MATCH for <"+a+">"),null):{o:cfg.band_svc[_],i:_}}function bands_init(){var e,t,a,_,i;if(cfg.bands&&cfg.band_svc&&cfg.dx_type)return console.log("BANDS: using stored cfg.bands"),bands_addl_info(),void dx_color_init();console.log("BANDS: using old config.js::bands"),cfg.dx_type=[];var o=-1;for(dx.legacy_stored_types.forEach(function(e,t){cfg.dx_type[t]={key:t,name:dx.legacy_stored_types[t],color:dx.legacy_stored_colors[t]},o=t}),t=dx_type2idx(dx.DX_MASKED),e=o+1;e<t;e++)cfg.dx_type[e]={key:e,name:"",color:""};for(cfg.dx_type[t]={key:e,name:"masked",color:"lightGrey"},dx_color_init(),cfg.band_svc=[],w3_obj_enum(svc,function(e,t,a){"X"==e&&"Beacons"==a.name&&(svc.L=svc.X,e="L",delete svc.X),console.log("key="+e),svc[e].key=e,cfg.band_svc[t]={key:e,name:a.name,color:a.color},"Industrial/Scientific"==a.name&&(cfg.band_svc[t].name="ISM",cfg.band_svc[t].longName="Industrial/Scientific")}),kiwi.cfg_bands_new=[],e=t=0;e<bands.length;e++){if("LW"==(_=bands[e]).name&&"E"==_.region&&(_.region="1"),"LW"==_.name&&">"==_.region&&(_.region="23"),"MW"!=_.name||"3"!=_.region&&">3"!=_.region||(_.region="13"),"NDB"==_.name&&"E"==_.region&&(_.region="1"),"NDB"==_.name&&"U"==_.region&&(_.region="2"),"NDB"==_.name&&">"==_.region&&(_.region="3"),"MF"==_.name&&">23"==_.region&&(_.region="*"),_.name.startsWith("Time ")&&"*"==_.region&&(_.region="m"),_.region){var n=_.region.length;if(1==n){kiwi.cfg_bands_new[t]=kiwi_shallow_copy(_),i=kiwi.cfg_bands_new[t],t++;var s=i.region.charAt(0);i.itu="1"<=s&&s<="3"?ord(s,"1")+1:"*"==s||">"==s?kiwi.ITU_ANY:"m"==s?kiwi.BAND_MENU_ONLY:kiwi.BAND_SCALE_ONLY,console.log("R"+s+"="+i.itu+" "+dq(_.name)),console.log(i)}else for(a=0;a<n;a++)">"!=(s=_.region.charAt(a))&&(kiwi.cfg_bands_new[t]=kiwi_shallow_copy(_),i=kiwi.cfg_bands_new[t],t++,i.itu="1"<=s&&s<="3"?ord(s,"1")+1:kiwi.BAND_SCALE_ONLY,console.log("R"+s+"="+i.itu+" "+dq(_.name)),console.log(i))}else kiwi.cfg_bands_new[t]=kiwi_shallow_copy(_),(i=kiwi.cfg_bands_new[t]).itu=kiwi.ITU_ANY,t++,console.log("DEFAULT ITU_ANY="+i.itu+" "+dq(_.name)),console.log(i);isNumber(i.sel)&&(i.sel=i.sel.toFixed(2)),"L"!=i.s.key&&"X"!=i.s.key||!i.sel.includes("cw")||"m"!=i.region||(i.name.includes("IBP")||(i.name="IBP "+i.name),i.sel.includes("cwn")||(i.sel=i.sel.replace("cw","cwn"))),i.name.includes("IBP")&&(i.s="L")}for(e=0;e<kiwi.cfg_bands_new.length;e++)i=kiwi.cfg_bands_new[e],isString(i.s)?i.svc=i.s:isObject(i.s)?i.svc=i.s.key:console.log("$$$ t/o(bnew.svc)="+typeof i.s),delete i.s,delete i.region;for(cfg.bands=[],e=0;e<kiwi.cfg_bands_new.length;e++){var r=(_=kiwi.cfg_bands_new[e]).sel||"";cfg.bands.push({min:_.min,max:_.max,name:_.name,svc:_.svc,itu:_.itu,sel:r,chan:_.chan})}console.log("kiwi.cfg_bands_new"),console.log(kiwi.cfg_bands_new),bands_addl_info()}function bands_addl_info(){var e,t,a,_=kiwi.freq_offset_kHz;for(console.log("BANDS: creating additional info in kiwi.bands"),kiwi.bands=[],e=0;e<cfg.bands.length;e++){t=cfg.bands[e],a=kiwi.bands[e]={},cfg.bands[e].chan=isUndefined(t.chan)?0:t.chan;var i=t.min,o=t.max;_&&t.min>=_?(i-=_,o-=_,a.isOffset=!0):32e3<t.min?a.isOffset=!0:1!=a.isOffset&&(a.isOffset=!1),a.minHz=1e3*i,a.maxHz=1e3*o,a.chanHz=1e3*t.chan;for(var n=a.maxHz-a.minHz,s=zoom_nom;0<=s;s--)if(n<=.8*(bandwidth/(1<<s)))break;a.zoom_level=s,a.cfHz=a.minHz+(a.maxHz-a.minHz)/2;o=band_svc_lookup(t.svc);null!=o?(o=o.o.longName||o.o.name,a.longName=t.name+" "+o):a.longName=t.name}}var band_menu=[],maxdb,mindb_un,mindb,full_scale;function setup_band_menu(){var e=0,t=null,a='<option value="0" selected disabled>select band</option>';band_menu[e++]=null;for(var _=cfg.init.ITU_region+1,i=0;i<cfg.bands.length;i++){var o=cfg.bands[i],n=kiwi.bands[i];if(kiwi.isOffset){if(!n.isOffset)continue}else if(n.isOffset)continue;if(o.itu==kiwi.BAND_MENU_ONLY||o.itu==kiwi.ITU_ANY||o.itu==_){if(t!=o.svc){t=o.svc;var s=band_svc_lookup(o.svc);if(!s)continue;a+="<option value="+dq(e)+" disabled>"+s.o.name.toUpperCase()+"</option>",band_menu[e++]=null}a+="<option value="+dq(e)+">"+o.name+"</option>",band_menu[e]={},band_menu[e].b1=o,band_menu[e].b2=n,e++}}return a}function mk_band_menu(){band_menu=[],owrx.last_selected_band=0,w3_innerHTML("id-select-band",setup_band_menu())}function find_band(e){for(var t=cfg.init.ITU_region+1,a=0;a<cfg.bands.length;a++){var _=cfg.bands[a],i=kiwi.bands[a];if(_.itu==kiwi.BAND_SCALE_ONLY||_.itu==kiwi.ITU_ANY||_.itu==t){var o="MW"==_.name?171e4:i.maxHz;if(e>=i.minHz&&e<=o)return _}}return null}function mk_bands_scale(){var e=band_ctx.canvas.width,t=band_scale_top,a=band_scale_h,_=t+band_scale_text_top,i=g_range.start,o=g_range.end;band_ctx.globalAlpha=1,band_ctx.fillStyle="White",band_ctx.fillRect(0,band_canvas_top,e,band_canvas_h);for(var n=cfg.init.ITU_region+1,s=0;s<cfg.bands.length;s++){var r,l,d,c,f,u,w=cfg.bands[s],p=kiwi.bands[s];if(kiwi.isOffset){if(!p.isOffset)continue}else if(p.isOffset)continue;w.itu!=kiwi.BAND_SCALE_ONLY&&w.itu!=kiwi.ITU_ANY&&w.itu!=n||(c=-1,u=p.minHz,d=i<=(f=p.maxHz)&&f<=o?1:0,(l=i<=u&&u<=o?1:0)&&d?(c=u,r=f):!l&&d?(c=i,r=f):l&&!d?(c=u,r=o):u<i&&o<f&&(c=i,r=o),-1!=c&&(u=scale_px_from_freq(c,g_range),(f=scale_px_from_freq(r,g_range)-u)<3||(c=band_svc_lookup(w.svc),band_ctx.fillStyle=c?c.o.color:"grey",band_ctx.globalAlpha=.2,band_ctx.fillRect(u,t,f,a),band_ctx.globalAlpha=1,band_ctx.font="bold 12px sans-serif",band_ctx.textBaseline="top",c=u+f/2,u=p.longName,f>=(p=band_ctx.measureText(u)).width+4||(u=w.name,f>=(p=band_ctx.measureText(u)).width+4||(u=null)),u&&band_ctx.fillText(u,c-p.width/2,_))))}}function parse_freq_pb_mode_zoom(e){return new RegExp("([0-9.,kM]*)([/:][-0-9.,k]*)?([^z]*)?z?([0-9]*)").exec(e)}function band_scroll(e){for(var t,a=owrx.last_selected_band;(a+=e)<0&&(a=band_menu.length-1),a>=band_menu.length&&(a=0),t=band_menu[a],null==t;);select_band(a),w3_set_value("id-select-band",a)}function select_band(e,t){var a,_,i,o,n=+e;if(isNumber(n))null!=(o=band_menu[n])?(a=o.b1,_=o.b2,dbgUs&&(console.log(o),console.log(a),console.log(_)),""!=a.sel?(i=parseFloat(a.sel),isUndefined(t)&&(t=-1==(t=a.sel.search(/[a-z]/i))?null:a.sel.slice(t))):i=_.cfHz/1e3,owrx.last_selected_band=n,dbgUs&&(sb_trace=0),freqmode_set_dsp_kHz(i,t),zoom_step(ext_zoom.TO_BAND,o)):check_band(!0);else{for(var s=0;s<band_menu.length-1&&(!band_menu[s]||band_menu[s].b1.name!=e);s++);s<band_menu.length-1&&select_band(s,t)}}function check_band(e){var t,a,_;owrx.last_selected_band&&((_=band_menu[owrx.last_selected_band]).b1,t=_.b2,a=freq_car_Hz,_=freq_passband_center(),(null!=e&&-1==e||(a<t.minHz||a>t.maxHz)&&(_<t.minHz||_>t.maxHz))&&(w3_select_value("id-select-band",0),owrx.last_selected_band=0))}function tune(e,t,a,_){ext_tune(e,t,ext_zoom.ABS,a,_)}function init_scale_dB(){maxdb=init_max_dB,mindb_un=init_min_dB,mindb=mindb_un-zoomCorrection(),full_scale=(full_scale=maxdb-mindb)||1,wf.save_maxdb=maxdb,wf.save_mindb_un=mindb_un,wf.auto_ceil.val=+initCookie("last_ceil_dB",cfg.init.ceil_dB),wf.auto_floor.val=+initCookie("last_floor_dB",cfg.init.floor_dB)}band_canvas_h=30,band_canvas_top=0,band_scale_h=20,band_scale_top=5,band_scale_text_top=5,dx_container_h=80,dx_container_top=band_canvas_h,dx_label_top=5,dx_line_h=dx_container_h-dx_label_top,scale_canvas_h=47,scale_canvas_top=band_canvas_h+dx_container_h,scale_container_h=band_canvas_h+dx_container_h+scale_canvas_h;var confirmation={displayed:!1,close_cb:null},cal_adc_new_adj;function confirmation_panel_init(){w3_el("id-panels-container").innerHTML+=w3_div('id-confirmation class-panel|border: 1px solid white|data-panel-name="confirmation" data-panel-pos="center" data-panel-order="0" data-panel-size="600,100"'),w3_innerHTML("id-confirmation",w3_divs("id-confirmation-container/class-panel-inner")+w3_div("id-confirmation-vis class-vis"))}function confirmation_panel_set_close_func(e){w3_el("id-confirmation-close").onclick=e,confirmation.close_cb=e}function confirmation_panel_init2(){confirmation_panel_set_close_func(confirmation_panel_close),w3_el("id-kiwi-body").addEventListener("keyup",function(e){"Escape"==e.key&&(confirmation.close_cb(),toggle_or_set_hide_panels(0))},!0)}function confirmation_show_content(e,t,a,_,i){confirmation.displayed&&w3_color("id-confirmation",null,""),w3_innerHTML("id-confirmation-container",e),w3_color("id-confirmation",null,i),_&&confirmation_panel_set_close_func(_),confirmation_panel_show(t,a),toggle_or_set_hide_panels(0)}function confirmation_panel_show(e,t){el=w3_el("id-confirmation"),el.style.zIndex=1020,null==e&&(e=525),null==t&&(t=80),confirmation_panel_resize(e,t),confirmation.displayed=!confirmation.displayed,toggle_panel("id-confirmation")}function confirmation_panel_resize(e,t){var a=w3_el("id-confirmation");panel_set_width_height("id-confirmation",e,t),a.style.left=px(window.innerWidth/2-a.activeWidth/2),a.style.bottom=px(window.innerHeight/2-a.uiHeight/2)}function confirmation_panel_close(){confirmation.displayed&&(w3_color("id-confirmation",null,""),toggle_panel("id-confirmation"),confirmation_panel_set_close_func(confirmation_panel_close),confirmation.displayed=!1)}function set_freq_offset_dialog(){confirmation_show_content(w3_col_percent("/w3-text-aqua",w3_input_get("","Frequency scale offset (kHz, 1 Hz resolution)","cfg.freq_offset","w3_float_set_cfg_cb|3"),80),525,80),w3_field_select("id-cfg.freq_offset",{mobile:1})}function cal_adc_dialog(e,t,a,_){var i;confirmation_show_content((cfg.ADC_clk_corr&&3<ext_adc_gps_clock_corr()?1:0)?w3_col_percent("/w3-valign",w3_div("w3-show-inline-block","GPS is automatically correcting ADC clock. <br> No manual calibration available.")+w3_button("w3-red w3-margin-left","Close","confirmation_panel_close"),80):(cal_adc_new_adj=e)<-(i=100*ext_adc_clock_nom_Hz()/1e6)||i<e?(console.log("cal ADC clock: ADJ TOO LARGE"),w3_col_percent("/w3-valign",w3_div("w3-show-inline-block","ADC clock adjustment too large: "+t+" Hz<br>(ADC clock "+_.toFixed(1)+" ppm, limit is +/- 100 ppm)")+w3_button("w3-red w3-margin-left","Close","confirmation_panel_close"),80)):w3_col_percent("/w3-valign",w3_div("w3-show-inline-block","ADC clock will be adjusted by<br>"+t+" Hz to "+a+" kHz<br>(ADC clock "+_.toFixed(1)+" ppm)")+w3_button("w3-green w3-margin-left","Confirm","cal_adc_confirm")+w3_button("w3-red w3-margin-left","Cancel","confirmation_panel_close"),80),525,70)}function cal_adc_confirm(){ext_send("SET clk_adj="+cal_adc_new_adj),ext_set_cfg_param("cfg.clk_adj",cal_adc_new_adj,!0),confirmation_panel_close()}function admin_pwd_query(e){ext_hasCredential("admin",admin_pwd_cb,e,ws_wf)}function admin_pwd_cb(e,t){console.log("admin_pwd_cb badp="+e),e?(confirmation_show_content(w3_col_percent("/w3-text-aqua",w3_input("kiwi-pw","Admin password","admin.pwd","","admin_pwd_cb2"),80),525,80),w3_field_select("id-admin.pwd",{mobile:1})):t()}function admin_pwd_cb2(e,t){w3_string_cb(e,t),confirmation_panel_close(),ext_valpwd("admin",t,ws_wf)}var dx={DB_STORED:0,DB_EiBi:1,db:0,db_s:["stored (writeable)","EiBi-B21 (read-only)"],db_flip_s:["EiBi","stored"],url_p:null,help:!1,ignore_dx_update:!1,DX_STEP:2,DX_JSON:0,DX_CSV:1,IDX_USER:null,UPD_MOD:0,UPD_ADD:1,o:{},legacy_stored_types:["active","watch-list","sub-band","DGPS","special event","interference"],legacy_stored_colors:["cyan","lightPink","aquamarine","lavender","violet","violet","lightGrey"],stored_colors_light:[],stored_lightness:.95,stored_filter_tod:1,dow_colors:["lightCoral","lightSalmon","gold","yellowGreen","springGreen","deepSkyBlue","violet"],eibi_colors:[],eibi_hue:["cyan",300,"deepSkyBlue","silver",50,"peachPuff","mediumAquaMarine",270,180,70,"springGreen",0],eibi_light:[0,80,0,0,70,0,0,80,80,45,0,75],eibi_colors_light:[],eibi_lightness:.9,eibi_svc_s:["Bcast","Utility","Time","ALE","HFDL","Milcom","CW","FSK","Fax","Aero","Maritime","Spy"],eibi_ext:["","","time","ale","hfdl","","cw","fsk","fax","","",""],eibi_filter_tod:1,DX_MODE:15,DX_TYPE:496,DX_TYPE_SFT:4,DX_N_STORED:16,DX_STORED:0,DX_QUICK_0:0,DX_QUICK_1:16,DX_MASKED:240,DX_N_EiBi:12,DX_EiBi:256,DX_BCAST:256,DX_UTIL:272,DX_TIME:288,DX_ALE:304,DX_HFDL:320,DX_MILCOM:336,DX_CW:352,DX_FSK:368,DX_FAX:384,DX_AERO:400,DX_MARINE:416,DX_SPY:432,DX_DOW_SFT:9,DX_DOW:65024,DX_MON:32768,DX_FLAGS:4294901760,DX_FILTERED:65536,DX_HAS_EXT:131072,eibi_types_mask:4294967295,list:[],displayed:[],filter_ident:"",filter_notes:"",filter_case:0,filter_wild:0,filter_grep:0,ctrl_click:!1};function dx_init(){dx.DX_DOW_BASE=dx.DX_DOW>>dx.DX_DOW_SFT,null!=(dx.url_p=kiwi_url_param("dx","",null))&&(dx.db=dx.DB_EiBi,w3_do_when_cond(function(){var e=w3_el("id-ext-controls");return!!e&&e.init},function(){var a;console.log('DX url_p="'+dx.url_p+'"'),""!=dx.url_p&&dx.url_p.split(",").forEach(function(e,t){console.log("DX url_p=<"+e+">"),w3_ext_param("help",e).match?dx.help=!0:0==t&&0==e?(dx.db=dx.DB_STORED,dx.stored_filter_tod=0,freq_displayed_kHz_str="0",cur_mode="am"):w3_ext_param("none",e).match?(dx.eibi_types_mask=0,console.log("SET none dx.eibi_types_mask="+dx.eibi_types_mask)):(a=w3_ext_param("filter",e)).match?dx.db==dx.DB_STORED?(dx.stored_filter_tod=a.has_value?a.num:1,console.log("SET stored_filter_tod="+dx.eibi_filter_tod+" r.has_value="+a.has_value+" r.num="+a.num)):(dx.eibi_filter_tod=a.has_value?a.num:1,console.log("SET eibi_filter_tod="+dx.eibi_filter_tod+" r.has_value="+a.has_value+" r.num="+a.num)):w3_ext_param_array_match_str(dx.eibi_svc_s,e,function(e,t){var a=dx.eibi_types_mask&1<<e;a?dx.eibi_types_mask&=~(1<<e):dx.eibi_types_mask|=1<<e,console.log("MATCH "+t+" v="+a.toHex(8)+"("+e+") dx.eibi_types_mask="+dx.eibi_types_mask.toHex(8))})}),console.log("FINAL dx.eibi_types_mask="+dx.eibi_types_mask.toHex(8)+" dx.help="+dx.help),dx_show_edit_panel(null,-1),dx_schedule_update()},0,500))}function dx_type2idx(e){return(e=e&dx.DX_TYPE)>=dx.DX_EiBi&&(e-=dx.DX_EiBi),e>>dx.DX_TYPE_SFT}function dx_eibi_type2mask(e){return 1<<dx_type2idx(e)}function dx_set_type(e){dx.eibi_types_mask=dx_eibi_type2mask(e)}function dx_is_single_type(e){return dx.db==dx.DB_EiBi&&dx.eibi_types_mask==dx_eibi_type2mask(e)}function dx_color_init(){for(var e=0;e<cfg.dx_type.length;e++){var t=cfg.dx_type[e],t=""==t.color?"white":t.color,t=w3color(t);t.valid&&(t.lightness=dx.stored_lightness,dx.stored_colors_light[e]=t.toHslString())}dx.eibi_hue.forEach(function(e,t){isString(e)?dx.eibi_colors[t]=e:dx.eibi_colors[t]="hsl("+e+",100%,"+dx.eibi_light[t]+"%)";e=w3color(dx.eibi_colors[t]);e.lightness=dx.eibi_lightness,dx.eibi_colors_light[t]=e.toHslString()});for(e=0;e<dx.DX_N_EiBi;e++)w3_color("eibi-cbox"+e+"-label","black",dx.eibi_colors[e])}function dx_update_request(){w3_do_when_cond(function(){return waterfall_setup_done},function(){dx_update(),bands_init(),mk_bands_scale(),mk_band_menu()},0,200)}var dx_update_delay=350,dx_update_timeout,dx_seq=0;function dx_schedule_update(){kiwi_clearTimeout(dx_update_timeout),dx_div.innerHTML="",dx_update_timeout=setTimeout(dx_update,dx_update_delay)}function dx_update(){var e=dx.db==dx.DB_EiBi;dx_seq++;var t=ext_panel_displayed("HFDL")&&dx_is_single_type(dx.DX_HFDL)&&4<=zoom_level?0:1;wf_send("SET MARKER db="+dx.db+" min="+(g_range.start/1e3).toFixed(3)+" max="+(g_range.end/1e3).toFixed(3)+" zoom="+zoom_level+" width="+waterfall_width+" eibi_types_mask="+dx.eibi_types_mask.toHex()+" filter_tod="+(e?dx.eibi_filter_tod:dx.stored_filter_tod)+" anti_clutter="+t),kiwi_clearTimeout(dx.dx_refresh_timeout),(e&&dx.eibi_filter_tod||!e&&dx.stored_filter_tod)&&(e=3e5-Date.now()%3e5,dx.dx_refresh_timeout=setTimeout(function(){dx_div.innerHTML="",dx_update()},2e3+e))}var dx_ibp_list,dx_ibp_interval,dx_ibp_server_time_ms,dx_ibp_local_time_epoch_ms=0,dx_ibp_freqs={14:0,18:1,21:2,24:3,28:4},dx_ibp_lastsec=0,dx_ibp_stations={"4U1UN":{value:0,text:"New York"},VE8AT:{value:1,text:"Nunavut"},W6WX:{value:2,text:"California"},KH6RS:{value:3,text:"Hawaii"},ZL6B:{value:4,text:"New Zealand"},VK6RBP:{value:5,text:"Australia"},JA2IGY:{value:6,text:"Japan"},RR9O:{value:7,text:"Siberia"},VR2B:{value:8,text:"Hong Kong"},"4S7B":{value:9,text:"Sri Lanka"},ZS6DN:{value:10,text:"South Africa"},"5Z4B":{value:11,text:"Kenya"},"4X6TU":{value:12,text:"Israel"},OH2B:{value:13,text:"Finland"},CS3B:{value:14,text:"Madeira"},LU4AA:{value:15,text:"Argentina"},OA4B:{value:16,text:"Peru"},YV5B:{value:17,text:"Venezuela"}},dx_keys,dx_z_save,dx_bg_color_save,smeter_width;function dx_label_cb(s){var e=s[0],t=dx.db==dx.DB_EiBi,r=t?40:35;if(dx_color_init(),e.t!=dx.DX_STEP){if(kiwi_clearInterval(dx_ibp_interval),dx_ibp_list=[],dx_ibp_server_time_ms=1e3*e.s+ +e.m,dx_ibp_local_time_epoch_ms=Date.now(),t)for(l=0;l<dx.DX_N_EiBi;l++)isDefined(e.ec[l])&&w3_innerHTML("eibi-cbox"+l+"-label",dx.eibi_svc_s[l]+" ("+e.ec[l]+")");dx.types_n=e.tc,dx_filter_field_err(+e.f);var a=120;dx_div.innerHTML="",dx.displayed=[],dx.last_ident="",dx.last_freq=-1,dx.post_render=[],dx.color_fixup=[],dx.f_same=[];function _(e,t,a){var _,i=Math.ceil(r/6);for(dx.font&&(dx.f_same.forEach(function(e,t){e=s[++e];e.di=kiwi_decodeURIComponent("",e.i),e.tw=getTextWidth(e.di,dx.font)}),dx.f_same.sort(function(e,t){e=s[e+1];return s[t+1].tw-e.tw})),_=0;_<=dx.f_same.length;_++){var o=dx.f_same[_],n=_%(i+1);dx.post_render[o]={top:dx_label_top+6*n,ltop:dx_label_top,x:e+5*n,z:t+_},n==i&&(e+=r)}}for(var i,o=0,n=[],l=1;l<s.length;l++){C=l-1;var d,c,f,u,w,p,m,h=(T=s[l]).fl,g=h&dx.DX_TYPE,x=dx_type2idx(g),b=h&dx.DX_FILTERED,v=T.i;t&&v==dx.last_ident?0==b&&(dx.color_fixup[dx.last_idx]=dx.eibi_colors[x]):(dx.last_idx=C,dx.last_ident=v,d=T.g,B=T.f,c=T.o,M=isDefined(T.n)?T.n:"",f=isDefined(T.p)?T.p:"",t&&h&dx.DX_HAS_EXT&&(f=dx.eibi_ext[dx_type2idx(g)]),w=scale_px_from_freq(u=(p=1e3*B)+passband_offset_dxlabel(kiwi.modes_l[h&dx.DX_MODE]),g_range)-1,g=0,p=p-c,c&&(g=scale_px_from_freq(p,g_range)),t&&u==dx.last_freq?(dx.f_same.push(C),i=w,0==o&&(o=a)):t&&(2<dx.f_same.length&&_(i,o,dx.last_freq),dx.f_same=[],dx.f_same.push(C),o=0),E=dx_label_top+r*(1&C),dx.post_render[C]={top:E,ltop:E,x:w},dx.last_freq=u,m=t?(b?dx.eibi_colors_light:dx.eibi_colors)[x]:(""==(m=cfg.dx_type[x].color)&&(m="white"),b?dx.stored_colors_light[x]:m),t||0!=x||"IBP"!=v&&"IARU%2fNCDXF"!=v||(m="aquamarine"),p/=1e3,dx.list[d]={gid:d,carrier:p,lo:T.lo,hi:T.hi,freq:B,moff:c,flags:h,begin:T.b,end:T.e,ident:v,notes:M,params:f},dx.displayed[C]=dx.list[d],h=""!=f?" id-has-ext":"",n[C]='<div id="'+C+'-id-dx-label" class="cl-dx-label '+(b?"cl-dx-label-filtered":"")+" "+d+"-id-dx-gid"+h+'" style="left:'+(w-10)+"px; z-index:"+a+"; background-color:"+m+';" onmouseenter="dx_enter(this,'+g+', event)" onmouseleave="dx_leave(this,'+g+')" onmousedown="ignore(event)" onmousemove="ignore(event)" onmouseup="ignore(event)" ontouchmove="ignore(event)" ontouchend="ignore(event)" onclick="dx_click(event,'+d+')" ontouchstart="dx_click(event,'+d+')" name="'+(""==f?0:1)+'"></div><div class="cl-dx-line" id="'+C+'-id-dx-line" style="left:'+w+'px; z-index:110"></div>',a++)}t&&2<dx.f_same.length&&_(i,o);var k="";for(l=0;l<s.length-1;l++)isDefined(n[l])&&(k+=n[l]);dx_div.innerHTML=k,dx.last_ident="",dx.font||(q=w3_el("0-id-dx-label"))&&(dx.font=css_style(q,"font-size")+" "+css_style(q,"font-family"),console_log_dbgUs("dx.font=<"+dx.font+">"));function y(e,t){var a="",_=e.fl&dx.DX_DOW;if(_==dx.DX_DOW&&(_=0),0==e.b&&0==e.e&&(e.e=2400,kiwi_trace("$SHOULD NOT OCCUR")),_)for(var i=0;i<7;i++)a+=dx.DX_MON>>i&_?"MTWTFSS"[i]:"_";else a="7-days";var o=e.b.leadingZeros(4)+"-"+e.e.leadingZeros(4)+" "+a;return t||((t="")!=e.l&&"-"!=e.l.charAt(0)&&(t=" lang: "+e.l),o+=t+" target: "+e.t),o}for(l=1;l<s.length;l++){var q,T,M,z,S,E,D,F,C=l-1,v=(T=s[l]).i,B=T.f;t&&v==dx.last_ident?(q=w3_el(dx.last_dx_idx+"-id-dx-label")).title+="\n"+y(T):(dx.last_dx_idx=C,dx.last_ident=v,M=isDefined(T.n)?T.n:"",(q=w3_el(C+"-id-dx-label"))&&(""==(S=kiwi_decodeURIComponent("dx_ident2",v).trim())&&(S="&nbsp;&nbsp;"),q.innerHTML=S.replace(/\\n/g,"<br>"),z=dx_type2idx(T.fl&dx.DX_TYPE),S=t&&""!=dx.eibi_ext[z]?"\nshift-click to open extension":"",t?q.title=dx.eibi_svc_s[z]+" // home country: "+T.c+S+"\n"+y(T):(S=(S=(S=kiwi_decodeURIComponent("dx_notes",M)).replace(/<br>/g,"\n")).replace(/\\n/g,"\n"),(T.fl&dx.DX_DOW)==dx.DX_DOW&&0==T.b&&0==T.b&&2400==T.e||(S=S+(""!=S?"\n":"")+y(T,!0)),q.title=S),C<dx.post_render.length&&(D=dx.post_render[C])&&(E=D.top,F=D.x-10,q.style.top=px(E),q.style.left=px(F),isDefined(D.z)&&(q.style.zIndex=D.z),F=w3_el(C+"-id-dx-line"),E=D.ltop,F.style.top=px(E),F.style.height=px(dx_container_h-E)),C<dx.color_fixup.length&&(D=dx.color_fixup[C])&&(q.style.backgroundColor=D),t||"IBP"!=v&&"IARU%2fNCDXF"!=v||(F=dx_ibp_freqs[Math.trunc(B/1e3)],dx_ibp_list.push({idx:C,off:F}),kiwi_clearInterval(dx_ibp_interval),dx_ibp_interval=setInterval(function(){var e=new Date(dx_ibp_server_time_ms+(Date.now()-dx_ibp_local_time_epoch_ms)),t=e.getMinutes(),a=e.getSeconds(),e=a%10;if(0==e&&9==dx_ibp_lastsec)for(var _=t%3*6+Math.trunc(a/10),i=0;i<dx_ibp_list.length;i++){var o,n,s=_-dx_ibp_list[i].off;s<0&&(s=18+s),q=w3_el(dx_ibp_list[i].idx+"-id-dx-label"),w3_obj_enum(dx_ibp_stations,function(e,t,a){t==s&&(o=e,n=a.text)}),q&&(q.innerHTML="IBP: "+o+" "+n)}dx_ibp_lastsec=e},500))))}}else{var A,I=s[1];I&&(A=kiwi.modes_l[I.fl&dx.DX_MODE],freqmode_set_dsp_kHz(I.f,A),0!=I.lo&&0!=I.hi?ext_set_passband(I.lo,I.hi):(A=cfg.passbands[A],ext_set_passband(A.lo,A.hi)))}}function dx_filter(){confirmation_show_content(w3_div("w3-medium w3-text-aqua w3-bold","DX label filter")+w3_divs("w3-text-aqua",w3_col_percent("",w3_divs("/w3-margin-T-8",w3_input("w3-label-inline/id-dx-filter-ident w3-retain-input-focus w3-input-any-change w3-padding-small","Ident","dx.filter_ident",dx.filter_ident,"dx_filter_cb"),w3_input("w3-label-inline/id-dx-filter-notes w3-retain-input-focus w3-input-any-change w3-padding-small","Notes","dx.filter_notes",dx.filter_notes,"dx_filter_cb")),90),w3_inline("w3-halign-space-around w3-margin-T-8 w3-text-white/",w3_checkbox("w3-retain-input-focus w3-label-inline w3-label-not-bold","case sensitive","dx.filter_case",dx.filter_case,"dx_filter_opt_cb"),w3_inline("",w3_text("","pattern match:"),w3_checkbox("w3-margin-left w3-retain-input-focus w3-label-inline w3-label-not-bold","grep","dx.filter_grep",dx.filter_grep,"dx_filter_opt_cb")))),450,140,dx_filter_panel_close),w3_field_select("id-dx-filter-ident",{mobile:1})}function dx_filter_panel_close(){var e=document.activeElement;e&&e.id&&(e.id.startsWith("id-dx-filter")||e.id.startsWith("id-dx.filter"))&&e.blur(),confirmation_panel_close()}function dx_filter_cb(e,t,a,_){a||(w3_string_cb(e,t),t=""!=dx.filter_ident||""!=dx.filter_notes,wf_send("SET DX_FILTER i="+encodeURIComponent(dx.filter_ident+"x")+" n="+encodeURIComponent(dx.filter_notes+"x")+" c="+dx.filter_case+" w="+dx.filter_wild+" g="+dx.filter_grep),w3_remove_then_add("id-dx-container","whiteSmoke cl-dx-filtered",t?"cl-dx-filtered":"whiteSmoke"),t||_||dx_filter_panel_close())}function dx_filter_opt_cb(e,t,a){a||(t=+t,w3_bool_cb(e,t),dx_filter_cb("dx.filter_ident",dx.filter_ident,!1,!0),w3_checkbox_set(e,t),t&&"dx.filter_case"!=e&&dx_filter_opt_cb("dx.filter_wild"==e?"dx.filter_grep":"dx.filter_wild",0),w3_field_select("id-dx-filter-ident",{mobile:1}))}function dx_filter_field_err(e){w3_set_props("id-dx-filter-ident","w3-pink",1&e),w3_set_props("id-dx-filter-notes","w3-pink",2&e)}function dx_label_step(e){var t;if(1==e){for(t=0;t<dx.displayed.length;t++)if(_=dx.displayed[t]){var a=Math.round(1e3*_.freq);if(freq_displayed_Hz<a)break}if(t==dx.displayed.length)return void wf_send("SET MARKER db="+dx.db+" dir=1 freq="+(freq_displayed_Hz/1e3).toFixed(3))}else{for(t=dx.displayed.length-1;0<=t;t--){var _=dx.displayed[t];if(_)if((a=Math.round(1e3*_.freq))<freq_displayed_Hz)break}if(t<0)return void wf_send("SET MARKER db="+dx.db+" dir=-1 freq="+(freq_displayed_Hz/1e3).toFixed(3))}e=kiwi.modes_l[_.flags&dx.DX_MODE];freqmode_set_dsp_kHz(_.freq,e),0!=_.lo&&0!=_.hi?ext_set_passband(_.lo,_.hi):(e=cfg.passbands[e],ext_set_passband(e.lo,e.hi))}function dx_admin_pwd_cb(e,t){w3_string_cb(e,t),ext_valpwd("admin",t,ws_wf)}function dx_show_edit_panel(e,t,a){dx_keys=e?{shift:e.shiftKey,alt:e.altKey,ctrl:e.ctrlKey,meta:e.metaKey}:{shift:0,alt:0,ctrl:0,meta:0},dx.o.gid=t,dx.db==dx.DB_STORED?(dx.badp=-1,ext_hasCredential("admin",function(e){(dx.badp=e)?(extint_panel_hide(),e=w3_inline("",w3_div("w3-medium w3-text-aqua w3-bold","DX label edit"),w3_select("w3-margin-L-64/w3-label-inline w3-text-white /w3-text-red","database","","dx.db",dx.db,dx.db_s,"dx_database_cb"))+w3_div("",w3_input("w3-margin-T-16//w3-margin-T-8 w3-padding-small|width:80%","Admin password","dx.pwd","","dx_admin_pwd_cb"),w3_text("w3-margin-T-4","editing the stored DX labels of this Kiwi requires admin privileges")),ext_panel_set_name("dx"),ext_panel_show(e,null,null,null,!0),ext_set_controls_width_height(550,260),1!=a&&w3_field_select("id-dx.pwd",{mobile:1})):dx_show_edit_panel2()},null,ws_wf),dx.badp):dx_show_edit_panel2()}function dx_show_edit_panel2(){var e,t=dx.o.gid;if(-1==t?(dx.o.fr=freq_displayed_kHz_str,dx.o.lo=dx.o.hi=dx.o.o=0,dx.o.fm=kiwi.modes_s[cur_mode],dx.o.ft=dx.DX_QUICK_0,dx.o.fd=dx.DX_DOW_BASE,dx.o.begin=0,dx.o.end=0,dx.o.i=dx.o.n=dx.o.p=""):(e=dx.list[t],dx.o.fr=e.carrier.toFixed(2),dx.o.lo=e.lo,dx.o.hi=e.hi,dx.o.o=e.moff,dx.o.fm=e.flags&dx.DX_MODE,dx.o.ft=(e.flags&dx.DX_TYPE)>>dx.DX_TYPE_SFT,dx.o.fd=(e.flags&dx.DX_DOW)>>dx.DX_DOW_SFT,0==dx.o.fd&&(dx.o.fd=dx.DX_DOW_BASE,kiwi_trace("$SHOULD NOT OCCUR")),dx.o.begin=e.begin,dx.o.end=e.end,dx.o.i=kiwi_decodeURIComponent("dx_ident",e.ident),dx.o.n=kiwi_decodeURIComponent("dx_notes",e.notes),dx.o.p=kiwi_decodeURIComponent("dx_params",e.params)),dx.db==dx.DB_STORED&&-1!=t&&dx_keys.shift&&dx_keys.alt){var a=(a=dx.o.ft)==dx.DX_QUICK_0?dx.DX_QUICK_1:dx.DX_QUICK_0;dx.o.ft=a;a=dx.o.fd<<dx.DX_DOW_SFT|a<<dx.DX_TYPE_SFT|dx.o.fm;wf_send("SET DX_UPD g="+dx.o.gid+" f="+dx.o.fr+" lo="+dx.o.lo.toFixed(0)+" hi="+dx.o.hi.toFixed(0)+" o="+dx.o.o.toFixed(0)+" fl="+a+" b="+dx.o.begin+" e="+dx.o.end+" i="+encodeURIComponent(dx.o.i+"x")+" n="+encodeURIComponent(dx.o.n+"x")+" p="+encodeURIComponent(dx.o.p+"x"))}else{extint_panel_hide(),dx.o.fr=(parseFloat(dx.o.fr)+kiwi.freq_offset_kHz).toFixed(2),dx.o.pb="",(dx.o.lo||dx.o.hi)&&(dx.o.lo==-dx.o.hi?dx.o.pb=(2*Math.abs(dx.o.hi)).toFixed(0):dx.o.pb=dx.o.lo.toFixed(0)+", "+dx.o.hi.toFixed(0));a=w3_inline("",w3_div("w3-medium w3-text-aqua w3-bold","DX label edit"),w3_select("w3-margin-L-64/w3-label-inline w3-text-white /w3-text-red","database","","dx.db",dx.db,dx.db_s,"dx_database_cb",0));if(dx.db==dx.DB_STORED){var _="",i=dx.o.fd;0==i&&(i=dx.o.fd=dx.DX_DOW_BASE),console.log("DX g="+t+" dow="+i+"|"+i.toHex(2)+" f="+(+dx.o.fr).toFixed(2)+" b="+dx.o.begin+" e="+dx.o.end+" "+dx.o.i);for(var o=0;o<7;o++){var n=i&1<<6-o,s=n?"black":"white",n=n?dx.dow_colors[o]:"darkGrey";_+=w3_button("w3-dummy//w3-round w3-padding-tiny"+(o?" w3-margin-L-4":"")+"|color:"+s+"; background:"+n,"MTWTFSS"[o],"dx_dow_button",o)}_=w3_inline("",_);var t=+dx.o.begin,r=+dx.o.end;0!=t||0!=r&&2400!=r?(d=t.toFixed(0).leadingZeros(4),c=r.toFixed(0).leadingZeros(4)):d=c="";var l=kiwi_deep_copy(cfg.dx_type);if(dx.types_n)for(o=0;o<dx.DX_N_STORED;o++)0!=dx.types_n[o]&&""==l[o].name&&(l[o].name="(T"+o+")");r=w3_divs("w3-text-white/w3-margin-T-8",w3_inline("w3-halign-space-between/",w3_input("w3-padding-small||size=8","Freq","dx.o.fr",dx.o.fr,"dx_num_cb"),w3_select("w3-text-red","Mode","","dx.o.fm",dx.o.fm,kiwi.modes_u,"dx_sel_cb"),w3_input("w3-padding-small||size=10","Passband","dx.o.pb",dx.o.pb,"dx_passband_cb"),w3_select("w3-text-red","Type","","dx.o.ft",dx.o.ft,l,"dx_sel_cb"),w3_input("w3-padding-small||size=8","Offset","dx.o.o",dx.o.o,"dx_num_cb")),w3_input("w3-label-inline/w3-padding-small","Ident","dx.o.i","","dx_string_cb"),w3_input("w3-label-inline/w3-padding-small","Notes","dx.o.n","","dx_string_cb"),w3_input("w3-label-inline/w3-padding-small","Extension","dx.o.p","","dx_string_cb"),w3_inline("w3-hspace-16",w3_text("w3-text-white w3-bold","Schedule (UTC)"),_,w3_input("w3-label-inline/w3-padding-small","Begin","dx.o.begin",d,"dx_sched_time_cb"),w3_input("w3-label-inline/w3-padding-small","End","dx.o.end",c,"dx_sched_time_cb")),w3_inline("w3-hspace-16",w3_button("w3-yellow","Modify","dx_modify_cb"),w3_button("w3-green","Add","dx_add_cb"),w3_button("w3-red","Delete","dx_delete_cb"),w3_div("w3-margin-T-4",w3_checkbox("/w3-label-inline w3-label-not-bold w3-text-white/","filter by time/day-of-week","dx.stored_filter_tod",dx.stored_filter_tod,"dx_time_dow_cb"),w3_text("w3-margin-T-4","Create new label with Add button"))))}else var d="w3-halign-space-around/|flex-basis:130px",c=function(e){var t=dx_type2idx(e),e=dx.eibi_types_mask&1<<t?1:0;return w3_checkbox("/w3-label-inline w3-label-not-bold w3-round w3-padding-small/",dx.eibi_svc_s[t],"eibi-cbox"+t,e,"dx_eibi_svc_cb",t)},r=w3_inline("",w3_checkbox("w3-margin-TB-16/w3-label-inline w3-label-not-bold w3-text-white/w3-hspace-32","select all","eibi-all",4294967295==dx.eibi_types_mask,"dx_eibi_all_cb"),w3_checkbox("/w3-label-inline w3-label-not-bold w3-text-white/w3-margin-L-32","filter by time/day-of-week","dx.eibi_filter_tod",dx.eibi_filter_tod,"dx_time_dow_cb"))+w3_div("w3-valign-col w3-round w3-padding-TB-10 w3-gap-10|background:whiteSmoke",w3_inline(d,c(dx.DX_BCAST),c(dx.DX_UTIL),c(dx.DX_TIME)),w3_inline(d,c(dx.DX_ALE),c(dx.DX_HFDL),c(dx.DX_MILCOM)),w3_inline(d,c(dx.DX_CW),c(dx.DX_FSK),c(dx.DX_FAX)),w3_inline(d,c(dx.DX_AERO),c(dx.DX_MARINE),c(dx.DX_SPY)));ext_panel_set_name("dx"),ext_panel_show(a+r,null,function(){if(dx.db==dx.DB_STORED)w3_el("dx.o.i").value=dx.o.i,w3_el("dx.o.n").value=dx.o.n,w3_el("dx.o.p").value=dx.o.p;else for(var e=0;e<dx.DX_N_EiBi;e++)w3_color("eibi-cbox"+e+"-label","black",dx.eibi_colors[e])},function(){},!0),ext_set_controls_width_height(550,290),dx.help&&(extint_help_click_now(),dx.help=!1)}}function dx_database_cb(e,t,a,_,i){a||(dx.db=+t,dx.list=[],console_log_dbgUs("DX DB-SWITCHED db="+dx.db),_?dx_show_edit_panel(null,-1,i):ext_panel_displayed("dx")&&dx_close_edit_panel(),dx_schedule_update())}function dx_eibi_all_cb(e,t,a){if(!a)for(var _=t?1:0,i=0;i<dx.DX_N_EiBi;i++)dx_eibi_svc_cb("eibi-cbox"+i,_,!1,i)}function dx_time_dow_cb(e,t,a){a||(setVarFromString(e,t?1:0),dx_schedule_update())}function dx_eibi_svc_cb(e,t,a,_){a||(a=+_,_=t?1:0,w3_checkbox_set(e,t),_?dx.eibi_types_mask|=1<<a:dx.eibi_types_mask&=~(1<<a),dx_schedule_update())}function dx_close_edit_panel(e){e&&w3_radio_unhighlight(e),extint_panel_hide()}function dx_modify_cb(e,t){var a;console_log_dbgUs("DX COMMIT modify entry #"+dx.o.gid+" f="+dx.o.fr),console_log_dbgUs(dx.o),-1!=dx.o.gid&&(a=dx.o.fd<<dx.DX_DOW_SFT|dx.o.ft<<dx.DX_TYPE_SFT|dx.o.fm,dx.o.fr-=kiwi.freq_offset_kHz,dx.o.fr<0&&(dx.o.fr=0),wf_send("SET DX_UPD g="+dx.o.gid+" f="+dx.o.fr+" lo="+dx.o.lo.toFixed(0)+" hi="+dx.o.hi.toFixed(0)+" o="+dx.o.o.toFixed(0)+" fl="+a+" b="+dx.o.begin+" e="+dx.o.end+" i="+encodeURIComponent(dx.o.i+"x")+" n="+encodeURIComponent(dx.o.n+"x")+" p="+encodeURIComponent(dx.o.p+"x")),setTimeout(function(){dx_close_edit_panel(e)},250))}function dx_add_cb(e,t){var a=dx.o.fd<<dx.DX_DOW_SFT|dx.o.ft<<dx.DX_TYPE_SFT|dx.o.fm;dx.o.fr-=kiwi.freq_offset_kHz,dx.o.fr<0&&(dx.o.fr=0),wf_send("SET DX_UPD g=-1 f="+dx.o.fr+" lo="+dx.o.lo.toFixed(0)+" hi="+dx.o.hi.toFixed(0)+" o="+dx.o.o.toFixed(0)+" fl="+a+" b="+dx.o.begin+" e="+dx.o.end+" i="+encodeURIComponent(dx.o.i+"x")+" n="+encodeURIComponent(dx.o.n+"x")+" p="+encodeURIComponent(dx.o.p+"x")),setTimeout(function(){dx_close_edit_panel(e)},250),owrx.dx_click_gid_last=void 0}function dx_delete_cb(e,t){-1!=dx.o.gid&&(wf_send("SET DX_UPD g="+dx.o.gid+" f=-1"),setTimeout(function(){dx_close_edit_panel(e)},250),owrx.dx_click_gid_last=void 0)}function dx_click(e,t){var a,_,i,o,n,s;return e.shiftKey&&dx.db==dx.DB_STORED?dx_show_edit_panel(e,t):(owrx.dx_click_gid_last=dx.db==dx.DB_STORED?t:void 0,s=(a=dx.list[t]).freq,_=kiwi.modes_l[a.flags&dx.DX_MODE],i=a.lo,o=a.hi,t=a.params,extint.extname=extint.param=null,isArg(t)&&(n=""==t?[]:decodeURIComponent(t).split(","),"drm"==_?(extint.extname="drm",n.push("lo:"+i),n.push("hi:"+o),extint.param=n.join(",")):(extint.extname=n[0],extint.param=n.slice(1).join(","))),n=extint.extname||"",console_log_dbgUs("dx_click f="+a.freq+" mode="+_+" cur_mode="+cur_mode+" lo="+i+" hi="+o+" params=<"+t+"> extname=<"+n+"> param=<"+extint.param+">"),dx.db,dx.DB_EiBi,freqmode_set_dsp_kHz(s,_,{open_ext:!0}),(i||o)&&ext_set_passband(i,o,!1,s),s=dx.db==dx.DB_STORED?!any_alternate_click_event(e):e.shiftKey,"drm"!=_&&s&&!dx.ctrl_click&&t&&(console_log_dbgUs("dx_click ext="+extint.extname+" <"+extint.param+">"),extint_open(extint.extname,250)),dx.ctrl_click=!1),cancelEvent(e)}function dx_enter(e,t,a){dx_z_save=e.style.zIndex,e.style.zIndex=999,dx_bg_color_save=e.style.backgroundColor,e.style.backgroundColor=w3_contains(e,"cl-dx-label-filtered")?"lightGrey":w3_contains(e,"id-has-ext")?"magenta":"yellow";e=w3_el(parseInt(e.id)+"-id-dx-line");e.zIndex=998,e.style.width="3px",t&&(dx_canvas.style.left=px(t-dx_car_w/2),dx_canvas.style.zIndex=100)}function dx_leave(e,t){e.style.zIndex=dx_z_save,e.style.backgroundColor=dx_bg_color_save;e=w3_el(parseInt(e.id)+"-id-dx-line");e.zIndex=110,e.style.width="1px",t&&(dx_canvas.style.zIndex=99)}function dx_help(e){return e&&(confirmation_show_content(w3_text("w3-medium w3-bold w3-text-aqua","DX label edit help")+w3_div("w3-margin-T-8 w3-scroll-y|height:90%",w3_div("w3-margin-R-8",'There are two types of DX labels seen in the area above the frequency scale: <br>1) Labels from a stored database, editable by the Kiwi owner/admin. <br>2) Labels from a read-only copy of the <a href="http://www.eibispace.de" target="_blank">EiBi database</a> that cannot be modified.<br><br>The DX label edit control panel has a <i>database</i> menu to select between the two. Similarly, there are two selection entries in the right-click menu (double-finger tap on mobile devices). The keyboard shortcut keys "\\" and "|" also switch between the two databases with the later also opening the control panel.<br><br>When zoomed out the number of labels shown is limited to prevent overwhelming the display. This is why some labels will only appear as you zoom in. The same is true if too many categories are selected enabling a large number of labels.<br><br>Information about using the editing controls for the stored labels can be found <a href="http://kiwisdr.com/quickstart/index.html#id-user-marker" target="_blank">here</a>.<br><br>Because there are so many EiBi labels (about 17000) they are organized into 12 categories with visibility selected by checkboxes on the control panel. In addition labels from either database can be filtered by their schedule (UTC time & day-of-week) specified in the database. If filtering is disabled labels outside their scheduled time appear with a lighter category color and a dashed border. When filtering is enabled the label display will refresh every 5 minutes so it reflects the current schedule.<br><br>Labels that have an extension specified turn magenta when moused-over as opposed to the usual yellow. And labels outside their scheduled time (if any) will mouse-over grey. For stored labels the extension is set per-label in the label edit panel and the extension opened when the label is clicked (a shift-click opens that label in the edit panel). For EiBi labels an extension is automatically assumed for the ALE, CW, FSK, Fax and Time categories, but is only opened if the label is shift-clicked (note difference from stored label behavior, a non-shift click simply selects the frequency/mode).<br><br>When a label is moused-over a popup is shown with optional information (stored labels) or database information (EiBi labels). On Safari and Chrome the popups take a few second to appear. EiBi information includes the station\'s home country, transmission schedule, language and target area (if any). Information about the EiBi database, including descriptions of the language and target codes seen in the mouse-over popups, <a href="http://kiwisdr.com/files/EiBi/README.txt" target="_blank">can be found here.</a><br><br>EiBi URL parameters: (use "dx=..." in the browser URL)<br>'+w3_text("|color:orange","none bcast utility time ale hfdl milcom cw fsk fax aero maritime spy filter[:0]")+'<br>By default all the category checkboxes and "<i>filter by time/day-of-week</i>" are checked. <br>Specifying <i>none</i> will uncheck all the categories. Specifying the individual category names will then toggle the checkbox state.<br><br>For example, to select only the ALE and Fax categories: <i>dx=none,ale,fax</i> <br>To select all except the CW and Time categories: <i>dx=cw,time</i> <br>To just bring up the EiBi control panel: <i>dx</i> (e.g. <i>my_kiwi:8073/?spec&dx</i>)<br>Keywords are case-insensitive and can be abbreviated. For example: <br><i>dx=n,bc,f:0</i> (show all broadcast stations without time/day filtering) <br>')),610,375),w3_el("id-confirmation-container").style.height="100%"),!0}var SMETER_RHS=38,SMETER_SCALE_HEIGHT=29,SMETER_BIAS=127,SMETER_INPUT_MAX=3.4,SMETER_INPUT_RANGE=SMETER_BIAS+SMETER_INPUT_MAX,SMETER_DISPLAY_MAX=-6,SMETER_DISPLAY_RANGE=SMETER_BIAS+SMETER_DISPLAY_MAX,sMeter_ctx,smeter_ovfl,bars={dBm:[-121,-109,-97,-85,-73,-63,-53,-33,-13],text:["S1","S3","S5","S7","S9","+10","+20","+40","+60"]};function smeter_dBm_biased_to_x(e){return SMETER_DISPLAY_RANGE<e&&(e=SMETER_DISPLAY_RANGE),Math.round(e/SMETER_DISPLAY_RANGE*smeter_width)}function smeter_init(e){owrx.force_no_agc_thresh_smeter=e;var t=w3_el("id-control-smeter");if(t){w3_innerHTML(t,'<canvas id="id-smeter-scale" class="class-smeter-scale" width="0" height="0"></canvas>',w3_div("id-smeter-ovfl w3-hide","OV"),w3_div("id-smeter-dbm-value"),w3_div("id-smeter-dbm-units","dBm"));var a=w3_el("id-smeter-scale");smeter_ovfl=w3_el("smeter-ovfl");var _=divControl?divControl.activeWidth:350,i=html_LR_border_pad(a),o=smeter_width=_-SMETER_RHS-i,e=SMETER_SCALE_HEIGHT,n=e-8,_=o+SMETER_RHS;t.style.width=px(_+i),(sMeter_ctx=a.getContext("2d")).canvas.width=_,sMeter_ctx.canvas.height=e,sMeter_ctx.fillStyle="gray",sMeter_ctx.globalAlpha=1,sMeter_ctx.fillRect(0,0,_,e),sMeter_ctx.font="11px Verdana",sMeter_ctx.textBaseline="middle",sMeter_ctx.textAlign="center",sMeter_ctx.fillStyle="white";for(var s=0;s<bars.text.length;s++){var r=smeter_dBm_biased_to_x(bars.dBm[s]+SMETER_BIAS);line_stroke(sMeter_ctx,1,3,"white",r,n-8,r,8+n),sMeter_ctx.fillText(bars.text[s],r,n-15)}line_stroke(sMeter_ctx,0,5,"black",0,n,o,n),kiwi_clearInterval(owrx.smeter_interval),owrx.smeter_interval=setInterval(update_smeter,100)}}var sm_px=0,sm_timeout=0,sm_interval=10,sm_ovfl_showing=!1,ident_tout;function update_smeter(){var e,t=smeter_dBm_biased_to_x(owrx.sMeter_dBm_biased),a=SMETER_SCALE_HEIGHT-8,_=smeter_width;sMeter_ctx.globalAlpha=1,line_stroke(sMeter_ctx,0,5,"lime",0,a,t,a),cfg.agc_thresh_smeter&&1!=owrx.force_no_agc_thresh_smeter&&(e=smeter_dBm_biased_to_x(-(cur_mode&&"cw"==cur_mode.substr(0,2)?threshCW:thresh)),line_stroke(sMeter_ctx,0,2,"white",0,a-3,_-e,a-3),line_stroke(sMeter_ctx,0,2,"black",_-e,a-3,_,a-3)),0==sm_timeout--?(sm_timeout=sm_interval,t<sm_px&&line_stroke(sMeter_ctx,0,5,"black",t,a,sm_px,a),sm_px=t):t<sm_px?line_stroke(sMeter_ctx,0,5,"red",t,a,sm_px,a):(sm_px=t,sm_timeout=sm_interval),audio_ext_adc_ovfl&&!sm_ovfl_showing?(w3_hide("id-smeter-dbm-units"),w3_show("id-smeter-ovfl"),w3_call("S_meter_adc_ovfl",!0),sm_ovfl_showing=!0):!audio_ext_adc_ovfl&&sm_ovfl_showing&&(w3_hide("id-smeter-ovfl"),w3_show("id-smeter-dbm-units"),w3_call("S_meter_adc_ovfl",!1),sm_ovfl_showing=!1),w3_innerHTML("id-smeter-dbm-value",owrx.sMeter_dBm.toFixed(0))}var ident_user="",send_ident=!1;function ident_init(){var e=Math.max(cfg.ident_len,kiwi.ident_min);user_url&&(user_url=kiwi_decodeURIComponent("user_url",user_url),user_url=kiwi_strip_tags(user_url,"").substring(0,e),writeCookie("ident",user_url));var t=initCookie("ident",""),t=kiwi_strip_tags(t,"").substring(0,e);t=kiwi_strip_tags(t,"").substring(0,e);var a=w3_el("id-ident-input1"),_=w3_el("id-ident-input2");w3_attribute(a,"maxlength",e),w3_attribute(_,"maxlength",e),a.value=t,_.value=t,ident_user=t,send_ident=!0}function ident_complete(e,t){var a=w3_el("id-ident-input"+t),_=w3_el("id-ident-input"+(1==t?2:1)),i=a.value,t=Math.max(cfg.ident_len,kiwi.ident_min),i=kiwi_strip_tags(i,"").substring(0,t);a.value=i,_.value=i,kiwi_clearTimeout(ident_tout),w3_schedule_highlight(a),w3_schedule_highlight(_),freqset_select(),writeCookie("ident",i),ident_user=i,send_ident=!0}function ident_keyup(e,t,a){if(kiwi_clearTimeout(ident_tout),null!=t&&null!=t.key){var _=t.key.length;if(any_alternate_click_event_except_shift(t)||1!=_&&"Backspace"!=t.key&&"Shift"!=t.key)return void("Enter"==t.key&&ident_complete("Enter",a))}send_ident||(ident_tout=setTimeout(function(){ident_complete("t/o",a)},5e3))}var shortcut={nav_off:0,keys:"",SHIFT:1,CTL_OR_ALT:2,SHIFT_PLUS_CTL_OR_ALT:3,KEYCODE_ALT:18};function keyboard_shortcut_init(){kiwi_isMobile()&&!mobile_laptop_test||kiwi_isFirefox()<47||kiwi_isChrome()<=49||kiwi_isOpera()<=36||(shortcut.help=w3_div("",w3_inline_percent("w3-padding-tiny w3-bold w3-text-aqua","Keys",25,"Function"),w3_inline_percent("w3-padding-tiny","g =",25,"select frequency entry field"),w3_inline_percent("w3-padding-tiny","j i LR-arrow-keys",25,"frequency step down/up, add shift or alt/ctrl for faster<br>shift plus alt/ctrl to step to next/prev DX label"),w3_inline_percent("w3-padding-tiny","m",25,"toggle frequency memory menu"),w3_inline_percent("w3-padding-tiny","b B",25,"scroll band menu"),w3_inline_percent("w3-padding-tiny","e E",25,"scroll extension menu"),w3_inline_percent("w3-padding-tiny","a A d l u c f q",25,"toggle modes: AM SAM DRM LSB USB CW NBFM IQ<br>add alt/ctrl to toggle backwards (e.g. SAM modes)"),w3_inline_percent("w3-padding-tiny","p P",25,"passband narrow/widen"),w3_inline_percent("w3-padding-tiny","r",25,"toggle audio recording"),w3_inline_percent("w3-padding-tiny","z Z",25,"zoom in/out, add alt/ctrl for max in/out"),w3_inline_percent("w3-padding-tiny","< >",25,"waterfall page down/up"),w3_inline_percent("w3-padding-tiny","w W",25,"waterfall min dB slider -/+ 1 dB, add alt/ctrl for -/+ 10 dB"),w3_inline_percent("w3-padding-tiny","S",25,"waterfall auto-scale"),w3_inline_percent("w3-padding-tiny","s D",25,"spectrum on/off toggle, slow device mode"),w3_inline_percent("w3-padding-tiny","v V space",25,"volume less/more, mute"),w3_inline_percent("w3-padding-tiny","o",25,'toggle between option bar "off" and "stats" mode,<br>others selected by related shortcut key'),w3_inline_percent("w3-padding-tiny","!",25,"toggle aperture manual/auto menu"),w3_inline_percent("w3-padding-tiny","@",25,"DX label filter"),w3_inline_percent("w3-padding-tiny","\\ |",25,"toggle (toggle & open) DX stored/EiBi database"),w3_inline_percent("w3-padding-tiny","x y",25,"toggle visibility of control panels, top bar"),w3_inline_percent("w3-padding-tiny","esc",25,"close/cancel action"),w3_inline_percent("w3-padding-tiny","? h",25,"toggle this help list"),w3_inline_percent("w3-padding-tiny w3-bold w3-text-aqua","",25,"Windows, Linux: use alt, not ctrl"),w3_inline_percent("w3-padding-tiny w3-bold w3-text-aqua","",25,"Mac: use ctrl or alt")),w3_el("id-kiwi-body").addEventListener("keydown",keyboard_shortcut_event,!0))}function keyboard_shortcut_help(){confirmation_show_content(shortcut.help,550,565)}function keyboard_shortcut_nav(e){w3_el("id-nav-optbar-"+e).click(),shortcut.nav_click=!0}function keyboard_shortcut_key_proc(){shortcut.key_i>=shortcut.keys.length||(keyboard_shortcut(shortcut.keys[shortcut.key_i],0,0),shortcut.key_i++,setTimeout(keyboard_shortcut_key_proc,100))}function keyboard_shortcut_url_keys(){shortcut.keys=shortcut.keys.split(""),shortcut.key_i=0,keyboard_shortcut_key_proc()}function keyboard_shortcut(e,t,a,_){var i=a?-1:1;switch(shortcut.nav_click=!1,e){case"a":mode_button(null,w3_el("id-button-am"),i);break;case"A":mode_button(null,w3_el("id-button-sam"),i);break;case"d":ext_set_mode("drm",null,{open_ext:!0});break;case"l":mode_button(null,w3_el("id-button-lsb"),i);break;case"u":mode_button(null,w3_el("id-button-usb"),i);break;case"c":mode_button(null,w3_el("id-button-cw"),i);break;case"f":ext_set_mode("nbfm");break;case"q":ext_set_mode("iq");break;case"j":case"J":case"ArrowLeft":t!=shortcut.SHIFT_PLUS_CTL_OR_ALT?freqstep(owrx.wf_snap?t:2-t):dx_label_step(-1);break;case"i":case"I":case"ArrowRight":t!=shortcut.SHIFT_PLUS_CTL_OR_ALT?freqstep(owrx.wf_snap?5-t:3+t):dx_label_step(1);break;case"p":passband_increment(!1);break;case"P":passband_increment(!0);break;case"v":setvolume(1,kiwi.volume-10),toggle_or_set_mute(0),keyboard_shortcut_nav("audio");break;case"V":setvolume(1,kiwi.volume+10),toggle_or_set_mute(0),keyboard_shortcut_nav("audio");break;case" ":toggle_or_set_mute(),shortcut.nav_click=!0;break;case"g":case"=":freqset_select();break;case"m":freq_memory_menu_show(!0);break;case"b":band_scroll(1);break;case"B":band_scroll(-1);break;case"<":page_scroll(-page_scroll_amount);break;case">":page_scroll(+page_scroll_amount);break;case"z":zoom_step(a?ext_zoom.NOM_IN:ext_zoom.IN);break;case"Z":zoom_step(a?ext_zoom.MAX_OUT:ext_zoom.OUT);break;case"w":incr_mindb(1,a?-10:-1),keyboard_shortcut_nav("wf");break;case"W":incr_mindb(1,a?10:1),keyboard_shortcut_nav("wf");break;case"s":toggle_or_set_spec(),keyboard_shortcut_nav("wf");break;case"S":wf_autoscale_cb(),keyboard_shortcut_nav("wf");break;case"D":toggle_or_set_slow_dev(),keyboard_shortcut_nav("wf");break;case"!":keyboard_shortcut_nav("wf"),wf_aper_cb("wf.aper",1^wf.aper,!1);break;case"#":dbgUs&&extint_open("prefs");break;case"o":keyboard_shortcut_nav(shortcut.nav_off?"status":"off"),shortcut.nav_off^=1;break;case"r":toggle_or_set_rec();break;case"x":toggle_or_set_hide_panels();break;case"y":toggle_or_set_hide_bars();break;case"@":dx_filter(),shortcut.nav_click=!0;break;case"e":extension_scroll(1);break;case"E":extension_scroll(-1);break;case"\\":case"|":dx_database_cb("",dx.db==dx.DB_STORED?dx.DB_EiBi:dx.DB_STORED,!1,"|"==e,!0);break;case"?":case"h":keyboard_shortcut_help();break;case"n":owrx.debug_drag&&(canvas_log("\f"),owrx.drag_count=0);break;default:1==e.length&&_!=shortcut.KEYCODE_ALT&&console.log("no shortcut key <"+e+">")}ignore_next_keyup_event=!0}function keyboard_shortcut_event(e){if(e.target){var t=e.key;if("Escape"!=t&&!t.match(/F[1-9][12]?/)){var a=e.target.id;""==a&&w3_iterate_classList(e.target,function(e,t){e.startsWith("id-")&&(a=e)});var _=e.shiftKey,i=e.ctrlKey,o=e.altKey,n=e.metaKey,s=i||o,r=_&&!s?shortcut.SHIFT:!_&s?shortcut.CTL_OR_ALT:_&&s?shortcut.SHIFT_PLUS_CTL_OR_ALT:0,l="0"<=t&&t<="9"&&!i||"."==t||","==t||"/"==t||":"==t||"-"==t||"+"==t||";"==t||"k"==t||"M"==t||"Enter"==t||"ArrowUp"==t||"ArrowDown"==t||"Backspace"==t||"Delete"==t;if("INPUT"!=e.target.nodeName||"id-freq-input"==a&&!l){if(kiwi_isMacOS()){if(n)return}else if(i)return;o&&!t.startsWith("Arrow")&&(t=String.fromCharCode(e.keyCode).toLowerCase(),_&&(t=t.toUpperCase())),keyboard_shortcut(t,r,s,e.keyCode),cancelEvent(e)}}}}function extension_scroll(e){console.log("extension_scroll dir="+e),console.log(extint_names);var t=w3_el("id-select-ext");console.log(t);var a,_=t.childNodes;console.log(_);var i=+t.value+1;for(console.log("extension_scroll initial i="+i);(i+=e)<1&&(i=_.length-1),i>=_.length&&(i=1),a=_[i],a.disabled;);var o=+a.value,t=+a.getAttribute("kiwi_idx");console.log("extension_scroll i="+i+" val="+o+" idx="+t+" "+a.innerHTML),w3_select_value("id-select-ext",o),owrx.sel_ext_to&&kiwi_clearTimeout(owrx.sel_ext_to),owrx.sel_ext_to=setTimeout(function(){extint_select(o)},2e3)}var panel_margin=10,ac_play_button;function check_suspended_audio_state(){try{if(window.AudioContext=window.AudioContext||window.webkitAudioContext,ac_play_button=new AudioContext,kiwi_isSafari()){var t=ac_play_button.createBufferSource();t.connect(ac_play_button.destination);try{t.start(0)}catch(e){t.noteOn(0)}}setTimeout(test_audio_suspended,500)}catch(e){console.log("#### no AudioContext?")}}function test_audio_suspended(){var e;"running"!=ac_play_button.state&&(e=w3_div('id-play-button-container class-overlay-container||onclick="play_button()"',w3_div("id-play-button",'<img src="gfx/openwebrx-play-button.png" width="150" height="150" /><br><br>'+(kiwi_isMobile()?"Tap to":"Click to")+" start OpenWebRX")),w3_create_appendElement("id-kiwi-body","div",e),el=w3_el("id-play-button"),el.style.marginTop=px(w3_center_in_window(el)))}function play_button(){try{if(kiwi_is_iOS()){var e=audio_context,t=e.createBufferSource();t.connect(e.destination);try{t.start(0)}catch(e){t.noteOn(0)}}else try{audio_context&&audio_context.resume()}catch(e){console.log("#### audio_context.resume() FAILED")}}catch(e){add_problem("audio start")}w3_el("id-play-button-container").style.opacity=0,setTimeout(function(){w3_hide("id-play-button-container")},1100),audio_reset(),freqset_select()}function panels_setup(){var o;w3_el("id-ident").innerHTML=w3_input('w3-label-not-bold/w3-custom-events|padding:1px|size=20 onchange="ident_complete(\'el\', 1)" onkeyup="ident_keyup(this, event, 1)"',"Your name or callsign:","ident-input1");var e=kiwi_isMobile()?" inputmode="+dq(kiwi_is_iOS()?"decimal":"tel")+' ontouchstart="popup_keyboard_touchstart(event)" onclick="this.select()"':"";w3_el("id-control-freq1").innerHTML=w3_inline("w3-halign-space-between/",w3_div("id-freq-cell",'<form id="id-freq-form" name="form_freq" action="#" onsubmit="freqset_complete(0); return false;">'+w3_input("w3-custom-events w3-font-16px|margin: 2px 0 0 2px; padding:0 4px; width:"+freq_field_width()+'|type="text"'+e+' onchange="freqset_complete(1)" onkeyup="freqset_keyup(this, event)"',"","id-freq-input")+"</form>")+'<select id="id-select-band" class="w3-pointer w3-select-menu" onchange="select_band(this.value)">'+setup_band_menu()+'</select><select id="id-select-ext" class="w3-pointer w3-select-menu" onchange="freqset_select(); extint_select(this.value)"><option value="-1" selected disabled>extension</option>'+extint_select_build_menu()+"</select>"),check_suspended_audio_state(),w3_el("id-control-freq2").innerHTML=w3_inline("w3-halign-space-between w3-margin-T-4/",w3_icon("id-freq-menu","fa-bars w3-text-white",20,"","freq_memory_menu_show"),w3_button('id-freq-vfo w3-text-in-circle w3-wh-20px w3-aqua||title="VFO A&slash;B"',"A","freq_vfo_cb"),kiwi_isMobile()?null:w3_div("id-freq-link|padding-left:0px"),w3_div("id-9-10-cell w3-hide",w3_div('id-button-9-10 class-button-small||title="LW/MW 9/10 kHz tuning step" onclick="button_9_10()"',"10")),w3_div("id-step-freq",'<img id="id-step-0" src="icons/stepdn.20.png" onclick="freqstep(0)" />','<img id="id-step-1" src="icons/stepdn.18.png" onclick="freqstep(1)" style="padding-bottom:1px" />','<img id="id-step-2" src="icons/stepdn.16.png" onclick="freqstep(2)" style="padding-bottom:2px" />','<img id="id-step-3" src="icons/stepup.16.png" onclick="freqstep(3)" style="padding-bottom:2px" />','<img id="id-step-4" src="icons/stepup.18.png" onclick="freqstep(4)" style="padding-bottom:1px" />','<img id="id-step-5" src="icons/stepup.20.png" onclick="freqstep(5)" />'),w3_div("",w3_button('id-button-spectrum class-button||title="toggle spectrum display"',"Spec","toggle_or_set_spec")),w3_div("",w3_div('fa-stack||title="record"',w3_icon("id-rec1","fa-repeat fa-stack-1x w3-text-pink",22,"","toggle_or_set_rec"))),w3_div('|width:8%|title="mute"',w3_div("id-mute-no fa-stack|width:100%; color:lime",w3_icon("","fa-volume-up fa-stack-2x",24,"inherit","toggle_or_set_mute")),w3_div("id-mute-yes fa-stack w3-hide|width:100%;color:magenta;",w3_icon("","fa-volume-off fa-stack-2x fa-nudge-left",24,"","toggle_or_set_mute"),w3_icon("","fa-times fa-right",12,"","toggle_or_set_mute")),w3_div("id-mute-exclaim fa-stack w3-hide|width:100%; color:yellow",w3_icon("","fa-exclamation-triangle fa-stack-1x",20,"inherit","freqset_select")))),button_9_10(step_9_10=isNaN(override_9_10)?null==(n=ext_get_cfg_param("init.AM_BCB_chan"))||null==n||n?0:1:override_9_10),o="",mode_buttons.forEach(function(e,t){var a=e.s[0],_=a.toLowerCase(),i=e.dis||"drm"==_&&!kiwi.DRM_enable,e=i?"":' onclick="mode_button(event, this)"';e+=' onmouseover="mode_over(event, this)"',o+=w3_div("id-button-"+_+" id-mode-"+_.substr(0,2)+" class-button"+(i?" class-button-disabled":"")+' ||id="'+t+'-id-mode-col"'+e+' onmousedown="cancelEvent(event)"',a)}),w3_el("id-control-mode").innerHTML=w3_inline("w3-halign-space-between/",o);var t=wf.audioFFT_active?" w3-disabled":"",a=wf.audioFFT_active?' w3-disabled||onclick="audioFFT_update()"':"";w3_el("id-control-zoom").innerHTML=w3_inline("w3-halign-space-between/",w3_div("id-zoom-in class-icon"+t+'||onclick="zoom_click(event,1)" onmouseover="zoom_over(event)" title="zoom in"','<img src="icons/zoomin.png" width="32" height="32" />'),w3_div("id-zoom-out class-icon"+t+'||onclick="zoom_click(event,-1)" onmouseover="zoom_over(event)" title="zoom out"','<img src="icons/zoomout.png" width="32" height="32" />'),w3_div("id-maxin"+a,w3_div('class-icon||onclick="zoom_click(event,8)" title="max in"','<img src="icons/maxin.png" width="32" height="32" />')),w3_div("id-maxin-nom w3-hide"+a,w3_div('class-icon||onclick="zoom_click(event,8)" title="max in"','<img src="icons/maxin.nom.png" width="32" height="32" />')),w3_div("id-maxin-max w3-hide"+a,w3_div('class-icon||onclick="zoom_click(event,8)" title="max in"','<img src="icons/maxin.max.png" width="32" height="32" />')),w3_div("id-maxout"+a,w3_div('class-icon||onclick="zoom_click(event,-9)" title="max out"','<img src="icons/maxout.png" width="32" height="32" />')),w3_div("id-maxout-max w3-hide"+a,w3_div('class-icon||onclick="zoom_click(event,-9)" title="max out"','<img src="icons/maxout.max.png" width="32" height="32" />')),w3_div("class-icon"+t+'||onclick="zoom_click(event,0)" title="zoom to band"','<img src="icons/zoomband.png" width="32" height="16" style="padding-top:13px; padding-bottom:13px;"/>'),w3_div("class-icon"+t+'||onclick="page_scroll_icon_click(event,'+-page_scroll_amount+')" title="page down\nalt: label step"','<img src="icons/pageleft.png" width="32" height="32" />'),w3_div("class-icon"+t+'||onclick="page_scroll_icon_click(event,'+page_scroll_amount+')" title="page up\nalt: label step"','<img src="icons/pageright.png" width="32" height="32" />'));var _,i=["w3-pink","w3-blue","w3-purple","w3-aqua","w3-yellow","w3-black","w3-red","w3-amber","w3-green","w3-orange","w3-lime","w3-indigo","w3-brown","w3-teal"],e=0,n=" w3-center|width:15.2%",a=n+";margin-right:6px";w3_el("id-optbar").innerHTML=w3_navbar("cl-optbar",w3_navdef(i[e++]+a,"WF","optbar-wf","optbar"),w3_nav(i[e++]+a,"Audio","optbar-audio","optbar"),w3_nav(i[e++]+a,"AGC","optbar-agc","optbar"),w3_nav(i[e++]+a,"Users","optbar-users","optbar"),w3_nav(i[+e]+a,"Stats","optbar-status","optbar"),w3_nav(i[5]+n,"Off","optbar-off","optbar")),wf_filter=readCookie("last_wf_filter",wf_sp_menu_e.OFF),spec_filter=readCookie("last_spec_filter",wf_sp_menu_e.IIR),isString(spectrum_show)&&(_=spectrum_show.toLowerCase(),wf_sp_menu_s.forEach(function(e,t){_==e.toLowerCase()&&(spec_filter=t)})),wf.max_min_sliders=w3_col_percent("w3-valign/class-slider",w3_text(optbar_prefix_color,"WF max"),19,'<input id="id-input-maxdb" type="range" min="-100" max="20" value="'+maxdb+'" step="1" onchange="setmaxdb(1,this.value)" oninput="setmaxdb(0,this.value)">',60,w3_div("id-field-maxdb class-slider"),19)+w3_col_percent("w3-valign/class-slider",w3_text(optbar_prefix_color,"WF min"),19,'<input id="id-input-mindb" type="range" min="-190" max="-30" value="'+mindb+'" step="1" onchange="setmindb(1,this.value)" oninput="setmindb(0,this.value)">',60,w3_div("id-field-mindb class-slider"),19),wf.floor_ceil_sliders=w3_col_percent("w3-valign/class-slider",w3_text(optbar_prefix_color,"WF ceil"),19,'<input id="id-input-ceildb" type="range" min="-30" max="30" value="'+wf.auto_ceil.val+'" step="5" onchange="setceildb(1,this.value)" oninput="setceildb(0,this.value)">',60,w3_div("id-field-ceildb class-slider"),19)+w3_col_percent("w3-valign/class-slider",w3_text(optbar_prefix_color,"WF floor"),19,'<input id="id-input-floordb" type="range" min="-30" max="30" value="'+wf.auto_floor.val+'" step="5" onchange="setfloordb(1,this.value)" oninput="setfloordb(0,this.value)">',60,w3_div("id-field-floordb class-slider"),19),w3_el("id-optbar-wf").innerHTML=w3_div("id-aper-data w3-hide w3-margin-B-5|left:0px; width:256px; height:16px; background-color:#575757; overflow:hidden; position:relative;",'<canvas id="id-aper-canvas" width="256" height="16" style="position:absolute"></canvas>')+w3_col_percent("",w3_div("",w3_div("id-wf-sliders",wf.max_min_sliders),w3_col_percent("w3-valign/class-slider",w3_text(optbar_prefix_color,"WF rate"),19,'<input id="slider-rate" class="'+t+'" type="range" min="0" max="4" value="'+wf_speed+'" step="1" onchange="setwfspeed(1,this.value)" oninput="setwfspeed(0,this.value)">',60,w3_div("slider-rate-field class-slider"),19),w3_col_percent("w3-valign/class-slider",w3_button("id-wf-sp-button class-button w3-font-12px","Spec &Delta;","toggle_or_set_wf_sp_button"),19,w3_slider("id-wf-sp-slider","","wf_sp_param",wf_sp_param,0,10,1,"wf_sp_slider_cb"),60,w3_div("id-wf-sp-slider-field class-slider"),19)),85,w3_divs("/w3-tspace-4 w3-hcenter w3-font-11_25px",w3_button('id-button-wf-autoscale class-button||title="waterfall auto scale"',"Auto<br>Scale","wf_autoscale_cb"),w3_button('id-button-slow-dev class-button||title="slow device mode"',"Slow<br>Dev","toggle_or_set_slow_dev"),w3_inline("",w3_button('id-button-spec-peak class-button||title="toggle peak hold"',"Pk","toggle_or_set_spec_peak"),w3_icon("id-wf-gnd w3-margin-L-4 w3-momentary","fa-caret-down",22,"white","wf_gnd_cb",1))),15)+w3_inline("w3-halign-space-between w3-margin-T-2/",w3_select('w3-text-red||title="colormap selection"',"","colormap","wf.cmap",wf.cmap,kiwi.cmap_s,"wf_cmap_cb"),w3_select('w3-text-red||title="aperture selection"',"","aper","wf.aper",wf.aper,kiwi.aper_s,"wf_aper_cb"),w3_select('w3-text-red||title="waterfall filter selection"',"","wf","wf_filter",wf_filter,wf_sp_menu_s,"wf_sp_menu_cb",1),w3_select('w3-text-red||title="spectrum filter selection"',"","spec","spec_filter",spec_filter,wf_sp_menu_s,"wf_sp_menu_cb",0),w3_button('id-button-wf-more class-button w3-text-orange||onclick="extint_open(\'waterfall\'); freqset_select();" title="more waterfall params"',"More")),setwfspeed(1,wf_speed),toggle_or_set_slow_dev(toggle_e.FROM_COOKIE|toggle_e.SET,0),toggle_or_set_spec_peak(toggle_e.FROM_COOKIE|toggle_e.SET_URL,peak_initially),toggle_or_set_wf_sp_button(toggle_e.FROM_COOKIE|toggle_e.SET,0);de_emphasis=readCookie("last_de_emphasis",0),de_emphasis=w3_clamp(de_emphasis,0,1,0),pan=readCookie("last_pan",0),w3_el("id-optbar-audio").innerHTML=w3_inline_percent("w3-valign/w3-last-halign-end",w3_text(optbar_prefix_color+" cl-closer-spaced-label-text","Noise"),17,w3_select_conditional('w3-text-red||title="noise blanker selection"',"","blanker","nb_algo",0,[["off",1],["std",1],["Wild",1]],"nb_algo_cb","m"),24,w3_div("w3-hcenter",w3_div('class-button w3-text-orange||onclick="extint_open(\'noise_blank\'); freqset_select();" title="noise blanker parameters"',"More")),19,w3_div("w3-hcenter ",w3_select_conditional('w3-text-red||title="noise filter selection"',"","filter","nr_algo",0,[["off",1],["wdsp",1],["LMS",1],["spec",1]],"nr_algo_cb","m")),27,w3_div('class-button w3-text-orange||onclick="extint_open(\'noise_filter\'); freqset_select();" title="noise filter parameters"',"More"))+w3_inline_percent("id-vol w3-valign w3-margin-T-2 w3-hide/class-slider w3-last-halign-end",w3_text(optbar_prefix_color,"Volume"),17,'<input id="id-input-volume" type="range" min="0" max="200" value="'+kiwi.volume+'" step="1" onchange="setvolume(1, this.value)" oninput="setvolume(0, this.value)">',50,"&nbsp;",8,w3_select('w3-text-red||title="de-emphasis selection"',"","de-emp","de_emphasis",de_emphasis,de_emphasis_s,"de_emp_cb"))+w3_inline_percent("id-vol-comp w3-valign w3-margin-T-2/class-slider w3-last-halign-end",w3_text(optbar_prefix_color,"Volume"),17,'<input id="id-input-volume" type="range" min="0" max="200" value="'+kiwi.volume+'" step="1" onchange="setvolume(1, this.value)" oninput="setvolume(0, this.value)">',40,w3_select("w3-text-red","","de-emp","de_emphasis",de_emphasis,de_emphasis_s,"de_emp_cb"),28,w3_button('id-button-compression class-button w3-hcenter||title="compression"',"Comp","toggle_or_set_compression"))+w3_inline_percent("id-pan w3-valign w3-hide/class-slider w3-last-halign-end",w3_text(optbar_prefix_color,"Pan"),17,'<input id="id-pan-value" type="range" min="-1" max="1" value="'+pan+'" step="0.01" onchange="setpan(1,this.value)" oninput="setpan(0,this.value)">',50,"&nbsp;",3,w3_div("id-pan-field"),8,"&nbsp;",7,w3_button('id-button-compression class-button w3-hcenter||title="compression"',"Comp","toggle_or_set_compression"))+w3_inline_percent("id-squelch w3-valign/class-slider w3-last-halign-end",w3_text("id-squelch-label","Squelch"),17,w3_slider("","","squelch-value",squelch,0,99,1,"set_squelch_cb"),50,"&nbsp;",3,w3_div("id-squelch-field class-slider"),14,w3_select('id-squelch-tail w3-hide w3-text-red||title="squelch tail length"',"","tail","squelch_tail",squelch_tail,squelch_tail_s,"squelch_tail_cb"))+w3_inline_percent("id-sam-carrier-container w3-hide w3-valign/",w3_inline("w3-halign-space-between/w3-last-halign-end",w3_text(optbar_prefix_color,"SAM"),w3_text("id-sam-carrier")),50,w3_div(),5,w3_inline("w3-halign-space-between/w3-last-halign-end",w3_select("w3-text-red","","PLL","owrx.sam_pll",owrx.sam_pll,owrx.sam_pll_s,"sam_pll_cb"),w3_button("class-button w3-hcenter","Reset","sam_pll_reset_cb")))+w3_inline_percent("w3-margin-T-2 w3-valign/",w3_div(""),55,w3_inline("w3-halign-space-between/w3-last-halign-end",w3_select("id-chan-null w3-text-red w3-hide","","channel<br>null","owrx.chan_null",owrx.chan_null,owrx.chan_null_s,"chan_null_cb"),w3_select("id-ovld-mute w3-text-red","","ovld<br>mute","owrx.ovld_mute",owrx.ovld_mute,owrx.ovld_mute_s,"ovld_mute_cb"))),kiwi_load_js_dir("extensions/",["noise_blank/noise_blank.js","noise_filter/noise_filter.js"],function(){noise_blank_init(),noise_filter_init()}),toggle_or_set_compression(toggle_e.FROM_COOKIE|toggle_e.SET,1),squelch_setup(toggle_e.FROM_COOKIE),audio_panner_ui_init(),w3_el("id-optbar-agc").innerHTML=w3_col_percent("w3-valign w3-margin-B-4/class-slider",'<div id="id-button-agc" class="class-button" onclick="toggle_agc(event)" onmousedown="cancelEvent(event)" onmouseover="agc_over(event)">AGC</div>',13,'<div id="id-button-hang" class="class-button" onclick="toggle_or_set_hang();">Hang</div>',17,w3_divs("w3-show-inline-block/id-label-man-gain cl-closer-spaced-label-text","Manual<br>gain"),15,'<input id="input-man-gain" type="range" min="0" max="120" value="'+manGain+'" step="1" onchange="setManGain(1,this.value)" oninput="setManGain(0,this.value)">',40,w3_div("field-man-gain w3-show-inline-block",manGain.toString())+" dB",15)+w3_div("",w3_col_percent("w3-valign/class-slider",w3_div("label-threshold w3-show-inline-block","Threshold"),20,'<input id="input-threshold" type="range" min="-130" max="0" value="'+thresh+'" step="1" onchange="setThresh(1,this.value)" oninput="setThresh(0,this.value)">',52,w3_div("field-threshold w3-show-inline-block",thresh.toString())+" dBm"),w3_col_percent("w3-valign/class-slider",w3_div("label-threshCW w3-show-inline-block","Thresh CW"),20,'<input id="input-threshCW" type="range" min="-130" max="0" value="'+threshCW+'" step="1" onchange="setThreshCW(1,this.value)" oninput="setThreshCW(0,this.value)">',52,w3_div("field-threshCW w3-show-inline-block",threshCW.toString())+" dBm"),w3_col_percent("w3-valign/class-slider",w3_div("label-slope w3-show-inline-block","Slope"),20,'<input id="input-slope" type="range" min="0" max="10" value="'+slope+'" step="1" onchange="setSlope(1,this.value)" oninput="setSlope(0,this.value)">',52,w3_div("field-slope w3-show-inline-block",slope.toString())+" dB"),w3_col_percent("w3-valign/class-slider",w3_div("label-decay w3-show-inline-block","Decay"),20,'<input id="input-decay" type="range" min="20" max="5000" value="'+decay+'" step="1" onchange="setDecay(1,this.value)" oninput="setDecay(0,this.value)">',52,w3_div("field-decay w3-show-inline-block",decay.toString())+" msec")),setup_agc(toggle_e.FROM_COOKIE|toggle_e.SET),w3_click_nav(kiwi_toggle(toggle_e.FROM_COOKIE|toggle_e.SET,"optbar-wf","optbar-wf","last_optbar"),"optbar","init"),w3_el("id-news").style.backgroundColor=news_color,w3_el("id-news-inner").innerHTML='<span style="font-size: 14pt; font-weight: bold;">KiwiSDR now available on <a href="https://www.kickstarter.com/projects/1575992013/kiwisdr-beaglebone-software-defined-radio-sdr-with" target="_blank"><img class="class-KS" src="icons/kickstarter-logo-light.150x18.png" /></a></span>',w3_el("id-readme").style.backgroundColor=readme_color,w3_el("id-readme-inner").innerHTML='<span style="font-size: 15pt; font-weight: bold;">Welcome!</span>&nbsp;&nbsp;&nbsp;Project website: <a href="http://kiwisdr.com" target="_blank">kiwisdr.com</a>&nbsp;&nbsp;&nbsp;&nbsp;Here are some tips:<ul style="padding-left: 12px;"><li> Windows: Firefox, Chrome & Edge work; IE does not work. </li><li> Mac & Linux: Safari, Firefox, Chrome & Opera should work fine. </li><li> Open and close the panels by using the circled arrows at the top right corner. </li><li> You can click and/or drag almost anywhere on the page to change settings. </li><li> Enter a numeric frequency in the box marked "kHz" at right. </li><li> Or use the "select band" menu to jump to a pre-defined band. </li><li> Use the zoom icons to control the waterfall span. </li><li> Tune by clicking on the waterfall, spectrum or the cyan/red-colored station labels. </li><li> Ctrl-shift or alt-shift click in the waterfall to lookup frequency in online databases. </li><li> Control or option/alt click to page spectrum down and up in frequency. </li><li> Adjust the "WF min" slider for best waterfall colors or use the "Auto Scale" button. </li><li> Type \'h\' or \'?\' to see the list of keyboard shortcuts. </li><li> See the <a href="http://www.kiwisdr.com/quickstart/" target="_blank">Operating information</a> pageand <a href="http://kiwisdr.com/docs/KiwiSDR/KiwiSDR.design.review.pdf" target="_blank">Design review document</a>. </li></ul>';n=ext_get_cfg_param("contact_admin");isUndefined(n)&&(n=!0);t=ext_get_cfg_param("admin_email");null!=(t="undefined"!=n&&null!=n&&1==n&&"undefined"!=t&&null!=t?t:null)&&(t=encodeURIComponent(encodeURIComponent(enc(t)))),w3_el("id-optbar-status").innerHTML=w3_div("id-status-msg")+w3_div("",w3_text(optbar_prefix_color,"Links"),w3_text("",(t?"<a href=\"javascript:sendmail('"+t+"');\">Owner/Admin</a> | ":"")+'<a href="http://kiwisdr.com" target="_blank">KiwiSDR</a> | <a href="http://forum.kiwisdr.com/discussions" target="_blank">Forum</a> | <a href="https://kiwiirc.com/client/chat.freenode.net/#kiwisdr" target="_blank">Chat</a> '))+w3_div("id-status-adc")+w3_div("id-status-config")+w3_div("id-status-gps")+w3_inline("w3-valign",w3_div("id-status-audio")," ",w3_div("id-status-problems"))+w3_div("id-status-stats-cpu")+w3_div("id-status-stats-xfer"),setTimeout(function(){setInterval(status_periodic,5e3)},1e3)}var prev_optbar=null;function optbar_focus(e,t){writeCookie("last_optbar",e),"optbar-off"==e?("init"!=t&&"optbar-off"==prev_optbar&&toggle_or_set_hide_bars(),w3_hide("id-optbar-content"),w3_el("id-control-top").style.paddingBottom="8px"):(w3_show_block("id-optbar-content"),w3_el("id-control-top").style.paddingBottom=""),w3_el("id-control").style.height="",prev_optbar=e,freqset_select()}function optbar_blur(e){}function zoomCorrection(){return 3*zoom_level}var WF_SPEED_OFF=0,WF_SPEED_1HZ=1,WF_SPEED_SLOW=2,WF_SPEED_MED=3,WF_SPEED_FAST=4,wf_speed=WF_SPEED_FAST,wf_speeds=["off","1 Hz","slow","med","fast"],wf={no_wf:!1,url_tstamp:0,ts_tz:0,scroll_multiple:3,no_sync:!1,cmap:0,cmap_override:-1,custom_colormaps:[new Uint8Array(768),new Uint8Array(768),new Uint8Array(768),new Uint8Array(768)],aper:0,aper_algo:3,aper_param:0,sqrt:0,contr:0,last_zoom:-1,need_autoscale:0,auto_ceil:{min:0,val:5,max:30},auto_floor:{min:-30,val:0,max:0},auto_maxdb:0,auto_mindb:0,audioFFT_active:!1,audioFFT_prev_mode:"",audioFFT_clear_wf:!1},wf_contr_s={0:"normal",1:"scheme 1",2:"scheme 2",3:"scheme 3",4:"scheme 4"};function wf_contr_cb(e,t,a){}var wf_gnd=0,wf_gnd_value_base=150,wf_gnd_value=wf_gnd_value_base;function wf_gnd_cb(e,t,a){t=+t,w3_color(e,t?"white":"lime"),wf_gnd=!t,0==t&&freqset_select()}var wf_sp_param=0,wf_param=0,sp_param=0,wf_sp_which=0,wf_filter=0,spec_filter=0,wf_sp_menu_s=["IIR","MMA","EMA","off"],wf_sp_menu_e={IIR:0,MMA:1,EMA:2,OFF:3},wf_sp_slider_s=["gain","avgs","avgs",""],wf_sp_filter_p=[{IIR_min:0,IIR_max:1,IIR_step:.1,IIR_def:.2,IIR_val:void 0,MMA_min:1,MMA_max:32,MMA_step:1,MMA_def:8,MMA_val:void 0,EMA_min:1,EMA_max:32,EMA_step:1,EMA_def:8,EMA_val:void 0,off_min:0,off_max:0,off_step:0,off_def:0,off_val:void 0},{IIR_min:0,IIR_max:2,IIR_step:.1,IIR_def:.8,IIR_val:void 0,MMA_min:1,MMA_max:16,MMA_step:1,MMA_def:2,MMA_val:void 0,EMA_min:1,EMA_max:16,EMA_step:1,EMA_def:2,EMA_val:void 0,off_min:0,off_max:0,off_step:0,off_def:0,off_val:void 0}];function spec_show(){toggle_or_set_spec(toggle_e.SET,1);var e=-1;spectrum_param=parseFloat(spectrum_param),isNaN(spectrum_param)||-1==spectrum_param||(e=spectrum_param),wf_sp_which=0;var t=wf_sp_menu_s[spec_filter],a=wf_sp_filter_p[0];e>=a[t+"_min"]&&e<=a[t+"_max"]&&(wf_sp_slider_cb("id-wf-sp-slider",e,!0,!1),toggle_or_set_wf_sp_button(toggle_e.SET,0))}function wf_sp_menu_cb(e,t,a,_){t=+t,(wf_sp_which=+_)?wf_filter=t:spec_filter=t;_=wf_sp_which?wf_filter:spec_filter,t=wf_sp_menu_s[_];wf_sp_slider_cb("id-wf-sp-slider",wf_sp_filter_p[wf_sp_which][t+"_val"],!0,!1),toggle_or_set_wf_sp_button(toggle_e.SET,wf_sp_which),writeCookie(wf_sp_which?"last_wf_filter":"last_spec_filter",_.toString()),wf_sp_which?need_clear_wfavg=!0:spec.need_clear_avg=!0,freqset_select()}function spectrum_filter(e){wf_sp_menu_cb("",e,!1,0)}function toggle_or_set_wf_sp_button(e,t){isNumber(e)?wf_sp_which=+kiwi_toggle(e,+t,+t,"last_wf_sp_filter"):wf_sp_which^=1,w3_innerHTML("id-wf-sp-button",wf_sp_which?"WF &Delta;":"Spec &Delta;");t=wf_sp_menu_s[wf_sp_which?wf_filter:spec_filter];wf_sp_slider_cb("id-wf-sp-slider",wf_sp_filter_p[wf_sp_which][t+"_val"],!0,!1),freqset_select()}function wf_sp_slider_cb(e,t,a,_){var i,o,n,s;_||(t=+t,o=wf_sp_menu_s[i=wf_sp_which?wf_filter:spec_filter],n=wf_sp_filter_p[wf_sp_which],null!=t&&!isNaN(t)||(t=n[o+"_def"],s=parseFloat(readCookie(wf_sp_which?"last_wf_filter":"last_spec_filter")),_=parseFloat(readCookie(wf_sp_which?"last_wf_filter_param":"last_spec_filter_param")),s!=i||isNaN(_)||(t=_)),wf_sp_which?wf_param=t:sp_param=t,n[o+"_val"]=t,w3_slider_setup("id-wf-sp-slider",n[o+"_min"],n[o+"_max"],n[o+"_step"],t),w3_el("id-wf-sp-slider-field").innerHTML=i==wf_sp_menu_e.OFF?"":t+" "+wf_sp_slider_s[i],a&&(writeCookie(wf_sp_which?"last_wf_filter_param":"last_spec_filter_param",t.toFixed(2)),freqset_select()))}function wf_cmap_cb(e,t,a){a||(t=+t,wf.cmap=w3_clamp(t,0,kiwi.cmap_s.length-1,0),w3_select_value(e,t,{all:1}),writeCookie("last_cmap",t),mkcolormap(),spectrum_dB_bands(),update_maxmindb_sliders(),wf_send("SET cmap="+wf.cmap),w3_call("colormap_select"),freqset_select())}function wf_aper_cb(e,t,a){a||(t=+t,wf.aper=w3_clamp(t,0,kiwi.aper_s.length-1,0),w3_select_value(e,t),writeCookie("last_aper",t),t=wf.aper==kiwi.aper_e.auto,w3_innerHTML("id-wf-sliders",t?wf.floor_ceil_sliders:wf.max_min_sliders),w3_color("id-button-wf-autoscale",null,t?w3_selection_green:""),t?(wf.save_maxdb=maxdb,wf.save_mindb_un=mindb_un,wf.audioFFT_active&&(wf.need_autoscale=16)):(setmaxdb(1,wf.save_maxdb),setmindb(1,wf.save_mindb_un-zoomCorrection())),spectrum_dB_bands(),update_maxmindb_sliders(),w3_show_hide_inline("id-wfext-maxmin",t),w3_show_hide_inline("id-wfext-maxmin-spacer",!t),colormap_update(),freqset_select())}function setwfspeed(e,t){wf.audioFFT_active?freqset_select():(wf_speed=+t,w3_set_value("slider-rate",wf_speed),w3_el("slider-rate-field").innerHTML=wf_speeds[wf_speed],w3_el("slider-rate-field").style.color=wf_speed?"white":"orange",wf_send("SET wf_speed="+wf_speed.toFixed(0)),e&&freqset_select())}function setmaxdb(e,t,a){var _=parseFloat(t),i=!1;if(wf.aper==kiwi.aper_e.auto)maxdb=_+wf.auto_ceil.val;else{var o=w3_el("id-input-maxdb"),n=w3_el("id-field-maxdb"),t=w3_el("id-field-mindb");if(!o||!n||!t)return;i=!0,_<=mindb?(maxdb=mindb+1,html(o).value=maxdb,html(n).innerHTML=maxdb.toFixed(0)+" dB",html(n).style.color="red"):(maxdb=_,html(n).innerHTML=_.toFixed(0)+" dB",html(n).style.color="white",html(t).style.color="white")}setmaxmindb(e,i,a)}function incr_mindb(e,t){wf.aper==kiwi.aper_e.man&&(t=+mindb+t,setmindb(e,Math.max(-190,Math.min(-30,t)).toFixed(0)))}function setmindb(e,t,a){var _=parseFloat(t),i=!1;if(wf.aper==kiwi.aper_e.auto)mindb=_+wf.auto_floor.val;else{var o=w3_el("id-input-mindb"),n=w3_el("id-field-maxdb"),t=w3_el("id-field-mindb");if(!o||!n||!t)return;i=!0,maxdb<=_?(mindb=maxdb-1,html(o).value=mindb,html(t).innerHTML=mindb.toFixed(0)+" dB",html(t).style.color="red"):(mindb=_,html(o).value=mindb,html(t).innerHTML=_.toFixed(0)+" dB",html(t).style.color="white",html(n).style.color="white")}mindb_un=mindb+zoomCorrection(),setmaxmindb(e,i,a)}function setmaxmindb(e,t,a){full_scale=(full_scale=maxdb-mindb)||1,spectrum_dB_bands(),wf_send("SET maxdb="+maxdb.toFixed(0)+" mindb="+mindb.toFixed(0)),need_clear_wf_sp_avg=!0,e&&(1!=a&&freqset_select(),t&&(writeCookie(wf.audioFFT_active?"last_AF_max_dB":"last_max_dB",maxdb.toFixed(0)),writeCookie(wf.audioFFT_active?"last_AF_min_dB":"last_min_dB",mindb_un.toFixed(0))))}function update_maxmindb_sliders(){var e,t,a,_,i,o=wf.aper==kiwi.aper_e.auto;o||(mindb=mindb_un-zoomCorrection()),full_scale=(full_scale=maxdb-mindb)||1,spectrum_dB_bands(),i=o?(e=wf.auto_ceil.val,i=wf.auto_floor.val,t=e.toFixed(0).positiveWithSign(),a=i.toFixed(0).positiveWithSign(),w3_el("id-input-ceildb").value=e,w3_el("id-input-floordb").value=i,_=w3_el("id-field-ceildb"),w3_el("id-field-floordb")):(i=mindb,t=(e=maxdb).toFixed(0),a=i.toFixed(0),w3_el("id-input-maxdb").value=e,w3_el("id-input-mindb").value=i,_=w3_el("id-field-maxdb"),w3_el("id-field-mindb")),_.innerHTML=t+" dB",i.innerHTML=a+" dB"}function setceildb(e,t){var a=w3_el("id-input-ceildb"),_=w3_el("id-field-ceildb");a&&_&&(t=parseFloat(t),w3_innerHTML(_,t.toFixed(0).positiveWithSign()+" dB"),wf.auto_ceil.val=t,set_ceilfloordb(e))}function setfloordb(e,t){var a=w3_el("id-input-floordb"),_=w3_el("id-field-floordb");a&&_&&(t=parseFloat(t),w3_innerHTML(_,t.toFixed(0).positiveWithSign()+" dB"),wf.auto_floor.val=t,set_ceilfloordb(e))}function set_ceilfloordb(e){maxdb=wf.auto_maxdb+wf.auto_ceil.val,mindb=wf.auto_mindb+wf.auto_floor.val,mindb_un=mindb+zoomCorrection(),setmaxmindb(e,!1),w3_call("waterfall_maxmin_cb"),e&&(freqset_select(),writeCookie("last_ceil_dB",wf.auto_ceil.val.toFixed(0)),writeCookie("last_floor_dB",wf.auto_floor.val.toFixed(0)))}function wf_autoscale_cb(){wf.need_autoscale=1,colormap_update(),freqset_select()}var spectrum_slow_dev=0;function toggle_or_set_slow_dev(e,t){isNumber(e)?spectrum_slow_dev=kiwi_toggle(e,t,spectrum_slow_dev,"last_slow_dev"):spectrum_slow_dev^=1,w3_color("id-button-slow-dev",spectrum_slow_dev?"lime":"white"),freqset_select(),writeCookie("last_slow_dev",spectrum_slow_dev.toString()),spectrum_slow_dev&&wf_speed==WF_SPEED_FAST&&setwfspeed(1,WF_SPEED_MED)}function toggle_or_set_spec_peak(e,t){isNumber(e)?spec.peak_show=kiwi_toggle(e,t,spec.peak_show,"last_spec_peak"):spec.peak_show^=1,spec.peak_show&&(spec.peak_clear=!0),w3_color("id-button-spec-peak",spec.peak_show?"lime":"white"),freqset_select(),writeCookie("last_spec_peak",spec.peak_show.toString())}var muted_until_freq_set=!0,recording=!1;function setvolume(e,t){kiwi.volume=+t,isNumber(kiwi.volume)||(kiwi.volume=50),kiwi.volume=w3_clamp3(kiwi.volume,0,200,0,50,50),kiwi.volume_f=kiwi.muted||0==kiwi.volume?1e-6:kiwi.volume/100,e&&(w3_set_value("id-input-volume",kiwi.volume),writeCookie("last_volume",kiwi.volume),freqset_select())}function toggle_or_set_mute(e){isNumber(e)?kiwi.muted=e:kiwi.muted^=1,console.log("$toggle_or_set_mute set="+e+" muted="+kiwi.muted),owrx.squelched_overload||(w3_show_hide("id-mute-no",!kiwi.muted),w3_show_hide("id-mute-yes",kiwi.muted)),kiwi.volume_f=kiwi.muted||0==kiwi.volume?1e-6:kiwi.volume/100,freqset_select()}var de_emphasis=0,de_emphasis_s=["off","on"];function de_emp_cb(e,t,a){snd_send("SET de_emp="+(de_emphasis=+t)),writeCookie("last_de_emphasis",de_emphasis.toString())}var pan=0;function setpan(e,t){t=+t;-.1<t&&t<.1&&(t=0),w3_set_value("id-pan-value",t),w3_color("id-pan-value",null,t<0?"rgba(255,0,0,0.3)":t?"rgba(0,255,0,0.2)":""),w3_innerHTML("id-pan-field",t?(100*Math.abs(t)).toFixed(0)+" "+(t<0?"L":"R"):"L=R"),audio_set_pan(t),e&&(writeCookie("last_pan",t.toString()),freqset_select())}function audio_panner_ui_init(){audio_panner&&(w3_hide2("id-vol-comp"),w3_hide2("id-vol",!1),w3_hide2("id-pan",!1),setpan(1,pan))}function toggle_or_set_hide_bars(e){isNumber(e)?owrx.hide_bars=e:(owrx.hide_bars=owrx.hide_bars+1&owrx.HIDE_ALLBARS,owrx.hide_bars&owrx.HIDE_TOPBAR&&(extint.using_data_container||spec.source_wf||spec.source_audio)&&(owrx.hide_bars=owrx.hide_bars+1&owrx.HIDE_ALLBARS)),w3_set_props("id-top-container","w3-panel-override-hide",owrx.hide_bars&owrx.HIDE_TOPBAR),w3_set_props("id-band-container","w3-panel-override-hide",owrx.hide_bars&owrx.HIDE_BANDBAR),openwebrx_resize()}var hide_panels=0,test_button;function toggle_or_set_hide_panels(e){isNumber(e)?hide_panels=e:hide_panels^=1,w3_iterate_children("id-panels-container",function(e){w3_contains(e,"class-panel")&&w3_set_props(e,"w3-panel-override-hide",hide_panels)})}function toggle_or_set_test(e){isNumber(e)?test_button=e:test_button^=1,console.log("toggle_or_set_test set="+e+" test_button="+test_button),w3_color("id-button-test",test_button?"lime":"white"),snd_send("SET test="+(test_button?1:0)),freqset_select()}function toggle_or_set_rec(e){var t,a,_;console.log("toggle_or_set_rec set="+e+" recording="+recording),recording=isBoolean(e)||isNumber(e)?e:!recording,w3_remove_then_add("id-rec1","fa-spin",recording?"fa-spin":""),w3_remove_then_add("id-rec2","fa-spin",recording?"fa-spin":""),w3_remove_then_add("id-rec1","w3-text-white","w3-text-pink"),w3_remove_then_add("id-rec2","w3-text-white","w3-text-pink"),recording?(window.recording_meta={buffers:[],data:null,offset:0,total_size:0,filename:kiwi_host()+"_"+(new Date).toISOString().replace(/:/g,"_").replace(/\.[0-9]+Z$/,"Z")+"_"+w3_el("id-freq-input").value+"_"+cur_mode+".wav"},window.recording_meta.buffers.push(new ArrayBuffer(65536)),window.recording_meta.data=new DataView(window.recording_meta.buffers[0])):window.recording_meta&&(_=new ArrayBuffer(44),(a=new DataView(_)).setUint32(0,1380533830),a.setUint32(4,window.recording_meta.total_size+36,!0),a.setUint32(8,1463899717),a.setUint32(12,1718449184),a.setUint32(16,16,!0),a.setUint16(20,1,!0),t=ext_is_IQ_or_stereo_curmode()?2:1,a.setUint16(22,t,!0),e=Math.round(audio_input_rate||12e3),a.setUint32(24,e,!0),a.setUint32(28,e*t*2,!0),a.setUint16(32,2*t,!0),a.setUint16(34,16,!0),a.setUint32(36,1684108385),a.setUint32(40,window.recording_meta.total_size,!0),window.recording_meta.buffers.unshift(_),a=new Blob(window.recording_meta.buffers,{type:"octet/stream"}),(_=document.createElement("a")).style="display: none",_.href=window.URL.createObjectURL(a),_.download=window.recording_meta.filename,document.body.appendChild(_),_.click(),window.URL.revokeObjectURL(_.href),document.body.removeChild(_),delete window.recording_meta)}var squelched=0,squelch=0,squelch_tail=0,squelch_tail_s=["0",".2s",".5s","1s","2s"],squelch_tail_v=[0,.2,.5,1,2];function squelch_action(e){var t=(squelched=e)?"white":kiwi.unmuted_color,e=t;owrx.squelched_overload=owrx.sMeter_dBm>=cfg.overload_mute,owrx.prev_squelched_overload!=owrx.squelched_overload&&(w3_show_hide("id-mute-exclaim",owrx.squelched_overload),w3_show_hide("id-mute-no",!owrx.squelched_overload&&!kiwi.muted),w3_show_hide("id-mute-yes",!owrx.squelched_overload&&kiwi.muted),owrx.prev_squelched_overload=owrx.squelched_overload),w3_color("id-squelch-label",e),w3_color("id-mute-no",t),recording&&(t=squelched||owrx.squelched_overload,w3_remove_then_add("id-rec1","fa-spin",t?"":"fa-spin"),w3_remove_then_add("id-rec2","fa-spin",t?"":"fa-spin"),w3_remove_then_add("id-rec1","w3-text-white w3-text-pink",t?"w3-text-white":"w3-text-pink"),w3_remove_then_add("id-rec2","w3-text-white w3-text-pink",t?"w3-text-white":"w3-text-pink"))}function squelch_setup(e){var t="nbfm"==cur_mode;e&toggle_e.FROM_COOKIE&&(e=readCookie("last_squelch"+(t?"":"_efm")),squelch=e?+e:0,w3_el("id-squelch-value").max=t?99:40,w3_set_value("id-squelch-value",squelch)),set_squelch_cb("",squelch,!0,!1,!0),t?squelch_action(squelched):w3_color("id-mute-no",kiwi.unmuted_color),w3_hide2("id-squelch-tail",t),w3_hide2("id-squelch","drm"==cur_mode)}function send_squelch(){var e="nbfm"==cur_mode;snd_send("SET squelch="+squelch.toFixed(0)+" param="+(e?squelch_threshold:squelch_tail_v[squelch_tail]).toFixed(2))}function set_squelch_cb(e,t,a,_,i){var o="nbfm"==cur_mode;_||(squelch=parseFloat(t),w3_el("id-squelch-field").innerHTML=squelch?t+(o?"":" dB"):"off",w3_color("id-squelch-value",null,squelch?"":"rgba(255,0,0,0.3)"),a&&(send_squelch(),1!=i&&writeCookie("last_squelch"+(o?"":"_efm"),t),freqset_select()))}function squelch_tail_cb(e,t,a){a||(squelch_tail=+t,send_squelch())}function sam_pll_reset_cb(e,t,a){snd_send("SET sam_pll=-1")}function sam_pll_cb(e,t,a){owrx.sam_pll=+t,snd_send("SET sam_pll="+owrx.sam_pll)}function chan_null_cb(e,t,a){a||(owrx.chan_null=+t,ext_set_mode(cur_mode))}function ovld_mute_cb(e,t,a){a||(owrx.ovld_mute=+t,snd_send("SET ovld_mute="+(owrx.ovld_mute?1:0)))}var btn_less_buffering=0;function toggle_or_set_audio(e,t){isNumber(e)?btn_less_buffering=kiwi_toggle(e,t,btn_less_buffering,"last_audio"):btn_less_buffering^=1;t=w3_el("id-button-buffering");t&&(t.style.color=btn_less_buffering?"lime":"white",t.style.visibility="visible",freqset_select()),writeCookie("last_audio",btn_less_buffering.toString()),isNumber(e)||window.location.reload(!0)}var btn_compression=0;function toggle_or_set_compression(e,t){recording||(isNumber(e)?btn_compression=kiwi_toggle(e,t,btn_compression,"last_compression"):btn_compression^=1,w3_els("id-button-compression",function(e){e.style.color=btn_compression?"lime":"white",e.style.visibility="visible",freqset_select()}),writeCookie("last_compression",btn_compression.toString()),snd_send("SET compression="+btn_compression.toFixed(0)))}function set_agc(){var e=cur_mode&&"cw"==cur_mode.substr(0,2);w3_color("label-threshold",!e&&agc?"orange":"white"),w3_color("label-threshCW",e&&agc?"orange":"white"),snd_send("SET agc="+agc+" hang="+hang+" thresh="+(e?threshCW:thresh)+" slope="+slope+" decay="+decay+" manGain="+manGain)}var agc=0;function toggle_agc(e){return any_alternate_click_event(e)?setup_agc(toggle_e.SET):toggle_or_set_agc(),cancelEvent(e)}function agc_over(e){w3_el("id-button-agc").title=any_alternate_click_event(e)?"restore AGC params":""}var default_agc=1,default_hang=0,default_manGain=50,default_thresh=-100,default_threshCW=-130,default_slope=6,default_decay=1e3;function setup_agc(e){toggle_or_set_agc(agc=kiwi_toggle(e,default_agc,agc,"last_agc")),toggle_or_set_hang(hang=kiwi_toggle(e,default_hang,hang,"last_hang")),setManGain(!0,manGain=kiwi_toggle(e,default_manGain,manGain,"last_manGain")),setThresh(!0,thresh=kiwi_toggle(e,default_thresh,thresh,"last_thresh")),setThreshCW(!0,threshCW=kiwi_toggle(e,default_threshCW,threshCW,"last_threshCW")),setSlope(!0,slope=kiwi_toggle(e,default_slope,slope,"last_slope")),setDecay(!0,decay=kiwi_toggle(e,default_decay,decay,"last_decay"))}function toggle_or_set_agc(e){null!=e?agc=e:agc^=1,html("id-button-agc").style.color=agc?"lime":"white",agc?(html("id-label-man-gain").style.color="white",html("id-button-hang").style.borderColor=html("label-slope").style.color=html("label-decay").style.color="orange"):(html("id-label-man-gain").style.color="orange",html("id-button-hang").style.borderColor=html("label-slope").style.color=html("label-decay").style.color="white"),set_agc(),writeCookie("last_agc",agc.toString()),freqset_select()}var hang=0;function toggle_or_set_hang(e){null!=e?hang=e:hang^=1,html("id-button-hang").style.color=hang?"lime":"white",set_agc(),writeCookie("last_hang",hang.toString()),freqset_select()}var manGain=0;function setManGain(e,t){manGain=parseFloat(t),html("input-man-gain").value=manGain,html("field-man-gain").innerHTML=t,set_agc(),writeCookie("last_manGain",manGain.toString()),e&&freqset_select()}var thresh=0;function setThresh(e,t){thresh=parseFloat(t),html("input-threshold").value=thresh,html("field-threshold").innerHTML=t,set_agc(),writeCookie("last_thresh",thresh.toString()),e&&freqset_select()}var threshCW=0;function setThreshCW(e,t){threshCW=parseFloat(t),html("input-threshCW").value=threshCW,html("field-threshCW").innerHTML=t,set_agc(),writeCookie("last_threshCW",threshCW.toString()),e&&freqset_select()}var slope=0;function setSlope(e,t){slope=parseFloat(t),html("input-slope").value=slope,html("field-slope").innerHTML=t,set_agc(),writeCookie("last_slope",slope.toString()),e&&freqset_select()}var decay=0;function setDecay(e,t){decay=parseFloat(t),html("input-decay").value=decay,html("field-decay").innerHTML=t,set_agc(),writeCookie("last_decay",decay.toString()),e&&freqset_select()}function users_setup(){for(var e="",t=0;t<rx_chans;t++)e+=w3_div("",w3_div("w3-show-inline-block w3-left w3-margin-R-5 "+(t==rx_chan?"w3-text-css-lime":optbar_prefix_color),"RX"+t),w3_div("id-optbar-user-"+t+" w3-show-inline-block"));var a=kiwi_isMobile()?" w3-font-16px":"";e+=w3_input("w3-margin-TB-4 w3-width-half/w3-label-not-bold/w3-custom-events"+a+'|padding:1px|size=20 onchange="ident_complete(\'el\', 2)" onkeyup="ident_keyup(this, event, 2)" ontouchstart="popup_keyboard_touchstart(event)"',"Your name or callsign:","ident-input2"),w3_innerHTML("id-optbar-users",w3_div("w3-nowrap",e))}function freq_vfo_cb(e){owrx.vfo_ab^=1,w3_flip_colors("id-freq-vfo","w3-aqua w3-orange",owrx.vfo_ab),w3_innerHTML("id-freq-vfo","AB"[owrx.vfo_ab]);var t=parse_freq_pb_mode_zoom(readCookie("last_vfo_"+"AB"[owrx.vfo_ab])),a=void 0,_=0;t[3]&&(a=t[3].toLowerCase()),t[4]&&(_=+t[4]),ext_tune(t[1],a,ext_zoom.ABS,_)}function toggle_or_set_spec(e,t){console.log("toggle_or_set_spec set="+e+" val="+t),isNumber(e)&&e&toggle_e.SET?spec.source_wf=t:spec.source_wf^=1,extint.using_data_container&&spec.source_wf&&extint_panel_hide(),html("id-button-spectrum").style.color=spec.source_wf?"lime":"white",w3_show_hide("id-spectrum-container",spec.source_wf),w3_show_hide("id-top-container",!spec.source_wf),freqset_select()}function mode_over(e,t){var a;switch(t.innerHTML.toLowerCase()){case"sam":a="synchronous AM";break;case"sal":a="synchronous AM LSB";break;case"sau":a="synchronous AM USB";break;case"sas":a="synchronous AM stereo";break;case"qam":a="C-QUAM AM stereo";break;default:a=""}t.title=e.shiftKey?"restore passband":a}function any_alternate_click_event(e){return e&&(e.shiftKey||e.ctrlKey||e.altKey||e.button==mouse.middle||e.button==mouse.right)}function any_alternate_click_event_except_shift(e){return e&&(e.ctrlKey||e.altKey||e.button==mouse.middle||e.button==mouse.right)}function any_modifier_key(e){return e&&(e.shiftKey||e.ctrlKey||e.altKey)}function restore_passband(e){cfg.passbands[e].last_lo=cfg.passbands[e].lo,cfg.passbands[e].last_hi=cfg.passbands[e].hi}var mode_buttons=[{s:["AM","AMN"],dis:0},{s:["SAM","SAL","SAU","SAS","QAM"],dis:0},{s:["DRM"],dis:0},{s:["LSB","LSN"],dis:0},{s:["USB","USN"],dis:0},{s:["CW","CWN"],dis:0},{s:["NBFM"],dis:0},{s:["IQ"],dis:0}],step_9_10,divControl;function mode_button(e,t,a){var _=t.innerHTML.toLowerCase();if(isUndefined(a)&&(a=1),any_alternate_click_event(e)){if(e.shiftKey||e.button==mouse.middle)return restore_passband(_),void ext_set_mode(_,null,{open_ext:!0});a=-1}var i=parseInt(t.id);if(isUndefined(owrx.last_mode_col)&&(owrx.last_mode_col=parseInt(owrx.last_mode_el.id)),owrx.last_mode_col!=i){if(recording)if((ext_is_IQ_or_stereo_curmode()?1:0)^(ext_is_IQ_or_stereo_mode(_)?1:0)||"drm"==_)return;owrx.last_mode_col=i}else{e=mode_buttons[i].s,i=_.toUpperCase(),a=e.indexOf(i)+a;if(a<=-1&&(a=e.length-1),a>=e.length&&(a=0),i=e[a],_=i.toLowerCase(),recording)if((ext_is_IQ_or_stereo_curmode()?1:0)^(ext_is_IQ_or_stereo_mode(_)?1:0)||"drm"==_)return;t.innerHTML=i}ext_set_mode(_,null,{open_ext:!0})}function button_9_10(e){null!=e?step_9_10=e:step_9_10^=1,writeCookie("last_9_10",step_9_10),freq_step_update_ui(!0),w3_el("id-button-9-10").innerHTML=step_9_10?"9":"10",freqset_select()}function pop_bottommost_panel(e){min_order=parseInt(e[0].getAttribute("data-panel-order"));for(var t=min_index=0;t<e.length;t++)actual_order=parseInt(e[t].getAttribute("data-panel-order")),actual_order<min_order&&(min_index=t,min_order=actual_order);return to_return=e[min_index],e.splice(min_index,1),to_return}function place_panels(){for(var e=[],t=[],a=html("id-panels-container").children,_=0;_<a.length;_++){var i,o,n=a[_];!n.classList.contains("class-panel")||(i=n.getAttribute("data-panel-pos"))&&(o=n.getAttribute("data-panel-size").split(","),"left"==i?e.push(n):"right"==i&&t.push(n),n.idName=n.id.replace("id-",""),n.style.width=o[0]+"px",n.style.height=o[1]+"px",n.style.margin=px(panel_margin),n.uiWidth=parseInt(o[0]),n.uiHeight=parseInt(o[1]),n.defaultWidth=parseInt(o[0]),n.defaultHeight=parseInt(o[1]),o=html_LR_border_pad(n),n.activeWidth=n.uiWidth-o,"center"==i&&(n.style.left=px(window.innerWidth/2-n.activeWidth/2),n.style.bottom=px(window.innerHeight/2-n.uiHeight/2),n.style.visibility="hidden"),"bottom-left"==i&&(n.style.left=0,n.style.bottom=0,n.style.visibility="hidden"))}for(y=0;0<e.length;)p=pop_bottommost_panel(e),p.style.left=0,p.style.bottom=px(y),p.style.visibility="visible",y+=p.uiHeight+3*panel_margin,w3_call("panel_setup_"+p.idName,p);for(y=0;0<t.length;)p=pop_bottommost_panel(t),p.style.right=kiwi_isMobile()?0:px(kiwi_scrollbar_width()),p.style.bottom=px(y),p.style.visibility="visible",y+=p.uiHeight+3*panel_margin,w3_call("panel_setup_"+p.idName,p)}var OPTBAR_CONTENT_HEIGHT=150;function panel_setup_control(e){(divControl=e).style.marginBottom="0",w3_el("id-control-inner").innerHTML=w3_div("id-control-top",w3_div("id-control-freq1"),w3_div("id-control-freq2"),w3_div("id-control-mode w3-margin-T-6"),w3_div("id-control-zoom w3-margin-T-6"),w3_div("id-optbar w3-margin-T-4"))+w3_div("id-optbar-content w3-margin-T-6 w3-scroll-y|height:"+px(OPTBAR_CONTENT_HEIGHT),w3_div("id-optbar-wf w3-hide"),w3_div("id-optbar-audio w3-hide"),w3_div("id-optbar-agc w3-hide"),w3_div("id-optbar-users w3-hide w3-scroll-x"),w3_div("id-optbar-status w3-hide"))+w3_div("id-control-smeter"),w3_el("id-control-freq1").style.width=px(e.activeWidth-visIcon-6),w3_show_hide("id-mute-no",!kiwi.muted),w3_show_hide("id-mute-yes",kiwi.muted)}function panel_set_vis_button(e){var t=w3_el(e),e=w3_el(e+"-vis"),t=t.activeWidth-visIcon;e.style.left=px(t+visBorder)}function panel_set_width_height(e,t,a){var _=w3_el(e);null==t&&(t=_.defaultWidth),_.style.width=px(t),_.uiWidth=t,null==a&&(a=_.defaultHeight),_.style.height=px(a),_.uiHeight=a;a=html_LR_border_pad(_);_.activeWidth=_.uiWidth-a,panel_set_vis_button(e)}function add_problem(e,t,a,_){if(el=w3_el(_||"id-status-problems"),el){if(isDefined(el.children)){for(var i=0;i<el.children.length;i++)if(el.children[i].innerHTML==e)return;if(0==t)for(;el.firstChild;)el.removeChild(el.firstChild)}t=w3_create_appendElement(el,"span",e);1!=a&&window.setTimeout(function(e,t){try{e.removeChild(t)}catch(e){}},1e3,el,t)}}function set_gen(e,t){snd_send("SET genattn="+t.toFixed(0)),snd_send("SET gen="+e+" mix=-1")}var bin_server=0,zoom_server=0;function owrx_msg_cb(e,t){switch(e[0]){case"wf_setup":wf_init();break;case"extint_list_json":extint_list_json(e[1]),override_ext&&extint_open(override_ext,3e3);break;case"bandwidth":bandwidth=parseInt(e[1]);break;case"center_freq":center_freq=parseInt(e[1]);break;case"wf_fft_size":wf_fft_size=parseInt(e[1]);break;case"wf_fps_max":wf_fps_max=parseInt(e[1]);break;case"wf_fps":wf_fps=parseInt(e[1]);break;case"start":bin_server=parseInt(e[1]);break;case"zoom":zoom_server=parseInt(e[1]);break;case"zoom_max":zoom_levels_max=parseInt(e[1]),zoom_nom=Math.min(ZOOM_NOMINAL,zoom_levels_max);break;case"audio_init":toggle_or_set_audio(toggle_e.FROM_COOKIE|toggle_e.SET,1),audio_init(+e[1],btn_less_buffering,kiwi_toggle(toggle_e.FROM_COOKIE|toggle_e.SET,1,1,"last_compression"));break;case"audio_camp":var a=e[1].split(",");audio_camp(+a[0],+a[1],btn_less_buffering,kiwi_toggle(toggle_e.FROM_COOKIE|toggle_e.SET,1,1,"last_compression"));break;case"audio_rate":audio_rate(parseFloat(e[1]));break;case"audio_adpcm_state":a=e[1].split(",");audio_adpcm_state(+a[0],+a[1]);break;case"audio_passband":a=e[1].split(",");audio_recompute_LPF(1,+a[0],+a[1]);break;case"audio_flags2":audio_recv_flags2(e[1]);break;case"kiwi_up":kiwi_up(parseInt(e[1]));break;case"gps":toggle_or_set_spec(toggle_e.SET,1);break;case"fft_mode":kiwi_fft_mode();break;case"maxdb":wf.auto_maxdb=+e[1],setmaxdb(1,wf.auto_maxdb,!0);break;case"mindb":wf.auto_mindb=+e[1],setmindb(1,wf.auto_mindb,!0),w3_call("waterfall_maxmin_cb"),update_maxmindb_sliders(!0);break;case"max_thr":owrx.overload_mute=Math.round(+e[1]);break;default:return!1}return!0}function owrx_ws_open_snd(e,t){return ws_snd=open_websocket("SND",e,t,owrx_msg_cb,audio_recv,on_ws_error,owrx_close_cb)}function owrx_ws_open_wf(e,t){return ws_wf=open_websocket("W/F",e,t,owrx_msg_cb,waterfall_add_queue,on_ws_error)}function owrx_close_cb(){toggle_or_set_rec(0)}function on_ws_error(){console.log("WebSocket error")}function snd_send(t){try{return ws_snd.send(t),0}catch(e){return console.log("CATCH snd_send('"+t+"') ex="+e),kiwi_trace(),-1}}function wf_send(t){try{return ws_wf.send(t),0}catch(e){return console.log("CATCH wf_send('"+t+"') ex="+e),kiwi_trace(),-1}}function ws_any(){return ws_snd||ws_wf||null}var need_geo=!0,need_status=!0;function send_keepalive(){for(var e=0;e<1&&(ws_snd.up&&!(snd_send("SET keepalive")<0));e++){if(need_geo&&""!=kiwi_geo()){if(msg_send("SET geoloc="+kiwi_geo())<0)break;if(msg_send("SET geojson="+kiwi_geojson())<0)break;need_geo=!1}if(send_ident){if(ident_user=ident_user||"",snd_send("SET ident_user="+encodeURIComponent(ident_user))<0)break;send_ident=!1}if(need_status){if(snd_send("SET need_status=1")<0)break;need_status=!1}}ws_wf.up&&wf_send("SET keepalive")}




/* web/openwebrx/audio.min.js */
var audio_stat_output_bufs,audio_stat_last_time,audio_running,audio_started,audio_last_output_offset,audio_mode_iq,audio_compression,audio_stat_input_epoch,audio_prepared_buffers,audio_prepared_buffers2,audio_prepared_seq,audio_prepared_flags,audio_prepared_smeter,audio_buffering,audio_convolver_running,audio_meas_dly,audio_meas_dly_start,resample_new,resample_old,resample_init1,resample_init2,resample_input_buffer,resample_input_available,resample_input_processed,resample_last_taps_delay,resample_output_buffer,resample_output_buffer2,resample_output_size,resample_taps,resample_taps_length,resample_last,resample_last2,audio_ext_adc_ovfl,audio_need_stats_reset,audio_change_LPF_latch,audio_change_freq_latch,audio_change_sq_UI_latch,audio_last_sq,audio_gain,comp_lpf_freq,comp_lpf_taps,comp_lpf_taps_length,audio_buffer_size,audio_buffer_min_length_sec,audio_buffer_max_length_sec,audio_data,audio_last_output_buffer,audio_last_output_buffer2,audio_silence_buffer,audio_stats_interval,audio_periodic_interval,audio_context,audio_output_rate,audio_last_is_local,audio_last_compression,audio_input_rate,audio_interpolation,audio_decimation,audio_resample_ratio,audio_transition_bw,audio_min_nbuf,audio_max_nbuf,audio_stat_output_epoch,audio_channels,audio_source,audio_watchdog,audio_change_LPF_delayed,audio_disconnected,audio_convolver,audio={d:!1,last_flags:0,trim_bufs:!1,lo_cut:0,hi_cut:0,SND_FLAG_LPF:1,SND_FLAG_ADC_OVFL:2,SND_FLAG_NEW_FREQ:4,SND_FLAG_MODE_IQ:8,SND_FLAG_COMPRESSED:16,SND_FLAG_RESTART:32,SND_FLAG_SQUELCH_UI:64,SND_FLAG_LITTLE_ENDIAN:128,SND_FLAG_SET_ACTIVE:256,SND_FLAG_CLR_ACTIVE:512,SND_FLAG_TUNE_ACK:1024,cur_flags2:0,_last:0},audio_periodic_interval_ms=1e3,audio_ext_sequence=0,audio_meas_dly_ena=0,audio_initial_connect=!1,audio_watchdog_restart=!1,audio_stat_input_size=0,audio_stat_total_input_size=0,audio_reconnect=0,audio_silence_count=0,audio_restart_count=0,audio_underrun_errors=0,audio_overrun_errors=0,audio_last_underruns=0,audio_last_reconnect=0,audio_last_restart_count=0,resample_new_default=!1,audio_adpcm={index:0,previousValue:0},audio_panner=null,audio_instance=0,audio_camping=0,audio_init_disconnect=0,audio_firefox_watchdog=0;function audio_camp(a,e,_,o){audio_camping=a?0:1,audio_init_disconnect=a,audio_init(e,_,o),audio_ext_sequence=0,audio_meas_dly_ena=0,audio_initial_connect=!1,audio_watchdog_restart=!1}function audio_reset(){audio.trim_bufs=!0}function audio_init(a,e,_){if(audio_running=!1,kiwi_clearInterval(audio_periodic_interval),console.log("--------------------------"),audio.d&&console.log("AUDIO audio_init CALLED audio_init_disconnect="+audio_init_disconnect+" is_local="+a+" less_buffering="+e+" compression="+_),e=!1,audio.d&&console.log("AUDIO audio_init LAST audio_last_is_local="+audio_last_is_local+" audio_last_compression="+audio_last_compression),null==a&&(a=audio_last_is_local),audio_last_is_local=a,null==_&&(_=audio_last_compression),audio_last_compression=_,console.log("AUDIO audio_init FINAL is_local="+a+" less_buffering="+e+" compression="+_),(audio_init_disconnect||null!=audio_source)&&(audio.d&&console.log("AUDIO audio_init audio_disconnect"),audio_disconnect()),audio_started=!1,audio_last_output_offset=0,audio_mode_iq=!1,audio_compression=!!_,audio_stat_input_epoch=-1,audio_prepared_buffers=[],audio_prepared_buffers2=[],audio_prepared_seq=[],audio_prepared_flags=[],audio_prepared_smeter=[],audio_buffering=!1,audio_convolver_running=!1,audio_meas_dly=0,audio_meas_dly_start=0,resample_new=!kiwi_isMobile()&&resample_new_default,resample_old=!resample_new,resample_init1=!1,resample_init2=!1,resample_input_buffer=[],resample_input_available=0,resample_input_processed=0,resample_last_taps_delay=0,resample_output_buffer=[],resample_output_buffer2=[],resample_taps=[],resample_last=0,resample_last2=0,comp_lpf_freq=0,comp_lpf_taps=[],comp_lpf_taps_length=255,audio_adpcm.index=0,audio_adpcm.previousValue=0,audio_ext_adc_ovfl=!1,audio_need_stats_reset=!0,audio_change_LPF_latch=!1,audio_change_freq_latch=!1,audio_change_sq_UI_latch=!1,audio_last_sq=void 0,audio_firefox_watchdog=0,kiwi_clearInterval(audio_stats_interval),audio_init_disconnect)return audio.d&&console.log("AUDIO audio_init DISCONNECT"),audio_init_disconnect=0,!1;var o,i=0,u=kiwi_url_param("abuf",null,null),t=0;if(null!=u){var d=u.split(",");if(t=parseFloat(d[0]),!isNaN(t)&&t>=.25&&t<=5){console.log("AUDIO override abuf="+u);var r=3*t;if(d.length>=2){var s=parseFloat(d[1]);!isNaN(s)&&s>=.25&&s<=5&&s>t&&(r=s)}else r=3*t;audio_buffer_min_length_sec=t,audio_buffer_max_length_sec=r,audio_buffer_size=8192,i=9,o="abuf="}else t=0}0==t&&(2==(i=e?a?2:1:0)?(audio_buffer_size=8192,audio_buffer_min_length_sec=.37,audio_buffer_max_length_sec=2,o="less buf, local"):1==i?(audio_buffer_size=8192,audio_buffer_min_length_sec=.74,audio_buffer_max_length_sec=3,o="less buf, remote"):0==i&&(audio_buffer_size=8192,audio_buffer_min_length_sec=.85,audio_buffer_max_length_sec=3.4,o="more buf")),audio_data=new Int16Array(audio_buffer_size),audio_last_output_buffer=new Float32Array(audio_buffer_size),audio_last_output_buffer2=new Float32Array(audio_buffer_size),audio_silence_buffer=new Float32Array(audio_buffer_size),console.log("AUDIO buffer_size="+audio_buffer_size+" buffering_scheme: "+o),audio_stats_interval=setInterval(audio_stats,1e3);try{window.AudioContext=window.AudioContext||window.webkitAudioContext,(audio_context=new AudioContext).sampleRate=44100,audio_output_rate=audio_context.sampleRate;try{audio_panner=audio_context.createStereoPanner(),audio_panner_ui_init()}catch(a){audio_panner=null}"LG"==kiwi_isSmartTV()&&(audio_gain=audio_context.createGain())}catch(a){return kiwi_serious_error("Your browser does not support Web Audio API, which is required for OpenWebRX to run. Please use an HTML5 compatible browser."),audio_context=null,audio_output_rate=0,!0}return setTimeout(function(a){snd_send("SET little-endian")},1e4,++audio_instance),audio_running=!0,!1}function audio_rate(a){if(0==(audio_input_rate=a))snd_send("SET x-DEBUG user's browser gave zero audio_input_rate?"),kiwi_serious_error("Audio initialization problem.");else if(0==audio_output_rate)snd_send("SET x-DEBUG user's browser doesn't support WebAudio"),snd_send("SET x-DEBUG "+navigator.userAgent),kiwi_serious_error("Browser doesn't support WebAudio:<br>"+navigator.userAgent+"<br><br>Please update to the latest version of your browser.");else if(resample_old)audio_interpolation=audio_output_rate/audio_input_rate,audio_decimation=1;else if(0==(audio_interpolation=0)){var e,_;for(e=2;e<=1024;e++){var o=a*e/audio_output_rate;if(_=Math.floor(o),Math.abs(o-_)<1e-5)break}e>1024?(snd_send("SET UAR in="+a+" out="+audio_output_rate),kiwi_serious_error("Your system uses an audio output rate of "+audio_output_rate+" sps which we do not support.")):(audio_interpolation=e,audio_decimation=_)}0!=audio_interpolation?(audio_transition_bw=.001,audio_resample_ratio=audio_output_rate/audio_input_rate,snd_send("SET AR OK in="+a+" out="+audio_output_rate)):audio_resample_ratio=1,audio_min_nbuf=Math.ceil(audio_buffer_min_length_sec*audio_output_rate/audio_buffer_size),audio_max_nbuf=Math.ceil(audio_buffer_max_length_sec*audio_output_rate/audio_buffer_size),console.log("AUDIO audio_input_rate="+audio_input_rate+" audio_output_rate="+audio_output_rate),console.log("AUDIO min_length_sec="+audio_buffer_min_length_sec+"("+audio_min_nbuf+" bufs) max_length_sec="+audio_buffer_max_length_sec+"("+audio_max_nbuf+" bufs)")}function audio_start(){if(audio.d&&console.log("AUDIO audio_start"),null!=audio_context){audio_started=!0,audio_connect(0),audio_periodic_interval=setInterval(audio_periodic,audio_periodic_interval_ms);try{demodulator_analog_replace(init_mode)}catch(a){snd_send("SET x-DEBUG audio_start.demodulator_analog_replace: catch: "+a.toString())}}}function audio_disconnect(){audio.d&&console.log("AUDIO audio_disconnect"),audio_source&&(audio_disconnected=!0,audio_source.disconnect(),audio_source.onaudioprocess=null,audio_source=null),audio_convolver_running&&(audio_convolver.disconnect(),audio_convolver_running=!1),audio_watchdog&&(audio_watchdog.disconnect(),audio_watchdog.onaudioprocess=null,audio_watchdog=null),audio_panner&&audio_panner.disconnect()}function audio_connect_destination(a){"LG"==kiwi_isSmartTV()&&(audio_gain.gain.value=.3,a.connect(audio_gain),a=audio_gain),audio_panner?(a.connect(audio_panner),audio_panner.connect(audio_context.destination)):a.connect(audio_context.destination)}function audio_set_pan(a){if(audio_panner)try{audio_panner.pan.value=a}catch(a){}}function audio_connect(a){null!=audio_context&&(!audio_initial_connect&&a||(a||(audio_initial_connect=!0),a&&(audio_disconnect(),resample_init1=resample_init2=!1,audio_reconnect++,kiwi_log("AUDIO reconnect BUFFERING true"),audio_buffering=!0),audio_stat_output_epoch=-1,audio_change_LPF_delayed=!1,(audio_source=audio_context.createScriptProcessor(audio_buffer_size,0,audio_channels)).onaudioprocess=audio_onprocess,audio_disconnected=!1,audio_convolver_running?(audio_source.connect(audio_convolver),audio_connect_destination(audio_convolver)):audio_connect_destination(audio_source),kiwi_isFirefox()&&((audio_watchdog=audio_context.createScriptProcessor(audio_buffer_size,audio_channels,0)).onaudioprocess=audio_watchdog_process,audio_convolver_running?audio_convolver.connect(audio_watchdog):audio_source.connect(audio_watchdog))))}function audio_watchdog_process(a){if(kiwi.muted||audio_buffering)audio_silence_count=0;else{var e=a.inputBuffer.getChannelData(0),_=0==e[0];kiwi_gc_snd&&(e=null),(audio_silence_count=_?audio_silence_count+1:0)>16&&(audio_connect(1),audio_silence_count=0,audio_restart_count++,add_problem("FF silence"),kiwi_log("AUDIO FF SILENCE"))}}function audio_onprocess(a){if(audio_firefox_watchdog++,!audio_disconnected){if(-1==audio_stat_output_epoch&&(audio_stat_output_epoch=(new Date).getTime(),audio_stat_output_bufs=0),audio_stat_output_bufs++,audio_started&&0==audio_prepared_buffers.length&&(audio_underrun_errors++,audio_buffering=!0),!audio_started||audio_buffering)return audio_need_stats_reset=!0,a.outputBuffer.copyToChannel(audio_silence_buffer,0),void(2==audio_channels&&a.outputBuffer.copyToChannel(audio_silence_buffer,1));a.outputBuffer.copyToChannel(audio_prepared_buffers.shift(),0),2==audio_channels&&a.outputBuffer.copyToChannel(audio_prepared_buffers2.shift(),1),audio_ext_sequence=audio_prepared_seq.shift(),audio_change_LPF_delayed&&(audio_recompute_LPF(0),audio_change_LPF_delayed=!1),owrx.sMeter_dBm_biased=audio_prepared_smeter.shift()/10,owrx.sMeter_dBm=owrx.sMeter_dBm_biased-SMETER_BIAS;var e=audio_prepared_flags.shift();audio_ext_adc_ovfl=!!(e&audio.SND_FLAG_ADC_OVFL),e&audio.SND_FLAG_LPF&&(audio_change_LPF_delayed=!0);var _=!!(e&audio.SND_FLAG_SQUELCH_UI);_!=audio_last_sq&&isDefined(squelch_action)&&(setTimeout(function(a){squelch_action(a)},1,_),audio_last_sq=_),e&audio.SND_FLAG_TUNE_ACK&&setTimeout(function(a){w3_call("ale_2g_tune_ack",a)},10,audio.tune_freq),audio_meas_dly_ena&&audio_meas_dly_start&&e&audio.SND_FLAG_NEW_FREQ&&(audio_meas_dly=(new Date).getTime()-audio_meas_dly_start,kiwi_log("AUDIO dly="+audio_meas_dly),audio_meas_dly_start=0)}}var audio_watchdog_restart_cnt=0;function audio_periodic(){audio_started&&audio_prepared_buffers.length&&0==audio_firefox_watchdog&&kiwi_isFirefox()&&!cfg.disable_recent_changes&&(add_problem("FF watchdog"),console.log("AUDIO FF WATCHDOG Q"+audio_prepared_buffers.length+" WD="+audio_firefox_watchdog+" ============================================"),audio_init(0,null,!1,null),audio_initial_connect=!0,audio_watchdog_restart=!0,snd_send("SET reinit"));for(var a=!1;audio_prepared_buffers.length>audio_max_nbuf;)a=!0,audio_prepared_buffers.shift(),2==audio_channels&&audio_prepared_buffers2.shift(),audio_prepared_seq.shift(),audio_prepared_flags.shift(),audio_prepared_smeter.shift();a&&(add_problem("audio overrun"),audio_overrun_errors++),audio_last_underruns!=audio_underrun_errors&&(add_problem("audio underrun"),snd_send("SET underrun="+audio_underrun_errors),audio_last_underruns=audio_underrun_errors)}function audio_adpcm_state(a,e){audio_adpcm.index=a,audio_adpcm.previousValue=e,audio_camping=2}function audio_recv(a){if(audio_running){var e=new Uint8Array(a,0,8),_=e[3],o=e[7]<<24|e[6]<<16|e[5]<<8|e[4];if(!(1==audio_camping&&_&audio.SND_FLAG_COMPRESSED)){var i,u=new Uint8Array(a,8,2),t=u[0]<<8|u[1],d=_&audio.SND_FLAG_MODE_IQ,r=new DataView(a,d?20:10),s=r.byteLength;if(audio_watchdog_restart){if(!(_&audio.SND_FLAG_RESTART))return;audio_watchdog_restart=!1,audio_prepared_buffers=[],audio_prepared_buffers2=[],audio_prepared_seq=[],audio_prepared_flags=[],audio_prepared_smeter=[],audio_mode_iq?resample_old=!(resample_new=!1):(audio_adpcm.index=audio_adpcm.previousValue=0,resample_new=!kiwi_isMobile()&&resample_new_default,resample_old=!resample_new),audio_connect(1)}else if(d)audio_mode_iq||(audio_prepared_buffers=[],audio_prepared_buffers2=[],audio_prepared_seq=[],audio_prepared_flags=[],audio_prepared_smeter=[],resample_old=!(resample_new=!1),audio_mode_iq=!0,audio_channels=2,audio.d&&console.log("AUDIO !IQ -> IQ transition"),audio_connect(1)),audio_last_compression=audio_compression=!1,audio_mode_iq=!0;else{var n=!!(_&audio.SND_FLAG_COMPRESSED);(audio_mode_iq||audio_compression!=n)&&(audio_prepared_buffers=[],audio_prepared_buffers2=[],audio_prepared_seq=[],audio_prepared_flags=[],audio_prepared_smeter=[],audio_adpcm.index=audio_adpcm.previousValue=0,resample_new=!kiwi_isMobile()&&resample_new_default,resample_old=!resample_new,audio.d&&(audio_mode_iq?console.log("AUDIO IQ -> !IQ transition, compressed="+n):console.log("AUDIO !IQ, compression change="+(audio_compression!=n)+" compressed="+n)),audio_mode_iq=!1,audio_channels=1,audio_last_compression=audio_compression=n,audio_connect(1)),audio_last_compression=audio_compression=n,audio_mode_iq=!1}if(audio_channels=audio_mode_iq?2:1,audio_compression)audio.d&&console.log("AC Q"+audio_prepared_buffers.length+" #"+audio_channels),decode_ima_adpcm_e8_i16(r,audio_data,s,audio_adpcm),i=2*s;else for(audio.d&&(d?console.log("ANC IQ Q"+audio_prepared_buffers.length+"/"+audio_prepared_buffers2.length+" #"+audio_channels):console.log("ANC Q"+audio_prepared_buffers.length+" #"+audio_channels)),i=s/2,p=0;p<i;p++)audio_data[p]=r.getInt16(2*p,!!(_&audio.SND_FLAG_LITTLE_ENDIAN));if(audio_prepare(audio_data,i,o,_,t),!audio_started)audio_prepared_buffers.length>audio_min_nbuf&&audio_start();if(audio_need_stats_reset&&audio_stats_reset(),audio_stat_input_size+=i,audio_stat_total_input_size+=i,extint_audio_data(audio_data,i),wf.audioFFT_active&&wf_audio_FFT(audio_data,i),window.recording&&0==audio_last_sq){for(var l=audio_mode_iq?1024:n?2048:512,p=0;p<l;++p)window.recording_meta.data.setInt16(window.recording_meta.offset,audio_data[p],!0),window.recording_meta.offset+=2;window.recording_meta.total_size+=2*l,65536==window.recording_meta.offset&&(window.recording_meta.buffers.push(new ArrayBuffer(65536)),window.recording_meta.data=new DataView(window.recording_meta.buffers[window.recording_meta.buffers.length-1]),window.recording_meta.offset=0)}}}}function audio_recv_flags2(a){var e=a.split(":");switch(e[0]){case"active":var _=+e[1];console.log("$ active="+_),audio.cur_flags2|=_?audio.SND_FLAG_SET_ACTIVE:SND_FLAG_CLR_ACTIVE;break;case"tune_ack":audio.tune_freq=+e[1],console.log("$ tune_ack="+audio.tune_freq),audio.cur_flags2|=audio.SND_FLAG_TUNE_ACK}}var audio_push_ct=0;function audio_prepare(a,e,_,o,i){var u,t,d,r=resample_new&&audio_compression&&comp_lpf_taps_length,s=function(){audio_prepared_buffers.push(audio_last_output_buffer),2==audio_channels&&audio_prepared_buffers2.push(audio_last_output_buffer2),audio_prepared_seq.push(_),audio_change_LPF_latch&&(audio_change_LPF_latch=!1,o|=audio.SND_FLAG_LPF),audio_change_freq_latch&&(audio_change_freq_latch=!1,o|=audio.SND_FLAG_NEW_FREQ),audio_change_sq_UI_latch&&(audio_change_sq_UI_latch=!1,o|=audio.SND_FLAG_SQUELCH_UI),audio.cur_flags2&&(o|=audio.cur_flags2,audio.cur_flags2=0),audio_prepared_flags.push(o),audio_prepared_smeter.push(i),audio_last_output_offset=0,audio_last_output_buffer=new Float32Array(audio_buffer_size),2==audio_channels&&(audio_last_output_buffer2=new Float32Array(audio_buffer_size))},n=function(a,e,_,o,i){var u;for(u=0;u<i;u++)a[e+u]=_[o+u]};if(0!=e){if(1!=audio_resample_ratio){var l,p;if(resample_init1||((resample_taps_length=Math.round(4/audio_transition_bw))%2==0&&resample_taps_length++,rational_resampler_get_lowpass_f(resample_taps,resample_taps_length,audio_interpolation,audio_decimation),resample_init1=!0),!resample_init2&&resample_init1&&(r||resample_old)&&null!=audio_source)audio_recompute_LPF(1),l=comp_lpf_taps,p=comp_lpf_taps_length,(audio_convolver=audio_context.createConvolver()).normalize=!1,audio_reload_convolver_buffer(l,p),audio.d&&console.log("AUDIO splice in convolver"),audio_source.disconnect(),audio_source.connect(audio_convolver),audio_connect_destination(audio_convolver),kiwi_isFirefox()&&audio_convolver.connect(audio_watchdog),audio_convolver_running=!0,resample_init2=!0;if(resample_old)if(2==audio_channels){resample_output_size=Math.round(e/2*audio_resample_ratio);var f,c=1/audio_resample_ratio,m=0,g=0;for(A=0;A<resample_output_size;A++)h=a[2*m],b=resample_last,resample_output_buffer[A]=(h-b)*g+b,f=a[2*m+1],b=resample_last2,resample_output_buffer2[A]=(f-b)*g+b,(g+=c)>=1&&(g-=1,resample_last=h,resample_last2=f,m++);resample_last=h,resample_last2=f}else{resample_output_size=Math.round(e*audio_resample_ratio);var h,b;c=1/audio_resample_ratio,m=0,g=0;for(A=0;A<resample_output_size;A++)h=a[m],b=resample_last,resample_output_buffer[A]=(h-b)*g+b,(g+=c)>=1&&(g-=1,resample_last=h,m++);resample_last=h}else{if(0!=resample_input_processed){var w=resample_input_available-resample_input_processed;n(resample_input_buffer,0,resample_input_buffer,resample_input_processed,w),resample_input_available=w,resample_input_processed=0}n(resample_input_buffer,resample_input_available,a,0,e),resample_input_available+=e,2==audio_channels?rational_resampler_cc(resample_input_buffer,resample_output_buffer,resample_output_buffer2,resample_input_available,audio_interpolation,audio_decimation,resample_taps,resample_taps_length,resample_last_taps_delay):rational_resampler_ff(resample_input_buffer,resample_output_buffer,resample_input_available,audio_interpolation,audio_decimation,resample_taps,resample_taps_length,resample_last_taps_delay)}u=resample_output_buffer,t=resample_output_buffer2,d=resample_output_size}else u=a,d=e;if(o&audio.SND_FLAG_LPF&&(audio_change_LPF_latch=!0),o&audio.SND_FLAG_NEW_FREQ||audio.trim_bufs){audio_change_freq_latch=!0,audio.trim_bufs=!1;audio_prepared_buffers.length;for(var v=audio_min_nbuf;audio_prepared_buffers.length>v;)audio_prepared_buffers.pop(),2==audio_channels&&audio_prepared_buffers2.pop(),audio_prepared_seq.pop(),audio_prepared_flags.pop(),audio_prepared_smeter.pop()}if(o&audio.SND_FLAG_SQUELCH_UI&&(audio_change_sq_UI_latch=!0),audio_last_output_offset+d<=audio_buffer_size){if(2==audio_channels)for(var A=0;A<d;A++)audio_last_output_buffer[A+audio_last_output_offset]=u[A]/32768*kiwi.volume_f,audio_last_output_buffer2[A+audio_last_output_offset]=t[A]/32768*kiwi.volume_f;else for(A=0;A<d;A++)audio_last_output_buffer[A+audio_last_output_offset]=u[A]/32768*kiwi.volume_f;(audio_last_output_offset+=d)==audio_buffer_size&&s()}else{var F=audio_buffer_size-audio_last_output_offset,D=d-F;if(2==audio_channels)for(A=0;A<audio_buffer_size-audio_last_output_offset;A++)audio_last_output_buffer[A+audio_last_output_offset]=u[A]/32768*kiwi.volume_f,audio_last_output_buffer2[A+audio_last_output_offset]=t[A]/32768*kiwi.volume_f;else for(A=0;A<audio_buffer_size-audio_last_output_offset;A++)audio_last_output_buffer[A+audio_last_output_offset]=u[A]/32768*kiwi.volume_f;s();do{for(A=0;A<D;A++){if(A==audio_buffer_size){s();break}audio_last_output_buffer[A]=u[A+F]/32768*kiwi.volume_f,2==audio_channels&&(audio_last_output_buffer2[A]=t[A+F]/32768*kiwi.volume_f)}D-=A,F+=A}while(D);audio_last_output_offset+=A}if(audio_buffering)audio_prepared_buffers.length>audio_min_nbuf&&(audio_buffering=!1)}}try{AudioBuffer.prototype.copyToChannel||(AudioBuffer.prototype.copyToChannel=function(a,e){for(var _=this.getChannelData(e),o=0;o<a.length;o++)_[o]=a[o]})}catch(a){console.log("CATCH: AudioBuffer.prototype.copyToChannel")}function audio_stats_reset(){audio_stat_input_epoch=(new Date).getTime(),audio_stat_last_time=audio_stat_input_epoch,audio_stat_input_size=audio_stat_total_input_size=0,audio_need_stats_reset=!1}function audio_stats(){if(-1!=audio_stat_input_epoch&&-1!=audio_stat_output_epoch){var a=(new Date).getTime(),e=(a-audio_stat_last_time)/1e3;audio_stat_last_time=a;var _=audio_stat_total_input_size/((a-audio_stat_input_epoch)/1e3),o=audio_stat_output_bufs*audio_buffer_size/((a-audio_stat_output_epoch)/1e3),i="Audio: network "+(audio_stat_input_size/e).toFixed(0)+" sps ("+_.toFixed(0)+" avg), output "+o.toFixed(0)+" sps";i+=", Qlen "+audio_prepared_buffers.length,audio_underrun_errors&&(i+=", underruns "+audio_underrun_errors.toString()),audio_restart_count&&(i+=", restart "+audio_restart_count.toString()),w3_innerHTML("id-msg-audio",i),audio.d&&console.log(i),isNaN(o)&&(o=0),w3_innerHTML("id-status-audio",w3_text(optbar_prefix_color,"WF"),w3_text("",kiwi.wf_fps.toFixed(0)+" fps"),w3_text(optbar_prefix_color,"Audio"),w3_text("",(o/1e3).toFixed(1)+"k, Qlen "+audio_prepared_buffers.length)),audio_stat_input_size=0}}function audio_recompute_LPF(a,e,_){isDefined(e)&&isDefined(_)&&(audio.lo_cut=Math.abs(e),audio.hi_cut=Math.abs(_)),audio_camping?(e=audio.lo_cut,_=audio.hi_cut):isDefined(demodulators[0])?(_=Math.abs(demodulators[0].high_cut),isNaN(_)&&console.log(demodulators[0]),e=Math.abs(demodulators[0].low_cut)):(e=0,_=4e3);var o=Math.max(_,e);(a||o!=comp_lpf_freq)&&(firdes_lowpass_f(comp_lpf_taps,comp_lpf_taps_length,o/audio_output_rate),comp_lpf_freq=o,audio_convolver_running&&audio_reload_convolver_buffer(comp_lpf_taps,comp_lpf_taps_length))}function audio_reload_convolver_buffer(a,e){var _=audio_context.createBuffer(2,e,audio_output_rate),o=_.getChannelData(0);o.set(a),(o=_.getChannelData(1)).set(a),audio_convolver.buffer=_}function rational_resampler_ff(a,e,_,o,i,u,t,d){var r,s,n,l,p=Math.round(_*o/i);for(s=0;s<p&&(n=Math.floor((s*i+o-1-d)/o),l=Math.floor((d+n*o-s*i)%o),!(n+t/o+1>_));s++){var f=Math.floor((t-l)/o),c=0;for(r=0;r<f;r++)c+=a[n+r]*u[l+r*o];e[s]=c*o}resample_input_processed=n,resample_output_size=s,resample_last_taps_delay=l}function rational_resampler_cc(a,e,_,o,i,u,t,d,r){console.log("WARNING rational_resampler_cc() not working yet!")}function rational_resampler_get_lowpass_f(a,e,_,o){var i=1/_,u=1/o;firdes_lowpass_f(a,e,(i<u?i:u)/2)}function firdes_lowpass_f(a,e,_){var o,i=Math.floor(e/2);for(a[i]=2*Math.PI*_*firdes_wkernel_hamming(0),o=1;o<=i;o++)a[i-o]=a[i+o]=Math.sin(2*Math.PI*_*o)/o*firdes_wkernel_hamming(o/i);var u=0;for(o=0;o<e;o++)u+=a[o];for(o=0;o<e;o++)a[o]/=u}function firdes_wkernel_hamming(a){return a=.5+a/2,.54-.46*Math.cos(2*Math.PI*a)}




/* web/openwebrx/ima_adpcm.min.js */
var indexAdjustTable=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],stepSizeTable=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767];function ImaAdpcmDecode(e,a){var p=stepSizeTable[a.index],d=p>>3;return 1&e&&(d+=p>>2),2&e&&(d+=p>>1),4&e&&(d+=p),8&e&&(d=-d),a.previousValue+=d,a.previousValue>a.pos_clamp?a.previousValue=a.pos_clamp:a.previousValue<a.neg_clamp&&(a.previousValue=a.neg_clamp),a.index+=indexAdjustTable[e],a.index<0?a.index=0:a.index>88&&(a.index=88),a.previousValue}function decode_ima_adpcm_e8_i16(e,a,p,d){d.pos_clamp=32767,d.neg_clamp=-32768;var c,i=0;for(c=0;c<p;c++){var m=e.getUint8(c);a[i++]=ImaAdpcmDecode(15&m,d),a[i++]=ImaAdpcmDecode(m>>4&15,d)}}function decode_ima_adpcm_e8_u8(e,a,p,d){d.pos_clamp=255,d.neg_clamp=0;var c,i=0;for(c=0;c<p;c++)a[i++]=ImaAdpcmDecode(15&e[c],d),a[i++]=ImaAdpcmDecode(e[c]>>4&15,d)}

/* web/pkgs/w3color.min.js */
function w3SetColorsByAttribute(){var e,t,s;for(e=document.getElementsByTagName("*"),t=0;t<e.length;t++)(s=e[t].getAttribute("data-w3-color"))&&(e[t].style.backgroundColor=w3color(s).toRgbString())}!function(){function e(r,i){return this instanceof e?"object"==typeof r?r:(this.attachValues(function(e){var r,i,h,o,f,c,b,d,g,m,y,p=[],k=[],w=[];e=l(e.toLowerCase()),r=e.substr(0,1).toUpperCase(),i=e.substr(1),d=1,"R"!=r&&"Y"!=r&&"G"!=r&&"C"!=r&&"B"!=r&&"M"!=r&&"W"!=r||isNaN(i)||6==e.length&&-1==e.indexOf(",")||(e="ncol("+e+")");3==e.length||6==e.length||isNaN(e)||(e="ncol("+e+")");e.indexOf(",")>0&&-1==e.indexOf("(")&&(e="ncol("+e+")");if("rgb"==e.substr(0,3)||"hsl"==e.substr(0,3)||"hwb"==e.substr(0,3)||"ncol"==e.substr(0,4)||"cmyk"==e.substr(0,4)){if("ncol"==e.substr(0,4)?(4==e.split(",").length&&-1==e.indexOf("ncola")&&(e=e.replace("ncol","ncola")),h="ncol",e=e.substr(4)):"cmyk"==e.substr(0,4)?(h="cmyk",e=e.substr(4)):(h=e.substr(0,3),e=e.substr(3)),o=3,c=!1,"a"==e.substr(0,1).toLowerCase()?(o=4,c=!0,e=e.substr(1)):"cmyk"==h&&(o=4,5==e.split(",").length&&(o=5,c=!0)),e=(e=e.replace("(","")).replace(")",""),p=e.split(","),"rgb"==h){if(p.length!=o)return{red:0,green:0,blue:0,hue:0,sat:0,lightness:0,whiteness:0,blackness:0,cyan:0,magenta:0,yellow:0,black:0,ncol:"R",opacity:1,valid:!1};for(f=0;f<o;f++){if(""!=p[f]&&" "!=p[f]||(p[f]="0"),p[f].indexOf("%")>-1&&(p[f]=p[f].replace("%",""),p[f]=Number(p[f]/100),f<3&&(p[f]=Math.round(255*p[f]))),isNaN(p[f]))return{red:0,green:0,blue:0,hue:0,sat:0,lightness:0,whiteness:0,blackness:0,cyan:0,magenta:0,yellow:0,black:0,ncol:"R",opacity:1,valid:!1};parseInt(p[f])>255&&(p[f]=255),f<3&&(p[f]=parseInt(p[f])),3==f&&Number(p[f])>1&&(p[f]=1)}y={r:p[0],g:p[1],b:p[2]},1==c&&(d=Number(p[3]))}if("hsl"==h||"hwb"==h||"ncol"==h){for(;p.length<o;)p.push("0");for("hsl"!=h&&"hwb"!=h||parseInt(p[0])>=360&&(p[0]=0),f=1;f<o;f++){if(p[f].indexOf("%")>-1){if(p[f]=p[f].replace("%",""),p[f]=Number(p[f]),isNaN(p[f]))return{red:0,green:0,blue:0,hue:0,sat:0,lightness:0,whiteness:0,blackness:0,cyan:0,magenta:0,yellow:0,black:0,ncol:"R",opacity:1,valid:!1};p[f]=p[f]/100}else p[f]=Number(p[f]);Number(p[f])>1&&(p[f]=1),Number(p[f])<0&&(p[f]=0)}"hsl"==h&&(y=a(p[0],p[1],p[2]),g=Number(p[0]),m=Number(p[1])),"hwb"==h&&(y=n(p[0],p[1],p[2])),"ncol"==h&&(y=function(e,t,s){var a,r,i;if(i=e,isNaN(e.substr(0,1))){if(a=e.substr(0,1).toUpperCase(),""==(r=e.substr(1))&&(r=0),r=Number(r),isNaN(r))return!1;"R"==a&&(i=0+.6*r),"Y"==a&&(i=60+.6*r),"G"==a&&(i=120+.6*r),"C"==a&&(i=180+.6*r),"B"==a&&(i=240+.6*r),"M"==a&&(i=300+.6*r),"W"==a&&(i=0,t=1-r/100,s=r/100)}return n(i,t,s)}(p[0],p[1],p[2])),1==c&&(d=Number(p[3]))}if("cmyk"==h){for(;p.length<o;)p.push("0");for(f=0;f<o;f++){if(p[f].indexOf("%")>-1){if(p[f]=p[f].replace("%",""),p[f]=Number(p[f]),isNaN(p[f]))return{red:0,green:0,blue:0,hue:0,sat:0,lightness:0,whiteness:0,blackness:0,cyan:0,magenta:0,yellow:0,black:0,ncol:"R",opacity:1,valid:!1};p[f]=p[f]/100}else p[f]=Number(p[f]);Number(p[f])>1&&(p[f]=1),Number(p[f])<0&&(p[f]=0)}y=function(e,t,s,a){var r,n,i;return r=255-255*Math.min(1,e*(1-a)+a),n=255-255*Math.min(1,t*(1-a)+a),i=255-255*Math.min(1,s*(1-a)+a),{r:r,g:n,b:i}}(p[0],p[1],p[2],p[3]),1==c&&(d=Number(p[4]))}}else if("ncs"==e.substr(0,3))y=function(e){var t,s,a,r,n,i,h,u,o,f,c,b,d,g,m,y,p;-1==(e=(e=(e=(e=(e=l(e).toUpperCase()).replace("(","")).replace(")","")).replace("NCS","NCS ")).replace(/  /g," ")).indexOf("NCS")&&(e="NCS "+e);if(null===(e=e.match(/^(?:NCS|NCS\sS)\s(\d{2})(\d{2})-(N|[A-Z])(\d{2})?([A-Z])?$/)))return!1;if(t=parseInt(e[1],10),s=parseInt(e[2],10),"N"!=(a=e[3])&&"Y"!=a&&"R"!=a&&"B"!=a&&"G"!=a)return!1;r=parseInt(e[4],10)||0,"N"!==a?(n=1.05*t-5.25,i=s,"Y"===a&&r<=60?o=1:"Y"===a&&r>60||"R"===a&&r<=80?(h="Y"===a?r-60:r+40,o=(Math.sqrt(14884-Math.pow(h,2))-22)/100):"R"===a&&r>80||"B"===a?o=0:"G"===a&&(h=r-170,o=(Math.sqrt(33800-Math.pow(h,2))-70)/100),"Y"===a&&r<=80?u=0:"Y"===a&&r>80||"R"===a&&r<=60?(h="Y"===a?r-80+20.5:r+20+20.5,u=(104-Math.sqrt(11236-Math.pow(h,2)))/100):"R"===a&&r>60||"B"===a&&r<=80?(h="R"===a?r-60-60:r+40-60,u=(Math.sqrt(1e4-Math.pow(h,2))-10)/100):"B"===a&&r>80||"G"===a&&r<=40?(h="B"===a?r-80-131:r+20-131,u=(122-Math.sqrt(19881-Math.pow(h,2)))/100):"G"===a&&r>40&&(u=0),"Y"===a?green1=(85-.85*r)/100:"R"===a&&r<=60?green1=0:"R"===a&&r>60?(h=r-60+35,green1=(67.5-Math.sqrt(5776-Math.pow(h,2)))/100):"B"===a&&r<=60?(h=1*r-68.5,green1=(6.5+Math.sqrt(7044.5-Math.pow(h,2)))/100):"B"===a&&r>60||"G"===a&&r<=60?green1=.9:"G"===a&&r>60&&(h=r-60,green1=(90-1/8*h)/100),h=(o+green1+u)/3,f=(h-o)*(100-i)/100+o,c=(h-green1)*(100-i)/100+green1,b=(h-u)*(100-i)/100+u,d=1/(f>c&&f>b?f:c>f&&c>b?c:b>f&&b>c?b:(f+c+b)/3),m=parseInt(f*d*(100-n)/100*255,10),y=parseInt(c*d*(100-n)/100*255,10),p=parseInt(b*d*(100-n)/100*255,10),m>255&&(m=255),y>255&&(y=255),p>255&&(p=255),m<0&&(m=0),y<0&&(y=0),p<0&&(p=0)):((g=parseInt(255*(1-t/100),10))>255&&(g=255),g<0&&(g=0),m=g,y=g,p=g);return{r:m,g:y,b:p}}(e);else{for(b=!1,k=s("names"),f=0;f<k.length;f++)if(e.toLowerCase()==k[f].toLowerCase()){w=s("hexs"),b=!0,y={r:parseInt(w[f].substr(0,2),16),g:parseInt(w[f].substr(2,2),16),b:parseInt(w[f].substr(4,2),16)};break}if(0==b){for(3==(e=e.replace("#","")).length&&(e=e.substr(0,1)+e.substr(0,1)+e.substr(1,1)+e.substr(1,1)+e.substr(2,1)+e.substr(2,1)),f=0;f<e.length;f++)if(!u(e.substr(f,1)))return{red:0,green:0,blue:0,hue:0,sat:0,lightness:0,whiteness:0,blackness:0,cyan:0,magenta:0,yellow:0,black:0,ncol:"R",opacity:1,valid:!1};for(p[0]=parseInt(e.substr(0,2),16),p[1]=parseInt(e.substr(2,2),16),p[2]=parseInt(e.substr(4,2),16),f=0;f<3;f++)if(isNaN(p[f]))return{red:0,green:0,blue:0,hue:0,sat:0,lightness:0,whiteness:0,blackness:0,cyan:0,magenta:0,yellow:0,black:0,ncol:"R",opacity:1,valid:!1};y={r:p[0],g:p[1],b:p[2]}}}return t(y,d,g,m)}(r)),void(i&&(i.style.backgroundColor=this.toRgbString()))):new e(r,i)}function t(e,t,s,a){var r,n,i,h,l,u,o,f;return e?(null===t&&(t=1),r=function(e,t,s){var a,r,n,i,h,l,u,o=[];for(o[0]=e/255,o[1]=t/255,o[2]=s/255,a=o[0],r=o[0],l=0,n=0;n<o.length-1;n++)o[n+1]<=a&&(a=o[n+1]),o[n+1]>=r&&(r=o[n+1],l=n+1);0==l&&(u=(o[1]-o[2])/(r-a));1==l&&(u=2+(o[2]-o[0])/(r-a));2==l&&(u=4+(o[0]-o[1])/(r-a));isNaN(u)&&(u=0);(u*=60)<0&&(u+=360);i=(a+r)/2,h=a==r?0:i<.5?(r-a)/(r+a):(r-a)/(2-r-a);return{h:u,s:h=h,l:i}}(e.r,e.g,e.b),n=function(e,t,s){var a,r,n;e/=255,t/=255,s/=255,max=Math.max(e,t,s),min=Math.min(e,t,s),chroma=max-min,a=0==chroma?0:e==max?(t-s)/chroma%6*360:t==max?((s-e)/chroma+2)%6*360:((e-t)/chroma+4)%6*360;return r=min,n=1-max,{h:a,w:r,b:n}}(e.r,e.g,e.b),i=function(e,t,s){var a,r,n,i;e/=255,t/=255,s/=255,max=Math.max(e,t,s),1==(i=1-max)?(a=0,r=0,n=0):(a=(1-e-i)/(1-i),r=(1-t-i)/(1-i),n=(1-s-i)/(1-i));return{c:a,m:r,y:n,k:i}}(e.r,e.g,e.b),u=s||r.h,o=a||r.s,h=function(e){for(;e>=360;)e-=360;if(e<60)return"R"+e/.6;if(e<120)return"Y"+(e-60)/.6;if(e<180)return"G"+(e-120)/.6;if(e<240)return"C"+(e-180)/.6;if(e<300)return"B"+(e-240)/.6;if(e<360)return"M"+(e-300)/.6}(u),l={red:e.r,green:e.g,blue:e.b,hue:u,sat:o,lightness:r.l,whiteness:n.w,blackness:n.b,cyan:i.c,magenta:i.m,yellow:i.y,black:i.k,ncol:h,opacity:t,valid:!0},(f=l).red=Number(f.red.toFixed(0)),f.green=Number(f.green.toFixed(0)),f.blue=Number(f.blue.toFixed(0)),f.hue=Number(f.hue.toFixed(0)),f.sat=Number(f.sat.toFixed(2)),f.lightness=Number(f.lightness.toFixed(2)),f.whiteness=Number(f.whiteness.toFixed(2)),f.blackness=Number(f.blackness.toFixed(2)),f.cyan=Number(f.cyan.toFixed(2)),f.magenta=Number(f.magenta.toFixed(2)),f.yellow=Number(f.yellow.toFixed(2)),f.black=Number(f.black.toFixed(2)),f.ncol=f.ncol.substr(0,1)+Math.round(Number(f.ncol.substr(1))),f.opacity=Number(f.opacity.toFixed(2)),l=f):{red:0,green:0,blue:0,hue:0,sat:0,lightness:0,whiteness:0,blackness:0,cyan:0,magenta:0,yellow:0,black:0,ncol:"R",opacity:1,valid:!1}}function s(e){return"names"==e?["AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","Black","BlanchedAlmond","Blue","BlueViolet","Brown","BurlyWood","CadetBlue","Chartreuse","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkBlue","DarkCyan","DarkGoldenRod","DarkGray","DarkGrey","DarkGreen","DarkKhaki","DarkMagenta","DarkOliveGreen","DarkOrange","DarkOrchid","DarkRed","DarkSalmon","DarkSeaGreen","DarkSlateBlue","DarkSlateGray","DarkSlateGrey","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DimGrey","DodgerBlue","FireBrick","FloralWhite","ForestGreen","Fuchsia","Gainsboro","GhostWhite","Gold","GoldenRod","Gray","Grey","Green","GreenYellow","HoneyDew","HotPink","IndianRed","Indigo","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenRodYellow","LightGray","LightGrey","LightGreen","LightPink","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSlateGrey","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Magenta","Maroon","MediumAquaMarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MidnightBlue","MintCream","MistyRose","Moccasin","NavajoWhite","Navy","OldLace","Olive","OliveDrab","Orange","OrangeRed","Orchid","PaleGoldenRod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","Purple","RebeccaPurple","Red","RosyBrown","RoyalBlue","SaddleBrown","Salmon","SandyBrown","SeaGreen","SeaShell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","SlateGrey","Snow","SpringGreen","SteelBlue","Tan","Teal","Thistle","Tomato","Turquoise","Violet","Wheat","White","WhiteSmoke","Yellow","YellowGreen"]:"hexs"==e?["f0f8ff","faebd7","00ffff","7fffd4","f0ffff","f5f5dc","ffe4c4","000000","ffebcd","0000ff","8a2be2","a52a2a","deb887","5f9ea0","7fff00","d2691e","ff7f50","6495ed","fff8dc","dc143c","00ffff","00008b","008b8b","b8860b","a9a9a9","a9a9a9","006400","bdb76b","8b008b","556b2f","ff8c00","9932cc","8b0000","e9967a","8fbc8f","483d8b","2f4f4f","2f4f4f","00ced1","9400d3","ff1493","00bfff","696969","696969","1e90ff","b22222","fffaf0","228b22","ff00ff","dcdcdc","f8f8ff","ffd700","daa520","808080","808080","008000","adff2f","f0fff0","ff69b4","cd5c5c","4b0082","fffff0","f0e68c","e6e6fa","fff0f5","7cfc00","fffacd","add8e6","f08080","e0ffff","fafad2","d3d3d3","d3d3d3","90ee90","ffb6c1","ffa07a","20b2aa","87cefa","778899","778899","b0c4de","ffffe0","00ff00","32cd32","faf0e6","ff00ff","800000","66cdaa","0000cd","ba55d3","9370db","3cb371","7b68ee","00fa9a","48d1cc","c71585","191970","f5fffa","ffe4e1","ffe4b5","ffdead","000080","fdf5e6","808000","6b8e23","ffa500","ff4500","da70d6","eee8aa","98fb98","afeeee","db7093","ffefd5","ffdab9","cd853f","ffc0cb","dda0dd","b0e0e6","800080","663399","ff0000","bc8f8f","4169e1","8b4513","fa8072","f4a460","2e8b57","fff5ee","a0522d","c0c0c0","87ceeb","6a5acd","708090","708090","fffafa","00ff7f","4682b4","d2b48c","008080","d8bfd8","ff6347","40e0d0","ee82ee","f5deb3","ffffff","f5f5f5","ffff00","9acd32"]:void 0}function a(e,t,s){var a,n;return{r:255*r(a=2*s-(n=s<=.5?s*(t+1):s+t-s*t),n,(e/=60)+2),g:255*r(a,n,e),b:255*r(a,n,e-2)}}function r(e,t,s){return s<0&&(s+=6),s>=6&&(s-=6),s<1?(t-e)*s+e:s<3?t:s<4?(t-e)*(4-s)+e:e}function n(e,t,s){var r,n,i,h=[];for(n=a(e,1,.5),h[0]=n.r/255,h[1]=n.g/255,h[2]=n.b/255,(i=t+s)>1&&(t=Number((t/i).toFixed(2)),s=Number((s/i).toFixed(2))),r=0;r<3;r++)h[r]*=1-t-s,h[r]+=t,h[r]=Number(255*h[r]);return{r:h[0],g:h[1],b:h[2]}}function h(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t}function l(e){return e.replace(/^\s+|\s+$/g,"")}function u(e){return"0123456789ABCDEFabcdef".indexOf(e)>-1}e.prototype={toRgbString:function(){return"rgb("+this.red+", "+this.green+", "+this.blue+")"},toRgbaString:function(){return"rgba("+this.red+", "+this.green+", "+this.blue+", "+this.opacity+")"},toHwbString:function(){return"hwb("+this.hue+", "+Math.round(100*this.whiteness)+"%, "+Math.round(100*this.blackness)+"%)"},toHwbStringDecimal:function(){return"hwb("+this.hue+", "+this.whiteness+", "+this.blackness+")"},toHwbaString:function(){return"hwba("+this.hue+", "+Math.round(100*this.whiteness)+"%, "+Math.round(100*this.blackness)+"%, "+this.opacity+")"},toHslString:function(){return"hsl("+this.hue+", "+Math.round(100*this.sat)+"%, "+Math.round(100*this.lightness)+"%)"},toHslStringDecimal:function(){return"hsl("+this.hue+", "+this.sat+", "+this.lightness+")"},toHslaString:function(){return"hsla("+this.hue+", "+Math.round(100*this.sat)+"%, "+Math.round(100*this.lightness)+"%, "+this.opacity+")"},toCmykString:function(){return"cmyk("+Math.round(100*this.cyan)+"%, "+Math.round(100*this.magenta)+"%, "+Math.round(100*this.yellow)+"%, "+Math.round(100*this.black)+"%)"},toCmykStringDecimal:function(){return"cmyk("+this.cyan+", "+this.magenta+", "+this.yellow+", "+this.black+")"},toNcolString:function(){return this.ncol+", "+Math.round(100*this.whiteness)+"%, "+Math.round(100*this.blackness)+"%"},toNcolStringDecimal:function(){return this.ncol+", "+this.whiteness+", "+this.blackness},toNcolaString:function(){return this.ncol+", "+Math.round(100*this.whiteness)+"%, "+Math.round(100*this.blackness)+"%, "+this.opacity},toName:function(){var e,t,a,r=s("hexs");for(i=0;i<r.length;i++)if(e=parseInt(r[i].substr(0,2),16),t=parseInt(r[i].substr(2,2),16),a=parseInt(r[i].substr(4,2),16),this.red==e&&this.green==t&&this.blue==a)return s("names")[i];return""},toHexString:function(){return"#"+h(this.red)+h(this.green)+h(this.blue)},toRgb:function(){return{r:this.red,g:this.green,b:this.blue,a:this.opacity}},toHsl:function(){return{h:this.hue,s:this.sat,l:this.lightness,a:this.opacity}},toHwb:function(){return{h:this.hue,w:this.whiteness,b:this.blackness,a:this.opacity}},toCmyk:function(){return{c:this.cyan,m:this.magenta,y:this.yellow,k:this.black,a:this.opacity}},toNcol:function(){return{ncol:this.ncol,w:this.whiteness,b:this.blackness,a:this.opacity}},isDark:function(e){var t=e||128;return(299*this.red+587*this.green+114*this.blue)/1e3<t},saturate:function(e){var s,r;s=e/100||.1,this.sat+=s,this.sat>1&&(this.sat=1),r=t(a(this.hue,this.sat,this.lightness),this.opacity,this.hue,this.sat),this.attachValues(r)},desaturate:function(e){var s,r;s=e/100||.1,this.sat-=s,this.sat<0&&(this.sat=0),r=t(a(this.hue,this.sat,this.lightness),this.opacity,this.hue,this.sat),this.attachValues(r)},lighter:function(e){var s,r;s=e/100||.1,this.lightness+=s,this.lightness>1&&(this.lightness=1),r=t(a(this.hue,this.sat,this.lightness),this.opacity,this.hue,this.sat),this.attachValues(r)},darker:function(e){var s,r;s=e/100||.1,this.lightness-=s,this.lightness<0&&(this.lightness=0),r=t(a(this.hue,this.sat,this.lightness),this.opacity,this.hue,this.sat),this.attachValues(r)},attachValues:function(e){this.red=e.red,this.green=e.green,this.blue=e.blue,this.hue=e.hue,this.sat=e.sat,this.lightness=e.lightness,this.whiteness=e.whiteness,this.blackness=e.blackness,this.cyan=e.cyan,this.magenta=e.magenta,this.yellow=e.yellow,this.black=e.black,this.ncol=e.ncol,this.opacity=e.opacity,this.valid=e.valid}},window.w3color=e}();




/* web/pkgs/xdLocalStorage/xdLocalStorage.min.js */
"use strict";window.xdLocalStorage=window.xdLocalStorage||function(){var e,n="cross-domain-local-message",t={iframeId:"cross-domain-iframe",iframeUrl:void 0,initCallback:function(){}},i=-1,o={},a=!1,l=!1;function r(e){var i;try{i=JSON.parse(e.data)}catch(e){}i&&i.namespace===n&&("iframe-ready"===i.id?(l=!0,t.initCallback()):function(e){o[e.id]&&(o[e.id](e),delete o[e.id])}(i))}function c(t,a,l,r){o[++i]=r;var c={namespace:n,etag:0,server:0,id:i,action:t,key:a,value:l};e.contentWindow.postMessage(JSON.stringify(c),"*")}function s(n){t=XdUtils.extend(n,t);var i=document.createElement("div");window.addEventListener?window.addEventListener("message",r,!1):window.attachEvent("onmessage",r),i.innerHTML='<iframe id="'+t.iframeId+'" src='+t.iframeUrl+' style="display: none;"></iframe>',document.body.appendChild(i),e=document.getElementById(t.iframeId)}function d(){return a?!!l||(console.log("You must wait for iframe ready message before using the api."),!1):(console.log("You must call xdLocalStorage.init() before using it."),!1)}return{init:function(e){if(!e.iframeUrl)throw"You must specify iframeUrl";a?console.log("xdLocalStorage was already initialized!"):(a=!0,"complete"===document.readyState?s(e):window.onload=function(){s(e)})},setItem:function(e,n,t){d()&&c("set",e,n,t)},getItem:function(e,n){d()&&c("get",e,null,n)},removeItem:function(e,n){d()&&c("remove",e,null,n)},key:function(e,n){d()&&c("key",e,null,n)},getSize:function(e){d()&&c("size",null,null,e)},getLength:function(e){d()&&c("length",null,null,e)},clear:function(e){d()&&c("clear",null,null,e)},wasInit:function(){return a}}}(),window.xdLocalStorageHA=window.xdLocalStorageHA||function(){var e="cross-domain-local-message",n={iframeId:"cross-domain-iframe",iframeUrls:void 0,initCallback:function(){}},t=-1,i=[],o=[],a=0,l={},r=[],c=!1,s=!1;function d(n){var t;try{t=JSON.parse(n.data)}catch(e){}t&&t.namespace===e&&("iframe-ready"===t.id||("ping"===t.action?(o[t.server]=!0,a++,console.log("XDLS ping reply server="+t.server+" seen_ct="+a)):r[t.server]=t))}function u(n,a,c,s){l[++t]=s;for(var d={namespace:e,etag:Date.now(),id:t,action:n,key:a,value:c},u=0;u<i.length;u++)("ping"==n||o[u])&&(d.server=u,r[u]=null,i[u].contentWindow.postMessage(JSON.stringify(d),"*"));"ping"!=n&&setTimeout(function(){for(var e=-1,n=-1,t=0;t<i.length;t++){var o=r[t];if(null!=o){var a=o.etag?o.etag:0;a>e&&(e=a,n=t)}}-1!=n?function(e){l[e.id]&&(l[e.id](e),delete l[e.id])}(r[n]):console.log("XDLS wait longer for response?")},250)}function f(e){n=XdUtils.extend(e,n),window.addEventListener?window.addEventListener("message",d,!1):window.attachEvent("onmessage",d);var t=0;n.iframeUrls.forEach(function(e){var o="id-"+n.iframeId+"-"+t,a=document.createElement("div");w3_add(a,"id-"+n.iframeId),a.innerHTML='<iframe id="'+o+'" src='+e+' style="display: none;"></iframe>',document.body.appendChild(a),i[t]=document.getElementById(o),t++})}function m(){return c?!!s||(console.log("You must wait for iframe ready message before using the api."),!1):(console.log("You must call xdLocalStorage.init() before using it."),!1)}return setTimeout(function(){u("ping",null,null,null),setTimeout(function(){console.log("XDLS seen servers="+a),s=!0,n.initCallback()},1e3)},5e3),{init:function(e){if(!e.iframeUrls)throw"You must specify iframeUrls";c?console.log("xdLocalStorage was already initialized!"):(c=!0,"complete"===document.readyState?f(e):window.onload=function(){f(e)})},setItem:function(e,n,t){m()&&u("set",e,n,t)},getItem:function(e,n){m()&&u("get",e,null,n)},removeItem:function(e,n){m()&&u("remove",e,null,n)},key:function(e,n){m()&&u("key",e,null,n)},getSize:function(e){m()&&u("size",null,null,e)},getLength:function(e){m()&&u("length",null,null,e)},clear:function(e){m()&&u("clear",null,null,e)},wasInit:function(){return c}}}();




/* web/pkgs/xdLocalStorage/xd-utils.min.js */
"use strict";window.XdUtils=window.XdUtils||function(){return{extend:function(n,t){var r,i=t||{};for(r in n)n.hasOwnProperty(r)&&(i[r]=n[r]);return i}}}();
