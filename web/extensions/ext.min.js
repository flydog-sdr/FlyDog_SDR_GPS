

/* web/extensions/ext.min.js (web/extensions/ext.js = Mon Jun 20 11:10:25 2022) */
var extint={ws:null,extname:null,srate:0,nom_srate:0,param:null,override_pb:!1,displayed:!1,help_displayed:!1,spectrum_used:!1,current_ext_name:null,using_data_container:!1,hide_func:null,default_w:525,default_h:300,prev_mode:null,seq:0,scanning:0,no_lockout:["noise_blank","noise_filter","ant_switch","iframe","colormap","devl","prefs"],excl_devl:["devl","s4285","prefs"],OPT_NOLOCAL:1},devl={p0:0,p1:0,p2:0,p3:0,p4:0,p5:0,p6:0,p7:0};function ext_switch_to_client(e,t,n){recv_websocket(extint.ws,n),ext_send("SET ext_switch_to_client="+e+" first_time="+(t?1:0)+" rx_chan="+rx_chan),w3_call(e+"_focus")}function ext_send(e,t){null==t&&(t=extint.ws);try{return t.send(e),0}catch(e){console.log("CATCH ext_send('"+s+"') ex="+e),kiwi_trace()}}function ext_panel_show(e,t,n,_){extint_panel_show(e,t,n,_)}function ext_set_data_height(e){var t=w3_el("id-ext-data-container");e?t&&(t.style.height=px(e)):t&&(t.style.height="")}function ext_set_controls_width_height(e,t){panel_set_width_height("ext-controls",e,t)}var EXT_SAVE=!0,EXT_NO_SAVE=!1;function ext_get_cfg_param(e,t,n){var _;e=w3_add_toplevel(e);try{_=getVarFromString(e)}catch(e){_=null}return null!=_&&null!=_||null==t||(_=t,setVarFromString(e,_),null!=n&&n!=EXT_SAVE||cfg_save_json("ext_get_cfg_param",e)),_}function ext_get_cfg_param_string(e,t,n){return kiwi_decodeURIComponent(ext_get_cfg_param_string+":"+e,ext_get_cfg_param(e,t,n))}function ext_set_cfg_param(e,t,n){e=w3_add_toplevel(e),setVarFromString(e,t),null!=n&&n==EXT_SAVE&&cfg_save_json("ext_set_cfg_param",e)}function ext_get_freq_range(){var e=kiwi.freq_offset_kHz;return{lo_kHz:cfg.sdr_hu_lo_kHz+e,hi_kHz:cfg.sdr_hu_hi_kHz+e,offset_kHz:e}}var extint_isAdmin_cb,extint_authkey_cb,ext_zoom={TO_BAND:0,IN:1,OUT:-1,ABS:2,WHEEL:3,CUR:4,NOM_IN:8,MAX_IN:9,MAX_OUT:-9},extint_ext_is_tuning=!1;function ext_tune(e,t,n,_,i,o,r){var l=null!=i&&null!=o;extint_ext_is_tuning=!0,freqmode_set_dsp_kHz(e,t,r),l&&ext_set_passband(i,o),null!=n?n==ext_zoom.CUR?zoom_step(ext_zoom.ABS,zoom_level):zoom_step(n,_):zoom_step(ext_zoom.TO_BAND),extint_ext_is_tuning=!1}function ext_get_freq_Hz(){return{displayed:freq_displayed_Hz,carrier:freq_car_Hz,passband_center:freq_passband_center()}}function ext_get_freq(){return freq_displayed_Hz}function ext_get_freq_kHz(){return(freq_displayed_Hz/1e3).toFixed(2)}function ext_get_carrier_freq(){return freq_car_Hz}function ext_get_passband_center_freq(){return freq_passband_center()}function ext_get_mode(){return cur_mode}function ext_is_IQ_or_stereo_mode(e){return"drm"==(e=e.toLowerCase(e))||"iq"==e||"sas"==e||"qam"==e}function ext_is_IQ_or_stereo_curmode(){return ext_is_IQ_or_stereo_mode(cur_mode)}function ext_get_prev_mode(){return extint.prev_mode}function ext_set_mode(e,t,n){var _="drm"==e;_&&(extint.prev_mode=cur_mode),demodulator_analog_replace(e,t);var i=w3_opt(n,"open_ext",!1),o=w3_opt(n,"no_drm_proc",!1),n="undefined"!=typeof drm&&drm.active;o||(_&&i?n?toggle_panel("ext-controls",1):extint_open("drm"):!_&&n&&(extint_panel_hide(),demodulator_analog_replace(e,t)))}function ext_get_passband(){var e=demodulators[0];return{low:e.low_cut,high:e.high_cut}}function ext_set_passband(e,t,n,_){var i=demodulators[0],o=i.filter;null==e&&(e=i.low_cut),null==t&&(t=i.high_cut);Math.abs(t-e);e=e<o.low_cut_limit?o.low_cut_limit:e,t=t>o.high_cut_limit?o.high_cut_limit:t;var r=!1;Math.abs(t-e)>=o.min_passband&&e<t&&(i.low_cut=e,i.high_cut=t,r=!0),isArg(n)&&n&&r&&(owrx.last_lo[cur_mode]=e,owrx.last_hi[cur_mode]=t),null!=_&&null!=_&&(_*=1e3,freq_car_Hz=freq_dsp_to_car(_)),extint_ext_is_tuning=!0,demodulator_set_offset_frequency(owrx.FSET_EXT_SET_PB,freq_car_Hz-center_freq),extint_ext_is_tuning=!1}function ext_get_tuning(){return{low:demod.low_cut,high:demod.high_cut,mode:cur_mode,freq_dial_kHz:freq_displayed_Hz/1e3}}function ext_get_zoom(){return zoom_level}function ext_set_scanning(e){extint.scanning=e?1:0}function ext_agc_delay(e){var t=w3_el("input-decay").value;return isDefined(e)&&setDecay(!0,e),t}function ext_get_optbar(){return readCookie("last_optbar")}function ext_set_optbar(e){extint.optbars[e]&&(writeCookie("last_optbar",e),w3_el("id-nav-"+e).click())}function ext_hasCredential(e,t,n,_){var i="admin"==(e="mfg"==e?"admin":e)?(deleteCookie("admin"),deleteCookie("admin-pwd"),""):(i=readCookie(e))?decodeURIComponent(i):"";extint_pwd_cb=t,extint_pwd_cb_param=n,ext_valpwd(e,i,_)}function ext_valpwd(e,t,n){t=encodeURIComponent(t),"admin"!=e&&writeCookie(e,t),extint_conn_type=e,t=""!=t?t:"#";var _=null,i=readCookie("iplimit"),o=kiwi_url_param(["pwd","password"],"","");""!=o?_=o:i&&""!=i&&(_=i),_=_?" ipl="+_:"",null!=kiwi_url_param(["p","prot","protected"],"true",null)&&"admin"!=e&&(e="prot");i=0;kiwi_url_param("nolocal")&&(i|=extint.OPT_NOLOCAL),0!=i&&ext_send("SET options="+i),ext_send("SET auth t="+e+" p="+t+_,n)}function ext_isAdmin(e){extint_isAdmin_cb=e,ext_send("SET is_admin")}function ext_get_authkey(e){ext_send("SET get_authkey"),extint_authkey_cb=e}extint.optbars={"optbar-wf":0,"optbar-audio":1,"optbar-agc":2,"optbar-users":3,"optbar-status":4,"optbar-off":5};var extint_adc_clock_Hz=0;function ext_adc_clock_Hz(){return extint_adc_clock_Hz}var extint_adc_gps_clock_corr=0;function ext_adc_gps_clock_corr(){return extint_adc_gps_clock_corr}var extint_adc_clock_nom_Hz=0;function ext_adc_clock_nom_Hz(){return extint_adc_clock_nom_Hz}function ext_sample_rate(){return extint.srate}function ext_nom_sample_rate(){return extint.nom_srate}var extint_audio_data_cb=null;function ext_register_audio_data_cb(e){extint_audio_data_cb=e}function ext_unregister_audio_data_cb(){extint_audio_data_cb=null}function ext_param(){var e=extint.param;return extint.param=null,e}function ext_panel_set_name(e){extint.current_ext_name=e}function ext_get_name(){return extint.current_ext_name}function ext_mobile_info(e){var t=window.innerWidth,n=window.innerHeight,_={width:t,height:n},n=owrx.popup_keyboard_active?e?e.isPortrait:1:t<n||mobile_laptop_test?1:0;return _.orient_unchanged=e&&e.isPortrait==n?1:0,_.isPortrait=n?1:0,_.iPad=n&&t<=768?1:0,_.small=n&&t<768?1:0,_.narrow=n&&t<=600?1:0,_}function ext_get_menus_cb(e,t,n,_,i){var o,r=!1;if(t?t.AJAX_error&&"timeout"==t.AJAX_error?(console.log("ext_get_menus_cb: TIMEOUT"),r=e.using_default=!0):t.AJAX_error&&"status"==t.AJAX_error?(console.log("ext_get_menus_cb: status="+t.status),r=e.using_default=!0):isObject(t)?isDefined(t.AJAX_error)&&(console.log("ext_get_menus_cb: AJAX_error"),r=!0):(console.log("ext_get_menus_cb: not array"),r=!0):(console.log("ext_get_menus_cb: freqs="+t),r=!0),r)return e.double_fault?(console.log("ext_get_menus_cb: default freq list fetch FAILED"),void console.log(t)):(console.log(t),o=e.int_url,console.log("ext_get_menus_cb: using default freq list "+o),e.using_default=!0,e.double_fault=!0,void kiwi_ajax(o,n,0,1e4));o=e.ext_url,console.log("ext_get_menus_cb: from "+o),dbgUs&&console.log(t),w3_call(_,i)}function ext_render_menus(_,i,o){isUndefined(o)&&(o=i);var r="";_.n_menu=0,w3_obj_enum(_.freqs,function(e,t,n){r+=(t=t,n=n,e=e,_.n_menu++,_.menus[t]=n,_.menu_s[t]=e,w3_div("id-"+e+" w3-margin-between-24",w3_select_hier(_.sfmt,e,"select",o+".menu"+t,-1,n,i+"_pre_select_cb")))}),w3_innerHTML("id-"+i+"-menus",r),console.log("ext_render_menus n_menu="+_.n_menu)}function ext_panel_init(){w3_el("id-panels-container").innerHTML+='<div id="id-ext-controls" class="class-panel" data-panel-name="ext-controls" data-panel-pos="bottom-left" data-panel-order="0" data-panel-size="'+extint.default_w+","+extint.default_h+'"></div>';w3_el("id-ext-data-container");w3_el("id-ext-controls").innerHTML=w3_div("id-ext-controls-container w3-relative|width:100%;height:100%;")+w3_div("id-ext-controls-vis class-vis")+w3_div("id-ext-controls-help cl-ext-help",w3_button('id-ext-controls-help-btn w3-green w3-small w3-padding-small w3-disabled||onclick="extint_help_click()"',"help")),w3_el("id-kiwi-body").addEventListener("keyup",function(e){"Escape"==e.key&&extint.displayed&&!confirmation.displayed&&1!=w3_call(extint.current_ext_name+"_escape_key_cb")&&(console.log("EXT ESC: no _escape_key_cb() routine, so doing id-ext-controls-close.click()"),w3_el("id-ext-controls-close").click())},!0)}function ext_show_spectrum(){w3_show_block("id-spectrum-container"),extint.spectrum_used=!0}function ext_hide_spectrum(){w3_hide("id-spectrum-container"),extint.spectrum_used=!1}function extint_panel_show(e,t,n,_,i){extint.using_data_container=!!t,extint.using_data_container?(toggle_or_set_spec(toggle_e.SET,0),w3_hide("id-top-container"),w3_show_block(w3_innerHTML("id-ext-data-container",t))):(w3_hide("id-ext-data-container"),spec.source_wf||w3_show_block("id-top-container")),1==extint.help_displayed&&(confirmation_panel_close(),extint.help_displayed=!1);t=w3_el("id-ext-controls-close");t.onclick=function(){toggle_panel("ext-controls"),extint_panel_hide()},ext_set_data_height(),w3_el("id-ext-controls").style.zIndex=150,w3_create_attribute("id-ext-controls-close-img","src","icons/close.24.png"),(t=w3_el("id-ext-controls-container")).innerHTML=e,n&&n(),extint.hide_func=_,(t=w3_el("id-ext-controls")).style.zIndex=150,w3_visible(t,!0),t.panelShown=1,toggle_or_set_hide_panels(0),w3_el("id-confirmation-container").style.height="",i=isDefined(i)?i:w3_call(extint.current_ext_name+"_help",!1),w3_set_props("id-ext-controls-help-btn","w3-disabled",isUndefined(i)||0==i),w3_show_hide("id-ext-controls-help-btn","off"!=i),extint.displayed=!0}function ext_panel_displayed(e){return extint.displayed&&(!e||e==extint.current_ext_name)}function ext_panel_redisplay(e){w3_innerHTML("id-ext-controls-container",e)}function extint_panel_hide(){extint.using_data_container&&(w3_hide("id-ext-data-container"),ext_hide_spectrum(),w3_show_block("id-top-container"),extint.using_data_container=!1,1==extint.help_displayed&&(confirmation_panel_close(),extint.help_displayed=!1)),w3_visible("id-ext-controls",!1),extint_blur_prev(1),w3_call(extint.hide_func),w3_select_value("id-select-ext",-1),resize_waterfall_container(!0),extint.displayed=!1,freqset_select()}function extint_help_click_now(){extint.help_displayed=w3_call(extint.current_ext_name+"_help",!0)}function extint_help_click(e){w3_contains("id-ext-controls-help-btn","w3-disabled")||(console.log(extint.current_ext_name+"_help_click CLICKED"),e?setTimeout(function(){extint_help_click_now()},2e3):extint_help_click_now())}function extint_environment_changed(e){setTimeout(function(){extint.current_ext_name&&w3_call(extint.current_ext_name+"_environment_changed",e),(e.freq||e.mode||e.zoom||e.waterfall_pan||e.resize)&&mouse_freq_remove(),w3_call("injection_environment_changed",e)},100)}var extint_pwd_cb=null,extint_pwd_cb_param=null,extint_conn_type=null;function extint_valpwd_cb(e){extint_pwd_cb&&extint_pwd_cb(e,extint_pwd_cb_param)}function extint_open_ws_cb(){ext_hasCredential("kiwi",null,null),setTimeout(function(){setInterval(function(){ext_send("SET keepalive")},5e3)},5e3)}function extint_connect_server(){return extint.ws=open_websocket("EXT",extint_open_ws_cb,null,extint_msg_cb),extint.ws}function extint_msg_cb(e,t){switch(e[0]){case"keepalive":break;case"ext_client_init":console.log("ext_client_init is_locked="+ +e[1]),extint_focus(+e[1]);break;default:return!1}return!0}function extint_blur_prev(e){null!=extint.current_ext_name&&(w3_call(extint.current_ext_name+"_blur"),recv_websocket(extint.ws,null),e&&ext_set_controls_width_height(),extint.current_ext_name=null,time_display_setup("id-topbar-right-container")),extint.ws&&ext_send("SET ext_blur="+rx_chan)}function extint_focus(e){var t=extint.current_ext_name;if(console.log("extint_focus: loading "+t+".js"),e&&!extint.no_lockout.includes(t))return extint_panel_show(w3_text("w3-medium w3-text-css-yellow","Cannot use extensions while <br> another channel is in DRM mode."),null,null,null,"off"),void ext_set_controls_width_height(300,75);kiwi_load_js_dir("extensions/"+t+"/"+t,[".js",".css"],function(){console.log("extint_focus: calling "+t+"_main()"),ext_set_controls_width_height(),w3_call(t+"_main"),isNonEmptyArray(shortcut.keys)&&setTimeout(keyboard_shortcut_url_keys,3e3)},function(e){console.log("extint_focus: "+t+" loaded="+e),e&&(extint_panel_show("loading extension...",null,null,null,"off"),ext_set_controls_width_height(325,45),kiwi.is_locked&&console.log("==== IS_LOCKED ================================================="))})}var extint_names,extint_first_ext_load=!0;function extint_select(e){extint_blur_prev(0),w3_call(extint.hide_func),freqset_select(),e=+e;var i,o,t=w3_el("id-select-ext");t?(w3_select_value(t,e),i=t.childNodes[e+1].innerHTML.toLowerCase(),console.log("extint_select val="+e+" name="+i),extint_names_enum(function(e,t,n,_){i.startsWith(n.toLowerCase())&&(o=e)}),extint.current_ext_name=extint_names[o],extint_first_ext_load?(extint.ws=extint_connect_server(),extint_first_ext_load=!1):ext_send("SET ext_is_locked_status")):setTimeout(extint_select,1e3,e)}function extint_list_json(e){extint_names=kiwi_JSON_parse("extint_list_json",decodeURIComponent(e))}function extint_names_enum(e){for(var t,n=t=0;n<extint_names.length;n++){var _,i=extint_names[n];!dbgUs&&extint.excl_devl.includes(i)||"sig_gen"==i&&(0!=rx_chan||14<=rx_chans)||(_=(i="wspr"==i?"WSPR":i).toLowerCase(),e(n,t,i,_="wspr"==(_="s_meter"==(_="drm"==(_="cw_decoder"==_?"cw":_)?"DRM":_)?"S_meter":_)?"WSPR":_),t++)}}function extint_select_build_menu(){var i="";return extint_names&&isArray(extint_names)&&extint_names_enum(function(e,t,n,_){_=ext_get_cfg_param(_+".enable");null!=_&&!kiwi.is_local[rx_chan]||(_=!0),"DRM"==n&&(kiwi.DRM_enable=_),"NAVTEX"==n&&(n="NAVTEX/DSC"),i+="<option value="+dq(t)+" kiwi_idx="+dq(e)+" "+(_?"":"disabled")+">"+n+"</option>"}),i}function extint_open(i,o){i=i.toLowerCase();var r=0;extint_names_enum(function(e,t,n,_){_=ext_get_cfg_param(_+".enable");null!=_&&!kiwi.is_local[rx_chan]||(_=!0),!r&&_&&n.toLowerCase().includes(i)&&(o?setTimeout(function(){extint_select(t)},o):extint_select(t),r=1)})}function extint_audio_data(e,t){isFunction(extint_audio_data_cb)&&extint_audio_data_cb(e,t)}



