

/* web/extensions/FT8/FT8.min.js (web/extensions/FT8/FT8.js = Thu Apr  6 19:56:01 2023) */
var ft8={ext_name:"FT8",first_time:!0,callsign:"",grid:"",mode:0,FT8:0,FT4:1,mode_s:["FT8","FT4"],freq_s:{FT8:["1840","3573","5357","7074","10136","14074","18100","21074","24915","28074"],FT4:["3575.5","7047.5","10140","14080","18104","21140","24919","28180"]},PASSBAND_LO:100,PASSBAND_HI:3100,console_status_msg_p:{no_decode:!0,scroll_only_at_bottom:!0,process_return_alone:!1,remove_returns:!0,cols:135,max_lines:1024},log_mins:0,log_interval:null,log_txt:"",autorun_u:["regular use","FT8-160m","FT8-80m","FT8-60m","FT8-40m","FT8-30m","FT8-20m","FT8-17m","FT8-15m","FT8-12m","FT8-10m","FT4-80m","FT4-40m","FT4-30m","FT4-20m","FT4-17m","FT4-15m","FT4-12m","FT4-10m"],PREEMPT_NO:0,PREEMPT_YES:1,preempt_u:["no","yes"],last_last:0};function FT8_main(){ext_switch_to_client(ft8.ext_name,ft8.first_time,ft8_recv),ft8.first_time||ft8_controls_setup(),ft8.first_time=!1}function ft8_recv(t){if("DAT"!=arrayBufferToStringLen(t,3))for(var e=arrayBufferToString(t).substring(4).split(" "),r=0;r<e.length;r++){var i=e[r].split("=");switch(0,i[0]){case"ready":ft8_controls_setup();break;case"chars":ft8_output_chars(i[1]);break;case"debug":dbgUs&&console.log(kiwi_decodeURIComponent("FT8",i[1]));break;default:console.log("ft8_recv: UNKNOWN CMD "+i[0])}}else{var o=new Uint8Array(t,4),t=o[0],o=o.length-1;console.log("ft8_recv: DATA UNKNOWN cmd="+t+" len="+o)}}function ft8_output_chars(t){var r=(t=kiwi_decodeURIComponent("FT8",t)).split("");r.forEach(function(t,e){"<"==t?r[e]=kiwi.esc_lt:">"==t&&(r[e]=kiwi.esc_gt)}),ft8.console_status_msg_p.s=r.join(""),kiwi_output_msg("id-ft8-console-msgs","id-ft8-console-msg",ft8.console_status_msg_p)}function ft8_controls_setup(){ft8.saved_mode=ext_get_mode(),ext_tune(null,"usb",ext_zoom.ABS,11,ft8.PASSBAND_LO,ft8.PASSBAND_HI);var t=time_display_html("ft8")+w3_div("id-ft8-data|left:150px; width:1044px; height:300px; overflow:hidden; position:relative; background-color:mediumBlue;",w3_div("id-ft8-console-msg w3-text-output w3-scroll-down w3-small w3-text-black|width:1024px; height:300px; position:absolute; overflow-x:hidden;",w3_code("id-ft8-console-msgs w3-text-output-striped/"))),e=ext_get_cfg_param_string("ft8.callsign")||"";""==(ft8.callsign=e)&&(e="(not set)");var r=ext_get_cfg_param_string("ft8.grid")||"";""==(ft8.grid=r)&&(r="(not set)");var i="https://pskreporter.info/pskmap.html?preset"+(""!=ft8.callsign?"&callsign="+ft8.callsign:"")+"&txrx=rx&mode=FT8&timerange=86400&blankifnone=1&hidepink=1&hidelight=1&showlines=1&mapCenter=35,13,2",r=w3_div("id-ft8-controls w3-text-white",w3_divs("",w3_col_percent("w3-valign/",w3_div("",w3_div("w3-medium w3-text-aqua","<b>FT8/FT4 decoder</b>")),40,w3_div("",'From <b><a href="https://github.com/kgoba/ft8_lib/tree/update_to_0_2" target="_blank">ft8_lib</a></b> Karlis Goba &copy; 2018'),45),w3_div("id-ft8-err w3-margin-T-10 w3-padding-small w3-css-yellow w3-width-fit w3-hide"),w3_inline("id-ft8-container w3-margin-T-6/w3-margin-between-16",w3_div("",w3_inline("/w3-margin-between-16",w3_select_hier("id-ft8-freq w3-text-red w3-width-auto","","freq","ft8.freq_idx",-1,ft8.freq_s,"ft8_freq_cb"),w3_select("w3-text-red","","mode","ft8.mode",ft8.FT8,ft8.mode_s,"ft8_mode_cb")),w3_div("w3-margin-T-4",w3_link("w3-bold",i,"pskreporter.info"))),w3_div("cl-ft8-text","reporter call "+e),w3_div("cl-ft8-text","reporter grid "+r),w3_button("w3-padding-smaller w3-css-yellow","Clear","ft8_clear_button_cb"),dbgUs?w3_button("w3-padding-smaller w3-aqua","Test","ft8_test_cb"):"")));ext_panel_show(r,t,null),time_display_setup("ft8"),ext_set_data_height(300),ext_set_controls_width_height(525,90),ft8_clear_button_cb(),12e3!=ext_nom_sample_rate()?(w3_hide2("id-ft8-container",!0),w3_hide2("id-ft8-err",!1),w3_innerHTML("id-ft8-err","FT8 extension only works on Kiwis configured for 12 kHz wide channels")):ext_send("SET ft8_start="+ft8.FT8),ft8.url_params=ext_param();var o,n,a,t=ft8.url_params;t&&(t=t.split(","),o=0,t.forEach(function(t,e){w3_ext_param("test",t).match&&(o=1),w3_ext_param("help",t).match&&extint_help_click()}),n=!1,a=parseFloat(ft8.url_params),isNaN(a)||w3_select_enum("id-ft8-freq",function(t){n||parseFloat(t.innerHTML)!=a||(ft8_freq_cb("id-ft8-freq",t.value,!1),n=!0)}),dbgUs&&o&&ft8_test_cb())}function ft8_freq_cb(t,e,r){var i;r||(e=+e,r=+(i=w3_select_get_value("id-ft8-freq",e)).option,ext_tune(r,"usb",ext_zoom.ABS,11),i=i.last_disabled,w3_select_value(t,e),console.log("ft8_freq_cb: path="+t+" idx="+e+" freq="+r+" mode="+i),i!=ft8.mode_s[ft8.mode]&&(ft8.mode^=1,ft8_mode_cb("ft8.mode",ft8.mode),console.log("ft8_freq_cb: changing mode to "+ft8.mode)))}function ft8_mode_cb(t,e,r){r||(console.log("ft8_mode_cb: idx="+e),e=+e,w3_set_value(t,e),ft8.mode=e?ft8.FT4:ft8.FT8,ext_send("SET ft8_protocol="+ft8.mode),console.log("ft8_mode_cb: changing mode to "+ft8.mode))}function ft8_clear_button_cb(t,e,r){r||(ft8.console_status_msg_p.s="\f",kiwi_output_msg("id-ft8-console-msgs","id-ft8-console-msg",ft8.console_status_msg_p),ft8.log_txt="")}function ft8_test_cb(){ext_send("SET ft8_test")}function FT8_config_html(){var t=w3_div("w3-show-inline-block w3-width-full",w3_col_percent("w3-container/w3-margin-bottom",w3_input_get("w3-restart","Reporter callsign","ft8.callsign","w3_string_set_cfg_cb",""),22,"",3,w3_input_get("w3-restart","Reporter grid square","ft8.grid","w3_string_set_cfg_cb","","6-character grid square location"),22,"",3,w3_input_get("","SNR correction","ft8.SNR_adj","w3_num_set_cfg_cb",""),22,"",3,w3_input_get("","dT correction","ft8.dT_adj","w3_num_set_cfg_cb",""),22),"<hr>",w3_div("w3-container",w3_div("","<b>Autorun</b>"),w3_div("w3-container",w3_div("w3-text-black",'On startup automatically begins running the FT8 decoder on the selected band(s).<br>Channels available for regular use are reduced by one for each FT8 autorun enabled.<br>If Kiwi has been configured for a mix of channels with and without waterfalls then channels without waterfalls will be used first.<br><br>Spot decodes are available in the Kiwi log (use "Log" tab above) and are listed on <a href="https://pskreporter.info/pskmap.html" target="_blank">pskreporter.info</a><br>The "Reporter" fields above must be set to valid values for proper spot entry into the <a href="https://pskreporter.info/pskmap.html" target="_blank">pskreporter.info</a> database.'),w3_div("w3-margin-T-10 w3-valign",'<header class="id-ft8-warn-full w3-container w3-yellow"><h6>If your Kiwi is publicly listed you must <b>not</b> configure all the channels to use FT8-autorun!<br>This defeats the purpose of making your Kiwi public and public registration will be disabled<br>until you make at least one channel available for connection. Check the Admin Public tab.</h6></header>'),w3_button("id-ft8-restart w3-margin-T-16 w3-aqua w3-hide","autorun restart","ft8_autorun_restart_cb"),w3_div("id-ft8-admin-autorun w3-margin-T-16"))));ext_config_html(ft8,"ft8","FT8","FT8/FT4 configuration",t);for(var t="",e=0;e<rx_chans;){for(var r="",i=0;i<8&&e<rx_chans;i++,e++)r+=w3_div("",w3_select_get_param("w3-margin-right","Autorun "+e,"FT8 band","ft8.autorun"+e,ft8.autorun_u,"ft8_autorun_select_cb"),w3_select_get_param("w3-margin-right w3-margin-T-8","","preemptible?","ft8.preempt"+e,ft8.preempt_u,"ft8_autorun_select_cb"));t+=w3_inline("w3-margin-bottom/",r)}w3_innerHTML("id-ft8-admin-autorun",t)}function ft8_autorun_public_check(){for(var t=0,e=0;e<rx_chans;e++)0!=cfg.ft8["autorun"+e]&&cfg.ft8["preempt"+e]==ft8.PREEMPT_NO&&t++;ext_set_cfg_param("ft8.autorun",t,EXT_SAVE);var r=adm.kiwisdr_com_register&&t>=rx_chans;w3_remove_then_add_cond("id-ft8-warn-full",r,"w3-red","w3-yellow"),r&&kiwisdr_com_register_cb("adm.kiwisdr_com_register",w3_SWITCH_NO_IDX)}function ft8_autorun_restart_cb(){ft8_autorun_public_check(),w3_hide("id-ft8-restart"),ext_send("ADM ft8_autorun_restart")}function ft8_autorun_select_cb(t,e,r){admin_select_cb(t,e,r),r||(w3_show("id-ft8-restart"),r=w3_el("id-kiwi-container"),w3_scrollDown(r))}function FT8_config_focus(){ft8_autorun_public_check()}function FT8_blur(){ext_set_data_height(),ext_set_mode(ft8.saved_mode),ext_send("SET ft8_close"),kiwi_clearInterval(ft8.log_interval)}function FT8_help(t){return t&&(t=w3_text("w3-medium w3-bold w3-text-aqua","FT8/FT4 decoder help")+"<br>Spots are uploaded to pskreporter.info if the <i>reporter call</i> and <i>reporter grid</i> fields on the admin page, extensions tab, FT8 subtab have valid entries. Leave the callsign field blank if you do not want any uploads to pskreporter.info But consider leaving the grid field set so the km distance from the Kiwi to the spot will be shown.<br><br>Uploaded spots are highlighted in green. Spots are only uploaded once every 60 minutes. The <i>age</i> column shows, in minutes, how long it has been since the last upload. <br>SNR information is currently not uploaded as it is not accurate.<br><br>Clicking the <i>pskreporter.info</i> link will take you directly to the map with the reporter callsign of the Kiwi preset.<br><br>URL parameters:<br>The first parameters can select one of the entries in the <i>freq</i> menu<br>e.g. <i>my_kiwi:8073/?ext=ft8,10136</i>",confirmation_show_content(t,610,300)),!0}



