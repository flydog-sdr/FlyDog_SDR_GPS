

/* web/extensions/prefs/prefs.min.js (web/extensions/prefs/prefs.js = Sun Sep 10 17:48:58 2023) */
var prefs={ext_name:'prefs',first_time:true,CMD1:0,id:'_no_user_',pobj:null,default:{p:'default-p'},status_anim:false,status_timeout:-1,};function prefs_main(){ext_switch_to_client(prefs.ext_name,prefs.first_time,prefs_recv);if(!prefs.first_time)
prefs_controls_setup();prefs.first_time=false;}
function prefs_recv(data){var firstChars=arrayBufferToStringLen(data,3);if(firstChars=="DAT"){var ba=new Uint8Array(data,4);var cmd=ba[0];if(cmd==prefs.CMD1){}else{console.log('prefs_recv: DATA UNKNOWN cmd='+cmd+' len='+(ba.length-1));}
return;}
var stringData=arrayBufferToString(data);var params=stringData.substring(4).split(" ");for(var i=0;i<params.length;i++){var param=params[i].split("=");if(1&&param[0]!="keepalive"){if(isDefined(param[1]))
console.log('prefs_recv: '+param[0]+'='+param[1]);else
console.log('prefs_recv: '+param[0]);}
switch(param[0]){case"ready":prefs_controls_setup();break;default:console.log('prefs_recv: UNKNOWN CMD '+param[0]);break;}}}
function prefs_controls_setup(){window.onstorage=function(e){console.log('Key Changed: '+e.key);console.log('New Value: '+e.newValue);};var controls_html=w3_divs('w3-text-css-yellow/w3-tspace-16',w3_div('w3-medium w3-text-aqua','<b>User preferences</b>'),w3_div('id-prefs-container'),w3_div('w3-show-inline-block w3-hspace-16',w3_div('id-prefs-buttons w3-hide',w3_button('w3-margin-R-16','Export','prefs_export_btn_cb'),w3_button('w3-margin-R-16','Import','prefs_import_btn_cb')),'<b>Status:</b> '+
w3_div('id-prefs-status w3-show-inline-block w3-snap-back')));ext_panel_show(controls_html);ext_set_controls_width_height(768,250);prefs_status('yellow','waiting for local storage..');prefs_load(function(){w3_innerHTML('id-prefs-container',w3_col_percent('',w3_input('','Prefs','prefs.pobj.p',prefs.pobj.p,'prefs_p_cb','something'),30));w3_show('id-prefs-buttons');});}
function prefs_p_cb(path,val){w3_string_cb(path,val);prefs_save();}
function prefs_refresh_ui(){w3_set_value('prefs.pobj.p',prefs.pobj.p);}
function prefs_status(color,msg){var el=w3_el('id-prefs-status');if(prefs.status_anim){kiwi_clearTimeout(prefs.status_timeout);w3_remove_then_add(el,'w3-fade-out','w3-snap-back');setTimeout(function(){prefs.status_anim=false;prefs_status(color,msg);},1000);return;}
el.style.color=color;el.innerHTML=msg;w3_remove_then_add(el,'w3-snap-back','w3-fade-out');prefs.status_anim=true;prefs.status_timeout=setTimeout(function(){el.innerHTML='';w3_remove_then_add(el,'w3-fade-out','w3-snap-back');prefs.status_anim=false;},1500);}
function prefs_export_btn_cb(path,val){console.log('prefs_export_btn_cb');prefs_save(function(){console.log('msg_send pref_export');msg_send('SET pref_export id='+encodeURIComponent(prefs.id)+' pref='+encodeURIComponent(JSON.stringify(prefs.pobj)));});prefs_status('lime','preferences exported');}
function prefs_import_btn_cb(path,val){console.log('prefs_import_btn_cb');var id=ident_user?ident_user:'_no_user_';msg_send('SET pref_import id='+encodeURIComponent(id));}
function prefs_import_cb(p,ch){var s=decodeURIComponent(p);console.log('prefs_import_cb '+s);if(s=='null'){prefs_status('yellow','no preferences previously exported');return;}else{var obj=kiwi_JSON_parse('prefs_import_cb',s);if(obj){prefs.pobj=obj;console.log(obj);prefs_save();prefs_refresh_ui();prefs_status('lime','preferences successfully imported from RX'+ch);}}}
function prefs_check(){var id=ident_user?ident_user:'_no_user_';xdLocalStorageHA.getItem('prefs.'+id,function(d){if(d.value){var obj=kiwi_JSON_parse('prefs_check',d.value);if(obj){if(prefs.pobj.p!=obj.p){console.log('--> prefs_check '+d.value);kiwi_debug('prefs_check '+d.value);}}}});setTimeout(prefs_check,1000);}
function prefs_load(cb){if(kiwi.xdLocalStorage_ready){var id=ident_user?ident_user:'_no_user_';xdLocalStorageHA.getItem('prefs.'+id,function(d){console.log('prefs_load key=prefs.'+id);kiwi_debug('prefs_load '+JSON.stringify(d));console.log(d);if(d.value==null){prefs.pobj=prefs.default;}else{var obj=kiwi_JSON_parse('prefs_load',d.value);if(obj){prefs.pobj=obj;kiwi_debug('prefs_load '+d.value);}}
console.log(prefs.pobj);if(cb)cb();});setTimeout(prefs_check,1000);}else{setTimeout(prefs_load,250,cb);}}
function prefs_save(cb){var id=ident_user?ident_user:'_no_user_';prefs.id=id;var val=JSON.stringify(prefs.pobj);xdLocalStorageHA.setItem('prefs.'+id,val,function(){console.log('prefs_save key=prefs.'+id);console.log(val);if(cb)cb();});}
function prefs_focus(){console.log('prefs_focus');}
function prefs_blur(){console.log('prefs_blur');}
function prefs_help(show){if(show){var s=w3_text('w3-medium w3-bold w3-text-aqua','User preferences help')+
w3_div('w3-margin-T-8 w3-scroll-y|height:90%',w3_div('w3-margin-R-8','...'));confirmation_show_content(s,610,350);w3_el('id-confirmation-container').style.height='100%';}
return true;}
function prefs_config_html(){ext_config_html(prefs,'prefs','Prefs','User preferences configuration');}



