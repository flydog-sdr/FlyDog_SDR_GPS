function FSK_async(t,s){var e=this;switch(e.framing=t,e.start_bit=1,e.data_bits=+t.substr(0,1),e.stop_variable=0,e.raw=0,t.endsWith("0V")?(e.stop_bits=0,e.stop_variable=1):t.endsWith("1V")?(e.stop_bits=1,e.stop_variable=1):t.endsWith("1.5")?e.stop_bits=1.5:t.endsWith("2")?e.stop_bits=2:e.stop_bits=1,t.includes("E")?(e.parity_bits=1,e.parity_even=1):t.includes("O")?(e.parity_bits=1,e.parity_odd=1):t.includes("P")?(e.parity_bits=1,e.parity_ignore=1):e.parity_bits=0,t.includes("EFR")?(e.EFR=1,"EFR2"==t&&(e.EFR2=1),e.EFR2&&fsk_output_char("EFR2 mode displays only uncommon telegrams\n"),e.ERF2_test=0,e.EFR_hdr_found=0,e.EFR_ch=[],e.data_bits=8,e.parity_bits=1,e.parity_ignore=1,e.stop_bits=1,e.stop_variable=1):(e.EFR=0,e.EFR2=0),"CHU"==t&&(e.CHU=1,e.CHU_ch=[],e.CHU_cn=[],e.data_bits=8,e.parity_bits=0,e.stop_bits=2,e.raw=1),"T600"==t&&(e.data_bits=7,e.parity_bits=0,e.stop_bits=1,fsk_output_char("T600 (aka CIS/BEE 36-50) not supported yet\n")),e.nbits=e.start_bit+e.data_bits+e.parity_bits+e.stop_bits,1.5==e.stop_bits&&(e.nbits*=2),e.msb=1<<e.nbits-1,e.data_msb=1<<e.data_bits-1,console.log("FSK_async data_bits="+e.data_bits+" parity_bits="+e.parity_bits+" stop_bits="+e.stop_bits+" nbits="+e.nbits+" data_msb=0x"+e.data_msb.toString(16)+" msb=0x"+e.msb.toString(16)+" enc="+s),e.ITA2=e.ASCII=0,s){case"ITA2":default:e.ITA2=1,e.LETTERS=31,e.FIGURES=27;break;case"ASCII":e.ASCII=1,e.LETTERS=-1,e.FIGURES=-1}e.last_code=0,e.code_ltrs=[],e.ltrs_code=[],e.code_figs=[],e.figs_code=[],e.shift=!1;var i=LTR="_";e.ltrs=["\0","E","\n","A"," ","S","I","U","\r","D","R","J","N","F","C","K","T","Z","L","W","H","Y","P","Q","O","B","G",i,"M","X","V",LTR],e.figs=["\0","3","\n","-"," ","","8","7","\r","$","4","'",",","!",":","(","5",'"',")","2","#","6","0","1","9","?","&",i,".","/",";",LTR];for(var r=0;r<32;r++){var a=e.ltrs[r];"_"!=a&&(e.code_ltrs[r]=a,e.ltrs_code[a]=r);var _=e.figs[r];"_"!=_&&(e.code_figs[r]=_,e.figs_code[_]=r)}}FSK_async.prototype.reset=function(){this.shift=!1},FSK_async.prototype.get_shift=function(){return this.shift},FSK_async.prototype.get_nbits=function(){return this.nbits},FSK_async.prototype.get_msb=function(){return this.msb},FSK_async.prototype.check_valid=function(t){return this.ITA2?t>=0&&t<32:t>=0&&t<=127},FSK_async.prototype.code_to_char=function(t,s,e){var i,r=this;if(r.ITA2)null==(i=s?r.code_figs[t]:r.code_ltrs[t])&&(i=-t);else if(r.EFR)if(i="",0==r.EFR_hdr_found)r.EFR_ch.push(t),r.EFR_ch.length>4&&r.EFR_ch.shift(),104==(F=r.EFR_ch)[0]&&F[1]==F[2]&&104==F[3]&&(r.EFR_hdr_found=1);else{r.EFR_ch.push(t);var a=(F=r.EFR_ch)[1],_=a+6;if(F.length==_){if(22==F[_-1])if(10==a&&7==(15&F[4])&&0==F[5]&&0==F[6]&&127!=(127&F[13])){if(!r.EFR2){var o=(F[8]>>2).leadingZeros(2),n=(63&F[9]).leadingZeros(2),c=(31&F[10]).leadingZeros(2),d=128&F[10],b=31&F[11],f=F[11]>>5,h=15&F[12],p=127&F[13];i=c+":"+n+":"+o+(d?" DST ":" ST ")+["Mon","Tue","Wed","Thu","Fri","Sat","Sun"][f-1]+" "+b+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][h-1]+" 20"+p,i+="\n"}}else{var l=19==a&&0==(15&F[4])&&32==F[5];if(!r.EFR2||!l||r.ERF2_test){if(r.EFR2)i=(g=new Date).toUTCString().substr(5,20)+" ",r.ERF2_test=0;i+="len="+a.toHex(-2)+" ",i+="C="+F[4].toHex(-2)+" ",i+="A="+F[5].toHex(-2)+" ",i+="CI="+F[6].toHex(-2)+" [";for(var u=7;u<F.length-2;u++)i+=F[u].toHex(-2)+(u==F.length-3?"] ":" ");i+="ck="+F[F.length-2].toHex(-2)+" ",i+="|";for(u=7;u<F.length-2;u++)i+=F[u]>=32&&F[u]<127?String.fromCharCode(F[u]):".";i+="|\n"}}r.EFR_ch=[],r.EFR_hdr_found=0}}else if(r.CHU){if(i="",e&&(r.CHU_ch=[],r.CHU_cn=[]),t=(15&t)<<4&240|(240&t)>>>4&15,r.CHU_ch.push(t),r.CHU_cn.push(255^t),10==r.CHU_ch.length){var F,y=240&(F=r.CHU_ch)[0],E=240&F[5],R=240&F[4],S=240&F[9];if(96==y&&48==R&&96==E&&48==S&&F[0]==F[5]&&F[1]==F[6]&&F[2]==F[7]&&F[3]==F[8]&&F[4]==F[9]){var g=new Date;i="CHU "+F[2].toHex(-2)+":"+F[3].toHex(-2)+":"+F[4].toHex(-2)+" UTC (browser "+g.toUTCString().substr(17,8)+")\n"}else{var C=r.CHU_cn;if(F[0]==C[5]&&F[1]==C[6]&&F[2]==C[7]&&F[3]==C[8]&&F[4]==C[9]){var H=F[1].toHex(-2)+F[2].toHex(-2),T=F[3].toHex(-1);i="CHU year="+H+" DST="+(d=F[4].toHex(-1))+" TAI-UTC="+T+"\n"}}}}else i=t>=0&&t<=9||t>=11&&t<=12||t>=14&&t<=31||t>=127?"â˜’":String.fromCharCode(t);return i},FSK_async.prototype.get_code=function(){return this.last_code},FSK_async.prototype.check_bits=function(t){var s=this;switch(s.stop_bits){case 1.5:if(0!=(3&t))return!1;t>>=2,s.last_code=0;for(var e=0;e<s.data_bits;e++){var i=3&t;if(0!=i&&3!=i)return!1;s.last_code=s.last_code>>1|(i?s.data_msb:0),t>>=2}if(7!=(7&t))return!1;if(0!=(t>>=3))return!1;break;default:if(!s.raw&&0!=(1&t))return!1;t>>=1,s.last_code=0;for(e=0;e<s.data_bits;e++)s.last_code=s.last_code>>1|(1&t?s.data_msb:0),t>>=1;if(1==s.parity_bits&&(t>>=1),2==s.stop_bits){if(!s.raw&&3!=(3&t))return!1;t>>=2}else if(1==s.stop_bits){if(!s.raw&&1!=(1&t))return!1;t>>=1}if(!s.raw&&0!=t)return!1}return!0},FSK_async.prototype.process_char=function(t,s,e){var i=this,r=i.check_bits(t),a=0;if(r)if(a=1,i.ITA2)switch(i.last_code){case i.LETTERS:i.shift=!1;break;case i.FIGURES:i.shift=!0;break;default:var _=i.code_to_char(i.last_code,i.shift);_<0?console.log("FSK_async missed this code: 0x"+Math.abs(_).toString(16)):e(_)}else e(i.code_to_char(i.last_code,!1,s));else a=-1;return{success:r,tally:a}};