

/* web/extensions/FSK/Selcall.min.js (web/extensions/FSK/Selcall.js = Mon Jun 20 11:27:28 2022) */
function Selcall(e,s){var r=this;console.log("FSK encoder: Selcall"),r.dbg=0,r.dump_always=1,r.dump_non_std_len=1,r.dump_no_eos=0,r.zoom=10,r.start_bit=0,r.seq=0,r.pkt=0,r.MSG_LEN_MIN=30,r.MSG_LEN_MAX=80,r.synced=0,r.sym_s=["   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","RTN","   ","   ","   ","Pr0","Pr1","Pr2","Pr3","Pr4","Pr5","   ","   ","   ","   ","   ","   ","   ","ARQ","   ","   ","SEL","   ","ABQ","SMA","   ","Pdx","  *","EOS"],r.DX=125,r.RX5=109,r.FMT_GEO_CALL=102,r.FMT_DISTRESS=112,r.FMT_GROUP_CALL=114,r.FMT_ALL_STATIONS=116,r.FMT_INDIV_CALL=120,r.FMT_RESV=121,r.FMT_INDIV_SEMI_AUTO=123,r.CAT_ROUTINE=100,r.CAT_SHIPS_BUSINESS=106,r.CAT_SAFETY=108,r.CAT_URGENCY=110,r.CAT_DISTRESS=112,r.CMD1_102=102,r.CMD1_POSITION=121,r.CMD1_FM_CALL=100,r.CMD1_FM_DUPLEX_CALL=101,r.CMD1_POLLING=103,r.CMD1_UNABLE_COMPLY=104,r.CMD1_END_OF_CALL=105,r.CMD1_F1B_DATA=106,r.CMD1_J3E_RT=109,r.CMD1_DISTRESS_ACK=110,r.CMD1_DISTRESS_ALERT_RELAY=112,r.CMD1_F1B_FEC=113,r.CMD1_F1B_ARQ=115,r.CMD1_TEST=118,r.CMD1_NOP=126,r.CMD2_100=100,r.CMD2_110=110,r.CMD2_UNABLE_FIRST=100,r.CMD2_BUSY=102,r.CMD2_UNABLE_LAST=109,r.CMD2_NON_CONFLICT=110,r.CMD2_MED_TRANSPORTS=111,r.CMD2_NOP=126,r.ARQ=117,r.ABQ=122,r.EOS=127,r.NOP=126,r.pos_s=["dx","rx5","dx","rx4","dx","rx3","dx","rx2","dx","rx1","dx","rx0","fmt","fmt","B1","fmt","B2","fmt","cat","B1","A1","B2","A2","cat","eos","A1","eos","A2","eos","eos"],r.pos={},r.pos_n={},r.pos_s.forEach(function(e,s){e=e.trim(),isDefined(r.pos_n[e])||(r.pos_n[e]=0),r.pos[e+"-"+r.pos_n[e].toString()]=s,r.pos_n[e]++}),r.dbg&&console.log(r.pos);function n(e){return e=kiwi_bitCount(127^e),kiwi_bitReverse(e,3)}r.DX_w=n(r.DX)<<7|r.DX,r.svec=[];for(var _=r.RX5,t=0;t<12;t++)r.svec[t]=1&t?n(_)<<7|_:r.DX_w,1&t&&_--;r.dbg&&console.log(r.svec)}Selcall.prototype.sym_by_sym_name=function(e){e=this.pos[e];return{pos:e,sym:this.syms[e]}},Selcall.prototype.output_msg=function(e){return(new Date).toUTCString().substr(17,8)+" "+(ext_get_freq()/1e3).toFixed(2)+" "+e+"\n"},Selcall.prototype.code_to_char=function(e){return e<0||127<e?"???":this.sym_s[e]},Selcall.prototype.reset=function(){var e=this;e.syncA=e.syncB=e.syncC=e.syncD=e.syncE=0},Selcall.prototype.get_nbits=function(){return 10},Selcall.prototype.get_msb=function(){return 512},Selcall.prototype.check_bits=function(){return!1},Selcall.prototype.search_sync=function(e){var s=this,r=e,e=1&s.syncA;s.syncA=s.syncA>>1&1023,s.syncA|=r?512:0,r=e,e=1&s.syncB,s.syncB=s.syncB>>1&1023,s.syncB|=r?512:0,r=e,e=1&s.syncC,s.syncC=s.syncC>>1&1023,s.syncC|=r?512:0,r=e,e=1&s.syncD,s.syncD=s.syncD>>1&1023,s.syncD|=r?512:0,r=e,e=1&s.syncE,s.syncE=s.syncE>>1&1023,s.syncE|=r?512:0;for(var n=0;n<=9;n++)if(s.syncC==s.svec[n]&&s.syncB==s.svec[n+1]&&s.syncA==s.svec[n+2])return console.log("SYNC-DRD-"+n),s.seq=n+3,s.full_syms=[],s.syms=[],s.bc_err=[],s.parity_errors=0,s.FEC_errors=0,s.synced=1,!0;for(n=1;n<=7;n+=2)if(s.syncE==s.svec[n]&&s.syncC==s.svec[n+2]&&s.syncA==s.svec[n+4])return console.log("SYNC-RRR-"+n),s.seq=n+5,s.full_syms=[],s.syms=[],s.bc_err=[],s.parity_errors=0,s.FEC_errors=0,s.synced=1,!0;return s.synced=0,!1},Selcall.prototype.process_char=function(e,s,r,n,_){var t=this;if(!t.synced)return{resync:0};12==t.seq&&t.pkt++;var o=(t.full_syms[t.seq]=e)>>7&7,c=127&e;t.syms[t.seq]=c,g=(g=t.pos_s[t.seq])||"unk";var i=t.code_to_char(c),a=(b=(T=kiwi_bitReverse(o,3))!=(E=kiwi_bitCount(127^c)))?" Zck="+T+" Zdata="+E:"";(t.bc_err[t.seq]=b)&&t.parity_errors++,t.dbg&&console.log(t.seq.leadingZeros(2)+" "+g.fieldWidth(6)+": "+i+" "+c.fieldWidth(3)+". "+o.toString(2).leadingZeros(3)+" "+c.toString(2).leadingZeros(7)+a),t.seq++;T=!1;if(t.seq>=t.MSG_LEN_MIN){function l(e,s){return"https://www.marinetraffic.com/en/ais/home/centerx:"+s+"/centery:"+e+"/zoom:"+t.zoom}function y(e){var s={code:127&t.full_syms[e],fec_err:!1};if(t.bc_err[e]){if(e+5<t.seq&&!t.bc_err[e+5])return s.code=127&t.full_syms[e+5],s;s.code=-1,s.fec_err=!0}return s}E=function(e){var s=0;return t.bc_err[t.seq-1]||t.syms[t.seq-1]!=e||s++,t.bc_err[t.seq-2]||t.syms[t.seq-2]!=e||s++,t.bc_err[t.seq-4]||t.syms[t.seq-4]!=e||s++,t.bc_err[t.seq-6]||t.syms[t.seq-6]!=e||s++,3<=s&&console.log("eos_n("+e+")="+s),3<=s},i=function(e,s){return e+s+ansi.NORM},o=function(e,s,r){return w3_link("w3-esc-html w3-link-darker-color",l(s,r),e)};if((T=E(t.EOS)||E(t.ARQ)||E(t.ABQ)?!0:T)||t.seq>t.MSG_LEN_MAX){a=t.dump_always;if(T?t.seq!=t.MSG_LEN_MIN&&(console.log("$$ non-std len="+t.seq),a|=t.dump_non_std_len):(b=t.parity_errors?" "+i(ansi.BLUE,t.parity_errors+" PE"):"",console.log("$$ no EOS pe="+t.parity_errors),a|=t.dump_no_eos),a){var u,S,A,C=!1,d=-1,f=0,p=[],D=ext_get_freq()/1e3,M=(new Date).toUTCString().substr(17,8)+" "+D.toFixed(2)+" ",E=y(12).code,m=!1;"NAVTEX"==ext_get_name()&&(I=getVarFromString("nt.freqs.Selcall.Austravel_net"),isArray(I)&&I.forEach(function(e,s){m||Math.abs(D-parseInt(e))<1&&(m=!0)}));for(var T=function(e,s){if(!m)return s;var r="";switch(e){case"2199":r="(Austravel Casino NSW)";break;case"3199":r="(Austravel Shepparton VIC)";break;case"4199":r="(Austravel Mareeba North QLD)";break;case"5199":r="(Austravel Base SA)";break;case"6199":r="(Austravel Perth WA)";break;case"6299":r="(Austravel Kununnura WA)";break;case"8199":r="(Austravel Alice Springs NT)"}return w3_sb(s,r)},N=0;N<t.seq;N++){var g,L,v,e=t.full_syms[N],c=127&(e=isUndefined(e)?119:e);g=(g=t.pos_s[N])||"unk",1&N||N<12||(c=(L=y(N)).code,L.fec_err&&(C=!0),14==N&&(99<y(18).code?(p.push("  "),M+="__ "):y(20).code),20==N&&(S=y(24).code,A=y(26).code,99<S?(p.push("  "),M+="__ "):(S=y(28).code,A=y(30).code)),L.fec_err?(M+="X ",v="0"):(f!=(v=c<=99?c.leadingZeros(2):c.toString()).length&&(d=(d+1)%ansi.rolling_n,u=ansi[ansi.rolling[d]],f=v.length),M+=u+v+ansi.NORM+" "),p.push(v))}var b=null;if(C)M+=i(ansi.RED,"FEC");else{var h,a=E==t.FMT_INDIV_CALL||E==t.FMT_INDIV_SEMI_AUTO;if(a&&(O=+p[1]?(F=p[1]+p[2]+p[3],i(ansi.CYAN,F)):(F=p[2]+p[3],i(ansi.CYAN,"__"+F)),R=+p[5]?(h=p[5]+p[6]+p[7],i(ansi.YELLOW,h)):(h=p[6]+p[7],i(ansi.YELLOW,"__"+h)),b=T(h,R)+" calling "+T(F,O)),a&&S==t.CMD1_POSITION&&A==t.CMD2_110&&48<=t.seq&&t.seq<=56){for(var q="",N=0;N<=6;N++)q+=p[N+10];var I=q.slice(1,3),E=q.slice(5,8),R=q.slice(3,5),T=q.slice(8,10),F=I+"."+R,O=E+"."+T;b+=", position "+o("["+F+","+O+"]",+F,+O);a=!1,F=+R,O=+T;60<=F&&(F=59,a=!0),60<=O&&(O=59,a=!0);R=I+"°"+R+"'",T=E+"°"+T+"'",F=I+(F/60).toFixed(2).slice(1),O=E+(O/60).toFixed(2).slice(1);b+=" "+o("["+R+","+T+"]",+F,+O),b+=" "+q.slice(10,12)+":"+q.slice(12,14);var T=!1;(T="NAVTEX"==ext_get_name()?navtex_location_update(h,+F,+O,l(+F,+O),a?["white","red"]:["white",D<7500?"magenta":"blue"]):T)&&(b+=" "+i(ansi.YELLOW,"(dupe)"))}b=b&&(new Date).toUTCString().substr(17,8)+" "+D.toFixed(2)+" "+b}console.log("fec_errors="+C+" show_errs="+_+" seq="+t.seq),!C&&b&&r(b+"\n"),(!C&&(!b||n)||C&&_)&&r(M+"\n")}return t.synced=0,{resync:1}}}return{resync:0}};



