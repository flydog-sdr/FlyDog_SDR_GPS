

/* web/extensions/FSK/FSK.min.js (web/extensions/FSK/FSK.js = Fri Jun 17 18:13:49 2022) */
var fsk={ext_name:"FSK",first_time:!0,dataH:300,ctrlW:575,ctrlH:200,lhs:150,tw:1024,x:0,last_y:[],freqs:null,menu_s:[],menus:[],sfmt:"w3-text-red w3-ext-retain-input-focus",header:null,menu_sel:"",test_mode:!1,auto_zoom:1,freq:0,cf:1e3,shift:170,shift_i:1,SHIFT_CUSTOM_IDX:9,shift_cval:0,shift_custom:!1,baud:50,baud_i:2,BAUD_CUSTOM_IDX:8,baud_cval:0,baud_custom:!1,baud_mult:1,framing:"5N1.5",inverted:1,encoding:"ITA2",MODE_DECODE:0,MODE_SCOPE:1,MODE_FRAMING:2,scope:0,run:0,single:0,decim:8,show_framing:0,fr_sample:0,fr_bits:[],fr_bpw_i:0,fr_bpw:5,fr_phase:0,fr_bpd_i:0,fr_bpd:0,fr_shift:!1,fr_w:6,fr_h:6,fr_s:2,sample_count:0,edge:0,CHU_offset:2.125,log_mins:0,log_interval:null,log_txt:"",last_last:0};function FSK_main(){ext_switch_to_client(fsk.ext_name,fsk.first_time,fsk_recv),fsk.first_time||fsk_controls_setup(),fsk.first_time=!1}function fsk_recv(s){if("DAT"!=arrayBufferToStringLen(s,3))for(var f=arrayBufferToString(s).substring(4).split(" "),e=0;e<f.length;e++){var _=f[e].split("=");switch(0,_[0]){case"ready":kiwi_load_js_dir("extensions/FSK/",["JNX.js","BiQuadraticFilter.js","CCIR476.js","DSC.js","Selcall.js","FSK_async.js"],"fsk_controls_setup");break;case"test_done":break;default:console.log("fsk_recv: UNKNOWN CMD "+_[0])}}else{var t=new Uint8Array(s,4),s=t[0],t=t.length-1;console.log("fsk_recv: DATA UNKNOWN cmd="+s+" len="+t)}}function fsk_scope_reset_display(){var s=fsk.canvas.ctx;s.fillStyle="black",s.fillRect(fsk.lhs,0,fsk.tw,fsk.th)}function fsk_scope(s,f,e){var _,t,i,n;fsk.scope&&fsk.run&&(fsk.sample_count++,fsk.edge|=f,0==(fsk.sample_count&fsk.decim-1)&&(i=fsk.canvas,_=fsk.canvas.ctx,t=i.width,f=i.height,i=fsk.lhs+fsk.x,fsk.edge?(_.fillStyle="red",_.fillRect(i,0,1,3*f/4),i-8>fsk.lhs&&(_.fillStyle="white",_.font="8px Courier",_.fillText(e,i-8,3*f/4+10))):(n=fsk.last_y[fsk.x],_.fillStyle="black",-1==n?_.fillRect(i,0,1,f):_.fillRect(i,n,1,1),_.fillStyle="yellow",_.fillRect(i,f/2,1,1)),(s=1<s?1:s)<-1&&(s=-1),n=Math.floor(f/2+s*f/4),_.fillStyle="lime",_.fillRect(i,n,1,1),fsk.last_y[fsk.x]=fsk.edge?-1:n,fsk.edge=0,fsk.x++,fsk.x>=t&&(fsk.x=0,fsk.single?fsk.run=0:(_.fillStyle="black",_.fillRect(fsk.lhs,3*f/4,fsk.tw,16)))))}function fsk_framing_reset(){fsk.fr_bits=[],fsk_framing_reset_display(),fsk.fr_sample=1,fsk.encoder&&fsk.encoder.reset()}function fsk_framing_reset_display(){var s,f,e;fsk.show_framing&&(s=fsk.canvas.ctx,fsk.fr_x=fsk.lhs+fsk.fr_s,fsk.fr_xi=0,fsk.fr_yi=fsk.fr_h+fsk.fr_s,fsk.fr_bitn=fsk.fr_bpw,fsk.data_msb=1<<fsk.fr_bpd-1,fsk.fr_shift=!1,fsk.fr_os="",s.fillStyle="lightGray",s.fillRect(fsk.lhs,0,fsk.tw,fsk.th),fsk.fr_bpd&&(s.fillStyle="red",e=0,fsk.encoder.start_bit&&(f=fsk.th-(fsk.fr_bitn-+fsk.baud_mult)*fsk.fr_yi-fsk.fr_s,s.fillRect(fsk.lhs,f,fsk.tw,fsk.fr_s),e=1),f=fsk.th-(fsk.fr_bitn-(fsk.fr_bpd+e)*fsk.baud_mult)*fsk.fr_yi-fsk.fr_s,s.fillRect(fsk.lhs,f,fsk.tw,fsk.fr_s)))}function fsk_framing(s){fsk.fr_sample&&(fsk.fr_bits.push(s),fsk_framing_proc(s),fsk.is_7_3&&fsk.encoder.search_sync(s))}function fsk_framing_proc(s){var f,e,_,t,i=fsk.canvas.ctx,n=fsk.fr_yi;fsk.fr_y=fsk.th-fsk.fr_bitn*n,fsk.fr_bpd&&(t=fsk.baud_mult,_=fsk.fr_bpd*t,f=fsk.encoder.start_bit?t:0,e=fsk.fr_bpw-f,_=fsk.fr_bpw-f-_,fsk.fr_bitn==fsk.fr_bpw&&(fsk.fr_code=0,fsk.fr_nzeros=0),fsk.fr_bitn<=e&&fsk.fr_bitn>_?(1!=t&&0!=(1&fsk.fr_bitn)||(fsk.fr_code>>=1,fsk.fr_code|=s?fsk.data_msb:0,s||fsk.fr_nzeros++),fsk.fr_bitzc=0):fsk.is_7_3&&(fsk.fr_bitzc<<=1,fsk.fr_bitzc|=s),1==fsk.fr_bitn&&(e=fsk.fr_code,i.fillStyle="black",_=fsk.th-fsk.fr_bpw*n,fsk.is_7_3?(i.font="12px Courier",t=0,3==(n=e.toString()).length&&(i.fillText(n[t],fsk.fr_x,_-8-36),t++),2<=n.length&&(i.fillText(n[t],fsk.fr_x,_-8-24),t++),i.fillText(n[t],fsk.fr_x,_-8-12),fsk.fr_nzeros!=fsk.fr_bitzc&&(i.fillStyle="red",i.fillText("x",fsk.fr_x,_-8))):((e=e==fsk.encoder.LETTERS?(fsk.fr_shift=!1,"↓"):e==fsk.encoder.FIGURES?(fsk.fr_shift=!0,"↑"):fsk.encoder.code_to_char(e,fsk.fr_shift))<0?(e="⬬",i.font="8px Courier"):i.font="12px Courier",i.fillText(e,fsk.fr_x,_-8)))),i.fillStyle=s?"yellow":"blue",i.fillRect(fsk.fr_x,fsk.fr_y,fsk.fr_w,fsk.fr_h),fsk.fr_bitn--,0==fsk.fr_bitn&&(fsk.fr_bitn=fsk.fr_bpw,fsk.fr_x+=fsk.fr_w+fsk.fr_s,fsk.fr_xi++,fsk.fr_x>=fsk.lhs+fsk.tw-fsk.fr_w-fsk.fr_s&&(fsk.fr_sample=0))}function fsk_phase(){fsk_framing_reset_display();for(var s=0;s<fsk.fr_bits.length-fsk.fr_phase;s++)fsk_framing_proc(fsk.fr_bits[s+fsk.fr_phase])}function fsk_baud_error_init(){var s=fsk.th/2,f=(fsk.canvas,fsk.canvas.ctx);f.fillStyle="white",f.font="14px Verdana",f.fillText("Baud",fsk.lhs/2-15,s),f.fillText("Error",fsk.lhs/2-15,14+s)}function fsk_baud_error(s){(s=8<s?8:s)<-8&&(s=-8);var f=Math.round(.4*fsk.th/2*s/8),e=fsk.lhs-40,_=fsk.th/2,s=(fsk.canvas,fsk.canvas.ctx);s.fillStyle="black",s.fillRect(e,0,20,fsk.th),0<f?(s.fillStyle="lime",s.fillRect(e,_-f,20,f)):(s.fillStyle="red",s.fillRect(e,_,20,-f))}var fsk_console_status_msg_p={scroll_only_at_bottom:!0,process_return_alone:!1,remove_returns:!0,cols:135};function fsk_output_char(s){""!=s&&(fsk.framing.includes("EFR")&&(s="EFR "+fsk.menu_sel+s),fsk_console_status_msg_p.s=encodeURIComponent(s),fsk.log_txt+=kiwi_remove_escape_sequences(kiwi_decodeURIComponent("FSK",s)),kiwi_output_msg("id-fsk-console-msgs","id-fsk-console-msg",fsk_console_status_msg_p))}function fsk_audio_data_cb(s,f){fsk.jnx.process_data(s,f)}var fsk_shift_s=[85,170,200,340,425,450,500,850,1e3,"custom"],fsk_baud_s=[36,45.45,50,75,100,150,200,300,"custom"],fsk_framing_s=["5N1","5N1V","5N1.5","5N2","7N1","8N1","4/7","EFR","EFR2","CHU","7/3"],fsk_encoding_s=["ITA2","ASCII","CCIR476","DSC","Selcall"],fsk_mode_s=["decode","scope","framing"],fsk_bpd_s=["none","5","6","7","8"],fsk_decim_s=[1,2,4,8,16,32];function fsk_controls_setup(){fsk.th=fsk.dataH,fsk.saved_mode=ext_get_mode(),fsk.jnx=new JNX,fsk.freq=ext_get_freq()/1e3,fsk.jnx.set_baud_error_cb(fsk_baud_error),fsk.jnx.set_output_char_cb(fsk_output_char);var s=fsk.url_params=ext_param();s&&(s=s.split(",")).forEach(function(s,f){var e=(e=s.split(":"))[e.length-1].toLowerCase();w3_ext_param_array_match_str(fsk_framing_s,e,function(s,f){fsk.framing=f}),w3_ext_param_array_match_str(fsk_encoding_s,e,function(s,f){fsk.encoding=f}),(e=w3_ext_param("shift",s)).match?isNaN(e.num)||(fsk.shift=e.num,w3_ext_param_array_match_str(fsk_shift_s,e.num.toString(),function(s){fsk.shift_custom=!1})||(fsk.shift_custom=!0)):(e=w3_ext_param("baud",s)).match?isNaN(e.num)||(fsk.baud=e.num,w3_ext_param_array_match_str(fsk_baud_s,e.num.toString(),function(s){fsk.baud_custom=!1})||(fsk.baud_custom=!0)):(e=w3_ext_param("inverted",s)).match?fsk.inverted=0==e.num?0:1:(e=w3_ext_param("zoom",s)).match?isNumber(e.num)&&(fsk.auto_zoom=0==e.num?0:1):(e=w3_ext_param("word",s)).match?!isNaN(e.num)&&5<=e.num&&e.num<=15&&(fsk.fr_bpw_i=e.num-5):(e=w3_ext_param("data",s)).match&&!isNaN(e.num)&&(0==e.num||5<=e.num&&e.num<=8)&&(fsk.fr_bpd_i=e.num?e.num-4:0)});var f=time_display_html("fsk")+w3_div("id-fsk-data|width:"+px(fsk.lhs+1024)+"; height:"+px(fsk.dataH)+"; overflow:hidden; position:relative; background-color:black;",'<canvas id="id-fsk-canvas" width='+dq(fsk.lhs+1024)+" height="+dq(fsk.dataH)+' style="left:0; position:absolute"></canvas>',w3_div("id-fsk-console-msg w3-text-output w3-scroll-down w3-small w3-text-black|left:"+px(fsk.lhs)+"; width:1024px; position:relative; overflow-x:hidden;",'<pre><code id="id-fsk-console-msgs"></code></pre>')),e=w3_div("id-fsk-controls w3-text-white",w3_divs("/w3-tspace-8",w3_col_percent("",w3_div("",w3_div("w3-show-inline-block w3-medium w3-text-aqua",'<b><a href="https://en.wikipedia.org/wiki/Frequency-shift_keying" target="_blank">FSK</a> decoder</b>')),50,w3_div("",'From <b><a href="https://arachnoid.com/JNX/index.html" target="_blank">JNX</a></b> by P. Lutus &copy; 2011'),50),w3_col_percent("",w3_div("id-fsk-station w3-text-css-yellow","&nbsp;"),50,"",50),w3_inline("id-fsk-menus/"),w3_inline("/w3-margin-between-16",w3_inline("",w3_select(fsk.sfmt,"","shift","fsk.shift_i",W3_SELECT_SHOW_TITLE,fsk_shift_s,"fsk_shift_cb"),w3_input("id-fsk-shift-custom w3-margin-left w3-hide|padding:0;width:auto|size=4","","fsk.shift_cval",fsk.shift_cval,"fsk_shift_custom_cb")),w3_inline("",w3_select(fsk.sfmt,"","baud","fsk.baud_i",W3_SELECT_SHOW_TITLE,fsk_baud_s,"fsk_baud_cb"),w3_input("id-fsk-baud-custom w3-margin-left w3-hide|padding:0;width:auto|size=4","","fsk.baud_cval",fsk.baud_cval,"fsk_baud_custom_cb")),w3_select(fsk.sfmt,"","framing","fsk.framing",fsk.framing,fsk_framing_s,"fsk_framing_cb"),w3_select(fsk.sfmt,"","encoding","fsk.encoding",fsk.encoding,fsk_encoding_s,"fsk_encoding_cb"),w3_checkbox("w3-label-inline w3-label-not-bold/","inverted","fsk.inverted",fsk.inverted,"fsk_inverted_cb")),w3_inline("/w3-margin-between-16",w3_button("w3-padding-smaller","Next","w3_select_next_prev_cb",{dir:w3_MENU_NEXT,id:"fsk.menu",func:"fsk_pre_select_cb"}),w3_button("w3-padding-smaller","Prev","w3_select_next_prev_cb",{dir:w3_MENU_PREV,id:"fsk.menu",func:"fsk_pre_select_cb"}),w3_select(fsk.sfmt,"","mode","fsk.mode",0,fsk_mode_s,"fsk_mode_cb"),w3_inline("",w3_inline("id-fsk-decode/w3-margin-between-16",w3_checkbox("w3-label-inline w3-label-not-bold/","auto<br>zoom","fsk.auto_zoom",fsk.auto_zoom,"fsk_auto_zoom_cb"),w3_button("w3-padding-smaller w3-css-yellow","Clear","fsk_clear_button_cb",0),w3_button("id-fsk-log w3-padding-smaller w3-purple","Log","fsk_log_cb"),w3_input("id-fsk-log-mins/w3-label-not-bold/w3-ext-retain-input-focus|padding:0;width:auto|size=4","log min","fsk.log_mins",fsk.log_mins,"fsk_log_mins_cb")),w3_inline("id-fsk-framing w3-hide/w3-margin-between-16",w3_button("w3-padding-smaller","Sample","fsk_sample_cb",0),w3_select(fsk.sfmt,"","word","fsk.fr_bpw_i",fsk.fr_bpw_i,"5:15","fsk_bpw_cb"),w3_inline("/w3-hspace-4",w3_div("id-fsk-phase w3-font-14px","ϕ00"),w3_icon("w3-text-pink","fa-plus-square",22,"","fsk_phase_cb",1),w3_icon("w3-text-blue","fa-minus-square",22,"","fsk_phase_cb",-1)),w3_select(fsk.sfmt,"","data","fsk.fr_bpd_i",fsk.fr_bpd_i,fsk_bpd_s,"fsk_bpd_cb")),w3_inline("id-fsk-scope w3-hide/w3-margin-between-16",w3_button("w3-padding-smaller","Single","fsk_single_cb",0),w3_select(fsk.sfmt,"","decim","fsk.decim",3,fsk_decim_s,"fsk_decim_cb"))),cfg.fsk.test_file?w3_button("w3-padding-smaller w3-aqua","Test","fsk_test_cb"):"")));ext_panel_show(e,f,null),time_display_setup("fsk"),fsk.canvas=w3_el("id-fsk-canvas"),fsk.canvas.ctx=fsk.canvas.getContext("2d"),fsk.url_params&&(s=fsk.url_params.split(",")).forEach(function(s,f){w3_ext_param("framing",s).match?fsk_mode_cb("id-fsk.mode",fsk.MODE_FRAMING):w3_ext_param("scope",s).match?fsk_mode_cb("id-fsk.mode",fsk.MODE_SCOPE):(r=w3_ext_param("log_time",s)).match?isNumber(r.num)&&fsk_log_mins_cb("id-fsk.log_mins",r.num):cfg.fsk.test_file&&w3_ext_param("test",s).match?ext_send("SET test"):w3_ext_param("help",s).match&&extint_help_click()}),fsk_setup(),fsk_baud_error_init(),ext_set_data_height(fsk.dataH),ext_set_controls_width_height(fsk.ctrlW,fsk.ctrlH),w3_do_when_rendered("id-fsk-menus",function(){fsk.ext_url=kiwi_SSL()+"files.kiwisdr.com/fsk/FSK_freq_menus.cjson",fsk.int_url=kiwi_url_origin()+"/extensions/FSK/FSK_freq_menus.cjson",fsk.using_default=!1,fsk.double_fault=!1,kiwi_ajax(fsk.ext_url,"fsk_get_menus_cb",0,1e4)}),fsk.shift_custom&&fsk_shift_custom_cb("id-fsk-shift-custom",fsk.shift),fsk.baud_custom&&fsk_baud_custom_cb("id-fsk-baud-custom",fsk.baud),ext_register_audio_data_cb(fsk_audio_data_cb)}function fsk_get_menus_cb(s){fsk.freqs=s,ext_get_menus_cb(fsk,s,"fsk_get_menus_cb",function(s){if(ext_render_menus(fsk,"fsk"),fsk.url_params){var f=parseFloat(fsk.url_params);if(!isNaN(f))for(var e=!1,_=0;_<fsk.n_menu;_++){var t="fsk.menu"+_;if(w3_select_enum(t,function(s){e||parseFloat(s.innerHTML)!=f||(fsk_pre_select_cb(t,s.value,!1),e=!0)}),e)break}}},null)}function fsk_auto_zoom(s){return s<170?14:s<=200?13:s<=450?12:11}function fsk_setup(){fsk.freq=ext_get_freq()/1e3,fsk.baud_mult=fsk.framing.endsWith(".5")?2:1;var s=fsk.baud*fsk.baud_mult;fsk.jnx.setup_values(ext_sample_rate(),fsk.cf,fsk.shift,s,fsk.framing,fsk.inverted,fsk.encoding),fsk.is_7_3="7/3"==fsk.framing,fsk.encoder=fsk.jnx.get_encoding_obj(),ext_tune(fsk.freq,"cw",fsk.auto_zoom?ext_zoom.ABS:ext_zoom.CUR,fsk_auto_zoom(fsk.shift));var f=Math.max(fsk.shift,fsk.baud)/2;f+=10*Math.round((.2*f+10)/10),ext_set_passband(fsk.cf-f,fsk.cf+f),ext_tune(fsk.freq,"cw",fsk.auto_zoom?ext_zoom.ABS:ext_zoom.CUR,fsk_auto_zoom(fsk.shift));f=fsk.shift_custom?"custom":fsk.shift;w3_select_set_if_includes("fsk.shift_i","\\b"+f+"\\b");s=fsk.baud_custom?"custom":fsk.baud;w3_select_set_if_includes("fsk.baud_i","\\b"+s+"\\b"),w3_select_set_if_includes("fsk.framing","\\b"+fsk.framing+"\\b"),w3_select_set_if_includes("fsk.encoding","\\b"+fsk.encoding+"\\b"),w3_checkbox_set("fsk.inverted",fsk.inverted),fsk_crosshairs(1)}function fsk_crosshairs(s){var f=canvas_annotation.ctx;if(f.clearRect(0,0,window.innerWidth,24),s&&10<=ext_get_zoom())for(var e=ext_get_freq(),s=get_visible_freq_range(),_=scale_px_from_freq(e-fsk.shift/2,s),t=scale_px_from_freq(e+fsk.shift/2,s),i=0;i<6;i++){var n=3*i;f.fillStyle=1&i?"black":"white",f.fillRect(_-3,n,3,3),f.fillRect(t-3,n,3,3),f.fillStyle=1&i?"white":"black",f.fillRect(_,n,3,3),f.fillRect(t,n,3,3)}}function fsk_pre_select_cb(e,_,s){var t,i;s||(_=+_,t=parseInt(e.split("fsk.menu")[1]),i=!1,w3_select_enum(e,function(s){var f;i||(s.disabled&&(fsk.header=s.innerHTML),s.value!=_||s.disabled||(i=!0,fsk.menu_sel=s.innerHTML+" ",s=+(f=(f=s.id.split("id-")[1]).split("-"))[0],f=+f[1],s=w3_obj_seq_el(fsk.menus[t],s),s=w3_obj_seq_el(s,f),"Test mode"==fsk.header?(fsk.test_mode=!0,console.log("test mode")):(fsk.test_mode=!1,fsk.framing=s.fr,fsk.freq=parseFloat(s.f)+("CHU"==fsk.framing?fsk.CHU_offset:0),fsk.cf=s.hasOwnProperty("cf")?s.cf:1e3,fsk.shift=s.s,fsk.baud=s.b,fsk.shift_custom=fsk.baud_custom=!1,fsk.inverted=s.i,fsk.encoding=s.e,ext_tune(fsk.freq,"cw",fsk.auto_zoom?ext_zoom.ABS:ext_zoom.CUR,fsk_auto_zoom(fsk.shift)),fsk_setup(),w3_select_value(e,_)),w3_el("id-fsk-station").innerHTML="<b>Station: "+fsk.menu_s[t]+", "+fsk.header+"</b>"))}),fsk_clear_menus(t))}function fsk_clear_menus(s){for(var f=0;f<fsk.n_menu;f++)isArg(s)&&f==s||w3_select_value("fsk.menu"+f,-1)}function FSK_environment_changed(s){var f;s.passband_screen_location&&(fsk_crosshairs(1),(s.freq||s.mode)&&(f=ext_get_freq()/1e3,s=ext_get_mode(),fsk.freq==f&&"cw"==s||(fsk_clear_menus(),fsk.menu_sel="",w3_el("id-fsk-station").innerHTML="&nbsp;")))}function fsk_shift_cb(s,f,e){var _=fsk_shift_s[+f],f=f==fsk.SHIFT_CUSTOM_IDX;w3_show_hide("id-fsk-shift-custom",f),f?(fsk.shift=w3_get_value("id-fsk-shift-custom"),fsk.shift_custom=!0):(fsk.shift=+_,fsk.shift_custom=!1),fsk_setup()}function fsk_shift_custom_cb(s,f){f=parseFloat(f);!f||isNaN(f)||f<=0||5e3<f||(w3_set_value(s,f),fsk.shift_cval=fsk.shift=f,fsk.shift_custom=!0,w3_show_hide("id-fsk-shift-custom",!0),fsk_setup())}function fsk_baud_cb(s,f,e){var _=fsk_baud_s[+f],f=f==fsk.BAUD_CUSTOM_IDX;w3_show_hide("id-fsk-baud-custom",f),f?(fsk.baud=w3_get_value("id-fsk-baud-custom"),fsk.baud_custom=!0):(fsk.baud=+_,fsk.baud_custom=!1),fsk_setup()}function fsk_baud_custom_cb(s,f){f=parseFloat(f);!f||isNaN(f)||f<=0||5e3<f||(w3_set_value(s,f),fsk.baud_cval=fsk.baud=f,fsk.baud_custom=!0,w3_show_hide("id-fsk-baud-custom",!0),fsk_setup())}function fsk_framing_cb(s,f,e){e||("custom"!=(f=fsk_framing_s[f])&&(fsk.framing=f),fsk_setup())}function fsk_encoding_cb(s,f,e){e||("custom"!=(f=fsk_encoding_s[f])&&(fsk.encoding=f),fsk_setup())}function fsk_inverted_cb(s,f,e){e||(f=f?1:0,fsk.inverted=f,w3_checkbox_set(s,f),fsk_setup())}function fsk_mode_cb(s,f,e){if(!e){switch(f=+f,fsk.decode=fsk.scope=fsk.show_framing=0,w3_select_value(s,f),f){case fsk.MODE_DECODE:default:fsk.decode=1;break;case fsk.MODE_SCOPE:fsk.scope=1,fsk.run=1,fsk_scope_reset_display();break;case fsk.MODE_FRAMING:fsk.show_framing=1,fsk_framing_reset()}fsk.jnx.set_scope_cb(fsk.scope?fsk_scope:null),fsk.jnx.set_output_bit_cb(fsk.show_framing?fsk_framing:null),w3_show_hide_inline("id-fsk-decode",fsk.decode),w3_show_hide_inline("id-fsk-console-msg",fsk.decode),w3_show_hide_inline("id-fsk-scope",fsk.scope),w3_show_hide_inline("id-fsk-framing",fsk.show_framing)}}function fsk_auto_zoom_cb(s,f,e){e||(f=f?1:0,fsk.auto_zoom=f,w3_checkbox_set(s,f))}function fsk_clear_button_cb(s,f,e){e||(fsk_console_status_msg_p.s=encodeURIComponent("\f"),kiwi_output_msg("id-fsk-console-msgs","id-fsk-console-msg",fsk_console_status_msg_p),fsk.log_txt="")}function fsk_log_mins_cb(s,f){fsk.log_mins=w3_clamp(+f,0,1440,0),console.log("fsk_log_mins_cb path="+s+" val="+f+" log_mins="+fsk.log_mins),w3_set_value(s,fsk.log_mins),kiwi_clearInterval(fsk.log_interval),0!=fsk.log_mins&&(console.log("FSK logging.."),fsk.log_interval=setInterval(function(){fsk_log_cb()},6e4*fsk.log_mins))}function fsk_log_cb(){var s=kiwi_host()+"_"+(new Date).toISOString().replace(/:/g,"_").replace(/\.[0-9]+Z$/,"Z")+"_"+w3_el("id-freq-input").value+"_"+cur_mode,f=new Blob([fsk.log_txt],{type:"text/plain"}),e=document.createElement("a");e.style="display: none",e.href=window.URL.createObjectURL(f),e.download="FSK."+s+".log.txt",document.body.appendChild(e),console.log("fsk_log: "+e.download),e.click(),window.URL.revokeObjectURL(e.href),document.body.removeChild(e)}function fsk_single_cb(s,f,e){e||(fsk.single&&(fsk.run=1),fsk.single^=1,w3_innerHTML(s,fsk.single?"Run":"Single"))}function fsk_sample_cb(s,f,e){e||fsk_framing_reset()}function fsk_decim_cb(s,f,e){e||(fsk.decim=[1,2,4,8,16,32][f])}function fsk_bpw_cb(s,f,e){if(fsk.fr_bpw=[5,6,7,8,9,10,11,12,13,14,15][f],fsk.fr_bits.length){fsk_framing_reset_display();for(var _=0;_<fsk.fr_bits.length-fsk.fr_phase;_++)fsk_framing_proc(fsk.fr_bits[_+fsk.fr_phase])}}function fsk_phase_cb(s,f,e){e||(f=+f,fsk.fr_phase-=f,fsk.fr_phase<0&&(fsk.fr_phase=fsk.fr_bpw-1),fsk.fr_phase>=fsk.fr_bpw&&(fsk.fr_phase=0),w3_innerHTML("id-fsk-phase","ϕ"+fsk.fr_phase.leadingZeros(2)),fsk_phase())}function fsk_bpd_cb(s,f,e){fsk.fr_bpd=[0,5,6,7,8][f],fsk_phase()}function fsk_test_cb(s,f,e){ext_send("SET test")}function FSK_blur(){ext_unregister_audio_data_cb(),ext_set_mode(fsk.saved_mode),fsk_crosshairs(0),kiwi_clearInterval(fsk.log_interval)}function FSK_config_html(){var s=w3_inline_percent("w3-container",w3_div("w3-restart",w3_input_get("","Test filename","fsk.test_file","w3_string_set_cfg_cb","FSK.test.12k.au")),40);ext_config_html(fsk,"fsk","FSK","FSK configuration",s)}function FSK_help(s){return s&&(s=w3_text("w3-medium w3-bold w3-text-aqua","FSK decoder help")+"<br>Decoding FSK is not always easy because of the many signal parameters involved. <br>Try the stations listed in the menus. Most of these are best heard from Kiwis in Europe. <br><br>The frequency shift can be set by zooming in sufficiently, centering the passband between <br>the two tones, and selecting a menu shift (or setting a custom shift) so that the <br>checkered crosshairs align on the tones. The scope and framing modes are to assist in setting the correct baud rate and framing. <br><br>URL parameters: <br>First parameter can be a frequency matching an entry in station menus. <br>shift:<i>num</i> &nbsp; baud:<i>num</i> &nbsp; framing:<i>value</i> &nbsp; encoding:<i>value</i> &nbsp; inverted<i>[:0|1]</i> &nbsp; log_time:<i>mins</i> <br>Values are those appearing in their respective menus. <br>Any number for shift and baud can be used. Not just the preset values in the menus. <br>Keywords are case-insensitive and can be abbreviated. <br>So for example this is valid: <i>ext=fsk,147.3,s:425,b:200,a,i:0</i> &nbsp; <i>ext=fsk,2474,log:5 <br>",confirmation_show_content(s,610,300)),!0}



