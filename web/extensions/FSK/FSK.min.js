

/* web/extensions/FSK/FSK.min.js (web/extensions/FSK/FSK.js = Fri May 27 10:45:14 2022) */
var fsk={ext_name:"FSK",first_time:!0,dataH:300,ctrlW:650,ctrlH:200,lhs:150,tw:1024,x:0,last_y:[],n_menu:4,menu0:-1,menu1:-1,menu2:-1,menu3:-1,header:null,menu_sel:"",test_mode:!1,freq:0,cf:1e3,shift:170,shift_i:1,SHIFT_CUSTOM_IDX:9,shift_cval:0,shift_custom:!1,baud:50,baud_i:2,BAUD_CUSTOM_IDX:8,baud_cval:0,baud_custom:!1,baud_mult:1,framing:"5N1.5",inverted:1,encoding:"ITA2",MODE_DECODE:0,MODE_SCOPE:1,MODE_FRAMING:2,scope:0,run:0,single:0,decim:8,show_framing:0,fr_sample:0,fr_bits:[],fr_bpw_i:0,fr_bpw:5,fr_phase:0,fr_bpd_i:0,fr_bpd:0,fr_shift:!1,fr_w:6,fr_h:6,fr_s:2,sample_count:0,edge:0,CHU_offset:2.125,log_mins:0,log_interval:null,log_txt:"",last_last:0};function FSK_main(){ext_switch_to_client(fsk.ext_name,fsk.first_time,fsk_recv),fsk.first_time||fsk_controls_setup(),fsk.first_time=!1}function fsk_recv(s){if("DAT"!=arrayBufferToStringLen(s,3))for(var e=arrayBufferToString(s).substring(4).split(" "),f=0;f<e.length;f++){var t=e[f].split("=");switch(t[0]){case"ready":kiwi_load_js_dir("extensions/FSK/",["JNX.js","BiQuadraticFilter.js","CCIR476.js","DSC.js","FSK_async.js"],"fsk_controls_setup");break;case"test_done":break;default:console.log("fsk_recv: UNKNOWN CMD "+t[0])}}else{var _=new Uint8Array(s,4),i=_[0],n=_.length-1;console.log("fsk_recv: DATA UNKNOWN cmd="+i+" len="+n)}}function fsk_scope_reset_display(){var s=fsk.canvas.ctx;s.fillStyle="black",s.fillRect(fsk.lhs,0,fsk.tw,fsk.th)}function fsk_scope(s,e,f){if(fsk.scope&&fsk.run&&(fsk.sample_count++,fsk.edge|=e,0==(fsk.sample_count&fsk.decim-1))){var t,_=fsk.canvas,i=fsk.canvas.ctx,n=_.width,r=_.height,a=fsk.lhs+fsk.x;fsk.edge?(i.fillStyle="red",i.fillRect(a,0,1,3*r/4),a-8>fsk.lhs&&(i.fillStyle="white",i.font="8px Courier",i.fillText(f,a-8,3*r/4+10))):(t=fsk.last_y[fsk.x],i.fillStyle="black",-1==t?i.fillRect(a,0,1,r):i.fillRect(a,t,1,1),i.fillStyle="yellow",i.fillRect(a,r/2,1,1)),s>1&&(s=1),s<-1&&(s=-1),t=Math.floor(r/2+s*r/4),i.fillStyle="lime",i.fillRect(a,t,1,1),fsk.last_y[fsk.x]=fsk.edge?-1:t,fsk.edge=0,fsk.x++,fsk.x>=n&&(fsk.x=0,fsk.single?fsk.run=0:(i.fillStyle="black",i.fillRect(fsk.lhs,3*r/4,fsk.tw,16)))}}function fsk_framing_reset(){fsk.fr_bits=[],fsk_framing_reset_display(),fsk.fr_sample=1,fsk.encoder&&fsk.encoder.reset()}function fsk_framing_reset_display(){if(fsk.show_framing){var s=fsk.canvas.ctx;if(fsk.fr_x=fsk.lhs+fsk.fr_s,fsk.fr_xi=0,fsk.fr_yi=fsk.fr_h+fsk.fr_s,fsk.fr_bitn=fsk.fr_bpw,fsk.data_msb=1<<fsk.fr_bpd-1,fsk.fr_shift=!1,fsk.fr_os="",s.fillStyle="lightGray",s.fillRect(fsk.lhs,0,fsk.tw,fsk.th),fsk.fr_bpd){s.fillStyle="red";var e,f=0;fsk.encoder.start_bit&&(e=fsk.th-(fsk.fr_bitn-1*fsk.baud_mult)*fsk.fr_yi-fsk.fr_s,s.fillRect(fsk.lhs,e,fsk.tw,fsk.fr_s),f=1),e=fsk.th-(fsk.fr_bitn-(fsk.fr_bpd+f)*fsk.baud_mult)*fsk.fr_yi-fsk.fr_s,s.fillRect(fsk.lhs,e,fsk.tw,fsk.fr_s)}}}function fsk_framing(s){fsk.fr_sample&&(fsk.fr_bits.push(s),fsk_framing_proc(s),fsk.encoder.isDSC&&fsk.encoder.search_sync(s))}function fsk_framing_proc(s){var e=fsk.canvas.ctx,f=fsk.fr_yi;if(fsk.fr_y=fsk.th-fsk.fr_bitn*f,fsk.fr_bpd){var t,_=fsk.baud_mult,i=fsk.fr_bpd*_,n=fsk.encoder.start_bit?_:0,r=fsk.fr_bpw-n,a=fsk.fr_bpw-n-i;if(fsk.fr_bitn==fsk.fr_bpw&&(fsk.fr_code=0,fsk.fr_nzeros=0),fsk.fr_bitn<=r&&fsk.fr_bitn>a?(1!=_&&0!=(1&fsk.fr_bitn)||(fsk.fr_code>>=1,fsk.fr_code|=s?fsk.data_msb:0,s||fsk.fr_nzeros++),fsk.fr_bitzc=0):fsk.encoder.isDSC&&(fsk.fr_bitzc<<=1,fsk.fr_bitzc|=s),1==fsk.fr_bitn){var k=fsk.fr_code;e.fillStyle="black";var c=fsk.th-fsk.fr_bpw*f;if(fsk.encoder.isDSC){e.font="12px Courier";var l=k.toString(),o=0;3==l.length&&(e.fillText(l[o],fsk.fr_x,c-8-36),o++),l.length>=2&&(e.fillText(l[o],fsk.fr_x,c-8-24),o++),e.fillText(l[o],fsk.fr_x,c-8-12),fsk.fr_nzeros!=fsk.fr_bitzc&&(e.fillStyle="red",e.fillText("x",fsk.fr_x,c-8))}else k==fsk.encoder.LETTERS?(fsk.fr_shift=!1,t="↓"):k==fsk.encoder.FIGURES?(fsk.fr_shift=!0,t="↑"):t=fsk.encoder.code_to_char(k,fsk.fr_shift),t<0?(t="⬬",e.font="8px Courier"):e.font="12px Courier",e.fillText(t,fsk.fr_x,c-8)}}e.fillStyle=s?"yellow":"blue",e.fillRect(fsk.fr_x,fsk.fr_y,fsk.fr_w,fsk.fr_h),fsk.fr_bitn--,0==fsk.fr_bitn&&(fsk.fr_bitn=fsk.fr_bpw,fsk.fr_x+=fsk.fr_w+fsk.fr_s,fsk.fr_xi++,fsk.fr_x>=fsk.lhs+fsk.tw-fsk.fr_w-fsk.fr_s&&(fsk.fr_sample=0))}function fsk_phase(){fsk_framing_reset_display();for(var s=0;s<fsk.fr_bits.length-fsk.fr_phase;s++)fsk_framing_proc(fsk.fr_bits[s+fsk.fr_phase])}function fsk_baud_error_init(){var s=fsk.th/2,e=(fsk.canvas,fsk.canvas.ctx);e.fillStyle="white",e.font="14px Verdana",e.fillText("Baud",fsk.lhs/2-15,s),e.fillText("Error",fsk.lhs/2-15,s+14)}function fsk_baud_error(s){s>8&&(s=8),s<-8&&(s=-8);var e=Math.round(.4*fsk.th/2*s/8),f=fsk.lhs-40,t=fsk.th/2,_=(fsk.canvas,fsk.canvas.ctx);_.fillStyle="black",_.fillRect(f,0,20,fsk.th),e>0?(_.fillStyle="lime",_.fillRect(f,t-e,20,e)):(_.fillStyle="red",_.fillRect(f,t,20,-e))}var fsk_console_status_msg_p={scroll_only_at_bottom:!0,process_return_alone:!1,remove_returns:!0,ncol:135};function fsk_output_char(s){""!=s&&(fsk.framing.includes("EFR")&&(s="EFR "+fsk.menu_sel+s),fsk_console_status_msg_p.s=encodeURIComponent(s),fsk.log_txt+=kiwi_remove_escape_sequences(kiwi_decodeURIComponent("FSK",s)),kiwi_output_msg("id-fsk-console-msgs","id-fsk-console-msg",fsk_console_status_msg_p))}function fsk_audio_data_cb(s,e){fsk.jnx.process_data(s,e)}var fsk_weather={Germany:[{f:"147.3 DDH47",s:85,b:50,fr:"5N1.5",i:1,e:"ITA2",cf:500},{f:"11039 DDH9",s:450,b:50,fr:"5N1.5",i:1,e:"ITA2"},{f:"14467.3 DDH8",s:450,b:50,fr:"5N1.5",i:1,e:"ITA2"},{f:"4583 DDK2",s:450,b:50,fr:"5N1.5",i:1,e:"ITA2"},{f:"7646 DDH7",s:450,b:50,fr:"5N1.5",i:1,e:"ITA2"},{f:"10100.8 DDK9",s:450,b:50,fr:"5N1.5",i:1,e:"ITA2"}]},fsk_maritime={"DSC (selcal)":[{f:2187.5,cf:500,s:170,b:100,fr:"7/3",i:1,e:"DSC"},{f:4207.5,cf:500,s:170,b:100,fr:"7/3",i:1,e:"DSC"},{f:6312,cf:500,s:170,b:100,fr:"7/3",i:1,e:"DSC"},{f:8414.5,cf:500,s:170,b:100,fr:"7/3",i:1,e:"DSC"},{f:12577,cf:500,s:170,b:100,fr:"7/3",i:1,e:"DSC"},{f:16804.5,cf:500,s:170,b:100,fr:"7/3",i:1,e:"DSC"}],NAVTEX:[{f:518,cf:500,s:170,b:100,fr:"4/7",i:0,e:"CCIR476"},{f:490,cf:500,s:170,b:100,fr:"4/7",i:0,e:"CCIR476"},{f:4209.5,cf:500,s:170,b:100,fr:"4/7",i:0,e:"CCIR476"}],"MSI (safety)":[{f:4210,cf:500,s:170,b:100,fr:"4/7",i:0,e:"CCIR476"},{f:6314,cf:500,s:170,b:100,fr:"4/7",i:0,e:"CCIR476"},{f:8416.5,cf:500,s:170,b:100,fr:"4/7",i:0,e:"CCIR476"},{f:12579,cf:500,s:170,b:100,fr:"4/7",i:0,e:"CCIR476"},{f:16806.5,cf:500,s:170,b:100,fr:"4/7",i:0,e:"CCIR476"},{f:19680.5,cf:500,s:170,b:100,fr:"4/7",i:0,e:"CCIR476"},{f:22376,cf:500,s:170,b:100,fr:"4/7",i:0,e:"CCIR476"}],"SVO Athens":[{f:12603.5,s:450,b:50,fr:"5N1.5",i:1,e:"ITA2"}],"UDK2 Murmansk":[{f:6322.5,s:450,b:50,fr:"5N1.5",i:1,e:"ITA2"}],"XSQ China":[{f:8425.5,s:450,b:50,fr:"5N1.5",i:1,e:"ITA2"},{f:12622.5,s:450,b:50,fr:"5N1.5",i:1,e:"ITA2"}]},fsk_military={"PBB Dutch Navy":[{f:2474,s:850,b:75,fr:"5N1V",i:1,e:"ITA2"},{f:4280,s:850,b:75,fr:"5N1V",i:1,e:"ITA2"},{f:6358.5,s:850,b:75,fr:"5N1V",i:1,e:"ITA2"},{f:8439,s:850,b:75,fr:"5N1V",i:1,e:"ITA2"}],"RDL CIS":[{f:18.1,s:75,b:36,fr:"T600",i:1,e:"ITA2"},{f:4582,s:200,b:50,fr:"T600",i:1,e:"ITA2"}]},fsk_ham_utility={"Ham RTTY":[{f:"3590 80m",s:170,b:45.45,fr:"5N1.5",i:0,e:"ITA2"},{f:"7043 40m",s:170,b:45.45,fr:"5N1.5",i:0,e:"ITA2"},{f:"10143 30m",s:170,b:45.45,fr:"5N1.5",i:0,e:"ITA2"},{f:"14080 20m",s:170,b:45.45,fr:"5N1.5",i:0,e:"ITA2"},{f:"18105 17m",s:170,b:45.45,fr:"5N1.5",i:0,e:"ITA2"},{f:"21080 15m",s:170,b:45.45,fr:"5N1.5",i:0,e:"ITA2"},{f:"24925 12m",s:170,b:45.45,fr:"5N1.5",i:0,e:"ITA2"},{f:"28080 10m",s:170,b:45.45,fr:"5N1.5",i:0,e:"ITA2"}],"EFR Teleswitch":[{f:"129.1 DCF49",s:340,b:200,fr:"EFR",i:1,e:"ASCII"},{f:"135.6 HGA22",s:340,b:200,fr:"EFR",i:1,e:"ASCII"},{f:"139 DCF39",s:340,b:200,fr:"EFR",i:1,e:"ASCII"}],"CHU time":[{f:3330,s:200,b:300,fr:"CHU",i:0,e:"ASCII"},{f:7850,s:200,b:300,fr:"CHU",i:0,e:"ASCII"},{f:14670,s:200,b:300,fr:"CHU",i:0,e:"ASCII"}]},fsk_menu_s=["Weather","Maritime","Military","Ham/Utility"],fsk_menus=[fsk_weather,fsk_maritime,fsk_military,fsk_ham_utility],fsk_shift_s=[85,170,200,340,425,450,500,850,1e3,"custom"],fsk_baud_s=[36,45.45,50,75,100,150,200,300,"custom"],fsk_framing_s=["5N1","5N1V","5N1.5","5N2","7N1","8N1","4/7","EFR","EFR2","CHU","T600"],fsk_encoding_s=["ITA2","ASCII","CCIR476"],fsk_mode_s=["decode","scope","framing"],fsk_bpd_s=["none","5","6","7","8"],fsk_decim_s=[1,2,4,8,16,32];function fsk_controls_setup(){fsk.th=fsk.dataH,fsk.saved_mode=ext_get_mode(),dbgUs&&!fsk_encoding_s.includes("DSC")&&(fsk_framing_s.push("7/3"),fsk_encoding_s.push("DSC")),fsk.jnx=new JNX,fsk.freq=ext_get_freq()/1e3,fsk.jnx.set_baud_error_cb(fsk_baud_error),fsk.jnx.set_output_char_cb(fsk_output_char);var s=fsk.url_params=ext_param();s&&(s=s.split(",")).forEach(function(s,e){var f,t=s.split(":");t=t[t.length-1].toLowerCase(),w3_ext_param_array_match_str(fsk_framing_s,t,function(s,e){fsk.framing=e}),w3_ext_param_array_match_str(fsk_encoding_s,t,function(s,e){fsk.encoding=e}),(f=w3_ext_param("shift",s)).match?isNaN(f.num)||(fsk.shift=f.num,w3_ext_param_array_match_str(fsk_shift_s,f.num.toString(),function(s){fsk.shift_custom=!1})||(fsk.shift_custom=!0)):(f=w3_ext_param("baud",s)).match?isNaN(f.num)||(fsk.baud=f.num,w3_ext_param_array_match_str(fsk_baud_s,f.num.toString(),function(s){fsk.baud_custom=!1})||(fsk.baud_custom=!0)):(f=w3_ext_param("inverted",s)).match?fsk.inverted=0==f.num?0:1:(f=w3_ext_param("word",s)).match?!isNaN(f.num)&&f.num>=5&&f.num<=15&&(fsk.fr_bpw_i=f.num-5):(f=w3_ext_param("data",s)).match&&!isNaN(f.num)&&(0==f.num||f.num>=5&&f.num<=8)&&(fsk.fr_bpd_i=f.num?f.num-4:0)});var e=time_display_html("fsk")+w3_div("id-fsk-data|width:"+px(fsk.lhs+1024)+"; height:"+px(fsk.dataH)+"; overflow:hidden; position:relative; background-color:black;",'<canvas id="id-fsk-canvas" width='+dq(fsk.lhs+1024)+" height="+dq(fsk.dataH)+' style="left:0; position:absolute"></canvas>',w3_div("id-fsk-console-msg w3-text-output w3-scroll-down w3-small w3-text-black|left:"+px(fsk.lhs)+"; width:1024px; position:relative; overflow-x:hidden;",'<pre><code id="id-fsk-console-msgs"></code></pre>'));dbgUs||(delete fsk_maritime["DSC (selcal)"],delete fsk_maritime.NAVTEX);var f=w3_div("id-fsk-controls w3-text-white",w3_divs("/w3-tspace-8",w3_col_percent("",w3_div("",w3_div("w3-show-inline-block w3-medium w3-text-aqua",'<b><a href="https://en.wikipedia.org/wiki/Frequency-shift_keying" target="_blank">FSK</a> decoder</b>')),50,w3_div("",'From <b><a href="https://arachnoid.com/JNX/index.html" target="_blank">JNX</a></b> by P. Lutus &copy; 2011'),50),w3_col_percent("",w3_div("id-fsk-station w3-text-css-yellow","&nbsp;"),50,"",50),w3_inline("w3-halign-space-between/",w3_select_hier("w3-text-red","Weather","select","fsk.menu0",fsk.menu0,fsk_weather,"fsk_pre_select_cb"),w3_select_hier("w3-text-red","Maritime","select","fsk.menu1",fsk.menu1,fsk_maritime,"fsk_pre_select_cb"),w3_select_hier("w3-text-red","Military","select","fsk.menu2",fsk.menu2,fsk_military,"fsk_pre_select_cb"),w3_select_hier("w3-text-red","Ham/Utility","select","fsk.menu3",fsk.menu3,fsk_ham_utility,"fsk_pre_select_cb")),w3_inline("/w3-margin-between-16",w3_inline("",w3_select("w3-text-red","","shift","fsk.shift_i",W3_SELECT_SHOW_TITLE,fsk_shift_s,"fsk_shift_cb"),w3_input("id-fsk-shift-custom w3-margin-left w3-hide|padding:0;width:auto|size=4","","fsk.shift_cval",fsk.shift_cval,"fsk_shift_custom_cb")),w3_inline("",w3_select("w3-text-red","","baud","fsk.baud_i",W3_SELECT_SHOW_TITLE,fsk_baud_s,"fsk_baud_cb"),w3_input("id-fsk-baud-custom w3-margin-left w3-hide|padding:0;width:auto|size=4","","fsk.baud_cval",fsk.baud_cval,"fsk_baud_custom_cb")),w3_select("w3-text-red","","framing","fsk.framing",fsk.framing,fsk_framing_s,"fsk_framing_cb"),w3_select("w3-text-red","","encoding","fsk.encoding",fsk.encoding,fsk_encoding_s,"fsk_encoding_cb"),w3_checkbox("w3-label-inline w3-label-not-bold/","inverted","fsk.inverted",fsk.inverted,"fsk_inverted_cb")),w3_inline("/w3-margin-between-16",w3_button("w3-padding-smaller","Next","w3_select_next_prev_cb",{dir:w3_MENU_NEXT,id:"fsk.menu",func:"fsk_pre_select_cb"}),w3_button("w3-padding-smaller","Prev","w3_select_next_prev_cb",{dir:w3_MENU_PREV,id:"fsk.menu",func:"fsk_pre_select_cb"}),w3_select("w3-text-red","","mode","fsk.mode",0,fsk_mode_s,"fsk_mode_cb"),w3_inline("",w3_inline("id-fsk-decode/w3-margin-between-16",w3_button("w3-padding-smaller w3-css-yellow","Clear","fsk_clear_button_cb",0),w3_button("id-fsk-log w3-padding-smaller w3-purple","Log","fsk_log_cb"),w3_input("id-fsk-log-mins/w3-label-not-bold/w3-ext-retain-input-focus|padding:0;width:auto|size=4","log min","fsk.log_mins",fsk.log_mins,"fsk_log_mins_cb")),w3_inline("id-fsk-framing w3-hide/w3-margin-between-16",w3_button("w3-padding-smaller","Sample","fsk_sample_cb",0),w3_select("w3-text-red","","bits/word","fsk.fr_bpw_i",fsk.fr_bpw_i,"5:15","fsk_bpw_cb"),w3_inline("/w3-hspace-4",w3_div("id-fsk-phase w3-font-14px","ϕ00"),w3_icon("w3-text-pink","fa-plus-square",22,"","fsk_phase_cb",1),w3_icon("w3-text-blue","fa-minus-square",22,"","fsk_phase_cb",-1)),w3_select("w3-text-red","","bits/data","fsk.fr_bpd_i",fsk.fr_bpd_i,fsk_bpd_s,"fsk_bpd_cb")),w3_inline("id-fsk-scope w3-hide/w3-margin-between-16",w3_button("w3-padding-smaller","Single","fsk_single_cb",0),w3_select("w3-text-red","","decim","fsk.decim",3,fsk_decim_s,"fsk_decim_cb"))),cfg.fsk.test_file?w3_button("w3-padding-smaller w3-aqua","Test","fsk_test_cb"):"")));if(ext_panel_show(f,e,null),time_display_setup("fsk"),fsk.canvas=w3_el("id-fsk-canvas"),fsk.canvas.ctx=fsk.canvas.getContext("2d"),fsk.url_params&&(s=fsk.url_params.split(",")).forEach(function(s,e){w3_ext_param("framing",s).match?fsk_mode_cb("id-fsk.mode",fsk.MODE_FRAMING):w3_ext_param("scope",s).match?fsk_mode_cb("id-fsk.mode",fsk.MODE_SCOPE):(r=w3_ext_param("log_time",s)).match?isNumber(r.num)&&fsk_log_mins_cb("id-fsk.log_mins",r.num):cfg.fsk.test_file&&w3_ext_param("test",s).match?ext_send("SET test"):w3_ext_param("help",s).match&&extint_help_click()}),fsk_setup(),fsk_baud_error_init(),ext_set_data_height(fsk.dataH),ext_set_controls_width_height(fsk.ctrlW,fsk.ctrlH),fsk.url_params){var t=parseFloat(fsk.url_params);if(!isNaN(t))for(var _=!1,i=0;i<fsk.n_menu;i++){var n="fsk.menu"+i;if(w3_select_enum(n,function(s){_||parseFloat(s.innerHTML)!=t||(fsk_pre_select_cb(n,s.value,!1),_=!0)}),_)break}}fsk.shift_custom&&fsk_shift_custom_cb("id-fsk-shift-custom",fsk.shift),fsk.baud_custom&&fsk_baud_custom_cb("id-fsk-baud-custom",fsk.baud),ext_register_audio_data_cb(fsk_audio_data_cb)}function fsk_setup(){fsk.freq=ext_get_freq()/1e3,fsk.baud_mult=fsk.framing.endsWith(".5")?2:1;var s=fsk.baud*fsk.baud_mult;fsk.jnx.setup_values(ext_sample_rate(),fsk.cf,fsk.shift,s,fsk.framing,fsk.inverted,fsk.encoding),fsk.encoder=fsk.jnx.get_encoding_obj();var e=ext_get_zoom();ext_tune(fsk.freq,"cw",ext_zoom.ABS,e);var f=Math.max(fsk.shift,fsk.baud)/2;f+=10*Math.round((.2*f+10)/10),ext_set_passband(fsk.cf-f,fsk.cf+f),ext_tune(fsk.freq,"cw",ext_zoom.ABS,e);var t=fsk.shift_custom?"custom":fsk.shift;w3_select_set_if_includes("fsk.shift_i","\\b"+t+"\\b");s=fsk.baud_custom?"custom":fsk.baud;w3_select_set_if_includes("fsk.baud_i","\\b"+s+"\\b"),w3_select_set_if_includes("fsk.framing","\\b"+fsk.framing+"\\b"),w3_select_set_if_includes("fsk.encoding","\\b"+fsk.encoding+"\\b"),w3_checkbox_set("fsk.inverted",fsk.inverted),fsk_crosshairs(1)}function fsk_crosshairs(s){var e=canvas_annotation.ctx;if(e.clearRect(0,0,window.innerWidth,24),s&&ext_get_zoom()>=10)for(var f=ext_get_freq(),t=get_visible_freq_range(),_=scale_px_from_freq(f-fsk.shift/2,t),i=scale_px_from_freq(f+fsk.shift/2,t),n=0;n<6;n++){var r=3*n;e.fillStyle=1&n?"black":"white",e.fillRect(_-3,r,3,3),e.fillRect(i-3,r,3,3),e.fillStyle=1&n?"white":"black",e.fillRect(_,r,3,3),e.fillRect(i,r,3,3)}}function fsk_pre_select_cb(s,e,f){if(!f){e=+e;var t=parseInt(s.split("fsk.menu")[1]),_=!1;w3_select_enum(s,function(f){if(!_&&(f.disabled&&(fsk.header=f.innerHTML),f.value==e&&!f.disabled)){_=!0,fsk.menu_sel=f.innerHTML+" ";var i=f.id.split("id-")[1],n=+(i=i.split("-"))[0],r=+i[1],a=w3_obj_seq_el(fsk_menus[t],n);if(a=w3_obj_seq_el(a,r),"Test mode"==fsk.header)fsk.test_mode=!0,console.log("test mode");else{fsk.test_mode=!1,fsk.framing=a.fr,fsk.freq=parseFloat(a.f)+("CHU"==fsk.framing?fsk.CHU_offset:0),fsk.cf=a.hasOwnProperty("cf")?a.cf:1e3,fsk.shift=a.s,fsk.baud=a.b,fsk.shift_custom=fsk.baud_custom=!1,fsk.inverted=a.i,fsk.encoding=a.e;var k=Math.min(ext_get_zoom(),12);ext_tune(fsk.freq,"cw",ext_zoom.ABS,k),fsk_setup(),w3_select_value(s,e)}w3_el("id-fsk-station").innerHTML="<b>Station: "+fsk_menu_s[t]+", "+fsk.header+"</b>"}}),fsk_clear_menus(t)}}function fsk_clear_menus(s){for(var e=0;e<fsk.n_menu;e++)isArg(s)&&e==s||w3_select_value("fsk.menu"+e,-1)}function FSK_environment_changed(s){if(s.passband_screen_location&&(fsk_crosshairs(1),s.freq||s.mode)){var e=ext_get_freq()/1e3,f=ext_get_mode();fsk.freq==e&&"cw"==f||(fsk_clear_menus(),fsk.menu_sel="",w3_el("id-fsk-station").innerHTML="&nbsp;")}}function fsk_shift_cb(s,e,f){var t=fsk_shift_s[+e],_=e==fsk.SHIFT_CUSTOM_IDX;w3_show_hide("id-fsk-shift-custom",_),_?(fsk.shift=w3_get_value("id-fsk-shift-custom"),fsk.shift_custom=!0):(fsk.shift=+t,fsk.shift_custom=!1),fsk_setup()}function fsk_shift_custom_cb(s,e){var f=parseFloat(e);!f||isNaN(f)||f<=0||f>5e3||(w3_set_value(s,f),fsk.shift_cval=fsk.shift=f,fsk.shift_custom=!0,w3_show_hide("id-fsk-shift-custom",!0),fsk_setup())}function fsk_baud_cb(s,e,f){var t=fsk_baud_s[+e],_=e==fsk.BAUD_CUSTOM_IDX;w3_show_hide("id-fsk-baud-custom",_),_?(fsk.baud=w3_get_value("id-fsk-baud-custom"),fsk.baud_custom=!0):(fsk.baud=+t,fsk.baud_custom=!1),fsk_setup()}function fsk_baud_custom_cb(s,e){var f=parseFloat(e);!f||isNaN(f)||f<=0||f>5e3||(w3_set_value(s,f),fsk.baud_cval=fsk.baud=f,fsk.baud_custom=!0,w3_show_hide("id-fsk-baud-custom",!0),fsk_setup())}function fsk_framing_cb(s,e,f){if(!f){var t=fsk_framing_s[e];"custom"!=t&&(fsk.framing=t),fsk_setup()}}function fsk_encoding_cb(s,e,f){if(!f){var t=fsk_encoding_s[e];"custom"!=t&&(fsk.encoding=t),fsk_setup()}}function fsk_inverted_cb(s,e,f){f||(e=e?1:0,fsk.inverted=e,w3_checkbox_set(s,e),fsk_setup())}function fsk_mode_cb(s,e,f){if(!f){switch(e=+e,fsk.decode=fsk.scope=fsk.show_framing=0,w3_select_value(s,e),e){case fsk.MODE_DECODE:default:fsk.decode=1;break;case fsk.MODE_SCOPE:fsk.scope=1,fsk.run=1,fsk_scope_reset_display();break;case fsk.MODE_FRAMING:fsk.show_framing=1,fsk_framing_reset()}fsk.jnx.set_scope_cb(fsk.scope?fsk_scope:null),fsk.jnx.set_output_bit_cb(fsk.show_framing?fsk_framing:null),w3_show_hide_inline("id-fsk-decode",fsk.decode),w3_show_hide_inline("id-fsk-console-msg",fsk.decode),w3_show_hide_inline("id-fsk-scope",fsk.scope),w3_show_hide_inline("id-fsk-framing",fsk.show_framing)}}function fsk_clear_button_cb(s,e,f){f||(fsk_console_status_msg_p.s=encodeURIComponent("\f"),kiwi_output_msg("id-fsk-console-msgs","id-fsk-console-msg",fsk_console_status_msg_p),fsk.log_txt="")}function fsk_log_mins_cb(s,e){fsk.log_mins=w3_clamp(+e,0,1440,0),console.log("fsk_log_mins_cb path="+s+" val="+e+" log_mins="+fsk.log_mins),w3_set_value(s,fsk.log_mins),kiwi_clearInterval(fsk.log_interval),0!=fsk.log_mins&&(console.log("FSK logging.."),fsk.log_interval=setInterval(function(){fsk_log_cb()},6e4*fsk.log_mins))}function fsk_log_cb(){var s=kiwi_host()+"_"+(new Date).toISOString().replace(/:/g,"_").replace(/\.[0-9]+Z$/,"Z")+"_"+w3_el("id-freq-input").value+"_"+cur_mode,e=new Blob([fsk.log_txt],{type:"text/plain"}),f=document.createElement("a");f.style="display: none",f.href=window.URL.createObjectURL(e),f.download="FSK."+s+".log.txt",document.body.appendChild(f),console.log("fsk_log: "+f.download),f.click(),window.URL.revokeObjectURL(f.href),document.body.removeChild(f)}function fsk_single_cb(s,e,f){f||(fsk.single&&(fsk.run=1),fsk.single^=1,w3_innerHTML(s,fsk.single?"Run":"Single"))}function fsk_sample_cb(s,e,f){f||fsk_framing_reset()}function fsk_decim_cb(s,e,f){f||(fsk.decim=[1,2,4,8,16,32][e])}function fsk_bpw_cb(s,e,f){if(fsk.fr_bpw=[5,6,7,8,9,10,11,12,13,14,15][e],fsk.fr_bits.length){fsk_framing_reset_display();for(var t=0;t<fsk.fr_bits.length-fsk.fr_phase;t++)fsk_framing_proc(fsk.fr_bits[t+fsk.fr_phase])}}function fsk_phase_cb(s,e,f){if(!f){var t=+e;fsk.fr_phase-=t,fsk.fr_phase<0&&(fsk.fr_phase=fsk.fr_bpw-1),fsk.fr_phase>=fsk.fr_bpw&&(fsk.fr_phase=0),w3_innerHTML("id-fsk-phase","ϕ"+fsk.fr_phase.leadingZeros(2)),fsk_phase()}}function fsk_bpd_cb(s,e,f){fsk.fr_bpd=[0,5,6,7,8][e],fsk_phase()}function fsk_test_cb(s,e,f){ext_send("SET test")}function FSK_blur(){ext_unregister_audio_data_cb(),ext_set_mode(fsk.saved_mode),fsk_crosshairs(0),kiwi_clearInterval(fsk.log_interval)}function FSK_config_html(){var s=w3_inline_percent("w3-container",w3_div("w3-restart",w3_input_get("","Test filename","fsk.test_file","w3_string_set_cfg_cb","FSK.test.12k.au")),40);ext_config_html(fsk,"fsk","FSK","FSK configuration",s)}function FSK_help(s){if(s){var e=w3_text("w3-medium w3-bold w3-text-aqua","FSK decoder help")+"<br>Decoding FSK is not always easy because of the many signal parameters involved. <br>Try the stations listed in the menus. Most of these are best heard from Kiwis in Europe. <br><br>The frequency shift can be set by zooming in sufficiently, centering the passband between <br>the two tones, and selecting a menu shift (or setting a custom shift) so that the <br>checkered crosshairs align on the tones. The scope and framing modes are to assist in setting the correct baud rate and framing. <br><br>URL parameters: <br>First parameter can be a frequency matching an entry in station menus. <br>shift:<i>num</i> &nbsp; baud:<i>num</i> &nbsp; framing:<i>value</i> &nbsp; encoding:<i>value</i> &nbsp; inverted<i>[:0|1]</i> &nbsp; log_time:<i>mins</i> <br>Values are those appearing in their respective menus. <br>Any number for shift and baud can be used. Not just the preset values in the menus. <br>Keywords are case-insensitive and can be abbreviated. <br>So for example this is valid: <i>ext=fsk,147.3,s:425,b:200,a,i:0</i> &nbsp; <i>ext=fsk,2474,log:5 <br>";confirmation_show_content(e,610,300)}return!0}


