function JNX(){var t=this;t.State_e={NOSIGNAL:0,SYNC1:1,SYNC2:2,READ_DATA:3,FIXED_LENGTH:4},t.states=["NOSIGNAL","SYNC1","SYNC2","READ_DATA","FIXED_LENGTH"],t.state=t.State_e.NOSIGNAL,t.fp_OFF=0,t.fp_WAIT=1,t.fp_WAIT2=2,t.fp_START=3,t.fp_PASS=4,t.invsqr2=1/Math.sqrt(2),t.audio_average=0,t.signal_accumulator=0,t.bit_duration=0,t.succeed_tally=t.fail_tally=0,t.bit_count=t.code_bits=t.code_word=t.idle_word=0,t.error_count=t.valid_count=0,t.inverted=0,t.biquad_mark=new BiQuadraticFilter,t.biquad_space=new BiQuadraticFilter,t.biquad_lowpass=new BiQuadraticFilter}JNX.prototype.setup_values=function(t,_,e,s,a,c,o){var i=this;switch(i.sample_rate=t,i.center_frequency_f=null==_?500:_,i.baud_rate=null==s?100:s,i.shift_Hz=null==e?850:e,i.deviation_f=i.shift_Hz/2,i.lowpass_filter_f=140,i.audio_average_tc=1e3/t,i.audio_minimum=256,i.baud_rate=i.baud_rate<10?10:i.baud_rate,i.bit_duration_seconds=1/i.baud_rate,i.bit_sample_count=Math.floor(i.sample_rate*i.bit_duration_seconds+.5),i.half_bit_sample_count=i.bit_sample_count/2,i.framing=a,i.stop_variable=a.endsWith("V")||a.includes("EFR")?1:0,"CHU"==a?(i.fp=i.fp_WAIT,i.fp_mark_bits=32,i.fp_pass_bits=110):i.fp=i.fp_OFF,dbgUs&&"CHU"==a&&(i.chu_dbg=1),i.inverted=c,o){case"ITA2":case"ASCII":default:i.encoding=new FSK_async(a,o);break;case"CCIR476":i.encoding=new CCIR476}i.msb=i.encoding.get_msb(),i.nbits=i.encoding.get_nbits(),i.pulse_edge_event=!1,i.error_count=0,i.valid_count=0,i.bbuffer=[],i.out_buffer=[],i.sbuffer=[],i.sample_count=0,i.next_event_count=0,i.averaged_mark_state=0,i.zero_crossing_samples=16,i.zero_crossings_divisor=4,i.zero_crossing_count=0,i.zero_crossings=[],i.sync_delta=0,i.update_filters(),i.state=i.State_e.NOSIGNAL},JNX.prototype.set_baud_error_cb=function(t){this.baud_error_cb=t},JNX.prototype.set_scope_cb=function(t){this.scope_cb=t},JNX.prototype.set_output_char_cb=function(t){this.output_char_cb=t},JNX.prototype.set_output_bit_cb=function(t){this.output_bit_cb=t},JNX.prototype.get_encoding_obj=function(t){return this.encoding},JNX.prototype.update_filters=function(){this.set_filter_values(),this.configure_filters()},JNX.prototype.set_filter_values=function(){var t=this;t.mark_space_filter_q=6*t.center_frequency_f/1e3;var _=t.center_frequency_f+4e3/t.center_frequency_f;t.mark_f=_+t.deviation_f,t.space_f=_-t.deviation_f},JNX.prototype.configure_filters=function(){var t=this;t.biquad_mark.configure(t.biquad_mark.Type_e.BANDPASS,t.mark_f,t.sample_rate,t.mark_space_filter_q),t.biquad_space.configure(t.biquad_space.Type_e.BANDPASS,t.space_f,t.sample_rate,t.mark_space_filter_q),t.biquad_lowpass.configure(t.biquad_lowpass.Type_e.LOWPASS,t.lowpass_filter_f,t.sample_rate,t.invsqr2)},JNX.prototype.set_state=function(t){t!=this.state&&(this.state=t)},JNX.prototype.process_data=function(t,_){for(var e,s,a,c,o=this,i=0;i<_;i++){var n=t[i];e=o.biquad_mark.filter(n),s=o.biquad_space.filter(n),a=Math.abs(e),c=Math.abs(s),o.audio_average+=(Math.max(a,c)-o.audio_average)*o.audio_average_tc,o.audio_average=Math.max(.1,o.audio_average);var r=a-c;r/=o.audio_average,n/=o.audio_average,e/=o.audio_average,s/=o.audio_average;var u=o.biquad_lowpass.filter(r),l=u>0;if(o.signal_accumulator+=l?1:-1,o.bit_duration++,null!=o.zero_crossings){if(l!=o.old_mark_state){if(o.bit_duration%o.bit_sample_count>o.half_bit_sample_count){var b=Math.floor((o.sample_count-o.next_event_count+8*o.bit_sample_count)%o.bit_sample_count);o.zero_crossings[b/o.zero_crossings_divisor]++}o.bit_duration=0}if(o.old_mark_state=l,o.sample_count%o.bit_sample_count==0&&(o.zero_crossing_count++,o.zero_crossing_count>=o.zero_crossing_samples)){for(var p,d=0,f=(b=0,0);f<o.zero_crossings.length;f++)p=o.zero_crossings[f],o.zero_crossings[f]=0,p>d&&(d=p,b=f);d>0&&(b=((b*=o.zero_crossings_divisor)+o.half_bit_sample_count)%o.bit_sample_count-o.half_bit_sample_count,b/=8,o.sync_delta=b,o.baud_error=b,o.baud_error_cb(o.baud_error)),o.zero_crossing_count=0}}if(o.pulse_edge_event=o.sample_count>=o.next_event_count,o.pulse_edge_event&&(o.averaged_mark_state=o.signal_accumulator>0^o.inverted,o.signal_accumulator=0,o.next_event_count=o.sample_count+o.bit_sample_count+Math.floor(o.sync_delta+.5),o.sync_delta=0),o.scope_cb&&o.scope_cb(u,o.pulse_edge_event?1:0,o.averaged_mark_state?1:0),o.output_bit_cb&&o.pulse_edge_event&&o.output_bit_cb(o.averaged_mark_state?1:0),o.audio_average<o.audio_minimum&&o.state!=o.State_e.NOSIGNAL?o.set_state(o.State_e.NOSIGNAL):o.state==o.State_e.NOSIGNAL&&(o.sync_setup=1),o.pulse_edge_event){var g=o.averaged_mark_state?1:0;if(o.fp!=o.fp_START&&o.fp!=o.fp_PASS||(o.fp==o.fp_START&&(o.fp=o.fp_PASS),o.fp_count++,o.fp_count>o.fp_pass_bits&&(o.fp=o.fp_WAIT)),o.fp==o.fp_WAIT||o.fp==o.fp_WAIT2){if(o.fp==o.fp_WAIT&&(o.fp_count=0,o.fp=o.fp_WAIT2),!(o.fp_count>=o.fp_mark_bits&&0==g)){1==g?o.fp_count++:o.fp_count=0,o.sample_count++;continue}o.fp_count=0,o.sync_setup=1,o.fp=o.fp_START}if(o.chu_dbg)if(o.fp==o.fp_START&&(o.chu_bn=0,o.chu_cc=0,o.chu_s1=""),0==o.chu_bn&&(o.chu_s=g+" ",o.chu_v=0),o.chu_bn>=1&&o.chu_bn<=8&&(o.chu_s+=g,o.chu_v>>=1,o.chu_v|=g?128:0),8==o.chu_bn&&(o.chu_s+=" "),o.chu_bn>=9&&o.chu_bn<=10&&(o.chu_s+=g,o.chu_s1+=g),10==o.chu_bn){var h=o.chu_v;h=(15&h)<<4&240|(240&h)>>>4&15,o.chu_s=o.chu_cc.leadingZeros(2)+": "+o.chu_s+" "+h.toHex(-2)+" ^"+(255^h).toHex(-2)+" ",o.chu_s1+="_"+h.toHex(-2)+" ",o.chu_bn=0,o.chu_cc++,5==o.chu_cc&&(o.chu_s1+=" |  "),10==o.chu_cc&&(o.chu_bn=11,o.chu_cc=0,console.log(o.chu_s1))}else o.chu_bn++;switch(o.sync_setup&&(o.bit_count=0,o.code_bits=0,o.error_count=0,o.valid_count=0,o.encoding.reset(),o.sync_chars=[],o.fp==o.fp_START?o.set_state(o.State_e.FIXED_LENGTH):o.set_state(o.State_e.SYNC1),o.sync_setup=0),o.state){case o.State_e.SYNC1:o.code_bits=o.code_bits>>1|(g?o.msb:0),o.dbg&&console.log("SYNC1 "+(g?1:0)+" 0x"+o.code_bits.toString(16)),o.encoding.check_bits(o.code_bits)&&(o.sync_chars.push(o.code_bits),o.valid_count++,o.dbg&&console.log("SYNC1 OK: first valid sync_chars. len="+o.sync_chars.length),o.bit_count=0,o.code_bits=0,o.set_state(o.State_e.SYNC2),o.waiting=!0);break;case o.State_e.SYNC2:if(o.stop_variable&&o.waiting&&1==g){o.dbg&&console.log("SYNC2 waiting");break}if(o.waiting=!1,o.code_bits=o.code_bits>>1|(g?o.msb:0),o.dbg&&console.log("SYNC2-"+o.bit_count+" "+(g?1:0)+" 0x"+o.code_bits.toString(16)),o.bit_count++,o.bit_count==o.nbits){if(o.dbg&&console.log("SYNC2 0x"+o.code_bits.toString(16)),o.encoding.check_bits(o.code_bits)){if(o.sync_chars.push(o.code_bits),o.code_bits=0,o.bit_count=0,o.valid_count++,o.dbg&&console.log("SYNC2 OK: valid_count="+o.valid_count+" sync_chars.len="+o.sync_chars.length),4==o.valid_count){for(var v=0;v<o.sync_chars.length;v++){1==(m=o.encoding.process_char(o.sync_chars[v],0,o.output_char_cb)).tally?o.succeed_tally++:-1==m.tally&&o.fail_tally++}o.set_state(o.State_e.READ_DATA),o.dbg&&console.log("READ_DATA sync_chars.len="+o.sync_chars.length)}}else o.code_bits=0,o.bit_count=0,o.dbg&&console.log("SYNC2 BAD: restarting sync"),o.sync_setup=1;o.waiting=!0}break;case o.State_e.READ_DATA:if(o.stop_variable&&o.waiting&&1==g){o.dbg&&console.log("READ_DATA waiting");break}var m;if(o.waiting=!1,o.code_bits=o.code_bits>>1|(g?o.msb:0),o.bit_count++,o.bit_count==o.nbits)o.error_count>0&&o.dbg&&console.log("READ_DATA: error count="+o.error_count),1==(m=o.encoding.process_char(o.code_bits,0,o.output_char_cb)).tally?o.succeed_tally++:-1==m.tally&&o.fail_tally++,m.success?o.error_count>0&&o.error_count--:(o.error_count++,o.error_count>2&&(o.dbg&&console.log("READ_DATA: returning to sync"),o.sync_setup=1)),o.bit_count=0,o.code_bits=0,o.waiting=!0;break;case o.State_e.FIXED_LENGTH:o.fp==o.fp_START&&(o.fixed_start=1),o.code_bits=o.code_bits>>1|(g?o.msb:0),o.bit_count++,o.bit_count==o.nbits&&(o.encoding.process_char(o.code_bits,o.fixed_start,o.output_char_cb),o.bit_count=0,o.code_bits=0,o.fixed_start=0)}o.sample_count++}else o.sample_count++}};