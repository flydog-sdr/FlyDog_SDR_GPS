

/* web/extensions/wspr/wspr.min.js (web/extensions/wspr/wspr.js = Sun Aug  7 13:14:18 2022) */
var wspr={ext_name:"wspr",first_time:!0,focus_interval:null,server_time_ms:0,local_time_epoch_ms:0,pie_size:25,stack_decoder:0,debug:0,no_upload:0,pie_interval:null,hop_period:20,SYNC:!0,NO_SYNC:!1},wspr_canvas_width=1024;function wspr_main(){ext_switch_to_client(wspr.ext_name,wspr.first_time,wspr_recv),wspr.first_time||wspr_controls_setup(),wspr.first_time=!1}var wspr_bins,wspr_startx,wspr_cmd_e={WSPR_DATA:0},wspr_cmd_d={0:"WSPR_DATA"},aw_ypos=0,y_tstamp=-1,span=0,over=16;function wspr_scroll(){var r=wccva.height;wccva.style.top=r-aw_ypos+"px",wccvao.style.top=-aw_ypos+"px",r<=++aw_ypos&&(aw_ypos=0,r=wccvao,wccvao=wccva,wccva=r)}var WSPR_F_BIN=4095,WSPR_F_DECODING=4096,WSPR_F_DELETE=8192,WSPR_F_DECODED=16384,WSPR_F_IMAGE=32768;function wspr_recv(r){if("DAT"!=arrayBufferToStringLen(r,3))for(var e=arrayBufferToString(r).substring(4).split(" "),t=0;t<e.length;t++){var s=e[t].split("=");switch(0,s[0]){case"ready":var _=parseInt(ext_get_cfg_param("WSPR.BFO",wspr_bfo));isNaN(_)||(wspr_bfo=_),ext_send("SET BFO="+wspr_bfo.toFixed(0)),wspr_controls_setup(),ext_send("SET stack_decoder="+wspr.stack_decoder),ext_send("SET debug="+wspr.debug);break;case"WSPR_TIME_MSEC":wspr.server_time_ms=1e3*s[1]+ +s[2],wspr.local_time_epoch_ms=Date.now();break;case"WSPR_SYNC":break;case"WSPR_STATUS":wspr_set_status(parseInt(s[1]));break;case"WSPR_DECODED":var a=decodeURIComponent(s[1]),i=w3_el("id-wspr-decode"),_=w3_isScrolledDown(i);i.innerHTML+=a+"<br>",_&&w3_scrollDown(i);break;case"WSPR_UPLOAD":a=decodeURIComponent(s[1]);wspr_upload(wspr_report_e.SPOT,a);break;case"WSPR_PEAKS":var w,p=0;""!=(a=decodeURIComponent(s[1]))&&(w=a.split(":")).length&&(p=(w.length-1)/2);for(t=0;t<p;t++){var o=parseInt(w[2*t]),n=o&~WSPR_F_BIN;if(o&=WSPR_F_BIN,!(n&WSPR_F_DELETE)){var c,l=wspr_startx+2*o;if(wspr_canvas_width<l)break;c=t<p-1?wspr_startx+2*parseInt(w[2*(t+1)]):wspr_canvas_width,wspr_canvas_width<=c&&(c=wspr_canvas_width+256);var d=w[2*t+1],o=d.filterInt(),n=isNaN(o)?n&WSPR_F_IMAGE?"cl-wspr-image":"cl-wspr-call":(d=o.toFixed(0),n&WSPR_F_DECODING?"cl-wspr-decoding":"");a+=w3_div("cl-wspr-mkr1|max-width:"+(c-l)+"px; left:"+(l-6)+"px; bottom:8px",w3_div("cl-wspr-mkr2",w3_div("cl-wspr-snr "+n,d)))+w3_div("cl-wspr-line "+n+"|width:1px; height:10px; position:absolute; left:"+l+"px; bottom:0px;")}}html("id-wspr-peaks-labels").innerHTML=a;break;case"nbins":wspr_bins=parseInt(s[1]),wspr_startx=Math.round((wspr_canvas_width-2*wspr_bins)/2);break;default:console.log("wspr_recv: UNKNOWN CMD "+s[0])}}else{var u=new Uint8Array(r,4),m=u[0];if(m==wspr_cmd_e.WSPR_DATA){var f=u.length-2,g=wccva.height;u[1]&&(y_tstamp=aw_ypos+12,wccva.ct.fillStyle="white",wccva.ct.fillRect(wspr_startx-over,aw_ypos,2*f+2*over,1),wspr_scroll());var b=wccva.im;for(t=0;t<f;t++){var v=u[2+t];for((v=255<v?255:v)<0&&(v=0),j=0;j<2;j++){var h=4*(2*t+j+wspr_startx);b.data[h]=color_map_r[v],b.data[1+h]=color_map_g[v],b.data[2+h]=color_map_b[v],b.data[3+h]=255}}wccva.ct.putImageData(b,0,aw_ypos),g<=y_tstamp&&aw_ypos==g-1&&(span=1),y_tstamp!=aw_ypos&&!span||(wccva.ct.fillStyle="white",wccva.ct.font="10px Verdana",r=wspr_server_Date(),wccva.ct.fillText(r.toUTCString().substr(17,5)+" UTC",wspr_startx+2*f+over,y_tstamp),span?(y_tstamp-=g,span=0):y_tstamp=-1),wspr_scroll()}else console.log("wspr_recv: DATA UNKNOWN cmd="+m+" len="+(u.length-1))}}var wspr_spectrum_A,wspr_spectrum_B,wspr_scale_canvas,wccva,wccva0,wspr_report_e={STATUS:0,SPOT:1},wspr_config={deco:1},wspr_config_okay=!0,wspr_init_band=-1;function wspr_controls_setup(){var r=time_display_html("wspr")+w3_div("id-wspr-peaks|width:1024px; height:30px; background-color:black; position:relative;",w3_div("id-wspr-peaks-labels|width:1024px; height:30px; position:absolute;"))+w3_div("id-wspr-spectrum|width:1024px; height:150px; overflow:hidden; position:relative;",'<canvas id="id-wspr-spectrum-A" width="1024" height="150" style="position:absolute">test</canvas>','<canvas id="id-wspr-spectrum-B" width="1024" height="150" style="position:absolute">test</canvas>')+w3_div("id-wspr-scale|width:1024px; height:20px; background-color:black; position:relative;",'<canvas id="id-wspr-scale-canvas" width="1024" height="20" style="position:absolute"></canvas>'),e=ext_get_cfg_param_string("WSPR.callsign","");null!=e&&null!=e&&""!=e||(wspr_config_okay=!(e="(not set)"));var t=kiwi.WSPR_rgrid;null==t||null==t||""==t?(wspr_config_okay=!(t="(not set)"),wspr.grid=""):wspr.grid=t;var s=ext_get_freq_range();if(32e3<s.lo_kHz&&32e3<s.hi_kHz){for(var _,a,i=!1,w=0;w<wspr_xvtr_center_freqs.length;w++)if((_=wspr_xvtr_center_freqs[w])>=s.lo_kHz&&_<=s.hi_kHz){i=!0;break}console.log("found="+i+" i="+w),wspr_center_freqs=[],wspr_freqs_s={},wspr_freqs_m=[],i&&(wspr_center_freqs[0]=_,a=wspr_xvtr_freqs_s[w],wspr_freqs_m=[a],(wspr_freqs_s[a]=0)<wspr_init_band&&(wspr_init_band=0))}t=w3_div("id-wspr-controls",w3_inline("w3-halign-space-between|width:83%/",w3_select("w3-text-red","","band","wspr_init_band",wspr_init_band,wspr_freqs_m,"wspr_band_select_cb"),w3_button("cl-wspr-button","stop","wspr_stop_start_cb"),w3_button("cl-wspr-button","clear","wspr_clear_cb"),w3_div("id-wspr-upload-bkg cl-upload-checkbox",'<input id="id-wspr-upload" type="checkbox" value="" onclick="wspr_set_upload_cb(this.checked)"> upload spots'),w3_div("w3-medium w3-text-aqua cl-viewer-label","<b>WSPR<br>viewer</b>")),w3_inline("w3-halign-space-between/",w3_div("cl-wspr-pie|background-color:#575757",kiwi_pie("id-wspr-pie",wspr.pie_size,"#eeeeee","deepSkyBlue")),w3_div("",w3_div("id-wspr-time cl-wspr-text"),w3_div("id-wspr-status cl-wspr-text")),w3_div("",w3_div("cl-wspr-text","BFO "+wspr_bfo),w3_div("id-wspr-cf cl-wspr-text")),w3_div("cl-wspr-text","reporter call "+e),w3_div("id-wspr-rgrid cl-wspr-text","reporter grid "+t)),w3_div("|background-color:lightGray; overflow:auto; width:100%; margin-top:5px; margin-bottom:0px; font-family:monospace; font-size:100%",'<pre style="display:inline"> UTC  dB   dT      Freq dF  Call   Grid    km  dBm</pre>')+w3_div("id-wspr-decode|white-space:pre; background-color:white; overflow:scroll; height:100px; width:100%; margin-top:0px; font-family:monospace; font-size:100%"));ext_panel_show(t,r,null),ext_set_controls_width_height(null,240),time_display_setup("wspr"),(wspr_spectrum_A=w3_el("id-wspr-spectrum-A")).ct=wspr_spectrum_A.getContext("2d"),wspr_spectrum_A.im=wspr_spectrum_A.ct.createImageData(1024,1),(wspr_spectrum_B=w3_el("id-wspr-spectrum-B")).ct=wspr_spectrum_B.getContext("2d"),wspr_spectrum_B.im=wspr_spectrum_B.ct.createImageData(1024,1),wccva=wspr_spectrum_A,wccvao=wspr_spectrum_B,(wspr_scale_canvas=w3_el("id-wspr-scale-canvas")).ct=wspr_scale_canvas.getContext("2d"),wspr.pie_interval=setInterval(wspr_draw_pie,1e3),wspr_draw_pie(),wspr_draw_scale(100),wspr_reset(),wspr_upload_timeout=setTimeout(function(){wspr_upload(wspr_report_e.STATUS)},1e3);r=ext_param();r?(r=r.toLowerCase().split(",")).forEach(function(r,e){var t;0==e&&isDefined(wspr_freqs_s[r])?(t=wspr_freqs_s[r],console.log("<"+r+"> "+e+" sel="+t),(e=wspr_center_freqs[t])>=s.lo_kHz&&e<=s.hi_kHz&&wspr_band_select_cb("wspr_init_band",t,!1)):r.startsWith("stack")?wspr.stack_decoder=1:r.startsWith("debug")?wspr.debug=1:r.startsWith("noupload")?wspr_set_upload_cb(!(wspr.no_upload=1)):console.log("WSPR unknown URL param <"+r+">")}):-1!=wspr_init_band&&wspr_freq(wspr_init_band)}function wspr_help(r){return console.log("wspr_help show="+r),!1}function wspr_band_select_cb(r,e,t){-1==(e=+e)||t||(w3_set_value(r,e),wspr_freq(wspr_init_band=e))}function wspr_focus(){}function wspr_blur(){ext_send("SET capture=0"),kiwi_clearTimeout(wspr_upload_timeout),kiwi_clearInterval(wspr.pie_interval)}function wspr_input_grid_cb(r,e,t){e=e.trim(),w3_string_set_cfg_cb(r,e),kiwi.WSPR_rgrid=e}var wspr_autorun_u=["regular use","LF","MF","160m","80m_JA","80m","60m","60m_EU","40m","30m","20m","17m","15m","12m","10m","6m","4m","2m","440","1296","ISM_6","ISM_13","IWBP"];function wspr_config_html(){var r=w3_div("w3-show-inline-block w3-foo w3-width-full",w3_col_percent("w3-container w3-restart/w3-margin-bottom",w3_input_get("","BFO Hz (multiple of 375 Hz)","WSPR.BFO","w3_num_set_cfg_cb","","typically 750 Hz"),24,""),w3_col_percent("w3-container w3-restart/w3-margin-bottom",w3_input_get("","Reporter callsign","WSPR.callsign","w3_string_set_cfg_cb",""),24,""),w3_col_percent("w3-container/w3-margin-bottom",w3_input_get("",w3_label("w3-bold","Reporter grid square ")+w3_div("id-wspr-grid-set cl-admin-check w3-blue w3-btn w3-round-large w3-hide","set from GPS"),"WSPR.grid","wspr_input_grid_cb","","4 or 6-character grid square location"),24,"",3,w3_divs("w3-center w3-tspace-8",w3_div("","<b>Update grid continuously<br>from GPS?</b>"),w3_switch("","Yes","No","cfg.WSPR.GPS_update_grid",cfg.WSPR.GPS_update_grid,"admin_radio_YN_cb"),w3_text("w3-text-black w3-center","Useful for Kiwis in motion <br> (e.g. marine mobile)")),22,"",3,w3_divs("w3-center w3-tspace-8",w3_div("","<b>Log decodes to<br>syslog?</b>"),w3_switch("","Yes","No","cfg.WSPR.syslog",cfg.WSPR.syslog,"admin_radio_YN_cb"),w3_text("w3-text-black w3-center","Use with care as over time <br> filesystem can fill up.")),22,"",3,w3_divs("w3-center w3-tspace-8",w3_div("","<b>Log spot debug<br>info?</b>"),w3_switch("","Yes","No","cfg.WSPR.spot_log",cfg.WSPR.spot_log,"admin_radio_YN_cb"),w3_text("w3-text-black w3-center","Logs the actual upload commands<br>used to assist in spot debugging."))),"<hr>",w3_div("w3-container",w3_div("","<b>Autorun</b>"),w3_div("w3-container",w3_div("w3-text-black",'On startup automatically begins running the WSPR decoder on the selected band(s).<br>Channels available for regular use are reduced by one for each WSPR autorun enabled.<br>If Kiwi has been configured for a mix of channels with and without waterfalls then channels without waterfalls will be used first.<br><br>Spot decodes are available in the Kiwi log (use "Log" tab above) and are listed on <a href="http://wsprnet.org/drupal/wsprnet/spots" target="_blank">wsprnet.org</a><br>The "Reporter" fields above must be set to valid values for proper spot entry into the <a href="http://wsprnet.org/drupal/wsprnet/spots" target="_blank">wsprnet.org</a> database.'),w3_div("w3-margin-T-10 w3-valign",'<header class="id-wspr-warn-full w3-container w3-yellow"><h6>If your Kiwi is publicly listed you must not configure all the channels to use WSPR-autorun!<br>This defeats the purpose of making your Kiwi public and public registration will be disabled<br>until you make at least one channel available for connection. Check the Admin Public tab.</h6></header>'),w3_button("id-wspr-restart w3-margin-T-16 w3-aqua w3-hide","autorun restart","wspr_autorun_restart_cb"),w3_div("id-wspr-admin-autorun w3-margin-T-16"))));ext_config_html(wspr,"WSPR","WSPR","WSPR configuration",r);for(var r="",e=0;e<rx_chans;){for(var t="",s=0;s<8&&e<rx_chans;s++,e++)t+=w3_select_get_param("w3-margin-right","Autorun "+e,"WSPR band","WSPR.autorun"+e,wspr_autorun_u,"wspr_autorun_select_cb");r+=w3_inline("w3-margin-bottom/",t)}w3_innerHTML("id-wspr-admin-autorun",r)}function wspr_autorun_public_check(){for(var r=0,e=0;e<rx_chans;e++)0!=cfg.WSPR["autorun"+e]&&r++;ext_set_cfg_param("WSPR.autorun",r,EXT_SAVE);var t=adm.kiwisdr_com_register&&r>=rx_chans;w3_remove_then_add_cond("id-wspr-warn-full",t,"w3-red","w3-yellow"),t&&kiwisdr_com_register_cb("adm.kiwisdr_com_register",w3_SWITCH_NO_IDX)}function wspr_autorun_restart_cb(){wspr_autorun_public_check(),w3_hide("id-wspr-restart"),ext_send("ADM wspr_autorun_restart")}function wspr_autorun_select_cb(r,e,t){admin_select_cb(r,e,t),t||(w3_show("id-wspr-restart"),t=w3_el("id-kiwi-container"),w3_scrollDown(t))}function wspr_config_focus(){wspr_autorun_public_check(),wspr_check_GPS_update_grid(),wspr.focus_interval=setInterval(function(){wspr_check_GPS_update_grid()},1e4);var r=w3_el("id-wspr-grid-set");r&&(r.onclick=function(){wspr.single_shot_update=!0,ext_send("ADM wspr_gps_info")})}function wspr_config_blur(){kiwi_clearInterval(wspr.focus_interval)}function wspr_check_GPS_update_grid(){w3_get_value("WSPR.grid")!=kiwi.WSPR_rgrid&&(w3_set_value("WSPR.grid",kiwi.WSPR_rgrid),w3_input_change("WSPR.grid")),kiwi.GPS_fixes&&w3_show_inline_block("id-wspr-grid-set"),wspr.single_shot_update=!1}function wspr_gps_info_cb(r){(cfg.WSPR.GPS_update_grid||wspr.single_shot_update)&&((r=kiwi_JSON_parse("wspr_gps_info_cb",r))&&(kiwi.WSPR_rgrid=r.grid,w3_set_value("WSPR.grid",kiwi.WSPR_rgrid),w3_input_change("WSPR.grid","wspr_input_grid_cb")),wspr.single_shot_update=!1)}var wspr_upload_timeout,wspr_stop_start_state=0;function wspr_stop_start_cb(r,e,t){0==wspr_stop_start_state?wspr_reset():-1!=wspr_init_band&&wspr_freq(wspr_init_band),wspr_stop_start_state^=1,w3_button_text(r,wspr_stop_start_state?"start":"stop")}function wspr_reset(){ext_send("SET capture=0"),wspr_set_status(wspr_status.IDLE),wspr_set_upload_cb(!0)}function wspr_clear_cb(r,e,t){wspr_reset(),html("id-wspr-decode").innerHTML="",html("id-wspr-peaks-labels").innerHTML=""}function wspr_draw_scale(r){wspr_scale_canvas.ct.fillStyle="black",wspr_scale_canvas.ct.fillRect(0,0,wspr_scale_canvas.width,wspr_scale_canvas.height);wspr_scale_canvas.ct.fillStyle="lime";var e,t=Math.round(512/375*50),s=Math.round(512/375*200);for(wspr_scale_canvas.ct.fillRect(wspr_startx+2*t,2,2*s,3),wspr_scale_canvas.ct.fillStyle="red",t=Math.round(512/375*150),wspr_scale_canvas.ct.fillRect(wspr_startx+2*t-2,2,5,3),wspr_scale_canvas.ct.fillStyle="white",wspr_scale_canvas.ct.font="10px Verdana",e=-150;e<=150;e+=50){var _=Math.round((e+150)*(512/375)),a=e+r;a<0&&(a+=1e3);var i=a<10?4:a<100?7:11;wspr_scale_canvas.ct.fillText(a.toFixed(0),wspr_startx+2*_-i,17)}}function wspr_set_upload_cb(r){deleteCookie("wspr_upload"),wspr_config_okay&&!wspr.no_upload||(r=!1),w3_checkbox_set("id-wspr-upload",r),w3_color("id-wspr-upload-bkg",r?"white":"black",r?"inherit":"yellow")}function wspr_upload(r,e){var t,s,_,a=r==wspr_report_e.SPOT?1:0,i=ext_get_cfg_param_string("WSPR.callsign",""),w=kiwi.WSPR_rgrid||cfg.WSPR.grid;wspr_rfreq&&wspr_tfreq&&null!=i&&null!=w&&null!=i&&null!=w&&""!=i&&""!=w&&0!=html("id-wspr-upload").checked?(a&&(t=e.replace(/[\s]+/g," ").split(" ")),r=kiwi_GETrequest(a?"spot":"stat","http://wsprnet.org/post"),kiwi_GETrequest_param(r,"function",a?"wspr":"wsprstat"),kiwi_GETrequest_param(r,"rcall",i),kiwi_GETrequest_param(r,"rgrid",w),kiwi_GETrequest_param(r,"rqrg",wspr_rfreq.toFixed(6)),_=a?(_=new Date,kiwi_GETrequest_param(r,"date",_.getUTCFullYear().toString().substr(2,2)+(_.getUTCMonth()+1).leadingZeros(2)+_.getUTCDate().leadingZeros(2)),kiwi_GETrequest_param(r,"time",t[0]),kiwi_GETrequest_param(r,"sig",t[1]),kiwi_GETrequest_param(r,"dt",t[2]),kiwi_GETrequest_param(r,"drift",t[4]),s=t[3],t[7]):(kiwi_GETrequest_param(r,"tpct","0"),s=wspr_tfreq.toFixed(6),"0"),kiwi_GETrequest_param(r,"tqrg",s),a&&(kiwi_GETrequest_param(r,"tcall",t[5]),kiwi_GETrequest_param(r,"tgrid","no_grid"!=t[6]?t[6]:"")),kiwi_GETrequest_param(r,"dbm",_),(_="1.4 Kiwi").length<=10&&(kiwi_GETrequest_param(r,"version",_),kiwi_GETrequest_submit(r,{gc:kiwi_gc_wspr}),r=new Date,console.log("WSPR "+(a?"SPOT":"STAT")+" "+r.toUTCString()+(a?" <"+e+">":""))),a||(wspr_upload_timeout=setTimeout(function(){wspr_upload(wspr_report_e.STATUS)},36e4))):wspr_upload_timeout=setTimeout(function(){wspr_upload(wspr_report_e.STATUS)},6e4)}var wspr_cur_status=0,wspr_status={NONE:0,IDLE:1,SYNC:2,RUNNING:3,DECODING:4},wspr_status_text={0:"none",1:"idle",2:"sync",3:"running",4:"decoding"},wspr_status_color={0:"white",1:"lightSkyBlue",2:"violet",3:"cyan",4:"lime"};function wspr_set_status(r){var e=html("id-wspr-status");e.innerHTML=wspr_status_text[r],e.style.backgroundColor=wspr_status_color[r],wspr_cur_status=r}function wspr_server_Date(){return new Date(wspr.server_time_ms+(Date.now()-wspr.local_time_epoch_ms))}function wspr_draw_pie(){var r=wspr_server_Date();html("id-wspr-time").innerHTML=r.toUTCString().substr(17,8)+" UTC";var e=r.getUTCMinutes(),t=60*(1&e)+r.getUTCSeconds()+1;kiwi_draw_pie("id-wspr-pie",wspr.pie_size,t/120);var s,_=kiwi.WSPR_rgrid||cfg.WSPR.grid;w3_innerHTML("id-wspr-rgrid","reporter grid<br>"+_+(cfg.WSPR.GPS_update_grid?" (GPS)":"")),wspr.IWBP&&110==t&&(s=Math.floor(e%wspr.hop_period/2),r=wspr_cf_IWBP[s],_=Math.floor((e+1)%wspr.hop_period/2),t=wspr_cf_IWBP[_],console.log("WSPR IWBP deco: #"+s+"/"+e+"m="+r+" capture: #"+_+"/"+(e+1)%60+"m="+t),wspr_change_freq(t,r,wspr.NO_SYNC))}var wspr_center_freqs=[137.5,475.7,1838.1,3570.1,3594.1,5288.7,5366.2,7040.1,10140.2,14097.1,18106.1,21096.1,24926.1,28126.1,6781.5,13555.4,9999],wspr_freqs_s={lf:0,mf:1,"160m":2,"80m_ja":3,"80m":4,"60m":5,"60m_eu":6,"40m":7,"30m":8,"20m":9,"17m":10,"15m":11,"12m":12,"10m":13,ism_6:14,ism_13:15,iwbp:16},wspr_freqs_m=["LF","MF","160m","80m_JA","80m","60m","60m_EU","40m","30m","20m","17m","15m","12m","10m","ISM_6","ISM_13","IWBP"],wspr_cf_IWBP=[1838.1,3570.1,5288.7,7040.1,10140.2,14097.1,18106.1,21096.1,24926.1,28126.1],wspr_xvtr_center_freqs=[50294.5,70092.5,144490.5,432301.5,1296501.5],wspr_xvtr_freqs_s=["6m","4m","2m","440","1296"],wspr_rfreq=0,wspr_tfreq=0,wspr_bfo=750,wspr_filter_bw=300;function wspr_freq(r){var e;wspr_reset(),wspr_change_freq(r="IWBP"==wspr_freqs_m[r]?(wspr.IWBP=!0,min=wspr_server_Date().getUTCMinutes(),e=Math.floor(min%wspr.hop_period/2),wspr_cf_IWBP[e]):(wspr.IWBP=!1,wspr_center_freqs[r]),r,wspr.SYNC)}function wspr_change_freq(r,e,t){var s=r-wspr_bfo/1e3,_=Math.round(1e3*(r-Math.floor(r))),a=e-wspr_bfo/1e3,i=Math.round(1e3*(e-Math.floor(e)));w3_el("id-wspr-cf").innerHTML="CF "+r.toFixed(1),wspr_rfreq=wspr_tfreq=r/1e3;s-=ext_get_freq_range().offset_kHz;ext_tune(s,"usb",ext_zoom.MAX_IN),ext_set_passband(wspr_bfo-wspr_filter_bw/2,wspr_bfo+wspr_filter_bw/2),ext_tune(s,"usb",ext_zoom.MAX_IN),wspr_draw_scale(_),ext_send("SET dialfreq="+a.toFixed(2)+" centerfreq="+e.toFixed(2)+" cf_offset="+i),t==wspr.SYNC&&ext_send("SET capture=1"),kiwi_clearTimeout(wspr_upload_timeout),wspr_upload_timeout=setTimeout(function(){wspr_upload(wspr_report_e.STATUS)},1e3)}



