

/* web/extensions/sig_gen/sig_gen.min.js (web/extensions/sig_gen/sig_gen.js = Fri Mar 31 10:57:04 2023) */
var gen={ext_name:"sig_gen",first_time:!0,freq:1e4,freq_stop:10006,step:.1,dwell:300,attn_dB:80,attn_ampl:0,filter:0,func:1,OFF:0,RF:1,AF:2,func_s:["off","RF tone","AF noise"],rf_enable:!0,sweeping:0,cicf:0,cich:0,cicw:0,attn_offset_val:0,attn_offset:1,attn_offset_s:["no offset","waterfall"]};function sig_gen_main(){ext_switch_to_client(gen.ext_name,gen.first_time,gen_recv),gen.first_time||gen_auth(),gen.first_time=!1}function gen_recv(e){if("DAT"!=arrayBufferToStringLen(e,3))for(var n=arrayBufferToString(e).substring(4).split(" "),t=0;t<n.length;t++){var _=n[t].split("=");0,"ready"===_[0]?gen_auth():console.log("gen_recv: UNKNOWN CMD "+_[0])}else{var g=new Uint8Array(e,4),e=g[0],g=g.length-1;console.log("gen_recv: DATA UNKNOWN cmd="+e+" len="+g)}}function gen_auth(){admin_pwd_query(function(){gen_controls_setup()})}function gen_controls_setup(){gen.attn_offset_s[1]="waterfall cal "+cfg.waterfall_cal+"dB",gen.save_freq=gen.freq;var e=0;gen.url_params=ext_param();var n=gen.url_params;n&&(n=n.split(","),isDefined(n[0])&&(gen.freq=+n[0]),isDefined(n[1])&&(gen.freq_stop=+n[1]),isDefined(n[2])&&(gen.step=+n[2]),isDefined(n[3])&&(gen.dwell=+n[3]),isDefined(n[4])&&(gen.attn_dB=+n[4]),isDefined(n[5])&&(e=+n[5]),gen.attn_dB<0&&(gen.attn_dB=-gen.attn_dB));n=w3_div("id-test-controls w3-text-white",w3_divs("/w3-tspace-8",w3_div("w3-medium w3-text-aqua","<b>Signal generator</b>"),w3_div("","All frequencies in kHz"),w3_inline("",w3_input("w3-padding-small w3-width-90 w3-margin-right","Start","gen.freq",gen.freq,"gen_freq_cb"),w3_input("w3-padding-small w3-width-90 w3-margin-right","Stop","gen.freq_stop",gen.freq_stop,"gen_stop_cb"),w3_input("w3-padding-small w3-width-90 w3-margin-right","Step","gen.step",gen.step,"gen_step_cb"),w3_input("w3-padding-small w3-width-90","Dwell (ms)","gen.dwell",gen.dwell,"w3_num_cb")),w3_inline("w3-margin-top/w3-margin-between-16 w3-valign",w3_select("w3-text-red","Function","","gen.func",gen.func,gen.func_s,"gen_func_cb"),w3_button("w3-red","-Step","gen_step_up_down_cb",-1),w3_button("w3-green","+Step","gen_step_up_down_cb",1),w3_button("id-gen-sweep w3-css-yellow","Sweep","gen_sweep_cb"),dbgUs?w3_checkbox("w3-label-inline w3-label-not-bold","CICF<br>filter","gen.cicf",gen.cicf,"gen_cicf_cb"):"",dbgUs?w3_checkbox("w3-label-inline w3-label-not-bold","HW<br>filter","gen.cich",gen.cich,"gen_cich_cb"):"",dbgUs?w3_checkbox("w3-label-inline w3-label-not-bold","FW<br>filter","gen.cicw",gen.cicw,"gen_cicw_cb"):""),w3_col_percent("w3-margin-top",w3_slider("","Attenuation","gen.attn_dB",gen.attn_dB,0,100,5,"gen_attn_cb"),35,w3_div(""),10,w3_div("",w3_div("","Offset attenuation by:"),w3_select("w3-text-red w3-width-auto","","","gen.attn_offset",gen.attn_offset,gen.attn_offset_s,"gen_attn_offset_cb")),55)));ext_panel_show(n,null,null),ext_set_controls_width_height(dbgUs?575:450,250),gen_freq_cb("gen.freq",gen.freq),null==kiwi_url_param("f",null,null)&&ext_tune(gen.freq,null,ext_zoom.CUR),toggle_or_set_spec(toggle_e.SET,spec.RF),spec.saved_audio_comp=ext_get_audio_comp(),spec.saved_audio_comp&&ext_set_audio_comp(!1),ext_send("SET wf_comp=0"),e&&gen_sweep_cb()}function gen_set(e,n,t){1!=t&&!gen.rf_enable||set_gen(e,n)}function gen_run(){var e=(gen.func==gen.RF?1:gen.func==gen.AF?2:0)|(gen.cicf?4:0)|(gen.cich?8:0)|(gen.cicw?16:0);ext_send("SET run="+e)}function gen_func_cb(e,n,t){gen.func=+n,gen.rf_enable=gen.func==gen.RF,!gen.rf_enable&&gen.sweeping&&gen_sweep_cancel(),gen_attn_cb("gen.attn_dB",gen.attn_dB,!0),gen_set(gen.rf_enable?gen.freq:0,gen.attn_ampl,!0),colormap_update(),gen_run()}function gen_cicf_cb(e,n,t){t||(w3_bool_cb(e,n,t),gen_run())}function gen_cich_cb(e,n,t){t||(w3_bool_cb(e,n,t),gen_run())}function gen_cicw_cb(e,n,t){t||(w3_bool_cb(e,n,t),gen_run())}function gen_freq_cb(e,n){gen.freq=n.toString().parseFloatWithUnits("kM",.001,3),w3_num_cb(e,gen.freq),w3_set_value(e,gen.freq),gen.old_freq&&gen_set(gen.old_freq,0),gen_set(gen.freq,0),gen_set(gen.freq,gen.attn_ampl),gen.old_freq=gen.freq}function gen_stop_cb(e,n,t){gen.freq_stop=n.parseFloatWithUnits("kM",.001,3),w3_num_cb(e,gen.freq_stop),w3_set_value(e,gen.freq_stop)}function gen_step_cb(e,n,t){console.log("gen_step_cb: val="+n+" "+typeof n),gen.step=n.parseFloatWithUnits("kM",.001,3),w3_num_cb(e,gen.step),w3_set_value(e,gen.step)}function gen_step_up_down_cb(e,n,t){n=parseInt(n)*gen.step;console.log("gen_step_up_down_cb: step="+n+" "+typeof n),gen.freq+=n,gen.freq=w3_clamp(gen.freq,0,cfg.max_freq?32e3:3e4),gen_freq_cb("gen.freq",gen.freq)}function gen_sweep_cancel(){kiwi_clearInterval(gen.sweep_interval),gen_freq_cb("gen.freq",gen.save_freq),w3_button_text("id-gen-sweep","Sweep","w3-css-yellow","w3-red"),gen.sweeping=0}function gen_sweep_cb(e,n,t){t||(!gen.sweeping&&gen.rf_enable?(gen.save_freq=gen.freq,w3_button_text("id-gen-sweep","Stop","w3-red","w3-css-yellow"),console.log("$ gen_sweep_cb"),gen.sweep_interval=setInterval(function(){var e=gen.freq;gen.freq+=gen.step,console.log("gen_sweep_cb "+e.toFixed(3)+"|"+gen.step.toFixed(3)+"|"+gen.freq.toFixed(3)),(0<gen.step&&gen.freq>gen.freq_stop||gen.step<0&&gen.freq<gen.freq_stop||gen.freq<.01||gen.freq>(cfg.max_freq?32e3:3e4))&&gen_sweep_cancel(),gen_freq_cb("gen.freq",gen.freq)},gen.dwell),gen.sweeping=1):gen_sweep_cancel())}function gen_attn_cb(e,n,t){gen.attn_dB=+n;n=gen.attn_dB+(gen.func==gen.RF?gen.attn_offset_val:0);n<0&&(n=0);n=Math.pow(10,-n/20);gen.attn_ampl=131071*n,w3_num_cb(e,gen.attn_dB),w3_set_label("Attenuation "+(-gen.attn_dB).toString()+" dB",e),t&&(gen_set(gen.freq,gen.attn_ampl),ext_send("SET attn="+gen.attn_ampl.toFixed(0)),colormap_update())}function gen_attn_offset_cb(e,n,t){n=+n,gen.attn_offset_val=0==n?0:cfg.waterfall_cal,gen_attn_cb("gen.attn_dB",gen.attn_dB,!0)}function sig_gen_blur(){gen_set(0,0,!0),ext_send("SET run=0"),spec.saved_audio_comp&&ext_set_audio_comp(!0),ext_send("SET wf_comp=1"),toggle_or_set_spec(toggle_e.SET,spec.NONE)}function sig_gen_config_html(){ext_config_html(gen,"sig_gen","Sig Gen","Signal Generator configuration")}



