

/* web/extensions/S_meter/S_meter.min.js (web/extensions/S_meter/S_meter.js = Sun Oct 10 08:46:18 2021) */
var S_meter={ext_name:"S_meter",first_time:!0,stop_start_state:0,update_interval:null,show_adc_ovfl:!0,have_adc_ovfl:0,maxdb_init:-30,mindb_init:-130,maxdb:0,mindb:0,speed_i:13,speed_max:13,range_s:["manual","auto"],range_i:0,range_MANUAL:0,range_AUTO:1,marker_sec:[1,5,10,15,30,60,300,600,900,1800,3600],marker_s:["1 sec","5 sec","10 sec","15 sec","30 sec","1 min","5 min","10 min","15 min","30 min","1 hr"],marker_i:0,marker_v:1,sm_last_freq:null,sm_last_mode:null,div:0,xendx:0};function S_meter_main(){ext_switch_to_client(S_meter.ext_name,S_meter.first_time,S_meter_recv),S_meter.first_time||S_meter_controls_setup(),S_meter.first_time=!1}S_meter.maxdb=S_meter.maxdb_init,S_meter.mindb=S_meter.mindb_init;var sm_w=1024,sm_h=180,sm_padding=10,sm_tw=sm_w+2*sm_padding;function S_meter_recv(e){if("DAT"!=arrayBufferToStringLen(e,3))for(var t=arrayBufferToString(e).substring(4).split(" "),_=0;_<t.length;_++){var r=t[_].split("=");switch(r[0]){case"ready":kiwi_load_js(["pkgs/js/graph.js"],"S_meter_controls_setup");break;case"smeter":0==S_meter.stop_start_state&&(S_meter.last_plot=parseFloat(r[1]),graph_plot(S_meter.gr,S_meter.last_plot),S_meter.show_adc_ovfl&&S_meter.have_adc_ovfl&&graph_annotate(S_meter.gr,"red"));break;default:console.log("S_meter_recv: UNKNOWN CMD "+r[0])}}else{var a=new Uint8Array(e,4),m=a[0],n=a.length-1;console.log("S_meter_recv: DATA UNKNOWN cmd="+m+" len="+n)}}function S_meter_controls_setup(){var e=time_display_html("S_meter")+w3_div("id-S_meter-data|left:150px; width:1044px; height:200px; background-color:mediumBlue; position:relative;",'<canvas id="id-S_meter-data-canvas" width="1024" height="180" style="position:absolute; padding: 10px;"></canvas>'),t=w3_div("id-S_meter-controls w3-text-white",w3_divs("/w3-tspace-8",w3_div("id-S_meter-info w3-medium w3-text-aqua","<b>S-meter graph</b>"),w3_inline("w3-halign-space-between/",w3_select("w3-text-red","Range","","S_meter.range_i",S_meter.range_i,S_meter.range_s,"S_meter_range_select_cb"),w3_select("w3-text-red","Marker rate","","S_meter.marker_i",S_meter.marker_i,S_meter.marker_s,"S_meter_marker_select_cb")),w3_div("id-S_meter-scale-sliders",w3_slider("","Scale max","S_meter.maxdb",S_meter.maxdb,-160,0,10,"S_meter_maxdb_cb"),w3_slider("","Scale min","S_meter.mindb",S_meter.mindb,-160,0,10,"S_meter_mindb_cb")),w3_slider("","Speed","S_meter.speed_i",S_meter.speed_i,1,S_meter.speed_max,1,"S_meter_speed_cb"),w3_inline("w3-halign-space-between/",w3_button("w3-padding-smaller","Stop","S_meter_stop_start_cb"),w3_button("w3-padding-smaller","Mark","S_meter_mark_cb"),w3_button("w3-padding-smaller","Clear","S_meter_clear_cb")),w3_inline("w3-halign-space-between/",w3_checkbox("/w3-label-inline","Averaging","S_meter.averaging",!0,"S_meter_averaging_cb"),w3_checkbox("/w3-label-inline","Timestamp","S_meter.timestamp",!1,"S_meter_timestamp_cb")),w3_checkbox("/w3-label-inline","Show ADC overflow","S_meter.show_adc_ovfl",!0,"w3_bool_cb")));ext_panel_show(t,e,null),time_display_setup("S_meter"),S_meter.data=w3_el("id-S_meter-data"),S_meter.data_canvas=w3_el("id-S_meter-data-canvas"),S_meter.data_canvas.ctx=S_meter.data_canvas.getContext("2d"),S_meter.gr=graph_init(S_meter.data_canvas,{dBm:1,averaging:!0}),S_meter_auto_man(),S_meter_environment_changed({resize:1}),ext_send("SET run=1"),S_meter.update_interval=setInterval(function(){S_meter_update(0)},1e3),S_meter_update(1)}function S_meter_auto_man(){ext_set_controls_width_height(250,S_meter.range_i==S_meter.range_AUTO?245:335),graph_mode(S_meter.gr,S_meter.range_i==S_meter.range_AUTO?"auto":"fixed",S_meter.maxdb,S_meter.mindb)}function S_meter_environment_changed(e){if(e.resize){var t,_=w3_el("id-S_meter-data"),r=(window.innerWidth-sm_tw-time_display_width())/2;if(w3_show_hide("S_meter-time-display",r>0),r>0)return t=sm_w,S_meter.data.style.width=px(t+2*sm_padding),S_meter.data_canvas.width=t,_.style.left=px(r),void graph_clear(S_meter.gr);if((r=(window.innerWidth-sm_tw)/2)>0)return t=sm_w,S_meter.data.style.width=px(t+2*sm_padding),S_meter.data_canvas.width=t,_.style.left=px(r),void graph_clear(S_meter.gr);t=window.innerWidth-30,console.log("shrink to "+t),S_meter.data.style.width=px(t),S_meter.data_canvas.width=t-2*sm_padding,_.style.left=px(15),graph_clear(S_meter.gr),S_meter_update(1)}}function S_meter_range_select_cb(e,t,_){_||(S_meter.range_i=+t,w3_show_hide("id-S_meter-scale-sliders",S_meter.range_i==S_meter.range_MANUAL),S_meter_auto_man())}function S_meter_maxdb_cb(e,t,_){var r=+t;r=Math.max(S_meter.mindb,r),w3_num_cb(e,r.toString()),w3_set_label("Scale max "+r.toString()+" dBm",e),S_meter_auto_man()}function S_meter_mindb_cb(e,t,_){var r=+t;r=Math.min(r,S_meter.maxdb),w3_num_cb(e,r.toString()),w3_set_label("Scale min "+r.toString()+" dBm",e),S_meter_auto_man()}function S_meter_speed_cb(e,t,_){var r=+t,a=Math.round(Math.pow(2,S_meter.speed_max-r));w3_num_cb(e,r.toString()),w3_set_label("Speed 1"+(1!=a?"/"+a.toString():""),e),graph_speed(S_meter.gr,a)}function S_meter_marker_select_cb(e,t){S_meter.marker_v=S_meter.marker_sec[+t],graph_marker(S_meter.gr,S_meter.marker_v)}function S_meter_stop_start_cb(e,t,_){S_meter.stop_start_state^=1,w3_button_text(e,S_meter.stop_start_state?"Start":"Stop")}function S_meter_mark_cb(e,t,_){graph_annotate(S_meter.gr,"magenta"),S_meter.stop_start_state&&graph_plot(S_meter.gr,S_meter.last_plot)}function S_meter_clear_cb(e,t){graph_clear(S_meter.gr),setTimeout(function(){w3_radio_unhighlight(e)},w3_highlight_time)}function S_meter_averaging_cb(e,t,_){_||graph_averaging(S_meter.gr,t)}function S_meter_timestamp_cb(e,t,_){_||graph_timestamp(S_meter.gr,t)}function S_meter_update(e){var t=ext_get_freq(),_=ext_get_mode(),r=t!=S_meter.sm_last_freq,a=_!=S_meter.sm_last_mode;(e||r||a)&&(e||(r&&graph_annotate(S_meter.gr,"lime"),a&&graph_annotate(S_meter.gr,"cyan")),S_meter.sm_last_freq=t,S_meter.sm_last_mode=_)}function S_meter_adc_ovfl(e){S_meter.have_adc_ovfl=e}function S_meter_blur(){ext_send("SET run=0"),kiwi_clearInterval(S_meter.update_interval)}function S_meter_config_html(){ext_config_html(S_meter,"S_meter","S-meter","S-meter graph configuration")}


