

/* web/extensions/noise_blank/noise_blank.min.js */
var noise_blank={ext_name:"noise_blank",first_time:!0,algo:0,algo_s:["(none selected)","standard blanker","Wild algorithm"],width:400,height:[185,310,350],NB_OFF:0,blanker:0,test:0,test_s:["test off","test on: pre filter (std)","test on: post filter (Wild)"],test_gain:0,test_width:1,wf:1,NB_BLANKER:0,NB_WF:1,NB_CLICK:2,NB_STD:1,gate:0,threshold:0,NB_WILD:2,thresh:.95,taps:10,impulse_samples:7};function noise_blank_main(){ext_switch_to_client(noise_blank.ext_name,noise_blank.first_time,noise_blank_recv),noise_blank.first_time||noise_blank_controls_setup(),noise_blank.first_time=!1}function noise_blank_recv(n){if("DAT"!=arrayBufferToStringLen(n,3))for(var e=arrayBufferToString(n).substring(4).split(" "),_=0;_<e.length;_++){var s=e[_].split("=");switch(s[0]){case"ready":noise_blank_controls_setup();break;default:console.log("noise_blank_recv: UNKNOWN CMD "+s[0])}}else{var l=new Uint8Array(n,4),o=l[0],a=l.length-1;console.log("noise_blank_recv: DATA UNKNOWN cmd="+o+" len="+a)}}function noise_blank_controls_html(){var n="";switch(noise_blank.algo){case noise_blank.NB_STD:n=w3_slider("","Gate","noise_blank.gate",noise_blank.gate,100,5e3,100,"noise_blank_gate_cb")+w3_slider("","Threshold","noise_blank.threshold",noise_blank.threshold,0,100,1,"noise_blank_threshold_cb");break;case noise_blank.NB_WILD:n=ext_is_IQ_or_stereo_curmode()?"No Wild algorithm blanking in IQ or stereo modes":w3_slider("","Threshold","noise_blank.thresh",noise_blank.thresh,.05,3,.05,"noise_blank_thresh_cb")+w3_slider("","Taps","noise_blank.taps",noise_blank.taps,6,40,1,"noise_blank_taps_cb")+w3_slider("","Samples","noise_blank.impulse_samples",noise_blank.impulse_samples,3,41,2,"noise_blank_impulse_samples_cb")}return w3_div("id-noise-blanker-controls w3-text-white",w3_divs("/w3-tspace-8",w3_inline("w3-margin-between-8",w3_div("w3-medium w3-text-aqua","<b>Noise blanker: </b>"),w3_div("w3-text-white",noise_blank.algo_s[noise_blank.algo])),w3_inline("w3-margin-between-32",w3_select("w3-text-red","","test mode","noise_blank.test",noise_blank.test,noise_blank.test_s,"noise_blank_test_cb"),w3_checkbox("w3-label-inline w3-text-css-orange/","Also blank WF","noise_blank.wf",noise_blank.wf,"noise_blank_wf_cb")),w3_slider("","Test pulse gain","noise_blank.test_gain",noise_blank.test_gain,-90,0,1,"noise_blank_test_gain_cb"),w3_slider("","Test pulse width","noise_blank.test_width",noise_blank.test_width,1,30,1,"noise_blank_test_width_cb"),noise_blank.algo!=noise_blank.NB_OFF?"<hr>":"",w3_div("w3-section",n)))}function noise_blank_controls_refresh(){ext_panel_displayed("noise_blank")&&(ext_panel_redisplay(noise_blank_controls_html()),ext_set_controls_width_height(noise_blank.width,noise_blank.height[noise_blank.algo]))}function noise_blank_controls_setup(){ext_panel_show(noise_blank_controls_html(),null,null),ext_set_controls_width_height(noise_blank.width,noise_blank.height[noise_blank.algo])}function noise_blank_environment_changed(n){if(n.mode){var e=ext_is_IQ_or_stereo_curmode();e!=noise_blank.is_IQ_or_stereo_mode&&(noise_blank_controls_refresh(),noise_blank.is_IQ_or_stereo_mode=e)}}function noise_blank_init(){noise_blank.algo=readCookie("last_nb_algo",0),nb_algo_cb("nb_algo",noise_blank.algo,!1,!0),noise_blank.gate=readCookie("last_noiseGate",100),noise_blank.threshold=readCookie("last_noiseThresh",50),noise_blank_send()}function noise_blank_send(){snd_send("SET nb algo="+noise_blank.algo),noise_blank.algo==noise_blank.NB_STD?(snd_send("SET nb type=0 param=0 pval="+noise_blank.gate),snd_send("SET nb type=0 param=1 pval="+noise_blank.threshold)):noise_blank.algo==noise_blank.NB_WILD&&(snd_send("SET nb type=0 param=0 pval="+noise_blank.thresh),snd_send("SET nb type=0 param=1 pval="+noise_blank.taps),snd_send("SET nb type=0 param=2 pval="+noise_blank.impulse_samples)),snd_send("SET nb type=0 en="+(noise_blank.algo?1:0)),snd_send("SET nb type=1 en="+noise_blank.wf),noise_blank.test&&(snd_send("SET nb type=2 param=0 pval="+Math.pow(10,noise_blank.test_gain/20)),snd_send("SET nb type=2 param=1 pval="+noise_blank.test_width)),snd_send("SET nb type=2 en="+noise_blank.test)}function nb_algo_cb(n,e,_,s){_||(e=+e,w3_select_value(n,e),noise_blank.algo=e,writeCookie("last_nb_algo",e.toString()),1!=s&&noise_blank_send(),noise_blank_controls_refresh())}function noise_blank_test_cb(n,e,_){_||(noise_blank.test=+e,noise_blank_send())}function noise_blank_test_gain_cb(n,e,_,s){e=+e,w3_num_cb(n,e),w3_set_label("Test pulse gain: "+e.toFixed(0)+" dB",n),_&&!s&&noise_blank_send()}function noise_blank_test_width_cb(n,e,_,s){e=+e,w3_num_cb(n,e),w3_set_label("Test pulse width: "+e.toFixed(0)+" samples",n),_&&!s&&noise_blank_send()}function noise_blank_wf_cb(n,e,_){_||(noise_blank.wf=e?1:0,noise_blank_send())}function noise_blank_gate_cb(n,e,_,s){e=+e,w3_num_cb(n,e),w3_set_label("Gate: "+e.toFixed(0)+" usec",n),_&&(writeCookie("last_noiseGate",e.toString()),s||noise_blank_send())}function noise_blank_threshold_cb(n,e,_,s){e=+e,w3_num_cb(n,e),w3_set_label("Threshold: "+e.toFixed(0)+"%",n),_&&(writeCookie("last_noiseThresh",e.toString()),s||noise_blank_send())}function noise_blank_thresh_cb(n,e,_,s){e=+e,w3_num_cb(n,e),w3_set_label("Threshold: "+e.toFixed(2),n),_&&!s&&noise_blank_send()}function noise_blank_taps_cb(n,e,_,s){e=+e,w3_num_cb(n,e),w3_set_label("Taps: "+e.toFixed(0),n),_&&!s&&noise_blank_send()}function noise_blank_impulse_samples_cb(n,e,_,s){e=+e,w3_num_cb(n,e),w3_set_label("Impulse samples: "+e.toFixed(0),n),_&&!s&&noise_blank_send()}


