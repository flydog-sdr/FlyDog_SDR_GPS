

/* web/extensions/SSTV/SSTV.min.js (web/extensions/SSTV/SSTV.js = Sat Jan 28 10:18:59 2023) */
var sstv={ext_name:"SSTV",first_time:!0,w:1088,h:256,iw:320,isp:64,iws:384,page:0,pg_sp:64,startx:86,tw:0,data_canvas:0,image_y:0,shift_second:!1,auto:!0,CMD_DRAW:0,CMD_REDRAW:1,img_width:0,freqs_s:["3630_ANZ","3730_EU","3845_NA",7171,14230,14233,21340,28680]};function SSTV_main(){ext_switch_to_client(sstv.ext_name,sstv.first_time,sstv_recv),sstv.first_time||sstv_controls_setup(),sstv.first_time=!1}function sstv_recv(s){var t=sstv.data_canvas,e=t.ctx;if("DAT"!=arrayBufferToStringLen(s,3))for(var a=arrayBufferToString(s).substring(4).split(" "),i=0;i<a.length;i++){var n=a[i].split("=");switch(0,n[0]){case"ready":sstv_controls_setup();break;case"img_width":sstv.img_width=n[1];break;case"new_img":sstv_clear_display(decodeURIComponent(n[1]));break;case"redraw":sstv.image_y=0;break;case"mode_name":sstv.mode_name=decodeURIComponent(n[1]),sstv_mode_name_cb(sstv.mode_name),sstv.line=1;break;case"status":sstv.status=decodeURIComponent(n[1]),sstv_status_cb(sstv.status);break;case"result":sstv.result=decodeURIComponent(n[1]),sstv_result_cb(sstv.result);break;case"fsk_id":sstv.fsk_id=decodeURIComponent(n[1]),sstv_fsk_id_cb(sstv.fsk_id);break;default:console.log("sstv_recv: UNKNOWN CMD "+n[0])}}else{var _=new Uint8Array(s,4),v=_[0],o=_[1],d=2,l=_.length-1;if(v==sstv.CMD_DRAW||v==sstv.CMD_REDRAW){for(var r,c=t.imd,i=0;i<sstv.img_width;i++)c.data[4*i+0]=_[d],c.data[4*i+1]=_[d+1],c.data[4*i+2]=_[d+2],c.data[4*i+3]=255,d+=3;sstv.image_y<sstv.h?sstv.image_y++:(r=sstv.startx,s=sstv.w,e.drawImage(t,r,1,s,sstv.h-1,r,0,s,sstv.h-1)),r=Math.round(sstv.startx+sstv.page*sstv.iws),e.putImageData(c,r,sstv.image_y-1,0,0,sstv.iw,1),v==sstv.CMD_DRAW&&sstv_status_cb("line "+sstv.line+", SNR "+(o-128).toFixed(0)+" dB"),sstv.line++}else console.log("sstv_recv: DATA UNKNOWN cmd="+v+" len="+l)}}function sstv_clear_display(s){var t=sstv.data_canvas.ctx,e=sstv.startx+sstv.page*sstv.iws,a=sstv.h/2,i=24,n=sstv.isp;-1!=sstv.page&&(t.fillStyle="dimGray",t.fillRect(e-i,a-12,i,i)),sstv.page=(sstv.page+1)%3,e=sstv.startx+sstv.page*sstv.iws,t.fillStyle="yellow",t.beginPath(),t.moveTo(e-i,a-12),t.lineTo(e,a),t.lineTo(e-i,12+a),t.closePath(),t.fill(),t.fillStyle="dimGray";t.fillRect(e-n,a-i-16,n,i),t.font="16px Arial",t.fillStyle="yellow";n=e-t.measureText(s).width-4;t.fillText(s,n,a-i),t.fillStyle="lightCyan",t.fillRect(e,0,sstv.iw,sstv.h),sstv.image_y=0,sstv.shift_second=!1}function sstv_controls_setup(){kiwi_isMobile()&&(sstv.startx=0),sstv.tw=sstv.w+sstv.startx;var s=time_display_html("sstv")+w3_div("id-sstv-data|left:0; width:"+px(sstv.tw)+"; background-color:black; position:relative;",'<canvas id="id-sstv-data-canvas" class="w3-crosshair" width='+dq(sstv.tw)+' style="position:absolute;"></canvas>'),t=w3_div("id-test-controls w3-text-white",w3_divs("/w3-tspace-8",w3_col_percent("",w3_div("w3-medium w3-text-aqua","<b>SSTV decoder</b>"),30,w3_div("",'From <b><a href="http://windytan.github.io/slowrx" target="_blank">slowrx</a></b> by Oona Räisänen, OH2EIQ')),w3_inline("",w3_select("id-sstv-freq-menu w3-text-red","","freq","sstv.freq",W3_SELECT_SHOW_TITLE,sstv.freqs_s,"sstv_freq_cb"),w3_checkbox("id-sstv-cbox-auto w3-margin-left w3-label-inline w3-label-not-bold","auto adjust","sstv.auto",!0,"sstv_auto_cbox_cb"),w3_button("id-sstv-btn-auto w3-margin-left w3-padding-smaller","Undo adjust","sstv_auto_cb"),w3_button("w3-margin-left w3-padding-smaller w3-css-yellow","Reset","sstv_reset_cb"),w3_button("w3-margin-left w3-padding-smaller w3-aqua","Test image","sstv_test_cb")),w3_half("","",w3_div("id-sstv-mode-name"),w3_div("id-sstv-fsk-id")),w3_div("id-sstv-status"),w3_div("id-sstv-result w3-hide")));ext_panel_show(t,s,null),ext_set_controls_width_height(560,125),sstv.saved_mode=ext_get_mode(),sstv_mode_name_cb(""),sstv_status_cb(""),sstv_result_cb(""),sstv_fsk_id_cb(""),time_display_setup("sstv"),sstv.data_canvas=w3_el("id-sstv-data-canvas"),sstv.data_canvas.ctx=sstv.data_canvas.getContext("2d"),sstv.data_canvas.imd=sstv.data_canvas.ctx.createImageData(sstv.w,1),sstv.data_canvas.addEventListener("mousedown",sstv_mousedown,!1),kiwi_isMobile()&&sstv.data_canvas.addEventListener("touchstart",sstv_touchstart,!1),sstv.data_canvas.height=sstv.h.toString(),ext_set_data_height(sstv.h);s=sstv.data_canvas.ctx;if(s.fillStyle="black",s.fillRect(0,0,sstv.tw,sstv.h),s.fillStyle="dimGray",s.fillRect(sstv.startx-sstv.isp,0,sstv.w+sstv.isp,sstv.h),sstv.page=-1,sstv.shift_second=!1,ext_send("SET start"),e=ext_param())for(var e=e.split(","),a=!1,i=0,n=e.length;i<n;i++){var _=e[i];w3_ext_param("help",_).match?extint_help_click():w3_ext_param("test",_).match?sstv_test_cb():w3_ext_param("noadj",_).match?sstv_auto_cbox_cb("id-sstv-cbox-auto",!(sstv.auto=1)):w3_select_enum("id-sstv-freq-menu",function(s,t){!a&&s.innerHTML.startsWith(_)&&(w3_select_value("id-sstv-freq-menu",t-1),sstv_freq_cb("",t-1,!1),a=!0)})}}function sstv_auto_cbox_cb(s,t,e){e||(w3_checkbox_set(s,t),w3_innerHTML("id-sstv-btn-auto",t?"Undo adjust":"Auto adjust"),sstv.auto=!sstv.auto,ext_send("SET noadj="+(sstv.auto?0:1)))}function sstv_auto_cb(s,t,e){ext_send("SET "+(sstv.auto?"undo":"auto"))}function sstv_freq_cb(s,t,e){e||(t=+t,e=parseInt(sstv.freqs_s[t]),isNaN(e)||(t=e<1e4,ext_tune(e,t?"lsb":"usb",ext_zoom.ABS,9),ext_set_passband((t?-2300:1200)-200,200+(t?-1200:2300))))}function sstv_mousedown(s){sstv_shift(s,!0)}function sstv_touchstart(s){sstv_shift(s,!1)}function sstv_shift(s,t){var e=s.clientX||s.offsetX||s.layerX,a=s.clientY||s.offsetY||s.layerY;if((e-=sstv.startx)<0||-1==sstv.page)sstv.shift_second=!1;else{var i=sstv.page*sstv.iws,s=i+sstv.iw;if(e<i||s<e)sstv.shift_second=!1;else{if(e-=i,!sstv.shift_second)return sstv.x0=e,sstv.y0=a,void(sstv.shift_second=!0);sstv.shift_second=!1,ext_send("SET shift x0="+sstv.x0+" y0="+sstv.y0+" x1="+e+" y1="+a)}}}function sstv_mode_name_cb(s){w3_el("id-sstv-mode-name").innerHTML="Mode: "+w3_div("w3-show-inline-block w3-text-black w3-background-pale-aqua w3-padding-LR-8",s)}function sstv_status_cb(s){w3_el("id-sstv-status").innerHTML="Status: "+w3_div("w3-show-inline-block w3-text-black w3-background-pale-aqua w3-padding-LR-8",s)}function sstv_result_cb(s){w3_el("id-sstv-result").innerHTML="Result: "+w3_div("w3-show-inline-block w3-text-black w3-background-pale-aqua w3-padding-LR-8",s)}function sstv_fsk_id_cb(s){w3_el("id-sstv-fsk-id").innerHTML="FSK ID: "+w3_div("w3-show-inline-block w3-text-black w3-background-pale-aqua w3-padding-LR-8",s)}function sstv_reset_cb(s,t,e){sstv_mode_name_cb(""),sstv_status_cb(""),sstv_result_cb(""),sstv_fsk_id_cb(""),ext_send("SET reset")}function sstv_test_cb(s,t,e){sstv_result_cb(""),sstv_fsk_id_cb(""),ext_send("SET test")}function SSTV_blur(){ext_send("SET stop"),ext_set_mode(sstv.saved_mode)}function SSTV_help(s){return s&&(s=w3_text("w3-medium w3-bold w3-text-aqua","SSTV decoder help")+w3_div("w3-margin-T-8 w3-scroll-y|height:90%",w3_div("w3-margin-R-8",'Select an entry from the SSTV freq menu and wait for a signal to begin decoding.<br>Sometimes activity is +/- the given frequencies. Try the "test image" button.<br><br>Supported modes:<ul><li>Martin: M1 M2 M3 M4</li><li>Scottie: S1 S2 SDX</li><li>Robot: R72 R36 R24 R24-BW R12-BW R8-BW</li><li>Wraase: SC-2-120 SC-2-180</li><li>PD: PD-50 PD-90</li></ul>If the image is still slanted or offset after auto adjustment you can make a manual<br>correction. If you see what looks like an edge in the image then click in two places along<br>the edge. The image will then auto adjust. You can repeat this procedure multiple times<br>if necessary.<br><br>URL parameters: <br><i>(freq menu match)</i> &nbsp; noadj &nbsp; test<br><br>The first URL parameter can be the number from an entry of the freq menu (e.g. "3730"). <i>noadj</i> un-checks the <i>auto adjust</i> box. <br><br>Keywords are case-insensitive and can be abbreviated. So for example these are valid: <br><i>ext=sstv,14230</i> &nbsp;&nbsp; <i>ext=sstv,7171,no &nbsp;&nbsp; <i>ext=sstv,t</i>')),confirmation_show_content(s,610,380),w3_el("id-confirmation-container").style.height="100%"),!0}function SSTV_config_html(){ext_config_html(sstv,"sstv","SSTV","SSTV configuration")}



