

/* web/extensions/timecode/bpc.min.js (web/extensions/timecode/bpc.js = Sun Sep 10 17:48:58 2023) */
var bpc={arm:0,NOISE_THRESHOLD:3,cur:0,sec:0,msec:0,dcnt:0,line:0,phase:0,prev:[],raw:[],chr:0,tod:0,time:0,dibit:['00','01','10','11'],end:null};function bpc_dmsg(s){w3_innerHTML('id-tc-bpc',s);}
function bpc_legend(){if((bpc.line&3)==0){tc_dmsg('ss hhhhhh mmmmmm ?????? dddddd mmmm yyyyyy ?? <br>');}}
function bpc_decode(b){var hour=b[1]*16+b[2]*4+b[3];if(hour<=11){var pm=b[9]&2;if(pm)hour+=12;hour=hour.leadingZeros(2);}else hour='??';var min=b[4]*16+b[5]*4+b[6];min=(min>59)?'??':min.leadingZeros(2);var sec=b[0];sec=(sec>2)?'??':(sec*20).leadingZeros(2);var day=b[10]*16+b[11]*4+b[12];day=(day==0||day>31)?'??':day.fieldWidth(2);var mo=b[13]*4+b[14];mo=(mo==0||mo>12)?'???':tc.mo[mo-1];var yr=b[15]*16+b[16]*4+b[17]+2000;var s=day+' '+mo+' '+yr+' '+hour+':'+min+':'+sec+' CST';tc_dmsg('   '+s+'<br>');tc_stat('lime','Time decoded: '+s);}
function bpc_clr(){var m=bpc;m.cur=m.cnt=m.one_width=m.zero_width=0;m.phase^=1;m.arm=m.no_modulation=m.dcnt=m.modct=m.line=m.sec=m.msec=0;tc.trig=0;tc.state=tc.ACQ_SYNC;if(server_time_local!=null&&server_time_local!=''){m.time=parseInt(server_time_local)*3600+parseInt(server_time_local.substr(3))*60+60;}
m.tod=m.time;}
function bpc_ampl(ampl){var i;var m=bpc;tc.trig++;if(tc.trig>=100)tc.trig=0;ampl=(ampl>0.5)?1:0;if(!tc.ref){tc.data=ampl^m.phase;tc.ref=1;}
if(ampl==m.cur){m.cnt=0;}else{m.cnt++;if(m.cnt>m.NOISE_THRESHOLD){m.cur=ampl;m.cnt=0;tc.data_last=tc.data;tc.data^=1;if(tc.data){if(tc.state!=tc.ACQ_SYNC){var t=Math.round((m.zero_width-9)/ 10);if(t>=4)t=0;m.raw[m.dcnt]=t;var s=m.dibit[t];if(t!=m.prev[m.dcnt]&&m.line){s='<span style="color:lime">'+s+'</span>';}
m.prev[m.dcnt]=t;tc_dmsg(s);if([0,3,6,9,12,14,17].includes(m.dcnt))tc_dmsg(' ');m.dcnt++;if(m.dcnt>=19){bpc_decode(m.raw);m.dcnt=0;m.line++;bpc_legend();}}
m.one_width=0;}else{m.zero_width=0;}}}
if(tc.data)m.one_width++;else m.zero_width++;if(tc.state==tc.ACQ_SYNC&&m.arm==0&&m.one_width>=170){m.arm=1;m.one_width=0;}
if(m.arm==1&&tc.data_last==1&&tc.data==0){m.arm=2;tc.state=tc.SYNCED;tc.trig=0;tc.sample_point=40;bpc_legend();tc_stat('cyan','Found sync');}
m.msec+=10;if(m.msec==1000){m.sec++;m.msec=0;}}
function bpc_focus(){}
function bpc_blur(){var el;el=w3_el('id-tc-bits');if(el)el.innerHTML='';el=w3_el('id-tc-bpc');if(el)el.innerHTML='';}
function bpc_init(){w3_el('id-tc-addon').innerHTML+=w3_div('id-tc-bits')+w3_div('id-tc-bpc');}



