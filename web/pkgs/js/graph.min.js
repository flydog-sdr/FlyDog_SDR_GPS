

/* web/pkgs/js/graph.min.js (web/pkgs/js/graph.js = Fri Feb 10 10:55:34 2023) */
function graph_init(l,t){return gr={auto:1,dBm:0,db_units:"dB",speed:1,marker:-1,x_tick:0,threshold:0,threshold_color:"red",averaging:!1,timestamp:!1,UTC:!0,avg_dB:0,divider:!1,max:0,min:0,hi:0,lo:0,goalH:0,goalL:0,scroll:0,scaleWidth:60,hysteresis:15,padding_tb:0,xi:0,secs_last:0,redraw_scale:!1,clr_color:"mediumBlue",bg_color:"ghostWhite",grid_color:"lightGrey",scale_color:"white",last_last:0},gr.cv=l,gr.ct=l.ctx,gr.auto=1,gr.dBm=w3_opt(t,"dBm",0),gr.speed=w3_opt(t,"speed",1),gr.averaging=w3_opt(t,"averaging",!1),gr.timestamp=w3_opt(t,"timestamp",!1),gr.UTC=w3_opt(t,"UTC",!0),gr.plot_color=w3_opt(t,"color","black"),gr.dBm?(gr.padding_tb=20,gr.db_units="dBm"):(gr.db_units="dB",gr.padding_tb=0),gr}function graph_clear(l){var t=l.ct;t.fillStyle=l.clr_color,t.fillRect(0,0,l.cv.width-l.scaleWidth,l.cv.height),l.x_tick=0,l.xi=l.cv.width-l.scaleWidth,graph_rescale(l)}function graph_rescale(l){l.redraw_scale=!0}function graph_mode(l,t,e,r){l.auto="auto"==t?1:0,l.auto||(l.max=e,l.min=r),graph_rescale(l)}function graph_speed(l,t){t<1&&(t=1),l.speed=t}function graph_marker(l,t){l.marker=t}function graph_annotate(l,t){l.divider=t}function graph_threshold(l,t,e){l.threshold=t,isString(e)&&(l.threshold_color=e)}function graph_averaging(l,t){l.averaging=t,l.avg_dB=0}function graph_timestamp(l,t){l.timestamp=t}function graph_UTC(l,t){l.UTC=t}function graph_plot(t,l,e){function r(l){return l=(l-t.lo)/m,Math.round(f-l*f)}function a(l){return 10*Math.ceil(l/10)}var i,o,c,g,d=w3_opt(e,"color",t.plot_color),s=w3_opt(e,"line",!1),_=t.cv,h=t.ct,n=_.width-t.scaleWidth,f=_.height,p=n-t.xi,m=t.hi-t.lo,e=!1;if((t.redraw_scale||t.auto)&&(t.auto?(i=.25/t.speed,t.goalH=t.goalH>l+t.padding_tb?t.goalH-i:l+t.padding_tb,t.goalL=t.goalL<l-t.padding_tb?t.goalL+i:l-t.padding_tb):(t.goalH=t.max,t.goalL=t.min,e=!0),(t.goalL>t.lo+t.hysteresis||t.goalL<t.lo||e)&&(g=t.goalL,i=10*Math.floor(g/10)-5,o=t.hi-i,i<=t.lo?(c=m/o,p&&(h.drawImage(_,t.xi,0,p,f,t.xi,0,p,f*c),h.fillStyle=t.bg_color,h.fillRect(t.xi,Math.floor(c*f),p,f*(1-c)+1))):(x=o/m,p&&h.drawImage(_,t.xi,0,p,f*x,t.xi,0,p,f)),t.lo=i,m=o,t.auto&&(t.redraw_scale=!0)),(t.goalH>t.hi||t.goalH<t.hi-t.hysteresis||e)&&(o=(w=a(t.goalH)+5)-t.lo,w>=t.hi?(c=m/o,p&&(h.drawImage(_,t.xi,0,p,f,t.xi,f*(1-c),p,f*c),h.fillStyle=t.bg_color,h.fillRect(t.xi,0,p,Math.ceil(f*(1-c))))):(x=o/m,p&&h.drawImage(_,t.xi,f*(1-x),p,f*x,t.xi,0,p,f)),t.hi=w,m=w-t.lo,t.auto&&(t.redraw_scale=!0))),t.redraw_scale){h.fillStyle=t.clr_color,h.fillRect(n,0,t.scaleWidth,f),h.fillStyle=t.scale_color,h.font="10px Verdana";for(var u=t.lo;(u=a(u))<=t.hi;u++)h.fillText(u+" "+t.db_units,2+n,r(u)+4,t.scaleWidth);t.redraw_scale=!1}var x=!1;if(++t.scroll>=t.speed){(t.scroll=0)<t.xi&&t.xi--,h.drawImage(_,1,0,n-1,f,0,0,n-1,f),t.date=new Date;var v,p=t.date.getTime()/1e3,w=Math.floor(p/t.marker),_=Math.floor(t.secs_last/t.marker);if(-1==t.marker||w==_){h.fillStyle=t.bg_color,h.fillRect(n-1,0,1,f),h.fillStyle=t.grid_color;for(u=t.lo;(u=a(u))<=t.hi;u++)h.fillRect(n-1,r(u),1,1)}else{var k=t.grid_color;t.timestamp&&0==t.x_tick&&(t.time_mark=t.date,t.x_tick=1,k="blue"),t.secs_last=p,h.fillStyle=k,h.fillRect(n-1,0,1,f)}100==t.x_tick&&(v=t.UTC?t.time_mark.toUTCString().substr(17,8)+" UTC":t.time_mark.toString().substr(16,8)+" L",k=n-90+h.measureText(v).width/2,w3_fillText(h,k,f-10,v,"black","14px Arial",1)),300==t.x_tick&&(t.x_tick=0),t.x_tick&&t.x_tick++,0!=t.divider&&(v=h.fillStyle,h.fillStyle=t.divider,h.fillRect(n-1,0,1,f),t.divider=!1,h.fillStyle=v),t.threshold&&(h.fillStyle=t.threshold_color,h.fillRect(n-1,r(t.threshold),1,1)),x=!0}t.averaging&&(b=(t.avg_dB*(t.speed-1)+l)/t.speed,l=t.avg_dB=b);var b=null;return t.averaging&&!x&&0==s||(l=r(l),0!=s?(h.strokeStyle=d,h.beginPath(),h.moveTo(n-1,s),h.lineTo(n,l),b=l,h.stroke()):(h.fillStyle=d,h.fillRect(n-1,l,1,1))),b}



