var sdr_hu_interval,ext_cur_nav,admin_sdr={pmi:0,pbm:"am",pbl:0,pbh:0,pbc:0,pbw:0,pbc_lock:!1,pb:{am:{c:0,w:9800},amn:{c:0,w:5e3},usb:{c:1500,w:2400},usn:{c:1350,w:2100},lsb:{c:-1500,w:2400},lsn:{c:-1350,w:2100},cw:{c:500,w:400},cwn:{c:500,w:60},nbfm:{c:0,w:12e3},nnfm:{c:0,w:6e3},iq:{c:0,w:1e4},drm:{c:0,w:1e4},sam:{c:0,w:9800},sau:{c:2450,w:9800},sal:{c:-2450,w:9800},sas:{c:0,w:9800},qam:{c:0,w:9800}},ADC_clk2_corr_s:["disabled","continuous","modulo even 2 min (WSPR-2)","modulo 5 min (FST4W-300)","modulo 15 min (FST4W-900)","modulo 30 min (FST4W-1800)"],CAT_baud_s:["disabled",115200],cfg_fields:["min","max","chan"],_last_:0},ITU_region_i=["R1: Europe, Africa","R2: North & South America","R3: Asia / Pacific"],AM_BCB_chan_i=["9 kHz","10 kHz"],max_freq_i=["32 MHz","42 MHz","52 MHz","62 MHz"],SPI_clock_i=["48 MHz","24 MHz"],led_brightness_i=["brighest","medium","dimmer","dimmest","off"],clone_host="",clone_pwd="",clone_files_s=["complete config","dx label config only"];function config_html(){kiwi_get_init_settings();var e=ext_get_cfg_param("init.mode","lsb").toUpperCase(),n=w3_array_el_seq(kiwi.mode_menu,e);console.log("config_html init_mode="+e+" mode_menu_idx="+n);var i=ext_get_cfg_param("init.colormap",0),t=ext_get_cfg_param("init.aperture",1),a=ext_get_cfg_param("init.AM_BCB_chan",0),_=ext_get_cfg_param("init.rf_attn",0),d=ext_get_cfg_param("init.ITU_region",0),o=ext_get_cfg_param("max_freq",0),o=ext_get_cfg_param("max_freq",0),r="<hr>"+w3_text("w3-margin-B-8 w3-text-teal w3-bold","Initial values for:")+w3_third("w3-margin-bottom w3-text-teal","w3-container",w3_input_get("","Frequency (kHz)","init.freq","admin_float_cb|3"),w3_inline("/w3-halign-space-around/w3-center",w3_select("","Mode","","init.mode",n,kiwi.mode_menu,"config_mode_cb"),w3_select("","Colormap","","init.colormap",i,kiwi.cmap_s,"admin_select_cb"),w3_select("","Aperture","","init.aperture",t,kiwi.aper_s,"config_aperture_cb"),w3_div("w3-center w3-tspace-8",w3_select("w3-width-auto","MW chan","","init.AM_BCB_chan",a,AM_BCB_chan_i,"admin_select_cb"))),w3_slider("id-rf-attn","RF Attn","init.rf_attn",_,0,31.5,.5,"config_rf_attn_cb"))+w3_third("w3-text-teal","w3-container",w3_div("",w3_input_get("id-wf-show-min//","Waterfall min (dBFS, fully zoomed-out)","init.min_dB","config_wfmin_cb"),w3_input_get("id-wf-show-floor//","Waterfall floor (dB)","init.floor_dB","admin_int_cb")),w3_div("",w3_input_get("id-wf-show-max//","Waterfall max (dBFS)","init.max_dB","config_wfmax_cb"),w3_input_get("id-wf-show-ceil//","Waterfall ceil (dB)","init.ceil_dB","admin_int_cb")),w3_input_get("","Zoom (0-14)","init.zoom","config_zoom_cb"))+w3_third("","w3-container",w3_div("id-wfmin-error w3-margin-T-8 w3-red w3-hide","Waterfall min must be < max"),w3_div("id-wfmax-error w3-margin-T-8 w3-red w3-hide","Waterfall max must be > min"),w3_div("id-zoom-error w3-margin-T-8 w3-red w3-hide","Zoom must be 0 to 14"))+w3_div("w3-margin-bottom"),e="<hr>"+w3_text("w3-text-teal w3-bold","Default passbands:")+w3_third("w3-text-teal w3-valign","w3-container",w3_inline("w3-halign-space-around w3-tspace-8/w3-center",w3_button("w3-aqua","Reset","config_pb_reset"),w3_select("w3-label-inline","Mode","","admin_sdr.pbm",0,kiwi.mode_menu,"config_pb_mode")),w3_input("","Passband low","admin_sdr.pbl",admin_sdr.pbl,"config_pb_val"),w3_input("","Passband high","admin_sdr.pbh",admin_sdr.pbh,"config_pb_val"))+w3_third("","w3-container","",w3_div("id-pbl-error w3-margin-T-8 w3-yellow w3-hide","Value creates an invalid passband"),w3_div("id-pbh-error w3-margin-T-8 w3-yellow w3-hide","Value creates an invalid passband"))+w3_third("w3-margin-T-16 w3-text-teal","w3-container",w3_divs("/w3-center w3-tspace-8",w3_div("w3-text-black","As each field is changed the others are <br>automatically adjusted. Define CW offset by <br>setting appropriate passband center frequency <br>for CW/CWN modes (typ 500, 800 or 1000 Hz).")),w3_half("w3-valign","",w3_input("","Passband center","admin_sdr.pbc",admin_sdr.pbc,"config_pb_val"),w3_checkbox("w3-halign-center//w3-label-inline","Lock","admin_sdr.pbc_lock",admin_sdr.pbc_lock,"config_pbc_lock")),w3_input("","Passband width","admin_sdr.pbw",admin_sdr.pbw,"config_pb_val"))+w3_third("","w3-container","",w3_div("id-pbc-error w3-margin-T-8 w3-yellow w3-hide","Value creates an invalid passband"),w3_div("id-pbw-error w3-margin-T-8 w3-yellow w3-hide","Value creates an invalid passband"))+w3_div("w3-margin-bottom"),n="<hr>"+w3_third("w3-margin-bottom w3-text-teal","w3-container",w3_div("",w3_input_get("","Frequency scale offset (kHz, 1 Hz resolution)","freq_offset","config_freq_offset"),w3_div("w3-text-black","Adds offset to frequency scale. <br> Useful when using a downconverter, e.g. set to <br>116000 kHz when 144-148 maps to 28-32 MHz.")),w3_divs("w3-restart/w3-center w3-tspace-8",w3_select("w3-width-auto","Max receiver frequency","","max_freq",o,max_freq_i,"admin_select_cb")),w3_div("",w3_checkbox_get_param("//w3-label-inline","Show 1 Hz frequency resolution","show_1Hz","admin_bool_cb",!0),w3_checkbox_get_param("w3-margin-T-8//w3-restart w3-label-inline","Show AGC threshold on S-meter","agc_thresh_smeter","admin_bool_cb",!0),w3_checkbox_get_param("w3-margin-T-8//w3-label-inline","Show user geolocation info","show_geo","admin_bool_cb",!0),w3_checkbox_get_param("id-config-spec-inv w3-margin-T-8//w3-label-inline","Downconverter high-side injection","spectral_inversion","config_spec_inv_cb",!1)))+w3_third("w3-margin-bottom w3-text-teal","w3-container",w3_input_get("","S-meter calibration (dB)","S_meter_cal","admin_int_cb"),w3_divs("/w3-center",w3_slider("","S-meter OV","cfg.S_meter_OV_counts",cfg.S_meter_OV_counts,0,15,1,"config_OV_counts_cb"),w3_text("w3-text-black","Increase if S-meter OV is flashing excessively.")),w3_divs("/w3-center",w3_slider("","Passband overload mute","cfg.overload_mute",cfg.overload_mute,-33,0,1,"overload_mute_cb"),w3_text("w3-text-black","When the signal level in the passband exceeds this level <br>the audio will be muted. The icon "+w3_icon("|padding:0 3px;","fa-exclamation-triangle",20,"yellow|#575757")+" will replace the <br>mute icon in the control panel. Useful for muting when <br>a strong nearby transmitter is active.")))+w3_third("w3-margin-bottom w3-text-teal","w3-container",w3_input_get("","Waterfall calibration (dB)","waterfall_cal","admin_int_cb"),w3_div("w3-center w3-tspace-8",w3_select("w3-width-auto","ITU region","","init.ITU_region",d,ITU_region_i,"admin_select_cb"),w3_div("w3-text-black","Configures LW/NDB, MW and <br> amateur band allocations, etc.")),w3_div("w3-center w3-tspace-8",w3_input_get("","Name/callsign input field max length (16-64)","ident_len","config_ident_len_cb"),w3_div("w3-text-black","Used to limit the number of characters a user can enter into the name/callsign field at the top-right of the page."))),i="<hr>"+w3_third("w3-margin-bottom w3-text-teal","w3-container",w3_divs("w3-restart/w3-center w3-tspace-8",w3_select_get_param("w3-width-auto","SPI clock","","SPI_clock",SPI_clock_i,"admin_select_cb",0),w3_div("w3-text-black","Set to 24 MHz to reduce interference <br> on 2 meters (144-148 MHz).")),w3_divs("w3-restart/w3-center w3-tspace-8",w3_select_get_param("w3-width-auto","Status LED brightness","","led_brightness",led_brightness_i,"admin_select_cb",0),w3_div("w3-text-black","Sets brightness of the 4 LEDs <br> that show status info.")),w3_divs("w3-restart/w3-center w3-tspace-8",w3_select_get_param("w3-width-auto","CAT interface baud rate","","CAT_baud",admin_sdr.CAT_baud_s,"admin_select_cb",0),w3_div("w3-text-black","Attach an optional USB/serial adapter to the Kiwi <br> for CAT interface reporting of frequency tuning."))),t="<hr>"+w3_div("w3-valign w3-container w3-section",'<header class="w3-container w3-yellow"><h6>Clone configuration from another Kiwi. <b>Use with care.</b> Current configuration is <b><i>not</i></b> saved. This Kiwi immediately restarts after cloning.<ul><li><b>CAUTION:</b> Kiwis running v1.602 or later must clone <b>ONLY</b> from Kiwis running v1.602 or later.</li><li><b>CAUTION:</b> Kiwis running v1.601 or earlier must <b>NOT</b> clone from Kiwis running v1.602 or later.</li></ul></h6></header>')+w3_inline_percent("w3-text-teal/w3-container",w3_input("","Clone config from Kiwi host","clone_host","","w3_string_cb","enter hostname (no port number)"),25,w3_input("","Kiwi host root password","clone_pwd","","w3_string_cb","required"),25,w3_select("w3-center//","Config to clone","","clone_files",0,clone_files_s,"w3_num_cb"),15,w3_button("w3-center//w3-red","Clone","config_clone_cb"),10,w3_label("w3-show-inline-block w3-margin-R-16 w3-text-teal","Status:")+w3_div("id-config-clone-status w3-show-inline-block w3-text-black w3-background-pale-aqua",""),25)+w3_inline_percent("w3-margin-bottom w3-text-teal/w3-container","",25,w3_div("w3-center w3-text-black","Either the root password you've explicitly set or the Kiwi device serial number."),25),a="<hr>"+w3_div("w3-valign w3-container w3-section",'<header class="w3-container w3-yellow"><h6>If the Kiwi doesn\'t like your external clock you can still connect (user and admin). However the waterfall will be dark and the audio silent.</h6></header>')+w3_third("w3-margin-bottom w3-text-teal","w3-container",w3_divs("w3-restart/w3-center w3-tspace-8",w3_select("","GPS correction of ADC clock","","cfg.ADC_clk2_corr",cfg.ADC_clk2_corr,admin_sdr.ADC_clk2_corr_s,"admin_select_cb"),w3_text("w3-text-black w3-center",'Set "disabled" to keep the Kiwi GPS from correcting <br>for errors in the ADC clock (internal or external). <br>Other settings prevent corrections from <br>disturbing WSPR and FST4W reception.'))),_="<hr>"+w3_div("w3-container",w3_div("w3-valign",'<header class="w3-container w3-yellow"><h6>To manually adjust/calibrate the ADC clock (e.g. when there is no GPS signal or GPS correction is disabled) follow these steps:</h6></header>'),w3_label("w3-text-teal","<ul><li>Close any admin page connections to the Kiwi</li><li>Open a normal user connection to the Kiwi</li><li>Tune to a time station or other accurate signal and zoom all the way in</li><li>Higher frequency shortwave stations are better because they will show more offset than LF/VLF stations</li><li>Select AM mode and click exactly on the signal carrier line in the waterfall</li><li>On the right-click menu select the <i>cal ADC clock (admin)</i> entry</li><li>You may have to give the admin password if not already authenticated</li><li>The adjustment is calculated and the carrier on the waterfall should move to the nearest 1 kHz marker</li><li>Use the fine-tuning controls on the IQ extension panel if necessary</li></ul>"),w3_label("w3-text-teal","You can fine-tune after the above steps as follows:<ul><li>Close any admin page connections to the Kiwi</li><li>Open IQ display extension</li><li>Set the receive frequency to the exact nominal carrier (e.g. 15000 kHz for WWV)</li><li>Press the <i>40</i> button (i.e. sets mode to AM with 40 Hz passband)</li><li>Set menus: Draw = points, Mode = carrier, PLL = off</li><li>Adjust the gain until you see a point rotating in a circle</li><li>Use the <i>Fcal</i> buttons to slow the rotation as much as possible</li><li>The total accumulated Fcal adjustment is shown</li><li>A full rotation in less than two seconds is good calibration</li></ul>"))+"<hr>",o=adm.firmware_sel==kiwi.RX3_WF3?1:0;console.log("mode_20kHz="+o);d="DC_offset"+(o?"_20kHz":"")+"_I",o="DC_offset"+(o?"_20kHz":"")+"_Q";return dbgUs&&(_=_+w3_div("w3-section w3-text-teal w3-bold","Development settings")+w3_third("w3-margin-bottom w3-text-teal w3-restart","w3-container",w3_input_get("","I balance (DC offset)",d,"admin_float_cb"),w3_input_get("","Q balance (DC offset)",o,"admin_float_cb"),"")+w3_third("w3-margin-bottom w3-text-teal w3-restart","w3-container",w3_divs("w3-center w3-tspace-8",w3_switch_label("w3-center","Increase web server priority?","Yes","No","test_webserver_prio",cfg.test_webserver_prio,"admin_radio_YN_cb"),w3_text("w3-text-black w3-center","Set 'no' for standard behavior.")),w3_divs("w3-center w3-tspace-8",w3_switch_label("w3-center","New deadline update scheme?","Yes","No","test_deadline_update",cfg.test_deadline_update,"admin_radio_YN_cb"),w3_text("w3-text-black w3-center","Set 'no' for standard behavior.")),"")+"<hr>"),w3_div("id-config w3-hide",r+e+n+i+t+a+_)}function config_mode_cb(e,n,i){i||(i=kiwi.mode_menu[+n].toLowerCase(),console.log("config_mode_cb: path="+e+" idx="+n+" mode_s="+i),ext_set_cfg_param(e,i,EXT_SAVE))}function config_freq_offset(e,n,i){admin_float_cb(e,n,i,[0,3]),kiwi_set_freq_offset(cfg.freq_offset)}function config_spec_inv_cb(e,n,i){i||admin_bool_cb(e,n,i)}function config_status_cb(e){e.sl&&!admin.spectral_inversion_lockout&&(admin.spectral_inversion_lockout=!0,e=w3_el("id-config-spec-inv"),w3_add(e,"w3-disabled"),w3_attribute(e,"title","overriden by antenna switch extension"))}function config_focus(){config_pb_mode("",admin_sdr.pmi,!1,!0),config_wf_show();var _=!1;w3_obj_enum(cfg.passbands,function(e,n,i){i.last_lo&&(delete i.last_lo,_=!0),i.last_hi&&(delete i.last_hi,_=!0)}),w3_obj_enum(admin_sdr.pb,function(e,n,i){var t,a;isDefined(cfg.passbands[e])||(console.log("config_focus: adding new mode "+e+" to cfg.passbands"),a=(t=admin_sdr.pb[e]).w/2,cfg.passbands[e]={},cfg.passbands[e].hi=t.c+a,cfg.passbands[e].lo=t.c-a,_=!0)}),_&&cfg_save_json("config_focus","cfg.passbands")}function config_wf_show(){w3_hide2("id-wf-show-min",0!=cfg.init.aperture),w3_hide2("id-wf-show-max",0!=cfg.init.aperture),w3_hide2("id-wf-show-floor",1!=cfg.init.aperture),w3_hide2("id-wf-show-ceil",1!=cfg.init.aperture)}function config_aperture_cb(e,n,i){i||(admin_select_cb(e,n),config_wf_show())}function config_pb_reset(e,n){var i=admin_sdr.pbm;console.log("config_pb_reset mode="+i),admin_sdr.pbc=admin_sdr.pb[i].c,admin_sdr.pbw=admin_sdr.pb[i].w;i=admin_sdr.pbw/2;admin_sdr.pbh=admin_sdr.pbc+i,admin_sdr.pbl=admin_sdr.pbc-i,admin_sdr.pbc_lock=!1,config_pb_val("pbc",admin_sdr.pbc,!1)}function config_pb_mode(e,n,i,t){i||(n=+n,admin_sdr.pmi=n,i=kiwi.mode_menu[n].toLowerCase(),admin_sdr.pbm=i,console.log("config_pb_mode idx="+n+" mode="+i+" no_save="+t),admin_sdr.pbl=cfg.passbands[i].lo,admin_sdr.pbh=cfg.passbands[i].hi,n=(admin_sdr.pbl+admin_sdr.pbh)/2,admin_sdr.pbc=ext_get_cfg_param("cfg.passbands."+i+".c",n,EXT_SAVE),admin_sdr.pbw=admin_sdr.pbh-admin_sdr.pbl,admin_sdr.pbc_lock=ext_get_cfg_param("cfg.passbands."+i+".lock",!1,EXT_SAVE),console.log("config_pb_mode: admin_sdr.pbc_lock="+admin_sdr.pbc_lock),w3_set_value("admin_sdr.pbl",admin_sdr.pbl),w3_set_value("admin_sdr.pbh",admin_sdr.pbh),w3_set_value("admin_sdr.pbc",admin_sdr.pbc),w3_set_value("admin_sdr.pbw",admin_sdr.pbw),w3_set_value("admin_sdr.pbc_lock",admin_sdr.pbc_lock),config_pb_val("pbl",admin_sdr.pbl,!1,null,t))}function config_pb_val(e,n,i,t,a){if(!i){i=e.slice(-3);n=+n;var _,d,o,e=ext_nom_sample_rate(),e=e?e/2:6e3,r=-e,c=e,l=admin_sdr.pbc_lock;switch(w3_show_hide("id-pbl-error",!1),w3_show_hide("id-pbh-error",!1),w3_show_hide("id-pbc-error",!1),w3_show_hide("id-pbw-error",!1),i){case"pbl":_=n,(s=l?(w=admin_sdr.pbc,g=admin_sdr.pbh-_,_<=admin_sdr.pbc-1&&r<=_):(w=(_+admin_sdr.pbh)/2,g=admin_sdr.pbh-_,_<=admin_sdr.pbh-2&&r<=_))&&(admin_sdr.pbl=_,admin_sdr.pbc=w,admin_sdr.pbw=g),console.log("pbl="+_+" ok="+s),w3_show_hide("id-pbl-error",!s);break;case"pbh":d=n,(s=l?(w=admin_sdr.pbc,g=d-admin_sdr.pbl,d>=admin_sdr.pbc+1&&d<=c):(w=(admin_sdr.pbl+d)/2,g=d-admin_sdr.pbl,d>=admin_sdr.pbl+2&&d<=c))&&(admin_sdr.pbh=d,admin_sdr.pbc=w,admin_sdr.pbw=g),console.log("pbh="+d+" ok="+s),w3_show_hide("id-pbh-error",!s);break;case"pbc":var s,w=n;(s=l?(p=admin_sdr.pbc-admin_sdr.pbl,m=admin_sdr.pbh-admin_sdr.pbc,console.log("delta_l="+p+" delta_h="+m),_=w-p,d=w+m,console.log(admin_sdr.pbl+"|"+admin_sdr.pbc+"|"+admin_sdr.pbh+" => "+_+"|"+w+"|"+d),_<w&&w<d):(d=w+(o=admin_sdr.pbw/2),r<=(_=w-o)&&d<=c))&&(admin_sdr.pbl=_,admin_sdr.pbh=d,admin_sdr.pbc=w),console.log("pbc="+w+" ok="+s),w3_show_hide("id-pbc-error",!s);break;case"pbw":var b,p,m,g=n;(s=l?(b=g-admin_sdr.pbw,w=(admin_sdr.pbh-admin_sdr.pbc)/admin_sdr.pbw,p=Math.round(b*(1-w)),m=Math.round(b*w),console.log("delta_w="+b+" ratio_pbh="+w.toFixed(4)+" delta_l="+p+" delta_h="+m),_=admin_sdr.pbl-p,d=admin_sdr.pbh+m,console.log(admin_sdr.pbl+"|"+admin_sdr.pbc+"|"+admin_sdr.pbh+" => "+_+"|"+admin_sdr.pbc+"|"+d),2<=g&&_<d&&_<admin_sdr.pbc&&d>admin_sdr.pbc&&r<=_&&d<=c):(o=g/2,_=admin_sdr.pbc-o,d=admin_sdr.pbc+o,2<=g&&r<=_&&d<=c))&&(admin_sdr.pbl=_,admin_sdr.pbh=d,admin_sdr.pbw=g),console.log("pbw="+g+" ok="+s),w3_show_hide("id-pbw-error",!s)}s&&(l&&console.log("LOCKED"),w3_set_value("admin_sdr.pbl",admin_sdr.pbl),w3_set_value("admin_sdr.pbh",admin_sdr.pbh),w3_set_value("admin_sdr.pbc",admin_sdr.pbc),w3_set_value("admin_sdr.pbw",admin_sdr.pbw),w3_checkbox_set("admin_sdr.pbc_lock",admin_sdr.pbc_lock),a=isArg(a)&&1==a?EXT_NO_SAVE:EXT_SAVE,ext_set_cfg_param("cfg.passbands."+admin_sdr.pbm+".lo",admin_sdr.pbl,EXT_NO_SAVE),ext_set_cfg_param("cfg.passbands."+admin_sdr.pbm+".hi",admin_sdr.pbh,EXT_NO_SAVE),ext_set_cfg_param("cfg.passbands."+admin_sdr.pbm+".c",admin_sdr.pbc,EXT_NO_SAVE),ext_set_cfg_param("cfg.passbands."+admin_sdr.pbm+".lock",admin_sdr.pbc_lock,a))}}function config_pbc_lock(e,n,i){i||(admin_sdr.pbc_lock=!!n,console.log("config_pbc_lock: cfg.passbands."+admin_sdr.pbm+".lock = "+admin_sdr.pbc_lock+" EXT_SAVE"),ext_set_cfg_param("cfg.passbands."+admin_sdr.pbm+".lock",admin_sdr.pbc_lock,EXT_SAVE))}function config_wfmin_cb(e,n,i){var t=(n=+n)<cfg.init.max_dB;t&&admin_int_cb(e,n,i),w3_show_hide("id-wfmin-error",!t)}function config_wfmax_cb(e,n,i){var t=(n=+n)>cfg.init.min_dB;t&&admin_int_cb(e,n,i),w3_show_hide("id-wfmax-error",!t)}function config_zoom_cb(e,n,i){var t=0<=(n=+n)&&n<=14;t&&admin_int_cb(e,n,i),w3_show_hide("id-zoom-error",!t)}function config_ident_len_cb(e,n,i){(n=+n)<16&&(n=16),64<n&&(n=64),admin_int_cb(e,n,i)}function config_rf_attn_cb(e,n,i,t){n=+n,admin_float_cb(e,n,t),w3_set_label("RF Attn "+n.toFixed(1)+" dB",e)}function config_OV_counts_cb(e,n,i,t){var a=1<<(n=+n);admin_int_cb(e,n,t),w3_set_label("S-meter OV if &ge; "+a+" ADC OV per 64k samples",e),ext_send("SET ov_counts="+a)}function overload_mute_cb(e,n,i,t){console.log("overload_mute_cb path="+e+" val="+n+" complete="+i+" first="+t),n=+n,admin_int_cb(e,n,t);t="Passband overload mute "+n+" dBm";-73<=n&&(t+=" (S9+"+(n- -73)+")"),w3_set_label(t,e)}function config_clone_cb(e,n){var i;""==clone_host?i="please enter Kiwi host to clone from":""==clone_pwd?i="please enter root password of Kiwi host":(i="cloning from "+clone_host,ext_send("SET config_clone host="+encodeURIComponent(clone_host)+" pwd=x"+encodeURIComponent(clone_pwd)+" files="+clone_files)),w3_innerHTML("id-config-clone-status",i)}function config_clone_status_cb(e){var n;if(0<=e&&e<=2){switch(e){case 0:n="Full configuration cloned.";break;case 1:n="DX configuration cloned.";break;case 2:n="DX configuration cloned, but no dx_config.json file found on Kiwi host."}ext_send("SET restart"),admin_wait_then_reload(60,n+" Restarting KiwiSDR server.")}else n=1280==e?"wrong password":256==e?"host unknown/unresponsive":"clone error #"+e;w3_innerHTML("id-config-clone-status",n)}function config_ext_clk_sel_cb(e,n){n=+n,admin_radio_YN_cb(e,n),w3_num_set_cfg_cb("cfg.clk_adj",0)}function config_ext_freq_cb(e,n,i){i||(n=parseFloat(n),isNaN(n)?n=null:(n<70?n*=1e6:n<7e4&&(n*=1e3),((n=Math.floor(n))<65e6||69e6<n)&&(n=null)),admin_int_cb(e,n))}function channels_html(){return w3_div("id-channels w3-hide","<hr>"+w3_third("w3-margin-bottom w3-text-teal w3-restart","w3-container","foo","bar","baz"))}function webpage_html(){var e="<hr>"+w3_divs("w3-margin-bottom/w3-container",w3_input("","Top bar title","index_html_params.RX_TITLE","","webpage_title_cb"))+w3_div("w3-container","<label><b>Top bar title HTML preview</b></label>",w3_div("id-webpage-title-preview w3-text-black w3-background-pale-aqua",""))+w3_divs("w3-margin-top w3-margin-bottom/w3-container",w3_input("","Owner info (appears in center of top bar; can use HTML like &lt;br&gt; for line break if line is too long)","owner_info","","webpage_owner_info_cb"))+w3_div("w3-container","<label><b>Owner info HTML preview</b></label>",w3_div("id-webpage-owner-info-preview w3-text-black w3-background-pale-aqua",""))+w3_divs("w3-margin-top w3-margin-bottom/w3-container",w3_input("","Status","status_msg","","webpage_status_cb"))+w3_div("w3-container","<label><b>Status HTML preview</b></label>",w3_div("id-webpage-status-preview w3-text-black w3-background-pale-aqua",""))+w3_divs("w3-margin-top/w3-container",w3_input("","Window/tab title","index_html_params.PAGE_TITLE","","webpage_string_cb")),n="<hr>"+w3_half("w3-margin-bottom","w3-container",w3_input("","Location","index_html_params.RX_LOC","","webpage_string_cb"),w3_input("",w3_label("w3-bold","Grid square (4 or 6 char) ")+w3_div("id-webpage-grid-check cl-admin-check w3-show-inline-block w3-green w3-btn w3-round-large"),"index_html_params.RX_QRA","","webpage_input_grid"))+w3_half("","w3-container",w3_input("","Altitude (ASL meters)","index_html_params.RX_ASL","","webpage_string_cb"),w3_input("",w3_label("w3-bold","Map (Google format or lat, lon) ")+w3_div("id-webpage-map-check cl-admin-check w3-show-inline-block w3-green w3-btn w3-round-large"),"index_html_params.RX_GMAP","","webpage_input_map"))+"<hr>"+w3_half("w3-margin-bottom","w3-container",w3_inline("w3-halign-space-between/",w3_inline("",w3_input('w3-flex-col//w3-no-styling||type="file" accept="image&slash;*"',"Photo file","id-photo-file","","webpage_photo_file_upload"),w3_div("id-photo-error","")),w3_checkbox_get_param("w3-restart w3-label-inline","Photo left margin","index_html_params.RX_PHOTO_LEFT_MARGIN","admin_bool_cb",!0)),w3_input("","Photo maximum height (pixels)","index_html_params.RX_PHOTO_HEIGHT","","webpage_photo_height_cb"))+w3_half("","w3-container",w3_input("","Photo title","index_html_params.RX_PHOTO_TITLE","","webpage_string_cb"),w3_input("","Photo description","index_html_params.RX_PHOTO_DESC","","webpage_string_cb")),i="<hr>"+w3_half("w3-margin-bottom w3-text-teal","w3-container",w3_divs("/w3-center w3-tspace-8",w3_switch_label("w3-center","Web server caching?","Yes","No","webserver_caching",cfg.webserver_caching,"admin_radio_YN_cb"),w3_text("w3-text-black w3-center",'Set "No" when there are caching problems in your <br>network path, e.g. user interface icons don\'t load.')))+"<hr>"+w3_div("w3-container",w3_textarea_get_param("w3-input-any-change|width:100%",w3_div("",w3_text("w3-bold w3-text-teal w3-show-block","Additional HTML/Javascript for HTML &lt;head&gt; element (e.g. Google analytics or user customization)"),w3_text("w3-text-black","Press enter(return) key while positioned at end of text to submit data.")),"index_html_params.HTML_HEAD",10,100,"webpage_string_cb",""))+"<hr>";return w3_div("id-webpage w3-text-teal w3-hide",e+n+i)}function webpage_input_grid(e,n){webpage_string_cb(e,n),webpage_update_check_grid()}function webpage_update_check_grid(){var e=ext_get_cfg_param("index_html_params.RX_QRA");w3_el("webpage-grid-check").innerHTML='<a href="http://www.levinecentral.com/ham/grid_square.php?Grid='+e+'" target="_blank">check grid</a>'}function webpage_input_map(e,n){webpage_string_cb(e,n.trim()),webpage_update_check_map()}function webpage_update_check_map(){var e=kiwi_decodeURIComponent("RX_GMAP",ext_get_cfg_param("index_html_params.RX_GMAP"));w3_el("webpage-map-check").innerHTML='<a href="https://google.com/maps/place/'+e+'" target="_blank">check map</a>'}function webpage_photo_uploaded(e){var n=null!=e.AJAX_error?-1:e.r;0==n&&webpage_string_cb("index_html_params.RX_PHOTO_FILE","kiwi.config/photo.upload");var i,e=w3_el("id-photo-error");switch(n){case-1:i="Communication error";break;case 0:i="Upload successful";break;case 1:i="Authentication failed";break;case 2:i="Not an image file?";break;case 3:i="Unable to determine file type";break;case 4:i="File too large";break;case 5:i="Can only upload from local network";break;default:i="Undefined error?"}e.innerHTML=i,w3_add(e,0==n?"w3-text-green":"w3-text-red"),w3_show_block(e)}function webpage_photo_file_upload(){ext_get_authkey(function(e){webpage_photo_file_upload2(e)})}function webpage_photo_file_upload2(e){var n=w3_el("id-photo-file");n.innerHTML="Uploading...";var i=n.files[0],n=new FormData;n.append("photo",i,i.name),console.log("webpage_photo_file_upload2"),console.log(i),console.log(n);i=w3_el("id-photo-error");w3_hide(i),w3_remove(i,"w3-text-red"),w3_remove(i,"w3-text-green"),kiwi_ajax_send(n,"/PIX?"+e,"webpage_photo_uploaded")}function webpage_title_cb(e,n){webpage_string_cb(e,n),w3_el("id-webpage-title-preview").innerHTML=admin_preview_status_box("RX_TITLE_2",cfg.index_html_params.RX_TITLE)}function webpage_owner_info_cb(e,n){webpage_string_cb(e,n),w3_el("id-webpage-owner-info-preview").innerHTML=admin_preview_status_box("owner_info_2",cfg.owner_info)}function webpage_status_cb(e,n){w3_string_set_cfg_cb(e,n),w3_el("id-webpage-status-preview").innerHTML=admin_preview_status_box("webpage_status_2",cfg.status_msg)}function webpage_focus(){admin_set_decoded_value("index_html_params.RX_TITLE"),w3_el("id-webpage-title-preview").innerHTML=admin_preview_status_box("RX_TITLE_1",cfg.index_html_params.RX_TITLE),admin_set_decoded_value("status_msg"),w3_el("id-webpage-status-preview").innerHTML=admin_preview_status_box("webpage_status_1",cfg.status_msg),admin_set_decoded_value("index_html_params.PAGE_TITLE"),admin_set_decoded_value("index_html_params.RX_LOC"),admin_set_decoded_value("index_html_params.RX_QRA"),admin_set_decoded_value("index_html_params.RX_ASL"),admin_set_decoded_value("index_html_params.RX_GMAP"),admin_set_decoded_value("index_html_params.RX_PHOTO_HEIGHT"),admin_set_decoded_value("index_html_params.RX_PHOTO_TITLE"),admin_set_decoded_value("index_html_params.RX_PHOTO_DESC"),admin_set_decoded_value("owner_info"),w3_el("id-webpage-owner-info-preview").innerHTML=admin_preview_status_box("owner_info_1",cfg.owner_info),webpage_update_check_grid(),webpage_update_check_map()}function webpage_string_cb(e,n){w3_string_set_cfg_cb(e,n),ext_send_after_cfg_save("SET reload_index_params")}function webpage_photo_height_cb(e,n){n=parseInt(n),isNaN(n)?(n=ext_get_cfg_param(e),w3_set_value(e,n)):(n=w3_clamp(n,0,4e3,0),w3_set_value(e,n),w3_num_set_cfg_cb(e,n),ext_send_after_cfg_save("SET reload_index_params"))}function kiwi_reg_html(){var e=w3_div("",w3_div("w3-margin-T-10 w3-valign",'<header class="w3-container w3-yellow"><h5>More information on <a href="http://kiwisdr.com/quickstart/index.html#id-config-kiwi-reg" target="_blank">kiwisdr.com</a><br><br>To list your Kiwi on <a href="http://rx.kiwisdr.com" target="_blank">rx.kiwisdr.com</a> edit the fields below and set the "<i>Register</i>" switch to <b>Yes</b>. Look for a successful status result within a few minutes.<br>The "<i>Location (lat, lon)</i>" field must be set properly for your Kiwi to be listed in the correct location on <a href="http://map.kiwisdr.com" target="_blank">map.kiwisdr.com</a></h5></header>'))+"<hr>"+w3_divs("w3-margin-bottom w3-container w3-center",w3_switch_label("w3-label-inline w3-label-left w3-center",'Register on <a href="http://rx.kiwisdr.com" target="_blank">rx.kiwisdr.com</a>?',"Yes","No","adm.kiwisdr_com_register",adm.kiwisdr_com_register,"kiwisdr_com_register_cb"),w3_div("id-kiwisdr_com-reg-status-container",w3_div("w3-container",w3_label("w3-show-inline-block w3-margin-R-16 w3-text-teal","kiwisdr.com registration status:")+w3_div("id-kiwisdr_com-reg-status w3-show-inline-block w3-padding-LR-8 w3-text-black","")))),n="<hr>"+w3_half("w3-margin-bottom w3-restart","w3-container",w3_input("","Name","rx_name","","w3_string_set_cfg_cb"),w3_input("","Location","rx_location","","w3_string_set_cfg_cb"))+w3_half("w3-margin-bottom w3-restart","w3-container",w3_input("","Admin email","admin_email","","w3_string_set_cfg_cb"),w3_input("","Antenna","rx_antenna","","w3_string_set_cfg_cb"))+w3_third("w3-margin-bottom w3-restart","w3-container",w3_input("",w3_label("w3-bold","Grid square (4/6 char) ")+w3_div("id-public-grid-check cl-admin-check w3-show-inline-block w3-green w3-btn w3-round-large")+" "+w3_div("id-public-grid-set cl-admin-check w3-blue w3-btn w3-round-large w3-hide","set from GPS"),"rx_grid","","sdr_hu_input_grid"),w3_div("",w3_input("",w3_label("w3-bold","Location (lat, lon) ")+w3_div("id-public-gps-check cl-admin-check w3-show-inline-block w3-green w3-btn w3-round-large")+" "+w3_div("id-public-gps-set cl-admin-check w3-blue w3-btn w3-round-large w3-hide","set from GPS"),"rx_gps","","public_check_gps_cb"),w3_div("w3-text-black","Format: (nn.nnnnnn, nn.nnnnnn)")),w3_input_get("","Altitude (ASL meters)","rx_asl","admin_int_cb"))+"<hr>"+w3_half("w3-margin-bottom","w3-container",w3_switch_label("w3-label-inline w3-label-left","Display owner/admin email link on KiwiSDR main page?","Yes","No","contact_admin",cfg.contact_admin,"admin_radio_YN_cb"),"")+"<hr>"+w3_half("w3-margin-bottom","w3-container",w3_div("",w3_input_get("","Coverage frequency low (kHz)","sdr_hu_lo_kHz","admin_int_cb"),w3_div("w3-text-black",'These two settings effect the frequency coverage label displayed on rx.kiwisdr.com <br>e.g. when set to 0 and 30000 "HF" is shown. If you\'re using a transverter <br>then appropriate entries will cause "2m" or "70cm" to be shown. Other labels will be <br>shown if you limit the range at HF due to antenna or filtering limitations.')),w3_input_get("","Coverage frequency high (kHz)","sdr_hu_hi_kHz","admin_int_cb"))+"<hr>";return w3_div("id-sdr_hu w3-text-teal w3-hide",e+n)}function kiwisdr_com_register_cb(e,n,i){n=+n;var t,a=!1,_=""==cfg.server_url,d=null!=kiwi_inet4_d2h(cfg.server_url)&&null==kiwi_inet4_d2h(cfg.server_url,!0),o=""!=adm.user_password&&0==cfg.chan_no_pwd,r=""==cfg.rx_gps||"(0.000000, 0.000000)"==cfg.rx_gps||"(0.000000%2C%200.000000)"==cfg.rx_gps,c=cfg.WSPR.autorun+cfg.ft8.autorun>=rx_chans;n==w3_SWITCH_YES_IDX&&(_||d||o||r||c)?(_?t='Error, you must first setup a valid Kiwi connection URL on the admin "connect" tab':d?t='Error, must be a public (not local) IP address on the admin "connect" tab':o?t='Error, must have at least one user channel that doesn\'t require a password (see admin "security" tab)':r?t='Error, you must first set a valid entry in the "<i>Location (lat, lon)</i>" field':c&&(t="Error, cannot have WSPR/FT8 autorun enabled on ALL channels!"),w3_switch_set_value(e,w3_SWITCH_NO_IDX),n=w3_SWITCH_NO_IDX,a=!0):t=n==w3_SWITCH_YES_IDX?"(waiting for kiwisdr.com response, can take several minutes in some cases)":"(registration not enabled)",w3_innerHTML("id-kiwisdr_com-reg-status",t),w3_remove_then_add_cond("id-kiwisdr_com-reg-status",a,"w3-red w3-text-white","w3-pale-blue w3-text-black"),admin_radio_YN_cb(e,n,i),ext_send_after_cfg_save("SET public_wakeup")}function sdr_hu_focus(){admin_set_decoded_value("rx_name"),admin_set_decoded_value("rx_location"),admin_set_decoded_value("rx_antenna"),admin_set_decoded_value("rx_grid"),admin_set_decoded_value("rx_gps"),admin_set_decoded_value("admin_email"),public_check_gps_cb("rx_gps",kiwi_decodeURIComponent("rx_gps",ext_get_cfg_param("rx_gps")),!0),public_update_check_grid(),public_update_check_map(),w3_el("id-public-grid-set").onclick=function(){var e=admin.reg_status.grid;w3_set_value("rx_grid",e),w3_input_change("rx_grid","sdr_hu_input_grid")},w3_el("id-public-gps-set").onclick=function(){var e="("+admin.reg_status.lat+", "+admin.reg_status.lon+")";w3_set_value("rx_gps",e),w3_input_change("rx_gps","public_check_gps_cb")},ext_send_after_cfg_save("SET public_update"),sdr_hu_interval=setInterval(function(){ext_send("SET public_update")},5e3),kiwisdr_com_register_cb("adm.kiwisdr_com_register",adm.kiwisdr_com_register?w3_SWITCH_YES_IDX:w3_SWITCH_NO_IDX,!0)}function sdr_hu_input_grid(e,n){w3_string_set_cfg_cb(e,n),public_update_check_grid()}function public_update_check_grid(){var e=ext_get_cfg_param("rx_grid");w3_el("id-public-grid-check").innerHTML='<a href="http://www.levinecentral.com/ham/grid_square.php?Grid='+e+'" target="_blank">check grid</a>'}function public_check_gps_cb(e,n,i){for(var t=0,a=0,_=/([-]?\d*\.?\d+)/g,d=0;d<2;d++){var o=_.exec(n);o&&(d?a=parseFloat(o[0]):t=parseFloat(o[0]))}"(-37.631120, 176.172210)"!=(n="("+t.toFixed(6)+", "+a.toFixed(6)+")")&&"(-37.631120%2C%20176.172210)"!=n||(n="(0.000000, 0.000000)"),"(0.000000, 0.000000)"==n?(w3_flag("rx_gps"),kiwisdr_com_register_cb("adm.kiwisdr_com_register",w3_SWITCH_NO_IDX)):w3_unflag("rx_gps"),w3_string_set_cfg_cb(e,n,i),w3_set_value(e,n),public_update_check_map()}function public_update_check_map(){var e=(e=kiwi_decodeURIComponent("rx_gps",ext_get_cfg_param("rx_gps"))).substring(1,e.length-1);w3_el("id-public-gps-check").innerHTML='<a href="https://google.com/maps/place/'+e+'" target="_blank">check map</a>'}function sdr_hu_blur(e){kiwi_clearInterval(sdr_hu_interval)}function public_update(e){e=decodeURIComponent(e),e=kiwi_JSON_parse("public_update",e);e&&(admin.reg_status=e),adm.kiwisdr_com_register&&null!=admin.reg_status.kiwisdr_com&&""!=admin.reg_status.kiwisdr_com&&w3_innerHTML("id-kiwisdr_com-reg-status","rx.kiwisdr.com registration: successful"),null!=admin.reg_status.lat&&(w3_show_inline_block("id-public-grid-set"),w3_show_inline_block("id-public-gps-set"))}function dx_html(){var e="";if(kiwi_isMobile())return w3_div("id-dx w3-hide",w3_div("w3-container w3-margin-top","Not available on mobile devices."));var n=w3_inline("/w3-margin-top",w3_select_get_param("/w3-label-inline w3-text-teal/w3-text-red","Default DX label database:","","dx_default_db",dx.db_s,"admin_select_cb"),w3_switch_label("w3-margin-L-64/w3-label-inline w3-label-left w3-text-teal/","Automatically download community database?","Yes","No","adm.dx_comm_auto_download",adm.dx_comm_auto_download,"admin_radio_YN_cb"),w3_button("w3-aqua w3-margin-L-64 w3-restart","Download now","dx_comm_download_cb"),w3_text("w3-margin-L-8 w3-text-black","(requires restart)"))+w3_hr("w3-margin-TB-16"),i=!1,t=" w3-hide";if(dx.dxcfg_parse_error&&(e=w3_div("",w3_text("","Warning: The configuration file /root/kiwi.config/dxcfg.json is corrupt. <br>The error is: "+dx.dxcfg_parse_error+'<br>Please use a text editor to fix the file (for example "nano /root/kiwi.config/dxcfg.json" in the admin console tab), or restore from backup, and restart the Kiwi. <br> Or ask for help on the Kiwi forum or email support@kiwisdr.com')),t=" w3-red",i=!0),dx.dxcomm_cfg_parse_error&&(e=w3_br(e)+w3_div("",w3_text("","Warning: The configuration file /root/kiwi.config/dx_community_config.json is corrupt. <br>The error is: "+dx.dxcomm_cfg_parse_error+'<br>Please use a text editor to fix the file (for example "nano /root/kiwi.config/dx_community_config.json" in the admin console tab), or restore from backup, and restart the Kiwi. <br> Or ask for help on the Kiwi forum or email support@kiwisdr.com')),t=" w3-red"),n+=w3_div("id-dx-err-msg w3-margin-T-8 w3-padding"+t,e)+w3_div("id-dx-list-msg w3-margin-T-8 w3-padding w3-red w3-hide"),i)return w3_div("id-dx w3-hide",w3_div("w3-container w3-margin-top",n));isUndefined(dxcfg.bands)||isUndefined(dxcfg.band_svc)||isUndefined(dxcfg.dx_type)?(bandwidth=1e6*[30,32][cfg.max_freq],zoom_nom=ZOOM_NOMINAL,bands_init(),console.log("BANDS: saving new dxcfg.bands ---------------------------------------------------"),cfg_save_json("config.js => dx_config.json","dxcfg.bands")):(console.log("BANDS: using stored dxcfg.bands -------------------------------------------------"),bands_addl_info(1)),dx.LEGEND=-1,dx.SAVE_NOW=!0,dx.SAVE_LATER=!1,dx.DX_DOW_BASE=dx.DX_DOW>>dx.DX_DOW_SFT,dx.spacer=w3_div("w3-font-fixed w3-text-in-circle w3-wh-24px w3-pale-blue","&nbsp;"),dx.button_section='w3-font-fixed w3-aqua w3-text-in-circle w3-wh-28px||title="show&slash;hide section"',dx.button_add='w3-css-lime||title="duplicate this entry"',dx.button_del='w3-css-red||title="delete this entry"',dx.link1='w3-link-darker-color w3-bold||title="more information"',dx.link2='w3-link-darker-color w3-bold|width:175px|title="more information"',dx.hover_over=w3_inline("w3-valign",w3_text("w3-margin-left w3-text-black","Hover over"),w3_icon("w3-link-darker-color w3-help","fa-info-circle",20),w3_text("w3-text-black","&nbsp;for info")),dx.export_label="Export: "+w3_icon('id-dx-export-info w3-link-darker-color w3-help||title="Export (download) DX labels from Kiwi\nto a file on this computer.\nFiles can be in JSON or CSV format."',"fa-info-circle",20),dx.import_label="Import: "+w3_icon('id-dx-import-info w3-link-darker-color w3-help||title="Import (upload) DX labels from a file\non this computer to Kiwi.\nFiles can be in JSON or CSV format."',"fa-info-circle",20),e=w3_div("id-search-wrap-container class-overlay-container w3-hide",w3_div("id-search-wrap",w3_icon("","fa-repeat",192))),w3_create_appendElement("id-kiwi-container","div",e);var a=w3_div("id-dx-convert w3-hide","<hr>",w3_div("w3-valign",w3_text("id-dx-convert-freq w3-text-black w3-center"),w3_button("w3-margin-L-16 w3-aqua","Add offset","dx_convert_label_foff_cb",0),w3_button("w3-margin-L-8 w3-yellow","Skip this and don't ask again","dx_convert_label_foff_cb",1)),"<hr>"),_="63vh",t=w3_inline("w3-margin-T-16 w3-halign-space-between/",w3_inline("/w3-margin-between-16 w3-valign",w3_button(dx.button_section,"-","dx_expand_cb",0),w3_link(dx.link1,"http://kiwisdr.com/quickstart/index.html#id-config-DX-list","Stored DX labels"),w3_text("id-dx-list-saved w3-margin-left w3-padding-medium w3-text-black w3-hide","Changes saved")),w3_inline("/w3-margin-between-16 w3-valign",w3_text("id-dx-export-label w3-padding-medium w3-padding-R-0 w3-text-teal w3-bold",dx.export_label),w3_inline("w3-margin-between-8",w3_button('w3-blue w3-font-12px w3-padding-tiny||title="export to JSON file"',"JSON","dx_export_cb",dx.DX_JSON),w3_button('w3-blue w3-font-12px w3-padding-tiny||title="export to CSV file"',"CSV","dx_export_cb",dx.DX_CSV)),w3_text("id-dx-import-label w3-padding-medium w3-padding-R-0 w3-text-teal w3-bold",dx.import_label),w3_inline("w3-margin-between-8",w3_button('w3-red w3-font-12px w3-padding-tiny||title="import from JSON file"',"JSON","dx_import_cb",dx.DX_JSON),w3_button('w3-red w3-font-12px w3-padding-tiny||title="import from CSV file"',"CSV","dx_import_cb",dx.DX_CSV),w3_input('//w3-hide w3-no-styling||type="file"',"","id-dx-import-form","","dx_file_upload_cb")),w3_text("w3-padding-medium w3-padding-R-0 w3-text-teal w3-bold","Search:"),w3_input('w3-text-black/w3-label-inline/w3-padding-small w3-retain-input-focus|width:75px|title="finds nearest freq"',"Freq","dx.o.search_f","","dx_search_freq_cb"),w3_input('w3-text-black/w3-label-inline/w3-padding-small w3-retain-input-focus w3-input-any-change|width:150px|title="Search ident fields.\nUse return&slash;enter key to find next. Wraps."',"Ident","dx.o.search_i","","dx_search_ident_cb"),w3_input('w3-text-black/w3-label-inline/w3-padding-small w3-retain-input-focus w3-input-any-change|width:150px|title="Search notes fields.\nUse return&slash;enter key to find next. Wraps."',"Notes","dx.o.search_n","","dx_search_notes_cb")))+w3_div("id-dx-list-container w3-container w3-margin-top w3-margin-bottom w3-card-8 w3-round-xlarge w3-pale-blue",w3_div("id-dx-list-legend w3-margin-R-15"),w3_div('id-dx-list w3-margin-bottom w3-padding-B-8 w3-black-box w3-scroll-y|height:63vh|onscroll="dx_list_scroll();"')),i=w3_inline("w3-margin-T-24 w3-halign-space-between/",w3_inline("/w3-margin-between-16 w3-valign",w3_button(dx.button_section,"+","dx_expand_cb",1),w3_link(dx.link2,"http://kiwisdr.com/quickstart/index.html#id-config-DX-type","DX type menu"),w3_text("w3-margin-left w3-text-black","Defines content of <b>Type</b> menu in <i>DX labels</i> section above.<br>Follow link at left for important info before making changes."),w3_text("id-dx-type-saved w3-margin-left w3-padding-medium w3-text-black w3-hide","Changes saved")),dx.hover_over)+w3_div("id-dx-type-container w3-hide w3-container w3-margin-top w3-margin-bottom w3-card-8 w3-round-xlarge w3-pale-blue",w3_div("id-dx-type-list-legend w3-margin-R-15"),w3_div("id-dx-type-list w3-margin-bottom w3-padding-B-8 w3-black-box w3-scroll-y|height:"+_)),e=w3_inline("w3-margin-T-24 w3-halign-space-between/",w3_inline("/w3-margin-between-16 w3-valign",w3_button(dx.button_section,"+","dx_expand_cb",2),w3_link(dx.link2,"http://kiwisdr.com/quickstart/index.html#id-config-band-bars","Band bars"),w3_text("w3-margin-left w3-text-black","Defines content of band bars and <b>select band</b> menu on user page.<br>Follow link at left for important info before making changes."),w3_text("id-band-bar-saved w3-margin-left w3-padding-medium w3-text-black w3-hide","Changes saved")),dx.hover_over)+w3_div("id-band-bar-container w3-hide w3-container w3-margin-top w3-margin-bottom w3-card-8 w3-round-xlarge w3-pale-blue",w3_div("id-band-bar-list-legend w3-margin-R-15"),w3_div("id-band-bar-list w3-margin-bottom w3-padding-B-8 w3-black-box w3-scroll-y|height:"+_)),_=w3_inline("w3-margin-TB-24 w3-halign-space-between/",w3_inline("/w3-margin-between-16 w3-valign",w3_button(dx.button_section,"+","dx_expand_cb",3),w3_link(dx.link2,"http://kiwisdr.com/quickstart/index.html#id-config-band-svc","Band service menu"),w3_text("w3-margin-left w3-text-black","Defines content of <b>Service</b> menu in <i>Band bars</i> section above.<br>Follow link at left for important info before making changes."),w3_text("id-band-svc-saved w3-margin-left w3-padding-medium w3-text-black w3-hide","Changes saved")),dx.hover_over)+w3_div("id-band-svc-container w3-hide w3-container w3-margin-top w3-margin-bottom w3-card-8 w3-round-xlarge w3-pale-blue",w3_div("id-band-svc-list-legend w3-margin-R-15"),w3_div("id-band-svc-list w3-margin-bottom w3-padding-B-8 w3-black-box w3-scroll-y|height:"+_));return w3_div("id-dx w3-hide",a+n+w3_div("id-dx-stored",t+i+e+_))}function dx_convert_label_foff_cb(e,n){n=+n;console.log("dx_convert_label_foff_cb ignore="+n),n?(w3_show_hide("id-dx-convert",!1),adm.dx_labels_converted=!0,cfg_save_json("dx_convert_label_foff_cb","adm.dx_labels_converted")):control_confirm_show("Really convert?",function(){adm.dx_labels_converted=!0,cfg_save_json("dx_convert_label_foff_cb","adm.dx_labels_converted"),ext_send_after_cfg_save("SET DX_UPD g=-9 f=-1"),admin_wait_then_reload(60,"DX labels converted, restarting KiwiSDR server")})}function dx_expand_cb(e,n){n=+n;var i=w3_el(e),t=["id-dx-list-container","id-dx-type-container","id-band-bar-container","id-band-svc-container"][n],e="-"==i.innerText;w3_hide2(t,e),i.innerText=e?"+":"-",0!=n||e||dx_list_scroll()}function dx_focus(){dx.dxcfg_parse_error||(dx.open_sched=-1,dx.o.last_search_idx=0,w3_innerHTML("id-dx-convert-freq","<b>One-time</b> addition of current frequency offset "+kiwi.freq_offset_kHz.toFixed(3)+" kHz<br>("+(kiwi.freq_offset_kHz/1e3).toFixed(6)+" MHz) to <b>ALL</b> DX labels <b>under 32 MHz</b>:"),w3_show_hide("id-dx-convert",0==adm.dx_labels_converted&&0!=kiwi.freq_offset_kHz),w3_innerHTML("id-band-bar-list-legend",""),w3_innerHTML("id-band-bar-list",""),w3_innerHTML("id-dx-list-legend",""),w3_innerHTML("id-dx-list",w3_div("w3-show-inline-block w3-relative|top:45%;left:45%",w3_icon("","fa-refresh fa-spin",48,"black"),w3_div("id-dx-list-count w3_text_black"))),ext_send("SET GET_DX_SIZE"))}function dx_size(e){dx.dxcfg_parse_error||(w3_innerHTML("id-dx-list-count","loading "+e+" entries"),dx_type_render(),band_svc_render(),band_bar_render(),setTimeout(function(){dx_size_cb(e)},500))}function dx_blur(){dx.dxcfg_parse_error||admin.init||(dx_save("id-band-svc-saved",dx.SAVE_LATER),dx_save("id-band-bar-saved",dx.SAVE_NOW))}function dx_sched_save(e,n){n=n||1500,kiwi_clearTimeout(dx.cfg_save_timeout),dx.cfg_save_timeout=setTimeout(function(){dx_save(e)},n),dx.cfg_save_sched=!0}function dx_save(e,n){kiwi_clearTimeout(dx.cfg_save_timeout),n!=dx.SAVE_NOW&&1!=dx.cfg_save_sched||(dx.cfg_save_sched=!1,w3_hide2(e,!1),w3_flash_fade(e,"cyan",50,1e3,"white"),setTimeout(function(){w3_hide2(e)},1250),"id-dx-list-saved"!=e&&n!=dx.SAVE_LATER&&(console.log("BANDS: saving dxcfg.{band_svc,bands}"),cfg_save_json("dx_save","dxcfg.bands")),ext_send_after_cfg_save("SET GET_DX_LIST"))}function dx_btn(e){return"w3-font-fixed w3-text-in-circle w3-wh-24px "+e}function dx_comm_download_cb(e,n){ext_send("SET dx_comm_download=1")}function dx_restart_cancel_cb(){ext_send("SET dx_comm_download=0")}function dx_render(e){var n;if(dx.export_active)dx_export_cb2(e);else if(dx.ignore_dx_update)dx.ignore_dx_update=!1;else{var i=e[0];(i.pe||i.fe)&&(d=w3_el("id-dx-list-msg"),w3_remove_then_add(d,"w3-green","w3-red"),_=i.pe+i.fe,d.innerHTML="Warning: dx.json file has "+_+plural(_," label")+" with errors -- see admin log tab for details.",w3_show(d));for(var t=kiwi_deep_copy(dxcfg.dx_type),a=0;a<dx.DX_N_STORED;a++)0!=i.tc[a]&&""==t[a].name&&(t[a].name="(T"+a+")");var _=+i.n,d=dx.o.len,o=dx.o.arr,r=!1;for(_!=d&&(_==d-1?o.pop():_==d+1?o.push(w3_div("cl-dx","&nbsp;")):(dx.o.last_start=0,dx.o.last_end=_-1),dx.o.len=d=_),a=dx.o.last_start;a<=dx.o.last_end&&a<o.length;a++)o[a]=w3_div("cl-dx","&nbsp;");if(d==o.length){for(dx.o.last_pb=[],dx.o.last_fd=[],n=0;n<e.length;n++){function c(e){return a==dx.LEGEND?"w3-margin-L-16/w3-padding-small/w3-hide":"w3-margin-L-16//"+e}function l(e){return a==dx.LEGEND?e:""}var s,w,b,p,m,g,f,x,u,h="",v="",k=0,T="",y=!1;(a=n?e[n].g:dx.LEGEND)!=dx.LEGEND&&(w=(s=e[n]).f,u=dx_decode_mode(s.fl),f=w3_array_el_seq(kiwi.mode_menu,kiwi.modes_uc[u]),k=(s.fl&dx.DX_TYPE)>>dx.DX_TYPE_SFT,b=kiwi_decodeURIComponent("dx_id",s.i),s.n&&(h=kiwi_decodeURIComponent("dx_no",s.n)),s.p&&(T=kiwi_decodeURIComponent("dx_ext",s.p)),p=s.o,m=s.s,x=s.lo,u=s.hi,(x||u)&&(v=x==-u?(2*Math.abs(u)).toFixed(0):x.toFixed(0)+", "+u.toFixed(0),dx.o.last_pb[a]=[x,u]),0==(g=(s.fl&dx.DX_DOW)>>dx.DX_DOW_SFT)&&(g=dx.DX_DOW_BASE),dx.o.last_fd[a]=g,x=+s.b,u=+s.e,0==x&&2400==u&&(u=0),g==dx.DX_DOW_BASE&&0==x&&0==u||(y=!0),dx.open_sched==a&&(y=!0));T=w3_inline_percent("w3-valign w3-text-black/w3-margin-T-8 w3-hspace-16x w3-margin-RE-16",w3_inline("w3-margin-L-8",a==dx.LEGEND?dx.spacer:w3_button(dx_btn(dx.button_add),"+","dx_list_add_cb",a),a==dx.LEGEND?dx.spacer:w3_button(dx_btn(dx.button_del),"-","dx_list_del_cb",a),a==dx.LEGEND||y?dx.spacer:w3_button("w3-padding-0",w3_icon('w3-pale-blue||title="add schedule time"',"fa-clock-o",26),"dx_list_sched_add_cb",a)),6,w3_input(c("w3-padding-small||size=8"),l("Freq kHz"),"dx.o.fr_"+a,w,"dx_freq_cb"),19,w3_select(c("w3-text-red"),l("Mode"),"","dx.o.mm_"+a,f,kiwi.mode_menu,"dx_sel_cb"),15,w3_input(c("w3-padding-small||size=4"),l("Passband<br>&nbsp;&nbsp;Hz"),"dx.o.pb_"+a,v,"dx_passband_cb"),19,w3_select(c("w3-text-red"),l("Type"),"","dx.o.ft_"+a,k,t,"dx_sel_cb"),25,w3_input(c("w3-padding-small||size=2"),l("Offset<br>&nbsp;&nbsp;Hz"),"dx.o.o_"+a,p,"dx_num_cb"),16,w3_input(c("w3-padding-small||size=2"),l("Sig bw<br>&nbsp;&nbsp;kHz"),"dx.o.s_"+a,m,"dx_num_cb"),19,w3_input(c("w3-padding-small"),l("Ident"),"dx.o.i_"+a,b,"dx_string_cb"),40,w3_input(c("w3-padding-small"),l("Notes"),"dx.o.n_"+a,h,"dx_string_cb"),40,w3_input(c("w3-padding-small"),l("Extension"),"dx.o.p_"+a,T,"dx_string_cb"),23);if(y){for(var E,S,D="",L=0;L<7;L++){var H=g&1<<6-L,M=H?"black":"white",H=H?dx.dow_colors[L]:"darkGrey";D+=w3_button_path("w3-dummy//w3-round w3-padding-tiny"+(L?" w3-margin-L-4":"")+"|color:"+M+"; background:"+H,"dx.o.d"+L+"_"+a,"MTWTFSS"[L],"dx_dow_button",L)}D=w3_inline("",D),0==x&&0==u?E=S="":(E=x.toFixed(0).leadingZeros(4),S=u.toFixed(0).leadingZeros(4)),T+=w3_inline_percent("w3-valign w3-text-black/w3-margin-T-8 w3-hspace-16 w3-margin-RE-16",w3_inline("w3-margin-L-8",dx.spacer,dx.spacer,w3_button("w3-padding-0",w3_icon('w3-pale-blue||title="delete schedule time"',"fa-trash-o",26),"dx_list_sched_del_cb",a)),6,D,13,w3_input("w3-label-inline/w3-padding-small","Begin","dx.o.b_"+a,E,"dx_sched_time_cb"),10,w3_input("w3-label-inline/w3-padding-small","End","dx.o.e_"+a,S,"dx_sched_time_cb"),9),dx.open_sched==dx.o.len-1&&(r=!0),dx.open_sched==a&&(dx.open_sched=-1)}a==dx.LEGEND?w3_innerHTML("id-dx-list-legend",T):o[a]=T}w3_innerHTML("id-dx-list",o.join("")),dx.o.last_start=e[1].g,dx.o.last_end=e[e.length-1].g,r&&(dx.ignore_dx_update=!0,w3_scrollDown("id-dx-list")),dx.o.search_result&&(w3_add("dx.o."+["fr_","i_","n_"][dx.o.search_result.which]+dx.o.search_result.idx,"w3-css-yellow"),setTimeout(function(){dx.o.search_result=null},500))}else dx.o.last_start=dx.o.last_end=0}}function dx_size_cb(e){var n=[];dx.o.len=+e,dx.o.arr=n;for(var i=dx.o.last_start=dx.o.last_end=0;i<e;i++)n[i]=w3_div("cl-dx","&nbsp;");w3_innerHTML("id-dx-list",n.join("")),dx_list_scroll()}function dx_list_scroll(){var e=w3_scrolledPosition("id-dx-list");kiwi_clearTimeout(dx.scroll_timeout),dx.scroll_timeout=setTimeout(function(){dx_list_scroll_done(e)},100)}function dx_list_scroll_done(e){var n;-1!=e&&(n=w3_el("id-dx-list"),n=Math.round(n.clientHeight/37.5),e=Math.round(e*(dx.o.len-n)),n=(e=Math.max(0,e-2))+n,n=Math.min(n+4,dx.o.len),ext_send("SET MARKER idx1="+e+" idx2="+n))}function dx_update_admin(){var e=w3_scrolledPosition("id-dx-list");console.log("dx_update_admin: pos="+e),dx_list_scroll_done(e)}function dx_list_add_cb(e,n){n=+n,dx_update_check(n,dx.UPD_ADD)}function dx_list_del_cb(e,n){n=+n,dx.o.len<=1||(ext_send("SET DX_UPD g="+n+" f=-1"),dx_save("id-dx-list-saved",dx.SAVE_NOW))}function dx_list_sched_add_cb(e,n){dx.open_sched=+n,dx_update_admin()}function dx_list_sched_del_cb(e,n){dx.o.last_fd[n]=dx.DX_DOW_BASE,w3_set_value("dx.o.b_"+n,0),w3_set_value("dx.o.e_"+n,2400),dx_update_check(n,dx.UPD_MOD),dx.ignore_dx_update=!1,dx_update_admin()}function dx_search_freq_cb(e,n,i){i||(n=n.parseFloatWithUnits("kM",.001),isNaN(n)?w3_set_value(e,""):ext_send("SET MARKER search_freq="+n))}function dx_search_ident_cb(e,n,i,t){i||"ev"!=t[1]&&((t=dx.o.last_search_idx)>=dx.o.len&&(t=0),ext_send("SET MARKER idx="+t+" search_ident="+encodeURIComponent(n)))}function dx_search_notes_cb(e,n,i,t){i||"ev"!=t[1]&&((t=dx.o.last_search_idx)>=dx.o.len&&(t=0),ext_send("SET MARKER idx="+t+" search_notes="+encodeURIComponent(n)))}function dx_search_pos_cb(e){var n=+(e=e.split(","))[0],i=+e[1];i<0?(w3_scrollTo("id-dx-list",0)&&dx_list_scroll(),dx_search_check_wrap(i)):(e=dx.o.len-1,w3_scrollTo("id-dx-list",+(e?i/e:0),!1)&&dx_list_scroll(),dx_search_check_wrap(i),dx.o.search_result={which:n,idx:i})}function dx_search_check_wrap(e){var n,i=0<=e&&e>=dx.o.last_search_idx;dx.o.last_search_idx=e+1,i||((n=w3_el("id-search-wrap-container")).style.opacity=.8,w3_show(n),(i=w3_el("id-search-wrap")).style.marginTop=px(w3_center_in_window(i,"SW")),setTimeout(function(){n.style.opacity=0,setTimeout(function(){w3_hide(n)},500)},300))}function dx_export_cb(e,n){dx.export_which=n,dx.export_active=!0,admin.long_running=!0,w3_innerHTML("id-dx-export-label",dx.export_label+w3_icon("w3-text-teal w3-margin-left","fa-refresh fa-spin",24)),dx.export_s_a=[],dx_export(0)}function dx_export(e){var n=dx.o.len-1,i=Math.min(e+99,n);ext_send("SET MARKER idx1="+e+" idx2="+i),i!=n&&setTimeout(function(){dx_export(i+1)},250)}function dx_export_cb2(e){function m(e){return dq(kiwi_str_decode_selective_inplace(e,!0))}var n,i,t,a,g=!1;e.length;dx.export_which==dx.DX_JSON?e.forEach(function(e,n){var i,t,a,_,d,o,r,c,l,s,w,b,p;0!=n&&((i=e.g)==dx.o.len-1&&(g=!0),t=g?"":",",a=e.f.toFixed(2),_=dq(kiwi.modes_uc[dx_decode_mode(e.fl)]),d=m(e.i),o=e.n?m(e.n):'""',p="",r=(r=(e.fl&dx.DX_TYPE)>>dx.DX_TYPE_SFT)?dq("T"+r)+":1":"",c=0!=e.lo||0!=e.hi?dqc("lo")+e.lo+", "+dqc("hi")+e.hi:"",l=e.o?dqc("o")+e.o:"",s=e.s?dqc("s")+e.s:"",w=e.p&&""!=e.p?dqc("p")+m(e.p):"",b=0!=(b=e.fl&dx.DX_DOW)&&b!=dx.DX_DOW?dqc("d0")+(b>>dx.DX_DOW_SFT):"",n=e.b,e=e.e,e=0!=n||2400!=e?dqc("b0")+n+", "+dqc("e0")+e:"",""!=(p=w3_sbc(", ",r,c,l,b,e,w,s))&&(p=", {"+p+"}"),dx.export_s_a[i]="["+a+", "+_+", "+d+", "+o+p+"]"+t+"\n")}):dx.export_which==dx.DX_CSV&&e.forEach(function(e,n){if(1,0!=n){(b=e.g)==dx.o.len-1&&(g=!0);var i=dq(kiwi.modes_uc[dx_decode_mode(e.fl)]);p=(p=(e.fl&dx.DX_TYPE)>>dx.DX_TYPE_SFT)?dq("T"+p):"";var t=e.lo,a=e.hi;0==t&&0==a&&(t=a="");var _=e.o||"",d=e.s||"",o=(e.fl&dx.DX_DOW)>>dx.DX_DOW_SFT;if(dow_s="",0!=o&&o!=dx.DX_DOW_BASE){for(var r=0;r<7;r++)dow_s+=o&1<<6-r?"MTWTFSS"[r]:"_";dow_s=dq(dow_s)}var c=e.b,l=e.e;0==c&&2400==l?c=l="":(c="'"+c.toFixed(0).leadingZeros(4),l="'"+l.toFixed(0).leadingZeros(4));var s=""!=e.i?m(e.i):"",w=e.n?m(e.n):"",n=e.p?m(e.p):"",d=[e.f,i,s,w,n,p,t,a,_,dow_s,c,l,d];dx.export_s_a[b+1]=d.join(";")+"\n"}else dx.export_s_a[0]='Freq kHz;"Mode";"Ident";"Notes";"Extension";"Type";PB low;PB high;Offset;"DOW";Begin;End;Sig bw\n';var b,p}),g&&(dx.export_which==dx.DX_JSON&&(a="application/json",n=".json",i='{"dx":[\n',t="]}\n"),dx.export_which==dx.DX_CSV&&(a="text/csv",n=".csv",i=t=""),t=new Blob([i+dx.export_s_a.join("")+t],{type:a}),(a=document.createElement("a")).style="display: none",a.href=window.URL.createObjectURL(t),a.download=kiwi_timestamp_filename("dx.",n),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(a.href),document.body.removeChild(a),dx.export_active=!1,admin.long_running=!1,w3_innerHTML("id-dx-export-label",dx.export_label))}function dx_import_cb(e,n){var i;(dx.current_import=n)==dx.DX_JSON&&((i=w3_el("id-dx-import-form")).setAttribute("accept",".json,application/json"),i.click()),n==dx.DX_CSV&&((i=w3_el("id-dx-import-form")).setAttribute("accept",".csv,text/csv"),i.click())}function dx_file_upload_cb(e){ext_get_authkey(function(e){dx_file_upload2(e)})}function dx_file_upload2(e){var n=w3_el("id-dx-import-form").files[0],i=new FormData;i.append(dx.current_import==dx.DX_JSON?"json":"csv",n,n.name),kiwi_ajax_send(i,"/DX?"+e,"dx_file_uploaded")}function dx_file_uploaded(e){var n,i=isDefined(e.AJAX_error)?-1:e.rc,t="CSV line "+e.line+": ";switch(i){case-1:n="Communication error";break;case 0:n="Successful -- Must restart to use new label data";break;case 1:n="Authentication failed";break;case 2:n="File too large";break;case 3:n="File write error";break;case 4:n="Bad upload type";break;case 10:n=t+"expected 12 fields, got "+e.nfields;break;case 11:n=t+"expected frequency number in field 1";break;case 12:n=t+"expected mode string in field 2";break;case 13:n=t+"expected ident string in field 3";break;case 14:n=t+"expected notes string in field 4";break;case 15:n=t+"expected extension string in field 5";break;case 16:n=t+"expected type string in field 6";break;case 17:n=t+"expected passband low number in field 7";break;case 18:n=t+"expected passband high number in field 8";break;case 19:n=t+"expected offset freq number in field 9";break;case 20:n=t+"expected day-of-week string in field 10";break;case 21:n=t+'day-of-week string in field 10 is not 7 characters long (i.e. "MTWTFSS")';break;case 22:n=t+"expected begin time number in field 11";break;case 23:n=t+"expected end time number in field 12";case 24:n=t+"expected signal bandwidth number in field 13";break;default:n="Undefined error?"}var a=w3_el("id-dx-list-msg");w3_remove_then_add(a,"w3-red w3-green",i?"w3-red":"w3-green"),a.innerHTML="File upload: "+n,w3_show(a),0==i&&w3_restart_cb()}function dx_type_render(){for(var e="dx_type_field_cb|",n=[],i="w3-link-darker-color w3-help",t="w3-margin-L-8 w3-center w3-bold|width:60px",a="Type "+w3_icon(i+"||title="+dq("The code appearing in the\ntype field of the dx.json file."),"fa-info-circle",20),_="Menu entry name "+w3_icon(i+"||title="+dq("The menu entry names. The ordering here determines\nthe ordering of entries in the menu. See instructions."),"fa-info-circle",20),d="HTML color name "+w3_icon(i+"||title="+dq("An HTML color specification, including\ncolor name, hex or HSL value etc."),"fa-info-circle",20),o="Test "+w3_icon(i+"||title="+dq("How the colors of the labels with\nthis type value should appear."),"fa-info-circle",20),r=-1;r<dxcfg.dx_type.length;r++){function c(e){return s?"w3-hide":e}function l(e){return s?e:""}var s=r==dx.LEGEND,w=s?{}:dxcfg.dx_type[r],b=s?w3_label(t,a):w3_div(t,"T"+r.toFixed(0)),p=r==dxcfg.dx_type.length-1,m=w3_psa_mix("w3-padding-small||size=8",p?"w3-cursor-not-allowed":"","",p?"disabled":""),p=w3_inline_percent("w3-valign w3-text-black/w3-margin-T-8 w3-hspace-16 w3-margin-RE-16",w3_inline("w3-margin-L-8",b),6,w3_input(c(m),l(_),r+"_type.name",w.name,e+"0"),13,w3_input(c(m),l(d),r+"_type.color",w.color,e+"1"),13,s?w3_label("w3-bold",o):""==w.name||p?"":w3_inline("w3-halign-space-between/",w3_div("id-"+r+"_type.ex cl-dx-type-test"),w3_div("id-"+r+"_type.exf cl-dx-type-test cl-dx-type-filtered-test")),20);s?w3_innerHTML("id-dx-type-list-legend",p):n[r]=p}w3_innerHTML("id-dx-type-list",n.join("")),dx_color_init();for(r=0;r<dxcfg.dx_type.length-1;r++)dx_type_bar_test(r)}function dx_type_bar_test(e){type=dxcfg.dx_type[e];var n=w3_el(e+"_type.ex");n&&(n.innerHTML=type.name,n.style.background=dxcfg.dx_type[e].color,(n=w3_el(e+"_type.exf")).innerHTML=type.name,n.style.background=dx.stored_colors_light[e])}function dx_type_field_cb(e,n,i,t){if(!i){var a=parseInt(e),i=dxcfg.dx_type[a];console.log("dx_type_field_cb path="+e+" val="+n+" i="+a+" obj="+i);i=i.key,t=+t[1];if(console.log("dx_type_field_cb key="+i+" which="+t),0==t)console.log("dxcfg.dx_type["+i+"].name="+n),dxcfg.dx_type[a].name=n,dx_type_render(),dx_update_admin();else if(1==t){console.log("dxcfg.dx_type["+i+"].color="+n);e=w3_el(e);if(!w3color(n).valid)return e.style.background="red",void console.log("invalid dx type color name");e.style.background="",dxcfg.dx_type[a].color=n,dx_color_init(),dx_type_bar_test(a)}dx_sched_save("id-dx-type-saved")}}function band_bar_render(){for(var e=[],n="band_bar_float_cb|",i="w3-link-darker-color w3-help",t="Min kHz "+w3_icon(i+"||title="+dq("If an entry is defining a single frequency in the select band menu,\nand not a band bar, then set Min equal to Max."),"fa-info-circle",20),a="Band name "+w3_icon(i+"||title="+dq("Name that appears in both the band bar\nand select band menu entry."),"fa-info-circle",20),_="Service "+w3_icon(i+"||title="+dq("Service class as defined by next section."),"fa-info-circle",20),d="ITU / Visibility "+w3_icon(i+"||title="+dq("ITU region or visibility of band bar or frequency entry."),"fa-info-circle",20),o="Chan "+w3_icon(i+"||title="+dq("Defines the band channel spacing (kHz).\nFor example with LW and MW bands."),"fa-info-circle",20),r="Freq/mode/zoom "+w3_icon(i+"||title="+dq("Optional frequency, mode and zoom\n to set when select band entry used."),"fa-info-circle",20),c=dx.LEGEND;c<dxcfg.bands.length;c++){p=c!=dx.LEGEND?dxcfg.bands[c]:{};function l(e){return c==dx.LEGEND?"w3-hide":e}function s(e){return c==dx.LEGEND?e:""}var w;c==dx.LEGEND?w=null:null!=(w=band_svc_lookup(p.svc))&&(w=w.i);var b=0<p.itu?p.itu:0,p=w3_inline_percent("w3-valign w3-text-black/w3-margin-T-8 w3-hspace-16 w3-margin-RE-16",w3_inline("w3-margin-L-8",c==dx.LEGEND?dx.spacer:w3_button(dx_btn(dx.button_add),"+","band_bar_add_cb",c),c==dx.LEGEND?dx.spacer:w3_button(dx_btn(dx.button_del),"-","band_bar_del_cb",c)),2,w3_input(l("w3-padding-small||size=8"),s(t),c+"_bands.min",p.min,n+"0"),10,w3_input(l("w3-padding-small||size=8"),s("Max kHz"),c+"_bands.max",p.max,n+"1"),10,w3_input(l("w3-padding-small"),s(a),c+"_bands.n",p.name,"band_bar_field_cb|0"),25,w3_select(l("w3-text-red"),s(_),"",c+"_bands.s",w,dxcfg.band_svc,"band_bar_select_cb","s"),12,w3_select(l("w3-text-red"),s(d),"",c+"_bands.i",b,kiwi.ITU_s,"band_bar_select_cb","i"),25,w3_input(l("w3-padding-small||size=6"),s(o),c+"_bands.c",p.chan,n+"2"),7,w3_input(l("w3-padding-small||size=8"),s(r),c+"_bands.fms",p.sel,"band_bar_field_cb|1"),15);c==dx.LEGEND?(w3_innerHTML("id-band-bar-list-legend",p),0==dxcfg.bands.length&&(e[0]=w3_button(dx_btn("w3-margin-L-8 w3-margin-T-8 w3-css-lime"),"+","band_bar_add_cb",c))):e[c]=p}w3_innerHTML("id-band-bar-list",e.join(""))}function band_bar_add_cb(e,n,i){if(!i){n=+n;if(console.log("band_bar_add_cb path="+e+" i="+n),n==dx.LEGEND)t={min:530,max:1600,name:"new band bar",svc:null,itu:0,sel:"",chan:0};else{if(n<0||n>=dxcfg.bands.length)return;var e=dxcfg.bands[n],t={min:e.min,max:e.max,name:e.name,svc:e.svc,itu:e.itu,sel:e.sel,chan:e.chan}}dxcfg.bands.splice(1+n,0,t),dx_save("id-band-bar-saved",dx.SAVE_NOW),bands_addl_info(1),band_bar_render()}}function band_bar_del_cb(e,n,i){i||(n=+n,console.log("band_bar_del_cb path="+e+" i="+n),n<0||n>=dxcfg.bands.length||(dxcfg.bands.splice(n,1),dx_save("id-band-bar-saved",dx.SAVE_NOW),bands_addl_info(1),band_bar_render()))}function band_bar_float_cb(e,n,i,t){var a;i||((a=parseInt(e))<0||a>=dxcfg.bands.length||(i=+t[1],t=dxcfg.bands[a][admin_sdr.cfg_fields[i]],n=parseFloat(n),console.log("band_bar_float_cb path="+e+" val="+n+" i="+a+" which="+i+" prior="+t),n=+n.toFixed(3),isNumber(n)||(n=t),w3_set_value(e,n||""),0==i?(console.log("dxcfg.bands["+a+"].min="+n),dxcfg.bands[a].min=n):1==i?(console.log("dxcfg.bands["+a+"].max="+n),dxcfg.bands[a].max=n):2==i&&(console.log("dxcfg.bands["+a+"].chan="+n),dxcfg.bands[a].chan=n),dx_sched_save("id-band-bar-saved")))}function band_bar_field_cb(e,n,i,t){i||(i=parseInt(e),console.log("band_bar_field_cb path="+e+" val="+n+" i="+i),i<0||i>=dxcfg.bands.length||(0==(t=+t[1])&&""==n&&(n="(blank)",w3_set_value(e,n)),0==t?dxcfg.bands[i].name=n:1==t&&(dxcfg.bands[i].sel=n),dx_sched_save("id-band-bar-saved")))}function band_bar_select_cb(e,n,i,t){i||(i=parseInt(e),n=+n,console.log("band_bar_select_cb path="+e+" val="+n+" i="+i+" which="+t),i<0||i>=dxcfg.bands.length||("s"==t?(e=dxcfg.band_svc[n].key,console.log("dxcfg.bands["+i+"].svc="+e),dxcfg.bands[i].svc=e):"i"==t&&(console.log("dxcfg.bands["+i+"].itu="+n),dxcfg.bands[i].itu=n),dx_sched_save("id-band-bar-saved")))}function band_svc_render(){for(var e="band_svc_field_cb|",n=[],i="w3-link-darker-color w3-help",t="Menu entry name "+w3_icon(i+"||title="+dq("Changes made here should immediately\nbe visible in Service menu above."),"fa-info-circle",20),a="HTML color name "+w3_icon(i+"||title="+dq("An HTML color specification, including\ncolor name, hex or HSL value etc."),"fa-info-circle",20),_="Long name "+w3_icon(i+"||title="+dq("Optional name shown in band bar, instead of menu entry name at left,\nwhen zoomed in and band bar is wide."),"fa-info-circle",20),d="&nbsp;Test "+w3_icon(i+"||title="+dq("Example of how band bar will look."),"fa-info-circle",20),o=-1;o<dxcfg.band_svc.length;o++){l=o!=dx.LEGEND?dxcfg.band_svc[o]:{};function r(e){return o==dx.LEGEND?"w3-hide":e}function c(e){return o==dx.LEGEND?e:""}var l=w3_inline_percent("w3-valign w3-text-black/w3-margin-T-8 w3-hspace-16 w3-margin-RE-16",w3_inline("w3-margin-L-8",o==dx.LEGEND?dx.spacer:w3_button(dx_btn(dx.button_add),"+","band_svc_add_cb",o),o==dx.LEGEND?dx.spacer:w3_button(dx_btn(dx.button_del),"-","band_svc_del_cb",o)),2,w3_input(r("w3-padding-small||size=8"),c(t),o+"_svc.name",l.name,e+"0"),13,w3_input(r("w3-padding-small||size=8"),c(a),o+"_svc.color",l.color,e+"1"),13,w3_input(r("w3-padding-small||size=8"),c(_),o+"_svc.lname",l.longName,e+"2"),30,o==dx.LEGEND?w3_label("w3-bold",d):w3_div("id-"+o+"_svc.ex cl-band-bar-test"),30);o==dx.LEGEND?w3_innerHTML("id-band-svc-list-legend",l):n[o]=l}w3_innerHTML("id-band-svc-list",n.join(""));for(o=0;o<dxcfg.band_svc.length;o++)band_svc_bar_test(o)}function band_svc_bar_test(e){svc=dxcfg.band_svc[e];var n=w3_el(e+"_svc.ex");n.innerHTML=isDefined(svc.longName)&&""!=svc.longName?svc.longName:svc.name;e=w3_fg_color_with_opacity_against_bk_color(svc.color,.2,"white");n.style.background=e.toRgbString(),n.style.color=svc.color}function band_svc_new_key(){var i=-1;return dxcfg.band_svc.forEach(function(e,n){e=+e.key;isNumber(e)&&i<e&&(i=e)}),i++,console.log("band_svc_new_key key="+i),i.toFixed(0)}function band_svc_add_cb(e,n,i){i||(i=+n,console.log("band_svc_add_cb path="+e+" i="+i),i<0||i>=dxcfg.band_svc.length||(n=dxcfg.band_svc[i],console.log(n),e={key:band_svc_new_key(),name:n.name,color:n.color},n.longName&&(e.longName=n.longName),dxcfg.band_svc.splice(1+i,0,e),dx_save("id-band-svc-saved",dx.SAVE_NOW),bands_addl_info(1),band_svc_render(),band_bar_render()))}function band_svc_del_cb(e,n,i){i||(n=+n,console.log("band_svc_del_cb path="+e+" i="+n),n<0||n>=dxcfg.band_svc.length||dxcfg.band_svc.length<=1||(dxcfg.band_svc.splice(n,1),dx_save("id-band-svc-saved",dx.SAVE_NOW),bands_addl_info(1),band_svc_render(),band_bar_render()))}function band_svc_field_cb(e,n,i,t){if(!i){var a=parseInt(e),_=dxcfg.band_svc[a];if(console.log("band_svc_field_cb path="+e+" val="+n+" i="+a+" obj="+_),null!=_){console.log(_);var d=_.key,i=+t[1];console.log("band_svc_field_cb key="+d+" which="+i);_=!1;if(0==i)""==n&&(n="(blank)",w3_set_value(e,n)),console.log("dxcfg.band_svc["+d+"].name="+n),dxcfg.band_svc[a].name=n,_=!0;else if(1==i){console.log("dxcfg.band_svc["+d+"].color="+n);t=w3_el(e),e=w3color(n);if(""==n||!e.valid)return t.style.background="red",void console.log("invalid band color name");t.style.background="",dxcfg.band_svc[a].color=n}else 2==i&&(console.log("dxcfg.band_svc["+d+"].longName="+n),dxcfg.band_svc[a].longName=n);band_svc_bar_test(a),dx_sched_save("id-band-svc-saved"),bands_addl_info(1),_&&band_bar_render()}}}function extensions_html(){return w3_div("id-extensions w3-hide w3-section",w3_sidenav("id-extensions-nav w3-margin-B-16"),w3_div("id-extensions-config"))}function extensions_focus(){w3_el("id-nav-wspr")&&w3_click_nav(kiwi_toggle(toggle_e.FROM_COOKIE|toggle_e.SET,"wspr","wspr","last_admin_ext_nav"),"extensions_nav")}function extensions_blur(){ext_cur_nav&&w3_call(ext_cur_nav+"_config_blur")}function extensions_nav_focus(e,n){writeCookie("last_admin_ext_nav",e),w3_show(e+"-container"),w3_call(e+"_config_focus"),ext_cur_nav=e}function extensions_nav_blur(e,n){w3_hide(e+"-container"),w3_call(e+"_config_blur")}var ext_seq=0;function ext_admin_config(e,n,i,t){null==t&&(t=null);t=ext_seq%admin_colors.length;w3_el("id-extensions-nav").innerHTML+=w3_nav(admin_colors[t]+" w3-border",n,e,"extensions_nav"),ext_seq++,w3_el("id-extensions-config").innerHTML+=w3_div("id-"+e+"-container w3-hide|width:95%",i)}function ext_config_html(e,n,i,t,a){var _=e.ext_name;e.enable=ext_get_cfg_param(n+".enable",!0,EXT_SAVE),!dbgUs&&extint.excl_devl.includes(_)||ext_admin_config(_,i,w3_div("id-"+_+" w3-text-teal w3-hide",w3_col_percent("w3-valign/",w3_div("w3-bold",t),40,w3_inline("",w3_switch_label("w3-margin-R-8/w3-label-inline w3-label-left/","User enabled?","Yes","No",n+".enable",e.enable,"admin_radio_YN_cb"),w3_div("w3-text-black w3-margin-L-32","Local connections exempt.")))+"<hr>"+(a||"")))}