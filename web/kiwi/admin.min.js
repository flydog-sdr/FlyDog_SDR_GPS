var admin={current_tab_name:"",console_open:!1,long_running:!1,no_admin_reopen_retry:!1,is_multi_core:!1,reg_status:{},pie_size:25,spectral_inversion_lockout:!1,_last_:0};function status_html(){var e=admin_sdr_mode?w3_div("w3-container w3-section",w3_text("w3-text-black",'Your Kiwi <i>may</i> restart during the nightly update window for the following reasons. The restart will not occur when there are active user connections. <br>But <b>will</b> occur if there are only "background" connections such as FT8/WSPR autorun, kiwirecorder (e.g. wsprdaemon) etc. <br>To prevent <i>any</i> restarts disable all of the restart sources listed below until all of the icons are grey in color.'),w3_div("w3-container",w3_inline("",w3_icon("id-rst-daily","fa-square",16,"grey"),w3_text("w3-margin-left w3-text-black","Control tab: Daily restart")),w3_inline("",w3_icon("id-rst-comm","fa-square",16,"grey"),w3_text("w3-margin-left w3-text-black","DX tab: Automatically download community database")),w3_inline("",w3_icon("id-rst-swupd","fa-square",16,"grey"),w3_text("w3-margin-left w3-text-black","Update tab: Automatically install software updates")),w3_inline("",w3_icon("id-rst-ipbl","fa-square",16,"grey"),w3_text("w3-margin-left w3-text-black","Network tab: Automatically download IP blacklist"))))+"<hr>":"",t=admin_sdr_mode?w3_div("id-msg-errors w3-container")+w3_div("w3-container w3-section",w3_inline("",w3_div("","Realtime response histograms:"),w3_button("w3-padding-smaller w3-aqua|margin-left:10px","Reset","status_dpump_hist_reset_cb")),w3_div("w3-container",w3_div("id-status-dp-hist"),w3_div("id-status-in-hist")))+"<hr>":"";return w3_div("id-status w3-hide","<hr>"+w3_div("id-problems w3-container")+w3_div("id-msg-config w3-container")+w3_div("id-msg-debian w3-container")+w3_div("id-msg-gps w3-container")+w3_div("id-msg-snr w3-container")+w3_div("w3-container","Browser: "+navigator.userAgent)+"<hr>"+w3_div("id-msg-stats-cpu w3-container")+w3_div("id-msg-stats-xfer w3-container")+"<hr>"+w3_div("id-users-list w3-container")+"<hr>"+e+t)}function status_focus(){admin_sdr_mode&&(w3_colors("id-rst-daily","grey","lime",adm.daily_restart),w3_colors("id-rst-comm","grey","lime",adm.dx_comm_auto_download),w3_colors("id-rst-swupd","grey","lime",adm.update_install),w3_colors("id-rst-ipbl","grey","lime",adm.ip_blacklist_auto_download)),kiwi.test_cfg_save_seq&&(cfg_save_json("test_cfg_save_seq 1","cfg"),setTimeout(function(){cfg_save_json("test_cfg_save_seq 2","cfg")},100),setTimeout(function(){cfg_save_json("test_cfg_save_seq 3","cfg")},200),setTimeout(function(){cfg_save_json("test_cfg_save_seq 4","cfg")},300))}function status_dpump_hist_reset_cb(e,t){ext_send("SET dpump_hist_reset")}function status_user_kick_cb(e,t){console.log("status_user_kick_cb="+t),ext_send("SET user_kick="+t)}var mode_icon_snd12=w3_icon("w3-text-blue","fa-volume-up",28)+"&nbsp;",mode_icon_snd20=w3_icon("w3-text-red","fa-volume-up",28)+"&nbsp;",mode_icon_fft=w3_icon("w3-text-green","fa-bar-chart",28)+"&nbsp;",mode_icon_wf=w3_icon("w3-text-amber","fa-area-chart",28)+"&nbsp;";function mode_html(){var e=px(235),t=px(113),n=0;return w3_div("id-mode w3-hide","<hr>",w3_div("w3-container",dbgUs?w3_switch_label("w3-restart w3-margin-B-32 w3-text-teal/w3-label-left w3-label-inline/","Use anti-aliased versions?","Yes","No","adm.anti_aliased",adm.anti_aliased,"admin_radio_YN_cb"):"",w3_div("w3-flex w3-margin-B-8",w3_div("w3-text-teal|width:"+t," "),w3_div("w3-text-teal w3-center w3-bold|width:"+e,"select FPGA mode"),w3_div("id-fw-hdr w3-flex w3-margin-left")),w3_div("",w3_div("w3-left",w3_div("w3-flex w3-halign-center w3-margin-B-5",'<img src="gfx/kiwi.73x73.jpg" width="73" height="73" />'),w3_div("w3-flex w3-halign-center w3-margin-B-5",'<img src="gfx/cowbelly.73x73.jpg" width="73" height="73" />'),w3_div("w3-flex",'<img src="gfx/kiwi.derp.113x73.jpg" width="113" height="73" />'),admin.is_multi_core?w3_div("w3-flex",'<img src="gfx/kiwi.derp.113x73.jpg" width="113" height="73" />'):""),w3_sidenav("id-fw-nav|width:"+e+";border-collapse:collapse",w3_nav(admin_colors[n++]+" w3-border w3-padding-xxlarge w3-restart","Kiwi classic",kiwi.RX4_WF4,"firmware_sel_cb",adm.firmware_sel==kiwi.RX4_WF4),w3_nav(admin_colors[n++]+" w3-border w3-padding-xxlarge w3-restart","More receivers",kiwi.RX8_WF2,"firmware_sel_cb",adm.firmware_sel==kiwi.RX8_WF2),w3_nav(admin_colors[+n]+" w3-border w3-padding-xxlarge w3-restart","More bandwidth",kiwi.RX3_WF3,"firmware_sel_cb",adm.firmware_sel==kiwi.RX3_WF3),admin.is_multi_core?w3_nav(admin_colors[3]+" w3-border w3-padding-xxlarge w3-restart","MCORE rx14_wf0",kiwi.RX14_WF0,"firmware_sel_cb",adm.firmware_sel==kiwi.RX14_WF0):""),w3_div("w3-margin-left w3-left",w3_div("id-fw-44 w3-flex w3-padding-TB-7"),w3_div("id-fw-82 w3-flex w3-padding-TB-7"),w3_div("id-fw-22 w3-flex w3-padding-TB-7"))),w3_div("w3-clear"," "),w3_div("w3-margin-T-16","<hr>"),w3_col_percent("w3-section/ w3-hspace-16",w3_div("w3-text-black",w3_text("w3-bold w3-margin-B-8 w3-text-teal","Trade-offs: receiver channels, audio bandwidth and waterfalls"),w3_div("w3-flex w3-valign-center",w3_div("|width:40px",mode_icon_snd12),w3_div("","Audio output, 12 kHz max bandwidth")),w3_div("w3-flex w3-valign-center",w3_div("|width:40px",mode_icon_snd20),w3_div("","Audio output, 20 kHz max bandwidth")),w3_div("w3-flex w3-margin-B-8 w3-valign-center",w3_div("|width:40px",mode_icon_wf),w3_div("","Tuneable waterfall/spectrum, 30 MHz bandwidth, 14-level zoom")),w3_div("w3-flex w3-margin-B-8 w3-valign-center",w3_div("|width:40px",mode_icon_fft),w3_div("","Audio FFT display, 12 kHz max bandwidth ")),"The original Kiwi FPGA with its 4 tuneable audio/waterfall receiver channels and 12 GPS channels was completely full. But it is now possible to load a different FPGA configuration where 2 of the waterfalls have been traded for adding more audio-only receiver channels. "),48,w3_div("w3-text-black"," "),4,w3_div("w3-text-black","Having more receiver channels per Kiwi is especially important with the recently added features that are channel intensive. Namely the TDoA service, WSPR/FT8 autorun and external connection via the kiwirecorder program for using other software such as WSJT-X and Dream (DRM). When these kinds of connections are made channels rx2 - rx7 will be used first leaving rx0 and rx1 available for normal browser connections where it is desirable to view the waterfall. However rx0 and rx1 will be used last if necessary. The configurable TDoA channel limit still applies.<br><br>To compensate for lack of the waterfall/spectrum on the new channels an audio-bandwidth FFT is presented instead. This requires no additional FPGA resources."),48),w3_div("w3-margin-T-16","<hr>"),w3_col_percent("w3-section/ w3-hspace-16",w3_div("w3-text-black",'And now a third option "More bandwidth". The audio bandwidth is increased from 12 to 20 kHz. This supports wide passbands for hi-fidelity listening of AM BCB and SW stations. And also wide IQ bandwidths for external applications processing large parts of the spectrum. '),48,w3_div("w3-text-black"," "),4,w3_div("w3-text-black","In exchange the number of channels must drop from four to three."),48),w3_div("w3-margin-T-16","<hr>")))}function mode_focus(){for(var e=px(90),t="",n=0;n<8;n++)t+=w3_div("w3-margin-left w3-bold w3-center|width:"+e,"rx"+n);w3_innerHTML("id-fw-hdr",t);var i=w3_div("w3-margin-left w3-border w3-border-light-blue w3-center|width:"+e,mode_icon_snd12,"<br>",mode_icon_wf),a=w3_div("w3-margin-left w3-border w3-border-light-blue w3-center|width:"+e,mode_icon_snd20,"<br>",mode_icon_wf),o=w3_div("w3-margin-left w3-border w3-border-light-blue w3-center|width:"+e,mode_icon_snd12,"<br>",mode_icon_fft);for(t="",n=0;n<4;n++)t+=i;for(w3_innerHTML("id-fw-44",t),t="",n=0;n<2;n++)t+=i;for(n=2;n<8;n++)t+=o;for(w3_innerHTML("id-fw-82",t),t="",n=0;n<3;n++)t+=a;w3_innerHTML("id-fw-22",t)}function firmware_sel_cb_focus(e){var t=+e;console.log("firmware_sel_cb_focus path="+e),ext_set_cfg_param("adm.firmware_sel",t,EXT_SAVE)}function control_html(){var e="<hr>"+w3_half("w3-valign","",w3_div("",w3_div("",w3_button("w3-aqua w3-margin","KiwiSDR server restart","control_restart_cb"),w3_button("w3-blue w3-margin","Beagle reboot","control_reboot_cb"),w3_button("w3-red w3-margin","Beagle power off","control_power_off_cb"))),w3_div("w3-container w3-center",w3_switch_label("w3-center","Daily restart?","Yes","No","adm.daily_restart",adm.daily_restart,"admin_radio_YN_cb"),w3_div("w3-text-black w3-tspace-8","Set if you're having problems with the server<br>after it has run for a period of time.<br>Restart occurs at the same time as updates (0100-0600 Local)<br> and will wait until there are no connections."))),t=ext_get_cfg_param("ext_api_nchans",-1);-1==t&&(t=rx_chans);for(var n=Math.min(t,rx_chans),i={0:"none"},a=1;a<=rx_chans;a++)i[a]=a.toFixed(0);t="<hr>"+w3_third("w3-container w3-valign","",w3_divs("",w3_inline("w3-halign-space-around/",w3_switch_label("w3-center","Enable user<br>connections?","Yes","No","adm.server_enabled",adm.server_enabled,"server_enabled_cb"),w3_divs("w3-center/w3-margin-T-8",w3_div("","<b>Close all active<br>user connections</b>"),w3_button("w3-red","Kick","control_user_kick_cb")))),w3_divs("/w3-center w3-tspace-8",w3_select("w3-width-auto","Number of simultaneous channels available<br>for connection by non-Kiwi apps","","ext_api_nchans",n,i,"admin_select_cb"),w3_div("w3-text-black","If you want to limit incoming connections from <br> non-Kiwi apps like kiwirecorder set this value. <br>This overrides similar value in TDoA extension settings.")),w3_divs("w3-restart/w3-tspace-8",w3_switch_label("w3-center","Disable waterfalls/spectrum?","Yes","No","cfg.no_wf",cfg.no_wf,"admin_radio_YN_cb"),w3_text("w3-text-black w3-center",'Set "yes" to save Internet bandwidth by preventing <br>the waterfall and spectrum from being displayed.')))+w3_half("w3-margin-top","w3-container",w3_div("",w3_input_get("","Reason if disabled","reason_disabled","reason_cb","","will be shown to users attempting to connect"),w3_divs("w3-margin-top/","<label><b>Disabled reason HTML preview</b></label>",w3_div("id-reason-disabled-preview w3-text-black w3-background-pale-aqua",""))),w3_div("",w3_input_get("","Reason if kicked","reason_kicked","reason_cb","","will be shown to users when kicked"),w3_divs("w3-margin-top/","<label><b>Kicked reason HTML preview</b></label>",w3_div("id-reason-kicked-preview w3-text-black w3-background-pale-aqua","")))),n=ext_get_cfg_param("n_camp",-1);console.log("rx_chans="+rx_chans+" n_camp="+n+" max_camp="+max_camp);for(var o=["disable camping"],a=1;a<=max_camp;a++)o[a]=a.toFixed(0);n="<hr>"+w3_third("w3-margin-bottom w3-text-teal","w3-container",w3_div("",w3_input_get("","Inactivity time limit (min, 0 = no limit)","inactivity_timeout_mins","admin_int_cb"),w3_div("w3-text-black","Connections from the local network are exempt.")),w3_div("",w3_input_get("","24hr per-IP addr time limit (min, 0 = no limit)","ip_limit_mins","admin_int_cb"),w3_div("w3-text-black","Connections from the local network are exempt.")),w3_div("",w3_input_get("","Time limit exemption password","adm.tlimit_exempt_pwd","w3_string_set_cfg_cb"),w3_div("w3-text-black","Password users can give to override time limits.")))+"<hr>"+w3_third("w3-margin-bottom w3-text-teal","w3-container",w3_divs("w3-restart/w3-center w3-tspace-8",w3_select("w3-width-auto","Number of audio campers per channel","","n_camp",n,o,"admin_select_cb"),w3_div("w3-text-black","Reduce this value if your Kiwi is experiencing <br>performance problems from too many audio campers.")),w3_divs("/w3-center w3-tspace-8",w3_select("w3-width-auto","SNR measurement interval","","cfg.snr_meas_interval_hrs",cfg.snr_meas_interval_hrs,["disable","hourly","4 hours","6 hours","24 hours"],"admin_select_cb"),w3_text("w3-text-black w3-center","Enables automatic sampling of <br>signal-to-noise ratio (SNR) at the specified interval. <br>Access SNR data in JSON format using <br>URL of the form: <i>my_kiwi:8073/snr</i>")),w3_divs("/w3-tspace-8",w3_checkbox_get_param("//w3-label-inline w3-restart","Non-Kiwi connections (kiwirecorder, TDoA) can preempt autorun processes","any_preempt_autorun","admin_bool_cb",!0),w3_checkbox_get_param("//w3-label-inline","Timestamp SNR with local time","snr_local_time","admin_bool_cb",!0),w3_button("w3-aqua w3-margin-T-16","Force SNR measurement","control_snr_measure_cb")))+"<hr>";return w3_div("id-control w3-text-teal w3-hide",e+(admin_sdr_mode?t+n:""))}function control_focus(){w3_innerHTML("id-reason-disabled-preview",admin_preview_status_box("disabled_preview_1",cfg.reason_disabled)),w3_innerHTML("id-reason-kicked-preview",admin_preview_status_box("kicked_preview_1",cfg.reason_kicked))}function server_enabled_cb(e,t,n){t=0==(t=+t);n||ext_send("SET server_enabled="+(t?1:0)),admin_bool_cb(e,t,n)}function control_user_kick_cb(e,t){ext_send("SET user_kick=-1")}function control_snr_measure_cb(e,t){ext_send("SET snr_meas")}function reason_cb(e,t){w3_string_set_cfg_cb(e,t),w3_el("id-reason-disabled-preview").innerHTML=admin_preview_status_box("disabled_preview_2",cfg.reason_disabled),w3_el("id-reason-kicked-preview").innerHTML=admin_preview_status_box("kicked_preview_2",cfg.reason_kicked)}var pending_restart=!1,pending_reboot=!1,pending_power_off=!1,control_confirm_cb_func=null;function control_confirm_show(e,t){control_confirm_cb_func=t,w3_innerHTML("id-confirm-msg","<h5>"+e+"</h5>"),w3_show_block("id-confirm")}function control_restart_cb(){pending_restart=!0,control_confirm_show("Really restart?")}function control_reboot_cb(){pending_reboot=!0,control_confirm_show("Really reboot?")}function control_power_off_cb(){pending_power_off=!0,control_confirm_show("Really power off?")}function control_confirm_cb(){pending_restart?admin_restart_now_cb():pending_reboot?admin_reboot_now_cb():pending_power_off?(ext_send("SET power_off"),admin_wait_then_reload(0,"Powering off Beagle")):w3_call(control_confirm_cb_func)}function control_confirm_cancel_cb(){w3_hide("id-confirm")}var connect={focus:0,timeout:null},connect_dom_sel={NAM:0,DUC:1,PUB:2,SIP:3,REV:4},duc_update_i={0:"5 min",1:"10 min",2:"15 min",3:"30 min",4:"60 min"},duc_update_v={0:5,1:10,2:15,3:30,4:60};function connect_html(){"kiwisdr.example.com"==ext_get_cfg_param("server_url")&&ext_set_cfg_param("cfg.server_url","",EXT_SAVE),"kiwisdr.example.com"==ext_get_cfg_param("sdr_hu_dom_name")&&ext_set_cfg_param("cfg.sdr_hu_dom_name","",EXT_SAVE);var e=0,t=w3_div("w3-valign",'<header class="w3-container w3-yellow"><h5>If you are not able to make an incoming connection from the Internet to your Kiwi because of problems <br> with your router or Internet Service Provider (ISP) then please consider using the KiwiSDR <a href="http://p.sdrotg.com" target="_blank">reverse proxy service</a>.</h5></header>')+"<hr>"+w3_divs("w3-container/w3-tspace-8",w3_label("w3-bold","What domain name or IP address will people use to connect to your KiwiSDR?<br>If you are listing on rx.kiwisdr.com this information will be part of your entry.<br>Click one of the five options below and enter any additional information:<br><br>"),w3_sidenav("id-admin-nav-dom w3-margin-R-16 w3-restart",w3_nav(admin_colors[e++]+" w3-border","Domain Name","connect_dom_nam","connect_dom_nam",cfg.sdr_hu_dom_sel==connect_dom_sel.NAM),w3_nav(admin_colors[e++]+" w3-border","DUC Domain","connect_dom_duc","connect_dom_duc",cfg.sdr_hu_dom_sel==connect_dom_sel.DUC),w3_nav(admin_colors[e++]+" w3-border","Reverse Proxy","connect_dom_rev","connect_dom_rev",cfg.sdr_hu_dom_sel==connect_dom_sel.REV),w3_nav(admin_colors[+e]+" w3-border","Public IP","connect_dom_pub","connect_dom_pub",cfg.sdr_hu_dom_sel==connect_dom_sel.PUB),w3_nav(admin_colors[4]+" w3-border","Specified IP","connect_dom_sip","connect_dom_sip",cfg.sdr_hu_dom_sel==connect_dom_sel.SIP)),w3_divs("w3-padding-L-16/w3-padding-T-1",w3_div("w3-show-inline-block|width:70%;",w3_input_get("","","sdr_hu_dom_name","connect_dom_name_cb","","Enter domain name that you will point to Kiwi public IP address, e.g. kiwisdr.my_domain.com (don't include port number)")),w3_div("id-connect-duc-dom w3-padding-TB-8"),w3_div("id-connect-rev-dom w3-padding-TB-8"),w3_div("id-connect-pub-ip w3-padding-TB-8"),w3_div("w3-show-inline-block|width:70%;",w3_input_get("","","sdr_hu_dom_ip","connect_dom_ip_cb","","Enter known public IP address of the Kiwi (don't include port number or use a local ip address)"))),w3_div("w3-margin-T-16",w3_label("id-connect-url-text-label w3-show-inline-block w3-margin-R-16 w3-text-teal")+w3_div("id-connect-url w3-show-inline-block w3-text-black w3-background-pale-aqua"))),n="<hr>"+w3_div("w3-container w3-text-teal|width:80%",w3_input_get("","Next Kiwi URL redirect","adm.url_redirect","w3_url_set_cfg_cb"),w3_div("w3-text-black",'Use this setting to get multiple Kiwis to respond to a single URL.<br>When all the channels of this Kiwi are busy further connection attempts will be redirected to the above URL.<br>Example: Your Kiwi is known as "mykiwi.com:8073". Configure another Kiwi to use port 8074 and be known as "mykiwi.com:8074".<br>On the port 8073 Kiwi set the above field to "http://mykiwi.com:8074".<br>On the port 8074 Kiwi leave the above field blank.<br>Configure the port 8074 Kiwi as normal (i.e. router port open, dynamic DNS, proxy etc.)<br><br><b>CAUTION:</b> Do not create a cycle by redirecting Kiwis like: A -> B -> A &nbsp;Always create a chain that stops redirecting at the end: A -> B <br>This prevents the browser from going into a loop when all channels on all Kiwis are full.')),i="<hr>"+w3_divs("/w3-tspace-8",w3_div("w3-container w3-valign",'<header class="w3-container w3-yellow"><h6>Please read these instructions before use: <a href="http://kiwisdr.com/quickstart/index.html#id-net-duc" target="_blank">dynamic DNS update client (DUC)</a></h6></header>'),w3_col_percent("w3-text-teal/w3-container",w3_div("w3-text-teal w3-bold","Dynamic DNS update client (DUC) configuration"),50,w3_div("w3-text-teal w3-bold w3-center w3-light-grey","Account at noip.com"),50),w3_col_percent("w3-text-teal/w3-container",w3_div(),50,w3_input_get("","Username or email","adm.duc_user","w3_string_set_cfg_cb","","required"),25,w3_input_get("","Password","adm.duc_pass","w3_string_set_cfg_cb","","required"),25),w3_col_percent("w3-text-teal/w3-container",w3_switch_label("w3-center","Enable DUC at startup?","Yes","No","adm.duc_enable",adm.duc_enable,"connect_DUC_enabled_cb"),20,w3_div("w3-center",w3_select("w3-width-auto","Update","","adm.duc_update",adm.duc_update,duc_update_i,"admin_select_cb")),10,w3_div("w3-center w3-tspace-8",w3_button("w3-aqua","Click to (re)start DUC","connect_DUC_start_cb"),w3_div("w3-text-black","After changing username or password click to test changes.")),20,w3_input_get("","Host","adm.duc_host","connect_DUC_host_cb","","required"),50),w3_div("w3-container",w3_label("w3-show-inline-block w3-margin-R-16 w3-text-teal","Status:")+w3_div("id-net-duc-status w3-show-inline-block w3-text-black w3-background-pale-aqua",""))),e="<hr>"+w3_divs("/w3-tspace-8",w3_div("w3-container w3-valign",'<header class="w3-container w3-yellow"><h6>Please read these instructions before use: <a href="http://p.sdrotg.com" target="_blank">reverse proxy service</a></h6></header>'),w3_text("id-proxy-menu w3-margin-left w3-valign w3-nopad w3-width-min w3-red w3-hide",'When adding or making changes to the proxy user key or host name fields <br>you must click the re-register button below AND select "Reverse proxy" <br>in the menu at the top of the page.'),w3_col_percent("w3-text-teal/w3-container",w3_div("w3-text-teal w3-bold","Reverse proxy configuration"),50,w3_div("id-proxy-hdr w3-text-teal w3-bold w3-center w3-light-grey","Proxy information for p.sdrotg.com"),50),w3_col_percent("w3-text-teal/w3-container",w3_div(),50,w3_input_get("","User key (see instructions)","adm.rev_user","connect_rev_user_cb","","required"),50),w3_col_percent("w3-text-teal/w3-container",w3_div("w3-center w3-tspace-8",w3_button("w3-aqua","Click to (re)register","connect_rev_register_cb"),w3_div("w3-text-black","After changing user key or<br>host name click to register proxy.")),50,w3_div("",w3_div("w3-show-inline-block|width:60%;",w3_input_get("","Host name: a-z, 0-9, -, _<br>(all lower case, see instructions)","adm.rev_host","connect_rev_host_cb","","required"))+w3_div("id-connect-proxy_server w3-margin-L-8 w3-show-inline-block")),50),w3_div("w3-container",w3_label("w3-show-inline-block w3-margin-R-16 w3-text-teal","Status:")+w3_div("id-connect-rev-status w3-show-inline-block w3-text-black w3-background-pale-aqua","")),w3_half("w3-margin-top w3-margin-bottom w3-text-teal","w3-container",w3_div("w3-restart",w3_input_get("id-proxy-server","Proxy server hostname","adm.proxy_server","connect_proxy_server_cb"),w3_div("w3-text-black",'Change <b>only</b> if you have implemented a private proxy server. <br>Set to "p.sdrotg.com" for the default proxy service.')),w3_div()))+"<hr>";return w3_div("id-connect w3-text-teal w3-hide",t+n+i+e)}function connect_focus(){connect.focus=1,connect_update_url(),w3_el("id-proxy-hdr").innerHTML="Proxy information for "+adm.proxy_server,ext_send("SET DUC_status_query"),w3_hide("id-proxy-menu"),cfg.sdr_hu_dom_sel==connect_dom_sel.REV&&ext_send("SET rev_status_query")}function connect_blur(){connect.focus=0}function connect_update_url(){var e=adm.duc_host&&""!=adm.duc_host,t=e?"w3-background-pale-aqua":"w3-override-yellow";w3_el("id-connect-duc-dom").innerHTML="Use domain name from DUC configuration below: "+w3_div("w3-show-inline-block w3-text-black "+t,e?adm.duc_host:"(none currently set)"),t=(e=adm.rev_host&&""!=adm.rev_host)?"w3-background-pale-aqua":"w3-override-yellow";var n=e?adm.rev_host+"."+adm.proxy_server:"(none currently set)";w3_el("id-connect-rev-dom").innerHTML="Use domain name from reverse proxy configuration below: "+w3_div("w3-show-inline-block w3-text-black "+t,n),w3_el("id-connect-proxy_server").innerHTML="."+adm.proxy_server,t=(e=config_net.pub_ip)?"w3-background-pale-aqua":"w3-override-yellow",w3_el("id-connect-pub-ip").innerHTML="Public IP address detected by Kiwi: "+w3_div("w3-show-inline-block w3-text-black "+t,e?config_net.pub_ip:"(no public IP address detected)");n=decodeURIComponent(cfg.server_url),t=n;cfg.sdr_hu_dom_sel!=connect_dom_sel.REV?(t+=":"+adm.port_ext,w3_set_label("Based on above selection, and external port from Network tab, the URL to connect to your Kiwi is:","connect-url-text")):(8073!=adm.port_ext&&(t+=" (proxy always uses port 80 even though your external port is "+adm.port_ext+")"),w3_set_label("Based on the above selection the URL to connect to your Kiwi is:","connect-url-text")),e=""!=n,w3_color("id-connect-url",null,e?"hsl(180, 100%, 95%)":"#ffeb3b"),w3_el("id-connect-url").innerHTML=e?"http://"+t:"(incomplete information)"}function connect_dom_nam_focus(){console.log("connect_dom_nam_focus server_url="+cfg.sdr_hu_dom_name),ext_set_cfg_param("cfg.server_url",cfg.sdr_hu_dom_name,EXT_NO_SAVE),ext_set_cfg_param("cfg.sdr_hu_dom_sel",connect_dom_sel.NAM,EXT_SAVE),connect_update_url()}function connect_dom_duc_focus(){console.log("connect_dom_duc_focus server_url="+adm.duc_host),ext_set_cfg_param("cfg.server_url",adm.duc_host,EXT_NO_SAVE),ext_set_cfg_param("cfg.sdr_hu_dom_sel",connect_dom_sel.DUC,EXT_SAVE),connect_update_url()}function connect_dom_rev_focus(){var e=""==adm.rev_host?"":adm.rev_host+"."+adm.proxy_server;console.log("connect_dom_rev_focus server_url="+e),ext_set_cfg_param("cfg.server_url",e,EXT_NO_SAVE),ext_set_cfg_param("cfg.sdr_hu_dom_sel",connect_dom_sel.REV,EXT_SAVE),connect_update_url()}function connect_dom_pub_focus(){console.log("connect_dom_pub_focus server_url="+config_net.pub_ip),ext_set_cfg_param("cfg.server_url",config_net.pub_ip,EXT_NO_SAVE),ext_set_cfg_param("cfg.sdr_hu_dom_sel",connect_dom_sel.PUB,EXT_SAVE),connect_update_url()}function connect_dom_sip_focus(){console.log("connect_dom_sip_focus server_url="+cfg.sdr_hu_dom_ip),ext_set_cfg_param("cfg.server_url",cfg.sdr_hu_dom_ip,EXT_NO_SAVE),ext_set_cfg_param("cfg.sdr_hu_dom_sel",connect_dom_sel.SIP,EXT_SAVE),connect_update_url()}function connect_dom_name_cb(e,t,n){connect_remove_port_and_local_ip(e,t,n,{if_ip:1}),cfg.sdr_hu_dom_sel==connect_dom_sel.NAM&&connect_dom_nam_focus()}function connect_dom_ip_cb(e,t,n){connect_remove_port_and_local_ip(e,t,n,{always:1}),cfg.sdr_hu_dom_sel==connect_dom_sel.SIP&&connect_dom_sip_focus()}function connect_remove_port_and_local_ip(e,t,n,i){for(var a=1,o=2,_=3,r=0,s=(t=t.replace("http://","").replace("https://","")).length-1;0<=s;s--){var l=t.charAt(s);if("0"<=l&&l<="9")r=a;else{if(":"==l){r==a&&(r=_);break}if(r=o,"]"==l)break}}r==_&&(t=t.substr(0,s)),i.always&&null==kiwi_inet4_d2h(t,!0)&&(t=""),i.if_ip&&null!=kiwi_inet4_d2h(t,!1)&&null==kiwi_inet4_d2h(t,!0)&&(t=""),w3_string_set_cfg_cb(e,t,n),admin_set_decoded_value(e)}function connect_DUC_enabled_cb(e,t,n){admin_bool_cb(e,0==(t=+t),n)}function connect_DUC_start_cb(e,t){var n="-u "+sq(decodeURIComponent(adm.duc_user))+" -p "+sq(decodeURIComponent(adm.duc_pass))+" -H "+sq(decodeURIComponent(adm.duc_host))+" -U "+duc_update_v[adm.duc_update];console.log("start DUC: "+n),w3_innerHTML("id-net-duc-status",w3_icon("","fa-refresh fa-spin",24)+"&nbsp; Getting status from DUC server..."),ext_send("SET DUC_start args="+encodeURIComponent(n))}function connect_DUC_host_cb(e,t,n){w3_string_set_cfg_cb(e,t,n),(cfg.sdr_hu_dom_sel==connect_dom_sel.DUC?connect_dom_duc_focus:connect_update_url)()}function connect_DUC_status_cb(e){var t;switch(e=+e,console.log("DUC_status="+e),e){case 0:t="DUC started successfully";break;case 100:t="Incorrect username or password";break;case 101:t="No hosts defined on your account at noip.com; please correct and retry";break;case 102:t="Please specify a host";break;case 103:t="Host given isn't defined on your account at noip.com; please correct and retry";break;case 300:t="DUC start failed";break;case 301:t="DUC enabled and running";break;default:t="DUC internal error: "+e}w3_el("id-net-duc-status").innerHTML=t}function connect_rev_usage(){w3_show("id-proxy-menu"),w3_scrollDown("id-kiwi-container")}function connect_rev_register_cb(e,t){if(""==adm.rev_user||""==adm.rev_host)return connect_rev_status_cb(100);connect_rev_usage(),kiwi_clearTimeout(connect.timeout),w3_innerHTML("id-connect-rev-status",w3_icon("","fa-refresh fa-spin",24)+"&nbsp; Getting status from proxy server...");var n="user="+adm.rev_user+" host="+adm.rev_host;console.log("start rev: "+n),ext_send("SET rev_register "+n)}function connect_rev_user_cb(e,t,n){connect_rev_usage(),w3_clearInnerHTML("id-connect-rev-status"),w3_string_set_cfg_cb(e,t,n)}function connect_rev_host_cb(e,t,n){connect_rev_usage(),w3_clearInnerHTML("id-connect-rev-status"),w3_string_set_cfg_cb(e,t,n),(cfg.sdr_hu_dom_sel==connect_dom_sel.REV?connect_dom_rev_focus:connect_update_url)()}function connect_rev_status_cb(e){if(connect.focus){var t;switch(e=+e,console.log("rev_status="+e),0<=e&&e<=99&&cfg.sdr_hu_dom_sel==connect_dom_sel.REV&&connect_dom_rev_focus(),e){case 0:t="Existing account, registration successful";break;case 1:t="New account, registration successful";break;case 2:t="Updating host name, registration successful";break;case 100:t="User key or host name field blank";break;case 101:t="User key invalid. Did you email your user/API key to support@kiwisdr.com as per the instructions?";break;case 102:t="Host name already in use; please choose another and retry";break;case 103:t="Invalid characters in user key or host name field (use a-z, 0-9, -, _)";break;case 200:t="Reverse proxy enabled and running";break;case 201:t="Reverse proxy enabled and pending";break;case 900:t="Problem contacting proxy server; please check Internet connection";break;case 901:t="Proxy server returned invalid status data?";break;default:t="Reverse proxy internal error: "+e}w3_innerHTML("id-connect-rev-status",t),201==e&&(connect.timeout=setTimeout(function(){ext_send("SET rev_status_query")},5e3))}}function connect_proxy_server_cb(e,t){""==(t=t.trim())&&(t="proxy.kiwisdr.com",w3_set_value("id-proxy-server",t)),w3_string_set_cfg_cb(e,t),connect_update_url()}function update_html(){return w3_div("id-update w3-hide","<hr>"+w3_div("id-msg-update w3-container")+"<hr>"+w3_div("w3-margin-bottom",w3_half("w3-container","w3-text-teal",w3_switch_label("w3-label-inline w3-label-left","Automatically check for software updates?","Yes","No","adm.update_check",adm.update_check,"admin_radio_YN_cb"),w3_switch_label("w3-label-inline w3-label-left","Automatically install software updates?","Yes","No","adm.update_install",adm.update_install,"admin_radio_YN_cb")),w3_half("w3-container w3-tspace-16","w3-text-teal",w3_div("",w3_select("/w3-label-inline/w3-width-auto","After a restart","","adm.restart_update",adm.restart_update,restart_update_u,"admin_select_cb")),w3_div("",w3_select("/w3-label-inline/w3-width-auto","After an update","","adm.update_restart",adm.update_restart,update_restart_u,"admin_select_cb"))))+w3_half("w3-container","w3-text-teal",w3_div("w3-valign","<b>Check for software update </b> "+w3_button("w3-aqua w3-margin","Check now","update_check_now_cb")),w3_div("w3-valign","<b>Force software build </b> "+w3_button("w3-aqua w3-margin","Build now","update_build_now_cb")))+"<hr>"+w3_inline("w3-halign-space-between w3-margin-bottom w3-text-teal w3-restart/w3-container",w3_divs("w3-tspace-8",w3_switch_label("w3-label-left","Disable recent changes?","Yes","No","disable_recent_changes",cfg.disable_recent_changes,"admin_radio_YN_cb"),w3_text("w3-text-black","Currently:<br><ul><li>The Firefox audio hang workaround.</li></ul>")),"")+"<hr>"+w3_div("w3-container","TODO: alt github name")+"<hr>")}var restart_update_u={0:"install updates",1:"delay updates until overnight"},update_restart_u={0:"restart server",1:"reboot Beagle"};function update_check_now_cb(e,t){ext_send("SET force_check=1 force_build=0"),w3_el("id-msg-update").innerHTML=w3_icon("","fa-refresh fa-spin",24)+" &nbsp; Checking for software update.."}function update_build_now_cb(e,t){ext_send("SET force_check=1 force_build=1"),w3_el("id-msg-update").innerHTML=w3_icon("","fa-refresh fa-spin",24)+' &nbsp; Monitor build progress using console tab, "monitor build progress" button.',0==adm.update_restart?w3_show_block("id-build-restart"):w3_show_block("id-build-reboot")}function backup_html(){return w3_div("id-backup w3-hide","<hr>",w3_div("w3-section w3-text-teal w3-bold",'Backup configuration by uploading archive to <a href="https://transfer.sh" target="_blank">Transfer.sh</a>'),w3_div("id-backup-container w3-hide","<hr>",w3_third("w3-container","w3-valign",w3_button("w3-aqua w3-margin","Click to backup","backup_sd_write"),w3_div("",w3_div("id-progress-container w3-progress-container w3-round-large w3-gray w3-show-inline-block",w3_div("id-progress w3-progressbar w3-round-large w3-light-green w3-width-zero",w3_div("id-progress-text w3-container"))),w3_div("w3-margin-T-8",w3_div("id-progress-time w3-show-inline-block")+w3_div("id-progress-icon w3-show-inline-block w3-margin-left"))),w3_div("id-sd-status class-sd-status")),"<hr>",w3_div("id-output-msg w3-container w3-text-output w3-scroll-down w3-small w3-margin-B-16")))}function backup_focus(){w3_el("id-progress-container").style.width=px(300),w3_el("id-output-msg").style.height=px(300),w3_do_when_cond(function(){return isNumber(kiwi.debian_maj)},function(){11<=kiwi.debian_maj&&w3_innerHTML("id-backup-container",w3_div("w3-container w3-text w3-red","Debian "+kiwi.debian_maj+" does not yet support the backup function.")),w3_show("id-backup-container","w3-show-inline")},null,250)}var sd_progress,backup_sd_interval,sd_progress_max=10,backup_refresh_icon=w3_icon("","fa-refresh fa-spin",20);function backup_sd_write(e,t){w3_el("id-sd-status").innerHTML="Backup in progress...",w3_el("id-progress-text").innerHTML=w3_el("id-progress").style.width="0%",sd_progress=-1,backup_sd_progress(),backup_sd_interval=setInterval(backup_sd_progress,1e3),w3_el("id-progress-icon").innerHTML=backup_refresh_icon,ext_send("SET microSD_write")}function backup_sd_progress(){var e=(++sd_progress/sd_progress_max*100).toFixed(0);e<=99&&(w3_el("id-progress-text").innerHTML=w3_el("id-progress").style.width=e+"%");var t=(sd_progress%60).toFixed(0).leadingZeros(2),e=Math.floor(sd_progress/60).toFixed(0);w3_el("id-progress-time").innerHTML=e+":"+t}function backup_sd_write_done(e){var t=w3_el("id-sd-status"),n=e?"FAILED error "+e.toString():"WORKED";1==e&&(n+="<br>Internet is not connected"),15==e&&(n+="<br>Failed to upload archive"),t.innerHTML=n,t.style.color=e?"red":"lime",e||(w3_el("id-progress-text").innerHTML=w3_el("id-progress").style.width="100%"),kiwi_clearInterval(backup_sd_interval),w3_el("id-progress-icon").innerHTML=""}var network={auto_nat_color:null,show_updating:!0,ip_blacklist_file_base:"kiwisdr.com/ip_blacklist/ip_blacklist3.cjson",ip_blacklist_check_mtime:!0,ethernet_speed_s:[["auto",1],["10 Mbps",1],["100 Mbps",1]],ESPEED_10M:1,ESPEED_ENA:1,ethernet_mtu_s:["1500 (default)","1440","1400"]};function network_html(){isDefined(adm.ip_address)||(console.log("network_html: adm.ip_address is undefined? -- initializing"),adm.ip_address={},adm.ip_address.use_static=!1,adm.ip_address.ip="",adm.ip_address.netmask="",adm.ip_address.gateway="",adm.ip_address.dns1="",adm.ip_address.dns2=""),network.ip_blacklist_file="http://"+network.ip_blacklist_file_base,network.ip_blacklist_file_SSL=kiwi_SSL()+network.ip_blacklist_file_base,network.ip_blacklist_file_SSL_mtime=kiwi_SSL()+network.ip_blacklist_file_base+".mtime";var e=ext_get_cfg_param("adm.ip_address.commit_use_static");console.log("commit_use_static="+e),isNoArg(e)&&(e=!1),adm.ip_address.use_static!=e&&(ext_set_cfg_param("adm.ip_address.use_static",e,EXT_SAVE),w3_switch_set_value("adm.ip_address.use_static",e?w3_SWITCH_NO_IDX:w3_SWITCH_YES_IDX)),network.ip_blacklist_check_mtime&&(network.ip_blacklist_double_fault=!1,kiwi_ajax(network.ip_blacklist_file_SSL_mtime,"network_blacklist_mtime_cb",0,1e4),network.ip_blacklist_check_mtime=!1),n=kiwi.platform==kiwi.PLATFORM_BB_AI64?(network.ethernet_speed_s[network.ESPEED_10M][network.ESPEED_ENA]=0,"10 Mbps setting not available <br> on BBAI-64."):"Select 10 Mbps to reduce <br> Ethernet spurs. Try changing <br> while looking at waterfall.";var t=w3_div("id-net-auto-nat-msg w3-valign w3-hide")+w3_div("id-net-need-update w3-valign w3-margin-T-8 w3-hide",w3_button("w3-yellow","Are you sure? Click to update interface DHCP/static IP configuration","network_dhcp_static_update_cb"))+"<hr>"+w3_div("id-net-reboot w3-container",w3_inline("w3-halign-space-between w3-margin-bottom w3-text-teal/",w3_divs("w3-valign w3-flex-col w3-restart/w3-tspace-6",w3_input_get("","Internal port","adm.port","admin_int_cb"),w3_input_get("","External port","adm.port_ext","admin_int_cb")),w3_divs("id-net-ssl-vis w3-hide/ w3-center w3-restart",w3_switch_label_get_param("id-net-ssl w3-center","Enable HTTPS/SSL on<br>network connections?","Yes","No","adm.use_ssl",!0,!1,"network_use_ssl_cb")),w3_divs("w3-center/",w3_select_conditional("w3-width-auto","Ethernet interface speed","","ethernet_speed",cfg.ethernet_speed,network.ethernet_speed_s,"network_ethernet_speed"),w3_div("w3-text-black",n)),w3_divs("w3-center/",w3_select("w3-width-auto","Ethernet interface MTU","","ethernet_mtu",cfg.ethernet_mtu,network.ethernet_mtu_s,"network_ethernet_mtu"),w3_div("w3-text-black","Select 1440 when having <br> connection problems <br> using 4G networks."))),w3_div("id-net-ssl-container w3-restart w3-hide",w3_inline("w3-halign-space-between w3-margin-bottom w3-text-teal/",w3_input_get("","Local port (HTTP)","adm.port_http_local","admin_int_cb"))),w3_div("id-net-static w3-hide",w3_div("",w3_third("w3-margin-B-8 w3-text-teal","w3-container",w3_input_get("","IP address (n.n.n.n where n = 0..255)","adm.ip_address.ip","network_ip_address_cb",""),w3_input_get("","Netmask (n.n.n.n where n = 0..255)","adm.ip_address.netmask","network_netmask_cb",""),w3_input_get("","Gateway (n.n.n.n where n = 0..255)","adm.ip_address.gateway","network_gw_address_cb","")),w3_third("w3-margin-B-8 w3-text-teal","w3-container",w3_div("id-network-check-ip w3-green"),w3_div("id-network-check-nm w3-green"),w3_div("id-network-check-gw w3-green")),w3_third("w3-valign w3-margin-bottom w3-text-teal","w3-container",w3_input_get("","DNS-1 (n.n.n.n where n = 0..255)","adm.ip_address.dns1","w3_string_set_cfg_cb",""),w3_input_get("","DNS-2 (n.n.n.n where n = 0..255)","adm.ip_address.dns2","w3_string_set_cfg_cb",""),w3_div("",w3_label("","<br>")+w3_button("w3-show-inline w3-aqua","Use well-known public DNS servers","net_public_dns_cb")))),w3_text("w3-margin-left w3-text-black","If DNS fields are blank the DNS servers specified by your router's DHCP will be used."))),e="<hr>"+w3_div("id-net-config w3-container")+"<hr>"+w3_half("w3-container","",w3_div("",w3_div("",w3_label("w3-show-inline w3-bold w3-text-teal","Check if your external router port is open:")+w3_button("w3-show-inline w3-aqua|margin-left:10px","Check port open","net_port_open_cb")),'Does kiwisdr.com successfully connect to your Kiwi using these URLs?<br>If both respond "NO" then check the NAT port mapping on your router.<br>If first responds "NO" and second "YES" then domain name of the first<br>isn\'t resolving to the ip address of the second. Check DNS.',w3_div("",w3_label("id-net-check-port-dom-q w3-show-inline-block w3-margin-LR-16 w3-text-teal")+w3_div("id-net-check-port-dom-s w3-show-inline-block w3-text-black w3-background-pale-aqua")),w3_div("",w3_label("id-net-check-port-ip-q w3-show-inline-block w3-margin-LR-16 w3-text-teal")+w3_div("id-net-check-port-ip-s w3-show-inline-block w3-text-black w3-background-pale-aqua"))),w3_div("w3-center w3-text-teal",w3_switch_label("w3-center","Register this Kiwi on my.kiwisdr.com<br>on each reboot?","Yes","No","adm.my_kiwi",adm.my_kiwi,"admin_radio_YN_cb"),w3_text("w3-block w3-center w3-text-black",'Registering on <a href="http://my.kiwisdr.com" target="_blank">my.kiwisdr.com</a> allows the local ip address of Kiwis <br>to be easily discovered. Set to "no" if you don\'t want your Kiwi <br>sending information to kiwisdr.com. Defaults to "yes".'))),n="<hr>"+w3_div("w3-container w3-text-teal",w3_inline("w3-valign w3-halign-space-between/",w3_div("",w3_text("w3-bold w3-text-teal","IP address blacklist"),w3_text("w3-text-black w3-show-block",'IP addresses/ranges listed here are<br>blocked from accessing your Kiwi. <br>Use CIDR notation for ranges, e.g.<br>"ip/24" is netmask "255.255.255.0".<br>More information at the '+w3_link("w3-link-darker-color","http://forum.kiwisdr.com/index.php?p=/discussion/2352/call-for-ip-address-blacklist-contributions/p1","Kiwi forum")+".")),w3_divs("/w3-center w3-tspace-8",w3_div("",w3_div("w3-margin-T-16","<b>Download IP address blacklist?</b>"),w3_text("id-ip-blacklist-new w3-text-red w3-hide","New blacklist available"),w3_inline("w3-valign w3-halign-space-evenly w3-margin-T-10/",w3_button("id-ip-blacklist-download w3-aqua","Download","network_download_button_cb"),w3_button("w3-aqua","Clear","network_download_clear_cb"))),w3_text("w3-text-black w3-center","Downloads a standard blacklist definition from<br>"+w3_link("w3-link-darker-color",network.ip_blacklist_file,"kiwisdr.com")+". A local, writeable blacklist<br>can be entered below.")),w3_switch_label("w3-center w3-margin-B-24","Automatically download<br>IP blacklist?","Yes","No","adm.ip_blacklist_auto_download",adm.ip_blacklist_auto_download,"admin_radio_YN_cb"),w3_switch_label("w3-center w3-margin-B-24","Prevent multiple connections<br>from the same IP address?","Yes","No","adm.no_dup_ip",adm.no_dup_ip,"admin_radio_YN_cb")),w3_inline("w3-valign w3-margin-top/",w3_text("w3-text-teal","Blacklist status:"),w3_div("id-ip-blacklist-status w3-margin-left w3-text-black w3-background-pale-aqua","")),w3_textarea_get_param("w3-margin-T-16//w3-light-grey|width:100%|readonly","Downloaded blacklist (read-only)","adm.ip_blacklist",8,100,"",""),w3_textarea_get_param("w3-margin-T-32//w3-input-any-change|width:100%",w3_div("w3-flex",w3_text("w3-bold  w3-text-teal","Local blacklist (writeable)"),w3_text("w3-text-black w3-margin-left",'Press enter(return) key while positioned at end of text to submit data.<br>Always add whitelist entries ("+" character before ip address) after corresponding ip range, e.g. 1.2.3.0/24 +1.2.3.22')),"adm.ip_blacklist_local",8,100,"network_user_blacklist_cb",""))+"<hr>";return w3_div("id-network w3-hide",t+e+n)}function network_ssl_container_init(){var e=dbgUs&&10<=debian_ver;w3_hide2("id-net-ssl-vis",!e);var t=e&&adm.use_ssl,e=t?" (HTTPS)":"";w3_innerHTML("id-adm.port-label","Internal port"+e),w3_innerHTML("id-adm.port_ext-label","External port"+e),w3_hide2("id-net-ssl-container",!t)}function network_use_ssl_cb(e,t,n){n||(t=0==+t,console.log("network_use_ssl_cb use_ssl="+t),admin_bool_cb(e,t),network_ssl_container_init())}function network_download_button_cb(e,t,n){n||(w3_innerHTML("id-ip-blacklist-status","updating.."+w3_icon("w3-margin-left","fa-refresh fa-spin",24)),kiwi_ajax(network.ip_blacklist_file_SSL,"network_download_blacklist_cb",0,1e4))}function network_download_clear_cb(e,t,n){network_ip_blacklist_cb("adm.ip_blacklist",""),w3_int_set_cfg_cb("adm.ip_blacklist_mtime",0)}function network_user_blacklist_cb(e,t){network_ip_blacklist_cb("adm.ip_blacklist_local",t)}function network_download_blacklist_cb(e){var t=!1;if(e?e.AJAX_error?(console.log("network_download_blacklist_cb: "+e.AJAX_error),console.log(e),t=!0):isArray(e)||(console.log("network_download_blacklist_cb: not array"),console.log(e),t=!0):(console.log("network_download_blacklist_cb: bl="+e),t=!0),t){if(network.ip_blacklist_double_fault)return console.log("network_download_blacklist_cb: default blacklist fetch FAILED"),console.log(e),void w3_innerHTML("id-ip-blacklist-status","download failed: could not contact kiwisdr.com or find default file");w3_innerHTML("id-ip-blacklist-status","download failed, using default.."+w3_icon("w3-margin-left","fa-refresh fa-spin",24)),network.show_updating=!1;t=kiwi_url_origin()+"/kiwi/ip_blacklist.default.cjson";return console.log("network_download_blacklist_cb: using default station list "+t),network.ip_blacklist_double_fault=!0,void kiwi_ajax(t,"network_download_blacklist_cb",0,1e4)}network.ip_blacklist_double_fault=!1;var _=[];e.forEach(function(e,t){var n,i,a,o;isString(e)&&(a=4294967295&~((1<<32-(i=1==(n=e.split("/")).length?32:+n[1]))-1),null!=(o=kiwi_inet4_d2h(n[0],!0))&&(o!=(e=o&a)&&console.log("ip/netmask mismatch: "+kiwi_ip_str(o)+"|"+o.toHex(8)+" "+kiwi_ip_str(e)+"|"+e.toHex(8)+" "+a.toHex(8)+"/"+i),_.push({ip:e,nm:a,nmd:i,whitelist:"+"==n[0][0]?1:0,del:0})))}),_.sort(function(e,t){return e.nm-t.nm});var o=kiwi_dup_array(_);_.forEach(function(n,i){var a=!1;o.forEach(function(e,t){a||t<=i||0==e.ip||(e.ip&n.nm)!=n.ip||e.whitelist||n.whitelist||(console.log("blacklist: #"+t+" "+kiwi_ip_str(e.ip)+"|"+e.ip.toHex(8)+" "+e.nm.toHex(8)+"/"+e.nmd+" is a subset of #"+i+" "+kiwi_ip_str(n.ip)+"|"+n.ip.toHex(8)+" "+n.nm.toHex(8)+"/"+n.nmd),e.del=1,a=!0)})});var n=[];o.forEach(function(e,t){e.del||n.push(e)}),console.log("blacklist: #"+n.length+" entries post duplicate check");var i="";n.forEach(function(e,t){i=i+" "+(e.whitelist?"+":"")+kiwi_ip_str(e.ip)+"/"+e.nmd}),network_ip_blacklist_cb("adm.ip_blacklist",i),network.show_updating=!0,kiwi_ajax(network.ip_blacklist_file_SSL_mtime,"network_blacklist_mtime_cb",1,1e4)}function network_blacklist_mtime_cb(e,t){var n=!1;isNoArg(e)?(console.log("network_blacklist_mtime_cb: mt="+e),n=!0):isObject(e)&&e.AJAX_error&&"timeout"==e.AJAX_error&&(console.log("network_blacklist_mtime_cb: TIMEOUT"),n=!0),n?console.log(e):(e=parseInt(e),dbgUs&&console.log("network_blacklist_mtime_cb: "+(t?"UPDATE":"AVAIL")+" mtime="+e+" adm.ip_blacklist_mtime="+adm.ip_blacklist_mtime),t?(w3_remove_then_add("id-ip-blacklist-download","w3-red","w3-aqua"),w3_hide2("id-ip-blacklist-new",!0),w3_int_set_cfg_cb("adm.ip_blacklist_mtime",e)):adm.ip_blacklist_mtime<e&&(w3_remove_then_add("id-ip-blacklist-download","w3-aqua","w3-red"),w3_hide2("id-ip-blacklist-new",!1)))}function network_ip_blacklist_cb(e,t){var n=/([^,;\s]+)/gm,t=t.match(n);null==t&&(t=[]);var i=[],a="";t.forEach(function(e,t){null!=kiwi_inet4_d2h(e,!0)&&(a+=e+" ",i.push(e))}),w3_set_value(e,a),w3_string_set_cfg_cb(e,a),e.endsWith("ip_blacklist_local")?(network.ip_blacklist_local=i,null==(t=decodeURIComponent(adm.ip_blacklist).match(n))&&(t=[]),network.ip_blacklist=t):(network.ip_blacklist=i,null==(t=decodeURIComponent(adm.ip_blacklist_local).match(n))&&(t=[]),network.ip_blacklist_local=t),ext_send("SET network_ip_blacklist_clear"),network.show_updating&&w3_innerHTML("id-ip-blacklist-status","updating.."+w3_icon("w3-margin-left","fa-refresh fa-spin",24)),network.seq=0,network.ip_address_error=!1,console.log("ip_blacklist:"),console.log(network.ip_blacklist),console.log("ip_blacklist_local:"),console.log(network.ip_blacklist_local),network_ip_blacklist_send({idx:0,type:0})}function network_ip_blacklist_send(e){0==e.type?e.idx==network.ip_blacklist.length?network_ip_blacklist_send({idx:0,type:1}):(ext_send("SET network_ip_blacklist="+encodeURIComponent(network.ip_blacklist[e.idx])),setTimeout(function(){network_ip_blacklist_send({idx:e.idx+1,type:0})},250)):e.idx==network.ip_blacklist_local.length?ext_send("SET network_ip_blacklist_enable"):(ext_send("SET network_ip_blacklist="+encodeURIComponent(network.ip_blacklist_local[e.idx])),setTimeout(function(){network_ip_blacklist_send({idx:e.idx+1,type:1})},250))}function network_ip_blacklist_status(e,t){console.log("network_ip_blacklist_status #"+network.seq+" status="+e+" ip="+t),network.seq++,0!=e&&(network.ip_address_error=!0,w3_innerHTML("id-ip-blacklist-status","ip address error: "+dq(t)))}function network_ethernet_speed(e,t,n){t=+t,n||admin_select_cb(e,t,n)}function network_ethernet_mtu(e,t,n){t=+t,n||admin_select_cb(e,t,n)}function network_port_open_init(){w3_do_when_rendered("id-net-check-port-dom-q",function(){var e=w3_el("id-net-check-port-dom-q"),t=cfg.sdr_hu_dom_sel==connect_dom_sel.REV?80:adm.port_ext;e.innerHTML=""!=cfg.server_url?"http://"+cfg.server_url+":"+t+" :":'(incomplete information -- on "connect" tab please use a valid setting in menu) :',w3_el("id-net-check-port-dom-s").innerHTML="",w3_el("id-net-check-port-ip-s").innerHTML=""}),w3_do_when_cond(function(){return isArg(config_net.pvt_ip)},function(){w3_el("id-net-check-port-ip-q").innerHTML="http://"+config_net.pvt_ip+":"+adm.port_ext+" :"})}function network_focus(){network_static_init(),network_port_open_init(),network_ssl_container_init(),network.status_interval=kiwi_setInterval(network_auto_nat_status_poll,2e3)}function network_blur(){kiwi_clearInterval(network.status_interval)}function network_auto_nat_status_poll(){ext_send("SET auto_nat_status_poll")}function network_auto_nat_cb(e,t,n){n||(n=0==(t=+t)?1:0,console.log("network_auto_nat_cb: path="+e+" auto_nat="+n),admin_radio_YN_cb(e,t),ext_send_after_cfg_save("SET auto_nat_set"))}function network_check_port_status_cb(e){var t;console.log("network_check_port_status_cb status="+e.toHex()),e<0?(w3_el("id-net-check-port-dom-s").innerHTML="Error checking port status",w3_el("id-net-check-port-ip-s").innerHTML="Error checking port status"):(t=240&e,e=15&e,w3_el("id-net-check-port-dom-s").innerHTML=t?"NO":"YES",w3_el("id-net-check-port-ip-s").innerHTML=e?"NO":"YES")}function net_port_open_cb(){w3_el("id-net-check-port-dom-s").innerHTML=w3_icon("","fa-refresh fa-spin",20),w3_el("id-net-check-port-ip-s").innerHTML=w3_icon("","fa-refresh fa-spin",20),ext_send("SET check_port_open")}function network_dhcp_static_update_cb(e,t){var n=adm.ip_address.use_static;n?(ext_send("SET dns dns1=x"+encodeURIComponent(adm.ip_address.dns1)+" dns2=x"+encodeURIComponent(adm.ip_address.dns2)),ext_send("SET static_ip="+kiwi_ip_str(network_ip)+" static_nm="+kiwi_ip_str(network_nm)+" static_gw="+kiwi_ip_str(network_gw))):ext_send("SET use_DHCP"),ext_set_cfg_param("adm.ip_address.commit_use_static",n,EXT_SAVE),w3_hide("id-net-need-update"),debian_ver<=9?w3_reboot_cb():admin_wait_then_reload(10,"Waiting for configuration change")}function network_static_init(){w3_do_when_rendered("id-net-static",function(){network_use_static_cb("adm.ip_address.use_static",ext_get_cfg_param("adm.ip_address.use_static",!1),!0)})}function network_use_static_cb(e,t,n){t=0==(t=+t);w3_hide2("id-net-static",t),n?(network_ip_address_cb("adm.ip_address.ip",adm.ip_address.ip,!0),network_netmask_cb("adm.ip_address.netmask",adm.ip_address.netmask,!0),network_gw_address_cb("adm.ip_address.gateway",adm.ip_address.gateway,!0)):t?w3_show_block("id-net-need-update"):network_show_update(!1),admin_bool_cb(e,t?0:1,n)}function network_ip_nm_check(e,t){var n,i,a,o,e=new RegExp("^([0-9]*).([0-9]*).([0-9]*).([0-9]*)$").exec(e);return null!=e&&(n=255<(n=parseInt(e[1]))?Math.NaN:n,i=255<(i=parseInt(e[2]))?Math.NaN:i,a=255<(a=parseInt(e[3]))?Math.NaN:a,o=255<(o=parseInt(e[4]))?Math.NaN:o),null==e||isNaN(n)||isNaN(i)||isNaN(a)||isNaN(o)?t.ok=!1:(t.ok=!0,t.a=n,t.b=i,t.c=a,t.d=o),t.ok}function network_show_update(e){(!e&&network_ip.ok&&network_nm.ok&&network_gw.ok?w3_show_block:w3_hide)("id-net-need-update")}function network_show_check(e,t,n,i,a,o,_){var r,s;""!=i&&(r=w3_el(e),s=!0,1==(e=network_ip_nm_check(i,a))&&null!=_&&(s=_(i,a)),0==e||0==s?(r.innerHTML="bad "+t+" entered",w3_remove(r,"w3-green"),w3_add(r,"w3-red")):(r.innerHTML=t+" okay, check: "+a.a+"."+a.b+"."+a.c+"."+a.d,w3_remove(r,"w3-red"),w3_add(r,"w3-green"),w3_string_set_cfg_cb(n,i,o)),network_show_update(o))}function network_ip_address_cb(e,t,n){network_show_check("network-check-ip","IP address",e,t,network_ip,n)}function network_netmask_cb(e,t,n){network_nm.nm=-1,network_show_check("network-check-nm","netmask",e,t,network_nm,n,function(e,t){var n=kiwi_inet4_d2h(e);if(null==n)return t.ok=!1;for(var i=t.nm=0;i<32;i++)if(n&1<<i)for(t.nm=32-i;i<32;i++)if(0==(n&1<<i))return t.nm=-1,t.ok=!1;return t.ok=!0}),-1!=network_nm.nm&&(w3_el("network-check-nm").innerHTML+=" (/"+network_nm.nm+")")}function network_gw_address_cb(e,t,n){network_show_check("network-check-gw","gateway",e,t,network_gw,n)}function net_public_dns_cb(e,t){w3_string_set_cfg_cb("adm.ip_address.dns1","1.1.1.1"),w3_set_value("adm.ip_address.dns1","1.1.1.1"),w3_string_set_cfg_cb("adm.ip_address.dns2","8.8.8.8"),w3_set_value("adm.ip_address.dns2","8.8.8.8")}network_ip={ok:!1,a:null,b:null,c:null,d:null},network_nm={ok:!1,a:null,b:null,c:null,d:null},network_gw={ok:!1,a:null,b:null,c:null,d:null};var gps_interval,gps_azel_interval,pin={green:w3_div("cl-leaflet-marker cl-legend-marker|background-color:lime"),red:w3_div("cl-leaflet-marker cl-legend-marker|background-color:red"),yellow:w3_div("cl-leaflet-marker cl-legend-marker|background-color:yellow")},_gps={leaflet:!0,gps_map_loaded:!1,pkgs_maps_js:["pkgs_maps/pkgs_maps.js","pkgs_maps/pkgs_maps.css"],gmap_js:["http://maps.googleapis.com/maps/api/js?key="],RSSI:0,AZEL:1,POS:2,MAP:3,IQ:4,IQ_data:null,iq_ch:0,map_init:0,map_needs_height:0,map_locate:0,map_mkr:[],legend_sep:w3_inline("",pin.green,"Navstar/QZSS only",pin.yellow,"Galileo only",pin.red,"all sats"),legend_all:w3_inline("",pin.green,"all sats (Navstar/QZSS/Galileo)")};function gps_html(){return w3_div("id-gps w3-hide|line-height:1.5",w3_inline("w3-valign w3-halign-space-between w3-margin-T-16/",w3_div("w3-valign w3-text-teal",w3_text("w3-text-teal w3-bold w3-small","Acquire"),w3_div("w3-flex-col w3-valign-start w3-margin-L-4",w3_checkbox("w3-label-inline w3-label-not-bold w3-small/w3-small","Navstar","adm.acq_Navstar",adm.acq_Navstar,"gps_acq_cb"),w3_inline("",w3_checkbox("w3-label-inline w3-label-not-bold w3-small/w3-small","QZSS","adm.acq_QZSS",adm.acq_QZSS,"gps_acq_cb"),w3_checkbox("w3-label-inline w3-label-not-bold w3-small w3-margin-left/w3-small/","Priority","adm.QZSS_prio",adm.QZSS_prio,"gps_acq_cb")),w3_checkbox("w3-label-inline w3-label-not-bold w3-small/w3-small","Galileo","adm.acq_Galileo",adm.acq_Galileo,"gps_acq_cb"))),w3_div("w3-valign w3-text-teal",w3_checkbox("w3-label-inline w3-small/w3-small","Acquire<br>if Kiwi<br>busy? [n]","adm.always_acq_gps",adm.always_acq_gps,"w3_bool_set_cfg_cb")),w3_div("w3-valign w3-text-teal",w3_checkbox("w3-label-inline w3-small/w3-small","Set date<br>from GPS?","adm.gps_set_date",adm.gps_set_date,"w3_bool_set_cfg_cb")),w3_div("w3-valign w3-text-teal",w3_checkbox("w3-label-inline w3-small/w3-small","Include<br>alerted sats in<br>solutions? [n]","adm.include_alert_gps",adm.include_alert_gps,"w3_bool_set_cfg_cb")),w3_div("w3-valign w3-text-teal",w3_checkbox("w3-label-inline w3-small/w3-small","Include<br>Galileo in<br>solutions? [y]","adm.include_E1B",adm.include_E1B,"w3_bool_set_cfg_cb")),w3_div("w3-valign w3-text-teal",w3_checkbox("w3-label-inline w3-small/w3-small","Use<br>Kalman<br>filter? [y]","adm.use_kalman_position_solver",adm.use_kalman_position_solver,"w3_bool_set_cfg_cb")),w3_div("w3-valign w3-hcenter w3-text-teal",w3_div("w3-margin-right","<b>Select<br>Graph</b>")+w3_radio_button("w3-margin-R-4","RSSI","adm.rssi_azel_iq",adm.rssi_azel_iq==_gps.RSSI,"gps_graph_cb"),w3_radio_button("w3-margin-R-4","Az/El","adm.rssi_azel_iq",adm.rssi_azel_iq==_gps.AZEL,"gps_graph_cb"),w3_radio_button("w3-margin-R-4","Pos","adm.rssi_azel_iq",adm.rssi_azel_iq==_gps.POS,"gps_graph_cb"),w3_radio_button("w3-margin-R-4","Map","adm.rssi_azel_iq",adm.rssi_azel_iq==_gps.MAP,"gps_graph_cb"),w3_radio_button("","IQ","adm.rssi_azel_iq",adm.rssi_azel_iq==_gps.IQ,"gps_graph_cb")),w3_divs("w3-hcenter w3-text-teal/w3-center",w3_div("id-gps-pos-scale w3-center w3-hide w3-small","<b>Scale</b> ",w3_select("w3-margin-L-5 w3-text-red","","","_gps.pos_scale",9,"1:20","gps_pos_scale_cb")),w3_div("id-gps-iq-ch w3-center w3-hide w3-small","<b>Chan</b> ",w3_select("w3-margin-L-5 w3-text-red","","","_gps.iq_ch",0,"1:12","gps_iq_ch_cb"))))+w3_div("w3-valign",w3_div("id-gps-loading-maps w3-container w3-section w3-card-8 w3-round-xlarge w3-pale-blue|width:100%","loading map..."),w3_div("id-gps-channels w3-container w3-section w3-card-8 w3-round-xlarge w3-pale-blue|width:100%",w3_table("id-gps-ch w3-table-6-8 w3-striped")),w3_div("id-gps-azel-container w3-hide",w3_div("w3-hcenter w3-relative",'<img id="id-gps-azel-graph" src="gfx/gpsEarth.png" width="400" height="400" style="position:absolute; top:-2px" />','<canvas id="id-gps-azel-canvas" width="400" height="400" style="position:absolute"></canvas>')),w3_div("id-gps-map-container",w3_div('||id="id-gps-map"',""),w3_div("id-gps-map-legend w3-small w3-margin-left","")))+w3_div("w3-container w3-section w3-card-8 w3-round-xlarge w3-pale-blue",w3_table("id-gps-info w3-table-6-8")))}function gps_acq_cb(e,t,n){n||(console.log("gps_acq_cb path="+e+" val="+t),w3_bool_set_cfg_cb(e,t))}function gps_graph_cb(e,t){admin_int_cb(e,t=+t),ext_send("SET gps_IQ_data_ch="+(t==_gps.IQ?_gps.iq_ch:0)),w3_show_hide("id-gps-pos-scale",t==_gps.POS),w3_show_hide("id-gps-iq-ch",t==_gps.IQ);e=w3_el("id-gps-channels");t==_gps.AZEL||t==_gps.MAP?(e.style.width="65%",w3_el("id-gps-azel-container").style.width="35%",w3_el("id-gps-map-container").style.width="35%",_gps.map_needs_height=1):e.style.width="100%",w3_show_hide("id-gps-azel-container",t==_gps.AZEL),w3_show_hide("id-gps-map-container",t==_gps.MAP),gps_update_admin_cb(),t==_gps.AZEL&&ext_send("SET gps_az_el_history")}function gps_E1B_offset_cb(e,t,n){-1==(t=+t)&&(t=4)}function gps_pos_scale_cb(e,t,n){-1!=(t=+t)&&!n||(t=9),_gps.pos_scale=t+1}function gps_iq_ch_cb(e,t,n){-1!=(t=+t)&&!n||(t=0),_gps.iq_ch=t+1,ext_send("SET gps_IQ_data_ch="+_gps.iq_ch),_gps.IQ_data=null}function gps_gain_cb(e,t,n){-1!=(t=+t)&&!n||(t=0),_gps.gain=t+1,ext_send("SET gps_gain="+_gps.gain)}var gps_has_lat_lon,gps_nsamp,gps_nsats,gps_now,gps_prn,gps_az_el_history_running=!1;function gps_schedule_azel(){0==gps_az_el_history_running&&(gps_az_el_history_running=!0,ext_send("SET gps_az_el_history"),gps_azel_interval=setInterval(function(){ext_send("SET gps_az_el_history")},6e4))}function gps_focus(e){_gps.gps_map_loaded?gps_focus2(e):(kiwi_load_js(_gps.leaflet?_gps.pkgs_maps_js:_gps.gmap_js,"gps_focus2"),_gps.gps_map_loaded=!0)}function gps_focus2(e){w3_hide("id-gps-loading-maps"),gps_schedule_azel(),ext_send("SET gps_update"),gps_interval=setInterval(function(){ext_send("SET gps_update")},1e3),gps_graph_cb("adm.rssi_azel_iq",adm.rssi_azel_iq)}function gps_blur(e){kiwi_clearInterval(gps_interval),kiwi_clearInterval(gps_azel_interval),gps_az_el_history_running=!1,ext_send("SET gps_IQ_data_ch=0")}var gps_az=null,gps_el=null,gps_qzs3_az=0,gps_qzs3_el=0,gps_shadow_map=null;function gps_az_el_history_cb(e){gps_nsats=e.n_sats,gps_nsamp=e.n_samp,gps_now=e.now,gps_prn=new Array(gps_nsats),(gps_az=new Array(gps_nsamp*gps_nsats)).fill(0),(gps_el=new Array(gps_nsamp*gps_nsats)).fill(0);for(var t=e.sat_seen.length,n=0;n<t;n++){var i=e.sat_seen[n];gps_prn[i]=e.prn_seen[n]}for(var a=0;a<gps_nsamp;a++)for(n=0;n<t;n++){var o=a*t+n,_=e.az[o],r=e.el[o],i=e.sat_seen[n],o=a*gps_nsats+i;gps_az[o]=_,gps_el[o]=r}gps_qzs3_az=e.qzs3.az,gps_qzs3_el=e.qzs3.el,gps_shadow_map=kiwi_dup_array(e.shadow_map),gps_update_azel()}var gps_canvas,SUBFRAMES=5,max_rssi=1,refresh_icon=w3_icon("","fa-refresh",20),sub_colors=["w3-red","w3-green","w3-blue","w3-yellow","w3-orange"],gps_last_good_el=[],gps_rssi_azel_iq_s=["RSSI","Az/el","Position solution map","Map","LO PLL IQ"];function gps_update_admin_cb(){if(gps){for(var e=w3_table_row("",w3_table_heads("w3-right-align","chan","acq","&nbsp;PRN","SNR","eph age","hold","wdog"),w3_table_heads("w3-center","status","subframe"),w3_table_heads("w3-right-align","ov","az","el"),adm.rssi_azel_iq==_gps.RSSI?null:w3_table_heads("w3-right-align","RSSI"),adm.rssi_azel_iq==_gps.AZEL||adm.rssi_azel_iq==_gps.MAP?null:w3_table_heads("w3-center|width:35%",(adm.rssi_azel_iq==_gps.IQ&&_gps.iq_ch?"Channel "+_gps.iq_ch+" ":"")+gps_rssi_azel_iq_s[adm.rssi_azel_iq])),t=0;t<gps.ch.length;t++)e+=w3_table_row("id-gps-ch-"+t,"");w3_el("id-gps-ch").innerHTML=e;for(var n=0==gps.stype?"w3-green":1==gps.stype?"w3-yellow":"w3-red",t=0;t<gps.ch.length;t++){var i=gps.ch[t];i.rssi>max_rssi&&(max_rssi=i.rssi);var a=0,o="";-1!=i.prn&&("N"!=i.prn_s&&(o=i.prn_s),a=i.prn);for(var _,r,s=n,l=i.alert?"A":1==i.ACF?"+":2==i.ACF?"-":"U",l=w3_table_cells("w3-right-align",t+1)+w3_table_cells("w3-center",t==gps.FFTch?refresh_icon:"")+w3_table_cells("w3-right-align",a?o+a:"",i.snr||"")+w3_table_cells("w3-right-align"+(i.old?" w3-text-red w3-bold":""),i.age)+w3_table_cells("w3-right-align",i.hold||"",i.rssi?i.wdog:"")+w3_table_cells("w3-center",'<span class="w3-tag '+(i.alert?1==i.alert?"w3-red":"w3-green":i.unlock?"w3-yellow":"w3-white")+'">'+l+'</span><span class="w3-tag '+(i.parity?"w3-yellow":"w3-white")+'">P</span><span class="w3-tag '+(i.soln?s:"w3-white")+'">S</span>'),c="",d=!1,w=SUBFRAMES-1;0<=w;w--)i.sub_renew&1<<w?r="w3-grey":(r=(_=i.sub&1<<w)?sub_colors[w]:"w3-white",_&&(d=!0)),c+='<span class="w3-tag '+r+'">'+(w+1)+"</span>";l+=w3_table_cells("w3-center",c),l+=w3_table_cells("w3-right-align",i.novfl||"",i.el?i.az:"",i.el||"",adm.rssi_azel_iq==_gps.RSSI?null:i.rssi||""),adm.rssi_azel_iq==_gps.RSSI?(s=(i.rssi/max_rssi*100).toFixed(0),O=d?"w3-light-green":"w3-red",l+=w3_table_cells("",w3_div("w3-progress-container w3-round-xlarge w3-white",w3_div("w3-progressbar w3-round-xlarge "+O+"|width:"+s+"%",w3_div("w3-container w3-text-white",i.rssi))))):adm.rssi_azel_iq==_gps.RSSI&&adm.rssi_azel_iq==_gps.AZEL&&adm.rssi_azel_iq==_gps.MAP||0==t&&(l+=w3_table_cells("|vertical-align:top;position:relative;|rowspan="+gps.ch.length,w3_div("w3-hcenter",'<canvas id="id-gps-canvas" width="400" height="400" style="position:absolute; z-index:2; pointer-events:none"></canvas>'))),w3_el("id-gps-ch-"+t).innerHTML=l}if(e=w3_table_row("",w3_table_heads("","acq","track","good","fixes","f/min","run","TTFF","UTC offset","ADC clock","lat","lon","alt","map"))+w3_table_row("",w3_table_cells("",gps.acq?"yes":"paused",gps.track||"",gps.good||"",gps.fixes?gps.fixes.toUnits():"",gps.fixes_min,gps.run,gps.ttff||"",gps.utc_offset||"",gps.adc_clk.toFixed(6)+" "+w3_span("w3-round-xlarge w3-padding-LR-6 "+(gps.is_corr?"w3-green":"w3-red"),gps.adc_corr.toUnits()),gps.lat||"",gps.lat?gps.lon:"",gps.lat?gps.alt:"",gps.lat?gps.map:"")),w3_el("id-gps-info").innerHTML=e,null!=(gps_canvas=w3_el("id-gps-canvas"))){gps_canvas.ctx=gps_canvas.getContext("2d");var p,m,g,u,b,h,f=gps_canvas.ctx;if(adm.rssi_azel_iq!=_gps.RSSI)if(!_gps.map_needs_height||(b=css_style_num(w3_el("id-gps-channels"),"height"))&&(w3_el("id-gps-azel-container").style.height=px(b-24),w3_el("id-gps-map").style.height=px(b-24),_gps.a=enc(gps.a),_gps.map_needs_height=0),adm.rssi_azel_iq!=_gps.MAP)if(adm.rssi_azel_iq!=_gps.IQ){if(adm.rssi_azel_iq==_gps.POS){N=400;if(f.fillStyle="hsl(0, 0%, 90%)",f.fillRect(0,0,N,N),_gps.POS_data){f.fillStyle="black";var k,v,x,y,S,T,E,A,M=N/2/(.001*_gps.pos_scale),I=_gps.POS_data.POS.length;f.globalAlpha=1,k=x=S=E=Number.MAX_VALUE,v=y=T=A=Number.MIN_VALUE;for(w=0;w<I&&(adm.plot_E1B||!(I/2<=w));w+=2){f.fillStyle=w<I/2?"DeepSkyBlue":"black";var R,q=_gps.POS_data.POS[w];0!=q&&(R=_gps.POS_data.POS[w+1],q-=_gps.POS_data.ref_lat,R-=_gps.POS_data.ref_lon,((P=Math.round(R*M+N/2))<0||N<=P)&&(P=P<0?0:N-1,0),((D=Math.round(-q*M+N/2))<0||N<=D)&&(D=D<0?0:N-1,0),w<I/2?(f.fillRect(P-2,D-2,5,5),v<P+8?v=P+8:P-8<k&&(k=P-8),y<D+8?y=D+8:D-8<x&&(x=D-8)):(f.fillRect(P,D-2,1,5),f.fillRect(P-2,D,5,1),T<P+8?T=P+8:P-8<S&&(S=P-8),A<D+8?A=D+8:D-8<E&&(E=D-8)))}N<=v&&(v=N-1),k<0&&(k=0),N<=y&&(y=N-1),x<0&&(x=0),line_stroke(f,0,1,"DeepSkyBlue",k,x,v,x),line_stroke(f,0,1,"DeepSkyBlue",k,y,v,y),line_stroke(f,1,1,"DeepSkyBlue",k,x,k,y),line_stroke(f,1,1,"DeepSkyBlue",v,x,v,y),adm.plot_E1B&&(N<=T&&(T=N-1),S<0&&(S=0),N<=A&&(A=N-1),E<0&&(E=0),line_stroke(f,0,1,"black",S,E,T,E),line_stroke(f,0,1,"black",S,A,T,A),line_stroke(f,1,1,"black",S,E,S,A),line_stroke(f,1,1,"black",T,E,T,A));P=16,D=N-32;f.font="15px Courier",f.fillStyle="DeepSkyBlue",f.fillRect(P-2,D-2-4,5,5),P+=12,f.fillStyle="black",f.fillText((adm.plot_E1B?" w/o Galileo span: ":"All sats span: ")+_gps.POS_data.y0span.toFixed(0).fieldWidth(4)+"m Ylat "+_gps.POS_data.x0span.toFixed(0).fieldWidth(4)+"m Xlon",P,D),adm.plot_E1B&&(P-=12,D+=18,f.fillStyle="black",f.fillRect(P,D-2-4,1,5),f.fillRect(P-2,D-4,5,1),P+=12,f.fillText("with Galileo span: "+_gps.POS_data.y1span.toFixed(0).fieldWidth(4)+"m Ylat "+_gps.POS_data.x1span.toFixed(0).fieldWidth(4)+"m Xlon",P,D))}}}else{var N=400;if(f.fillStyle="hsl(0, 0%, 90%)",f.fillRect(0,0,N,N),f.fillStyle="yellow",f.fillRect(N/2,0,1,N),f.fillRect(0,N/2,N,1),_gps.IQ_data){f.fillStyle="black";for(var M=N/2/32768*8,I=_gps.IQ_data.IQ.length,w=0;w<I;w+=2){var P,D,C=_gps.IQ_data.IQ[w],z=_gps.IQ_data.IQ[w+1];0==C&&0==z||(((P=Math.round(C*M+N/2))<0||N<=P)&&(P=P<0?0:N-1),((D=Math.round(z*M+N/2))<0||N<=D)&&(D=D<0?0:N-1),f.fillRect(P,D,2,2))}}}else if(_gps.map_init||_gps.map_needs_height||(_gps.leaflet?(maxZoom=19,p=2,(g=m=3)==0&&(h=function(e){return L.mapboxGL({attribution:'<a href="https://www.maptiler.com/license/maps/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',accessToken:"not-needed",style:"https://api.maptiler.com/maps/"+e+"/style.json"+_gps.a})}),g!=1&&g!=p||(u=g==p?"/256":"",h=function(e){return L.tileLayer("hybrid"==e?"https://api.maptiler.com/maps/"+e+u+"/{z}/{x}/{y}{r}.jpg"+_gps.a:"https://api.maptiler.com/maps/"+e+u+"/{z}/{x}/{y}.png"+_gps.a,{tileSize:g==p?256:512,zoomOffset:g==p?0:-1,attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',crossOrigin:!0})}),g==m&&(h=function(){return maxZoom=18,L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{tileSize:256,zoomOffset:0,attribution:'<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',crossOrigin:!0})}),b=h("hybrid"),_gps.map=L.map("id-gps-map",{maxZoom:maxZoom,minZoom:1}).setView([0,0],1),b.addTo(_gps.map),g!=m&&L.control.layers({Satellite:b,Basic:h("basic"),Bright:h("bright"),Positron:h("positron"),Street:h("streets"),Topo:h("topo")},null).addTo(_gps.map)):(K=new google.maps.LatLng(0,0),h=w3_el("id-gps-map"),_gps.map=new google.maps.Map(h,{zoom:1,center:K,navigationControl:!1,mapTypeControl:!1,streetViewControl:!1,mapTypeId:google.maps.MapTypeId.SATELLITE})),_gps.map_init=1),w3_innerHTML("id-gps-map-legend",adm.plot_E1B?_gps.legend_sep:_gps.legend_all),_gps.MAP_data&&_gps.map_init){_gps.map_locate||(_gps.leaflet?_gps.map.setView([_gps.MAP_data.ref_lat,_gps.MAP_data.ref_lon],15,{duration:0,animate:!1}):(K=new google.maps.LatLng(_gps.MAP_data.ref_lat,_gps.MAP_data.ref_lon),_gps.map.panTo(K),_gps.map.setZoom(18)),_gps.map_locate=1);for(var H=_gps.MAP_data.MAP.length,U=0;U<H;U++){var B=_gps.MAP_data.MAP[U],O=0==B.nmap?_gps.leaflet?"lime":"green":1==B.nmap?"red":"yellow";if(_gps.leaflet){var F=L.divIcon({className:"fooLM",iconAnchor:[12,12],labelAnchor:[-6,0],popupAnchor:[0,-36],html:'<span class="cl-leaflet-marker" style="background-color:'+O+';"/>'});for((F=L.marker([B.lat,B.lon],{icon:F,opacity:1})).addTo(_gps.map),_gps.map_mkr.push(F);12<_gps.map_mkr.length;)_gps.map_mkr.shift().remove()}else{var K=new google.maps.LatLng(B.lat,B.lon),F=new google.maps.Marker({position:K,icon:"http://maps.google.com/mapfiles/ms/icons/"+O+"-dot.png",map:_gps.map});for(_gps.map_mkr.push(F);12<_gps.map_mkr.length;)_gps.map_mkr.shift().setMap(null)}}_gps.MAP_data=null}}}}function gps_update_azel(){if(adm.rssi_azel_iq==_gps.AZEL&&null!=gps_el){var e=w3_el("id-gps-azel-canvas");if(null!=e){e.ctx=e.getContext("2d");var t=e.ctx,n=200;if(t.clearRect(0,0,400,400),adm.rssi_azel_iq==_gps.AZEL&&gps_shadow_map){t.fillStyle="cyan",t.globalAlpha=.1;for(var a=2*(h=4)+1,o=0;o<360;o++)for(var _=o*Math.PI/180,r=gps_shadow_map[o],s=0,l=1;s<32;s++,l<<=1)r&l&&(p=(90-(w=s/31*90))/90*180,m=Math.round(p*Math.sin(_)),g=Math.round(p*Math.cos(_)),t.fillRect(m+n-h-1,n-g-h-1,a+2,a+2));t.globalAlpha=1}t.strokeStyle="black",t.miterLimit=2,t.lineJoin="circle",t.font="13px Verdana",0<gps_qzs3_el&&(_=gps_qzs3_az*Math.PI/180,p=(90-gps_qzs3_el)/90*180,m=Math.round(p*Math.sin(_)),m+=n,g=n-(g=Math.round(p*Math.cos(_))),t.lineWidth=1,t.beginPath(),t.arc(m,g,10,0,2*Math.PI),t.stroke(),m=12,g=30,t.lineWidth=1,t.beginPath(),t.arc(m,g,10,0,2*Math.PI),t.stroke(),t.fillStyle="black",t.lineWidth=1,t.fillText("QZS-3",m+16,g+4)),t.fillStyle="black";for(var c=0;c<gps_nsats;c++)gps_last_good_el[c]=-1;for(var d=gps_nsamp-10;-1<=d;d--)for(c=0;c<gps_nsats;c++){var w,p,m,g,u,b,h,f=-1==d?gps_last_good_el[c]:d;-1==d&&-1==f||((b=gps_now-f)<0&&(b+=gps_nsamp),i=b*gps_nsats+c,o=gps_az[i],0!=(w=gps_el[i])&&(gps_last_good_el[c]=d,_=o*Math.PI/180,p=(90-w)/90*180,m=Math.round(p*Math.sin(_)),g=Math.round(p*Math.cos(_)),-1==d?(u=gps_prn[c],b=t.measureText(u).width,b=o<=180?-b-8:8,t.fillStyle=1<f?"pink":"yellow",t.lineWidth=3,t.strokeText(u,m+b+n,n-g+5),t.lineWidth=1,t.fillText(u,m+b+n,n-g+5),a=2*(h=3)+1,t.fillStyle="black",t.fillRect(m+n-h-1,n-g-h-1,a+2,a+2),t.fillStyle=1<f?"red":"yellow",t.fillRect(m+n-h,n-g-h,a,a)):(t.fillStyle="black",t.fillRect(m+n,n-g,2,2))))}}}}var log_interval,log={},nlog=256;function log_html(){return w3_div("id-log w3-text-teal w3-hide","<hr>"+w3_div("w3-container",w3_inline("w3-valign w3-halign-space-between/",w3_div("",w3_label("w3-show-inline","KiwiSDR server log (scrollable list, first and last set of messages)"),w3_button("w3-aqua|margin-left:10px","Log state","log_state_cb"),w3_button("w3-aqua|margin-left:10px","Log IP blacklist","log_blacklist_cb"),w3_button("w3-blue|margin-left:10px","Clear Histogram","log_clear_hist_cb")),w3_switch_label("w3-label-inline w3-label-left","Log connections from local ip addresses?","Yes","No","adm.log_local_ip",adm.log_local_ip,"admin_radio_YN_cb")),w3_div("id-log-msg w3-margin-T-8 w3-text-output w3-small w3-text-black","")))}function log_setup(){for(var e=w3_el("id-log-msg"),t="<pre>",n=0;n<nlog;n++)n==nlog/2&&(t+='<code id="id-log-not-shown"></code>'),t+='<code id="id-log-'+n+'"></code>';t+="</pre>",e.innerHTML=t,ext_send("SET log_update=1")}function log_state_cb(e,t){ext_send("SET log_state")}function log_blacklist_cb(e,t){ext_send("SET log_blacklist")}function log_clear_hist_cb(e,t){ext_send("SET log_clear_hist")}function log_resize(){var e,t=w3_el("id-log-msg");t&&(e=window.innerHeight-w3_el("id-admin-header-container").clientHeight-100,t.style.height=px(e))}function log_focus(e){log_resize(),log_update(),log_interval=setInterval(log_update,3e3)}function log_blur(e){kiwi_clearInterval(log_interval)}function log_update(){ext_send("SET log_update=0")}function console_html(){return admin.console={scroll_only_at_bottom:!0,inline_returns:!0,process_return_alone:!1,remove_returns:!1,rows:10,cols:140,show_cursor:!0,is_char_oriented:!1},admin.console.isMobile=kiwi_isMobile(),admin.console.always_char_oriented=!admin.console.isMobile,w3_div("id-console w3-margin-top w3-text-teal w3-hide",w3_div("w3-container",w3_div("",w3_label("w3-show-inline","Beagle Debian console"),w3_button("w3-aqua|margin-left:10px","Connect","console_connect_cb"),w3_button("w3-green|margin-left:32px","monitor build progress","console_cmd_cb","console_input_cb|tail -fn 500 /root/build.log"),w3_button("w3-aqua|margin-left:16px","htop","console_cmd_cb","console_input_cb|htop"),w3_button("w3-yellow|margin-left:16px","disk free","console_cmd_cb","console_input_cb|df ."),w3_button('w3-red|margin-left:16px|title="CAUTION: Do not use unless git clone in\n&slash;root&slash;Beagle_SDR_GPS has become corrupted"',"re-clone sources","console_reclone_confirm"),w3_button("w3-blue|margin-left:16px","check github","console_cmd_cb","console_input_cb|cdp; git show origin:Makefile &vbar; head -n 2"),w3_button("w3-blue|margin-left:16px","ping DNS","console_cmd_cb","console_input_cb|ping -c3 1.1.1.1; ping -c3 8.8.8.8"),w3_button("w3-blue|margin-left:16px","ping kiwisdr","console_cmd_cb","console_input_cb|ping -c3 kiwisdr.com")),w3_div("id-console-msg w3-margin-T-8 w3-text-output w3-scroll-always-y w3-scroll-down w3-small w3-text-black|background-color:#a8a8a8",'<pre><code id="id-console-msgs"></code></pre>'),admin.console.always_char_oriented?w3_text("id-console-debug w3-text-black w3-margin-T-8","New scheme: After connecting just start typing. Keyboard input appears immediately in console window."):w3_div("id-console-line",admin.console.isMobile?w3_inline("w3-margin-T-8 w3-halign-space-between/",w3_input("w3-width-half//id-console-line-input w3-input-any-key","","console_input","","console_input_cb|console_key_cb","enter shell command"),w3_inline("w3-margin-R-16/",w3_button("w3-yellow","Send ^C","console_ctrl_button_cb","c"),w3_button("w3-blue|margin-left:10px","Send ^D","console_ctrl_button_cb","d"),w3_button("w3-red|margin-left:10px","Send ^\\","console_ctrl_button_cb","<"),w3_button("w3-blue|margin-left:10px","Send ^P","console_ctrl_button_cb","p"),w3_button("w3-blue|margin-left:10px","Send ^N","console_ctrl_button_cb","n"))):w3_div("w3-margin-T-8",w3_input("id-console-line-input w3-input-any-key","","console_input","","console_input_cb|console_key_cb","enter shell command"),w3_text("id-console-debug w3-text-black w3-margin-T-8","Control characters (^C, ^D, ^\\) and empty lines may now be typed directly into shell command field.")))))}function console_reclone_confirm(e){control_confirm_show("Really re-clone?",function(){console_cmd_cb("console_reclone_confirm","console_input_cb|cd /root; rm -rf Beagle_SDR_GPS; git clone https://github.com/jks-prv/Beagle_SDR_GPS.git"),control_confirm_cancel_cb()})}function console_is_char_oriented(e){var t;e=isDefined(e)?e:admin.console.always_char_oriented,admin.console.is_char_oriented=e,admin.console.always_char_oriented||(w3_disable("id-console-line",e),t=w3_el("id-console-line-input"),e?t.blur():t.focus())}function console_input_cb(e,t){admin.console.is_char_oriented||(ext_send("SET console_w2c="+encodeURIComponent(t+"\n")),w3_set_value(e,""),w3_scrollDown("id-console-msg"))}function console_key_cb(e,t){if(t=t||!1,e&&e.key){var n=e.key,i=ord(n),a=31&i;if(admin.console.is_char_oriented){if(!e.metaKey){if(t)return;var o=n,_=!0,r=!1;1==n.length?o=n:"Enter"==n?(o="\r",r=!0):"Backspace"==n?(o="",r=!0):"Tab"==n?(o="\t",r=!0):"Escape"==n?(o="",r=!0):"ArrowUp"==n?o="OA":"ArrowDown"==n?o="OB":"ArrowRight"==n?o="OC":"ArrowLeft"==n?o="OD":"F1"==n?o="OP":"F2"==n?o="OQ":"F3"==n?o="OR":"F4"==n?o="OS":"F5"==n?o="[15~":"F6"==n?o="[17~":"F7"==n?o="[18~":"F8"==n?o="[19~":"F9"==n?o="[20~":"F10"==n?o="[21~":_=!1,r&&(a=31&(i=ord(o)));i=e.ctrlKey;_&&(i?a<=255&&ext_send("SET console_oob_key="+a):ext_send("SET console_w2c="+encodeURIComponent(o)),admin.console.must_scroll_down=!0)}}else{if(!t)return;var t=n.toUpperCase(),_=!0;e.ctrlKey&&"CDPN\\".includes(t)||("ArrowUp"==n?n="OA":"ArrowDown"==n?n="OB":"ArrowRight"==n?n="OC":"ArrowLeft"==n?n="OD":_=!1),_&&(e.ctrlKey?a<=255&&ext_send("SET console_oob_key="+a):ext_send("SET console_w2c="+encodeURIComponent(n)),w3_scrollDown("id-console-msg"))}e.metaKey||e.preventDefault()}}function console_ctrl_button_cb(e,t){console.log("console_ctrl_button_cb ch="+ord(t)),ext_send("SET console_oob_key="+(31&ord(t)))}function console_calc_rows_cols(e){var t=parseInt(w3_el("id-console-msg").style.height)-25,n=t/15.6,t=Math.floor(n);n=parseInt(w3_el("id-console-msg").style.width)-25,n/=7.4,n=Math.floor(n);256<n&&(n=256),!e&&t==admin.console.rows&&n==admin.console.cols||(admin.console.init=!1,ext_send("SET console_rows_cols="+t+","+n),admin.console.rows=t,admin.console.cols=n)}function console_connect_cb(e){admin.console_open||(ext_send("SET console_open"),console_calc_rows_cols(1),console_is_char_oriented(),admin.console_open=!0)}function console_cmd_cb(e,n){var t=1;admin.console_open||(ext_send("SET console_open"),console_calc_rows_cols(1),console_is_char_oriented(),admin.console_open=!0,t=1e3),setTimeout(function(){var e=n.split("|"),t=e[0],e=e[1];admin.console.is_char_oriented?(e=e.replace("&vbar;","|"),ext_send("SET console_w2c="+encodeURIComponent(e+"\n")),w3_scrollDown("id-console-msg")):w3_input_force("id-console-line-input",t,e)},t)}function console_resize(){var e,t=w3_el("id-console-msg");t&&(e=window.innerHeight-w3_el("id-admin-header-container").clientHeight-(admin.console.always_char_oriented?110:admin.console.isMobile?120:150),t.style.height=px(e),e=window.innerWidth-65,t.style.width=px(e),console_calc_rows_cols())}function console_focus(e){document.addEventListener("keydown",console_key_cb,!1),console_resize()}function console_blur(e){document.removeEventListener("keydown",console_key_cb,!1)}function security_html(){for(var e=ext_get_cfg_param("chan_no_pwd",0),e=Math.min(e,rx_chans-1),t={0:"none"},n=1;n<rx_chans;n++)t[n]=n.toFixed(0);var i="<hr>"+w3_inline_percent("w3-container/w3-hspace-16 w3-text-teal",w3_div("",w3_switch_label("","User auto-login from local net<br>even if password set?","Yes","No","adm.user_auto_login",adm.user_auto_login,"admin_radio_YN_cb")),25,w3_div("w3-center",w3_select("w3-width-auto","Number of channels<br>not requiring a password<br>even if password set","","chan_no_pwd",e,t,"admin_select_cb"),w3_div("w3-margin-T-8 w3-text-black","Set this and a password to create two sets of channels. Some that have open-access requiring no password and some that are password protected.")),30,w3_div(""),1,w3_div("",w3_input("w3-encrypted","User password","adm.user_password","","security_set_upw_cb","No password set: unrestricted Internet access to SDR")),40)+"<hr>"+w3_inline_percent("w3-container/w3-hspace-16 w3-text-teal",w3_div("",w3_switch_label("","Admin auto-login from local net<br>even if password set?","Yes","No","adm.admin_auto_login",adm.admin_auto_login,"admin_radio_YN_cb")),25,w3_div("w3-text-teal",""),30,w3_div(""),1,w3_div("",w3_input("w3-encrypted","Admin password","adm.admin_password","","security_set_apw_cb","No password set: no admin access from Internet allowed")),40),a="<hr>"+w3_inline_percent("w3-container/w3-hspace-16 w3-text-teal",w3_div("",w3_switch_label("","Allow GPS timestamp information <br> to be sent on the network?","Yes","No","adm.GPS_tstamp",adm.GPS_tstamp,"admin_radio_YN_cb")),25,w3_div("w3-text-black",'Set to "No" to prevent timestamp information from your GPS (assuming it is working) from being used by applications on the Internet such as the TDoA service. You would only do this if you had some concern about your publicly-listed Kiwi participating in these kinds of projects. '),33,w3_div("w3-text-black"),1,w3_div("w3-text-black","However we expect most Kiwi owners will want to participate and we encourage you to do so. Your precise GPS location is not revealed by the timestamp information. For more discussion please see the "+w3_link("w3-link-darker-color","http://forum.kiwisdr.com/discussion/1218/participation-of-kiwis-in-the-tdoa-process/p1","Kiwi forum")+"."),33),e="<hr>"+w3_inline_percent("w3-container/w3-hspace-16 w3-text-teal",w3_div("",w3_switch_label("","Automatically reload admin page <br> if server stops responding?","Yes","No","adm.admin_keepalive",adm.admin_keepalive,"admin_radio_YN_cb")),25,w3_div("w3-text-black",'Default "Yes". If set to "No" only a warning message will be displayed if the Kiwi server or network closes the connection.'),33,w3_div("w3-text-black"),1,w3_div("w3-text-black",""),33)+"<hr>";return w3_div("id-security w3-hide",i+a+e)}function security_focus(e){admin_set_decoded_value("adm.user_password"),admin_set_decoded_value("adm.admin_password")}function security_set_upw_cb(e,t,n){adm.user_pwd_seq=+adm.user_pwd_seq+1,w3_string_set_cfg_cb(e,t,n)}function security_set_apw_cb(e,t,n){adm.admin_pwd_seq=+adm.admin_pwd_seq+1,w3_string_set_cfg_cb(e,t,n)}var admin_colors=["w3-hover-red","w3-hover-blue","w3-hover-purple","w3-hover-black","w3-hover-aqua","w3-hover-pink","w3-hover-yellow","w3-hover-amber","w3-hover-green","w3-hover-orange","w3-hover-grey","w3-hover-lime","w3-hover-indigo","w3-hover-brown","w3-hover-teal","w3-hover-blue-grey"];function admin_main(){ext_send("SET browser="+navigator.userAgent),window.addEventListener("resize",admin_resize)}function admin_resize(){log_resize(),console_resize()}function kiwi_ws_open(e,t,n){return open_websocket(e,t,n,admin_msg,admin_recv,null,admin_close)}function admin_draw(e){var t=w3_el("id-admin"),n=0,i="";e||(i+=w3_nav(admin_colors[n++],"GPS","gps","admin_nav")),i+=w3_nav(admin_colors[n++],"Status","status","admin_nav")+w3_nav(admin_colors[n++],"Mode","mode","admin_nav")+w3_nav(admin_colors[n++],"Control","control","admin_nav")+w3_nav(admin_colors[n++],"Connect","connect","admin_nav"),e&&(i+=w3_nav(admin_colors[n++],"Config","config","admin_nav")+w3_nav(admin_colors[n++],"Webpage","webpage","admin_nav")+w3_nav(admin_colors[n++],"Public","sdr_hu","admin_nav")+w3_nav(admin_colors[n++],"DX","dx","admin_nav")),i+=w3_nav(admin_colors[n++],"Backup","backup","admin_nav")+w3_nav(admin_colors[n++],"Network","network","admin_nav")+(e?w3_nav(admin_colors[n++],"GPS","gps","admin_nav"):"")+w3_nav(admin_colors[n++],"Log","log","admin_nav")+(e?w3_nav(admin_colors[n++],"Extensions","extensions","admin_nav"):"")+w3_nav(admin_colors[n++],"Security","security","admin_nav"),t.innerHTML=w3_div("id-admin-header-container",'<header class="w3-container w3-teal"><h5>Admin interface</h5></header>'+w3_navbar("w3-border w3-light-grey",i)+w3_divs("id-confirm w3-hide/w3-valign",'<header class="id-confirm-msg w3-show-inline-block w3-container w3-red"></header>'+w3_div("w3-show-inline-block",w3_button("w3-green w3-margin-L-16","Confirm","control_confirm_cb"))+w3_div("w3-show-inline-block",w3_button("w3-yellow w3-margin-L-16","Cancel","control_confirm_cancel_cb")))+w3_divs("id-restart w3-hide/w3-valign",'<header class="w3-show-inline-block w3-container w3-red"><h5>Restart required for changes to take effect</h5></header>'+w3_div("w3-show-inline-block",w3_button("w3-green w3-margin-L-16","KiwiSDR server restart","admin_restart_now_cb"))+w3_div("w3-show-inline-block",w3_button("w3-yellow w3-margin-L-16","Cancel","admin_restart_cancel_cb")))+w3_divs("id-reboot w3-hide/w3-valign",'<header class="w3-show-inline-block w3-container w3-red"><h5>Reboot required for changes to take effect</h5></header>'+w3_div("w3-show-inline-block",w3_button("w3-green w3-margin-L-16","Beagle reboot","admin_reboot_now_cb"))+w3_div("w3-show-inline-block",w3_button("w3-yellow w3-margin-L-16","Cancel","admin_reboot_cancel_cb")))+w3_div("id-build-restart w3-valign w3-hide",'<header class="w3-container w3-blue"><h5>Server will restart after build</h5></header>')+w3_div("id-build-reboot w3-valign w3-hide",'<header class="w3-container w3-red"><h5>Beagle will reboot after build</h5></header>')+w3_div("id-admin-closed w3-valign w3-hide",'<header class="w3-container w3-red"><h5>Warning: Admin connection closed</h5></header>')),i=e?status_html():gps_html()+status_html(),i+=mode_html()+control_html()+connect_html(),e&&(i+=config_html()+webpage_html()+kiwi_reg_html()+dx_html()),i+=update_html()+backup_html()+network_html()+(e?gps_html():"")+log_html()+console_html()+(e?extensions_html():"")+security_html(),t.innerHTML+=i,log_setup(),stats_init(),e?users_init({admin:1}):gps_focus(),w3_show_block("id-admin");e=e?"status":"gps";admin.init=!0,w3_click_nav(kiwi_toggle(toggle_e.FROM_COOKIE|toggle_e.SET,e,e,"last_admin_navbar"),"admin_nav"),admin.init=!1,setTimeout(function(){setInterval(status_periodic,5e3)},1e3)}function admin_nav_focus(e,t){admin.current_tab_name=e,w3_click_nav(e,e),writeCookie("last_admin_navbar",e)}function admin_nav_blur(e,t){w3_call(e+"_blur")}function admin_close(){kiwi_clearTimeout(admin.keepalive_timeoout),admin.no_admin_reopen_retry?(w3_hide("id-kiwi-msg-container"),w3_show_block("id-kiwi-container"),admin_wait_then_reload(0,"Server has closed connection.")):isUndefined(adm.admin_keepalive)||1==adm.admin_keepalive?admin.reload_rem||admin.long_running||(w3_hide("id-kiwi-msg-container"),w3_show_block("id-kiwi-container"),admin_wait_then_reload(60,"Server has closed connection. Will retry.")):(w3_show_block("id-admin-closed"),w3_scrollTop("id-kiwi-container"))}var gps=null;function admin_msg(e){switch(e[0]){case"gps_update_cb":gps=kiwi_JSON_parse("gps_update_cb",decodeURIComponent(e[1])),w3_call("gps_update_admin_cb");break;case"gps_IQ_data_cb":_gps.IQ_data=kiwi_JSON_parse("gps_IQ_data_cb",decodeURIComponent(e[1]));break;case"gps_POS_data_cb":_gps.POS_data=kiwi_JSON_parse("gps_POS_data_cb",decodeURIComponent(e[1]));break;case"gps_MAP_data_cb":_gps.MAP_data=kiwi_JSON_parse("gps_MAP_data_cb",decodeURIComponent(e[1]));break;case"gps_az_el_history_cb":var t=kiwi_JSON_parse("gps_az_el_history_cb",decodeURIComponent(e[1]));t&&w3_call("gps_az_el_history_cb",t);break;case"dx_size":dx_size(e[1]);break;case"admin_mkr":t=e[1],t=kiwi_JSON_parse("admin_mkr",t);t&&dx_render(t);break;case"mkr_search_pos":dx_search_pos_cb(e[1]);break;case"keepalive":kiwi_clearTimeout(admin.keepalive_timeoout),adm.admin_keepalive&&(admin.keepalive_rx_time=Date.now(),admin.keepalive_timeoout=setTimeout(function(){75e3<Date.now()-admin.keepalive_rx_time&&admin_close()},9e4));break;default:return!1}return!0}var log_msg_idx,log_msg_not_shown=0,admin_sdr_mode=1;function admin_recv(e){for(var t=arrayBufferToString(e).substring(4).split(" "),n=0;n<t.length;n++){var i=t[n].split("=");switch(i[0]){case"admin_sdr_mode":admin_sdr_mode=+i[1]?1:0;break;case"is_multi_core":admin.is_multi_core=!0;break;case"init":rx_chans=rx_chan=+i[1],admin_draw(admin_sdr_mode),ext_send("SET extint_load_extension_configs");break;case"ext_call":var a=decodeURIComponent(i[1]).split("="),o=a[0],_=1<a.length?a[1]:null;w3_call(o,_);break;case"public_update":public_update(i[1]);break;case"auto_nat":var r,s,l=+i[1],c=w3_el("id-net-auto-nat-msg"),d="add";switch(l){case 0:break;case 1:r="succeeded",s="w3-green";break;case 2:r="no device found",s="w3-orange";break;case 3:r="rule already exists",s="w3-yellow";break;case 4:r="command failed",s="w3-red";break;case 5:r="pending",s="w3-yellow";break;case 6:r="pending",s="w3-yellow",d="delete";break;case 7:r="succeeded",s="w3-green",d="delete"}l&&c&&(c.innerHTML='<header class="w3-container"><h5>Automatic '+d+" of NAT rule on firewall / router: "+r+"</h5></header>",w3_remove_then_add(c,network.auto_nat_color,s),network.auto_nat_color=s,w3_show_block(c));break;case"log_msg_not_shown":(log_msg_not_shown=parseInt(i[1]))&&((c=w3_el("id-log-not-shown")).innerHTML="---- "+log_msg_not_shown.toString()+" lines not shown ----\n");break;case"log_msg_idx":log_msg_idx=parseInt(i[1]);break;case"log_msg_save":if(!(c=w3_el("id-log-"+log_msg_idx)))break;a=w3_el("id-log-msg"),o=w3_isScrolledDown(a),_=kiwi_decodeURIComponent("log_msg_save",i[1]).replace(/</g,"&lt;").replace(/>/g,"&gt;");c.innerHTML=_,w3_scrollDown(a,o);break;case"log_update":log_update(i[1]);break;case"microSD_done":backup_sd_write_done(parseFloat(i[1]));break;case"DUC_status":connect_DUC_status_cb(parseFloat(i[1]));break;case"rev_status":connect_rev_status_cb(parseFloat(i[1]));break;case"check_port_status":network_check_port_status_cb(parseInt(i[1]));break;case"console_c2w":admin.console.s=i[1],kiwi_output_msg("id-console-msgs","id-console-msg",admin.console);break;case"console_done":console.log("## console_done");break;case"config_clone_status":config_clone_status_cb(parseInt(i[1]));break;case"network_ip_blacklist_status":l=decodeURIComponent(i[1]).split(","),network_ip_blacklist_status(parseInt(l[0]),l[1]);break;case"network_ip_blacklist_enabled":network.ip_address_error||w3_innerHTML("id-ip-blacklist-status","updated");break;default:console.log("ADMIN UNKNOWN: "+i[0]+"="+i[1])}}}function w3_restart_cb(){w3_show_block("id-restart"),w3_scrollTop("id-kiwi-container")}function w3_reboot_cb(){w3_show_block("id-reboot"),w3_scrollTop("id-kiwi-container")}function admin_draw_pie(){if(w3_el("id-admin-reload-secs").innerHTML="Admin page reload in "+admin.reload_rem+" secs",0<admin.reload_rem)admin.reload_rem--,kiwi_draw_pie("id-admin-pie",admin.pie_size,(admin.reload_secs-admin.reload_rem)/admin.reload_secs);else try{window.location.reload(!0)}catch(e){console.log("RELOAD FAILED?"),console.log(e)}}function admin_wait_then_reload(e,t){var n=w3_el("id-admin"),i=e?w3_divs("w3-valign w3-margin-T-8/w3-container",w3_div("w3-show-inline-block",kiwi_pie("id-admin-pie",admin.pie_size,"#eeeeee","deepSkyBlue")),w3_div("w3-show-inline-block",w3_div("id-admin-reload-msg"),w3_div("id-admin-reload-secs"))):w3_divs("w3-valign w3-margin-T-8/w3-container",w3_div("id-admin-reload-msg")),i='<header class="w3-container w3-teal"><h5>Admin interface</h5></header>'+i;n.innerHTML=i,t&&(w3_el("id-admin-reload-msg").innerHTML=t),e&&(admin.reload_rem=admin.reload_secs=e,setInterval(admin_draw_pie,1e3),admin_draw_pie())}function admin_restart_now_cb(){ext_send("SET restart"),admin_wait_then_reload(60,"Restarting KiwiSDR server")}function admin_restart_cancel_cb(){w3_hide("id-restart"),w3_call(admin.current_tab_name+"_restart_cancel_cb")}function admin_reboot_now_cb(){ext_send("SET reboot"),admin_wait_then_reload(90,"Rebooting Beagle")}function admin_reboot_cancel_cb(){w3_hide("id-reboot")}function admin_int_cb(e,t,n){console.log("admin_int_cb "+e+"="+t+" save="+void 0),t=parseInt(t),isNaN(t)?t=ext_get_cfg_param(e):(n=!isArg(n)||!n,ext_set_cfg_param(e,t,n)),w3_set_value(e,t)}function admin_float_cb(e,t,n,i){var a=-1;i&&2<=i.length&&(a=+i[1],isNaN(a)&&(a=-1)),t=parseFloat(t),isNaN(t)?t=ext_get_cfg_param(e):(-1!=a&&(t=+t.toFixed(a)),n=!isArg(n)||!n,ext_set_cfg_param(e,t,n)),w3_set_value(e,t)}function admin_bool_cb(e,t,n){n=!isArg(n)||!n;ext_set_cfg_param(e,!!t,n)}function admin_set_decoded_value(e){var t=ext_get_cfg_param(e);w3_set_decoded_value(e,t)}function admin_radio_YN_cb(e,t){admin_bool_cb(e,t?0:1)}function admin_select_cb(e,t,n){-1!=(t=+t)&&(n=!isArg(n)||!n,ext_set_cfg_param(e,t,n))}function admin_slider_cb(e,t,n,i){n&&!i&&(t=+t,ext_set_cfg_param(e,t,EXT_SAVE))}function admin_preview_status_box(e,t){t=kiwi_decodeURIComponent("admin_preview_status_box:"+e,t);return t&&""!=t||(t="&nbsp;"),t}